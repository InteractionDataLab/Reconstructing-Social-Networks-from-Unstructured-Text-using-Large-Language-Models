<HTML xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki  ltr ns-0 ns-subject page-Team_SYSU-China_temp_SpryDOMEffects_js"><DIV id="globalWrapper"><DIV id="top-section"><DIV id="p-logo"><A href="/Main_Page" title="Main Page">&quot;
	    </A></DIV><DIV id="menubar" class="left-menu noprint"><UL><LI class="selected"><A href="/Team:SYSU-China/temp/SpryDOMEffects.js">Page               </A></LI><LI class="new"><A href="/wiki/index.php?title=Talk:Team:SYSU-China/temp/SpryDOMEffects.js&amp;action=edit&amp;redlink=1">Discussion               </A></LI><LI><A href="/wiki/index.php?title=Team:SYSU-China/temp/SpryDOMEffects.js&amp;action=edit">View source               </A></LI><LI><A href="/wiki/index.php?title=Team:SYSU-China/temp/SpryDOMEffects.js&amp;action=history">History               </A></LI><LI style="color:#808080;cursor:default">teams</LI></UL></DIV><DIV class="right-menu noprint" id="menubar"><UL><LI id="pt-login"><A href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Team:SYSU-China/temp/SpryDOMEffects.js" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</A></LI></UL></DIV><DIV id="search-controls" class="noprint"><FORM action="/Special:Search" id="searchform"> </FORM></DIV></DIV><DIV id="content"><H1 class="firstHeading">Team:SYSU-China/temp/SpryDOMEffects.js</H1><DIV id="bodyContent"><H3 id="siteSub" class="noprint">From 2011.igem.org</H3><P>// SpryDOMEffects.js - version 0.6 - Spry Pre-Release 1.7
//
// Copyright (c) 2007. Adobe Systems Incorporated.
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//
//   * Redistributions of source code must retain the above copyright notice,
//     this list of conditions and the following disclaimer.
//   * Redistributions in binary form must reproduce the above copyright notice,
//     this list of conditions and the following disclaimer in the documentation
//     and/or other materials provided with the distribution.
//   * Neither the name of Adobe Systems Incorporated nor the names of its
//     contributors may be used to endorse or promote products derived from this
//     software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
// ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
// CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
// ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
// POSSIBILITY OF SUCH DAMAGE.
</P><P>(function() { // BeginSpryComponent
</P><P>if (typeof Spry == &quot;undefined&quot; || !Spry.Utils || !Spry.$$)
{
	alert(&quot;SpryDOMEffects.js requires SpryDOMUtils.js&quot;);
	return;
}
</P><P>if (!Spry.Effect) Spry.Effect = {};
</P><P>Spry.Effect.Animator = function(opts)
{
	Spry.Effect.Animator.Notifier.call(this);
</P><P>	this.animatorID = Spry.Effect.Animator.nextID++;
	this.dropFrames = true;
	this.fps = 60; // frames per-second
	this.duration = 500; // msecs
	this.timer = 0;
	this.startTime = 0; // Used only when dropFrames is true.
	this.currentFrame = 0;
	this.easeFunc = Spry.Effect.Animator.defaultEaseFunc;
	this.stopped = false;
</P><P>	Spry.Effect.Animator.copyProps(this, opts);
</P><P>	this.interval = 1000 / this.fps;
	this.numFrames = (this.duration / 1000) * this.fps;
</P><P>	if (this.onComplete)
	{
		var self = this;
		this.addObserver({ onAnimationComplete: function(){ self.onComplete(); } });
	}
};
</P><P>Spry.Effect.Animator.nextID = 1;
</P><P>Spry.Effect.Animator.copyProps = function(dst, src)
{
	if (src)
	{
		for (prop in src)
			dst[prop] = src[prop];
	}
	return dst;
};
</P><P>Spry.Effect.Animator.getElement = function(element)
{
	if (arguments.length &gt; 1)
	{
		for (var i = 0, elements = [], length = arguments.length; i &lt; length; i++)
			elements.push(Spry.Effect.Animator.getElement(arguments[i]));
		return elements;
	}
	if (typeof element == 'string')
		element = document.getElementById(element);
	return element;
};
</P><P>Spry.Effect.Animator.defaultEaseFunc = function(time, begin, finish, duration) { time /= duration; return begin + ((2 - time) * time * finish); };
</P><P>Spry.Effect.Animator.Notifier = function()
{
	this.observers = [];
	this.suppressNotifications = 0;
};
</P><P>Spry.Effect.Animator.Notifier.prototype.addObserver = function(observer)
{
	if (!observer)
		return;
</P><P>	// Make sure the observer isn't already on the list.
</P><P>	var len = this.observers.length;
	for (var i = 0; i &lt; len; i++)
	{
		if (this.observers[i] == observer)
			return;
	}
	this.observers[len] = observer;
};
</P><P>Spry.Effect.Animator.Notifier.prototype.removeObserver = function(observer)
{
	if (!observer)
		return;
</P><P>	for (var i = 0; i &lt; this.observers.length; i++)
	{
		if (this.observers[i] == observer)
		{
			this.observers.splice(i, 1);
			break;
		}
	}
};
</P><P>Spry.Effect.Animator.Notifier.prototype.notifyObservers = function(methodName, data)
{
	if (!methodName)
		return;
</P><P>	if (!this.suppressNotifications)
	{
		var len = this.observers.length;
		for (var i = 0; i &lt; len; i++)
		{
			var obs = this.observers[i];
			if (obs)
			{
				if (typeof obs == &quot;function&quot;)
					obs(methodName, this, data);
				else if (obs[methodName])
					obs[methodName](this, data);
			}
		}
	}
};
</P><P>Spry.Effect.Animator.Notifier.prototype.enableNotifications = function()
{
	if (--this.suppressNotifications &lt; 0)
	{
		this.suppressNotifications = 0;
		Spry.Debug.reportError(&quot;Unbalanced enableNotifications() call!\n&quot;);
	}
};
</P><P>Spry.Effect.Animator.Notifier.prototype.disableNotifications = function()
{
	++this.suppressNotifications;
};
</P><P>Spry.Effect.Animator.prototype = new Spry.Effect.Animator.Notifier;
Spry.Effect.Animator.prototype.constructor = Spry.Effect.Animator;
</P><P>Spry.Effect.Animator.prototype.start = function()
{
	this.stopped = false;
	this.currentFrame = 0;
	this.startTime = (new Date()).getTime();
</P><P>	this.notifyObservers(&quot;onAnimationStart&quot;);
</P><P>	var self = this;
	this.timer = setTimeout(function(){ self.onStepAnimation(); }, this.interval);
};
</P><P>Spry.Effect.Animator.prototype.stop = function()
{
	if (this.timer)
		clearTimeout(this.timer);
	this.timer = 0;
	this.stopped = true;
</P><P>	this.notifyObservers(&quot;onAnimationStopped&quot;);
};
</P><P>Spry.Effect.Animator.prototype.onStepAnimation = function()
{
	var obj = {};
</P><P>	if (this.dropFrames)
	{
		obj.duration = this.duration;
		obj.elapsed = ((new Date).getTime()) - this.startTime;
		if (obj.elapsed &gt; obj.duration)
			obj.elapsed = obj.duration;
	}
	else
	{
		obj.duration = this.numFrames;
		obj.elapsed = ++this.currentFrame;
	}
</P><P>	obj.easingConst = this.easeFunc(obj.elapsed, 0, 1, obj.duration)
</P><P>	this.notifyObservers(&quot;onPreDraw&quot;, obj);
	this.draw(obj.elapsed, obj.duration, obj.easingConst);
	this.notifyObservers(&quot;onPostDraw&quot;, obj);
</P><P>	if (!this.stopped)
	{
		if (obj.elapsed &lt; obj.duration)
		{
			var self = this;
			this.timer = setTimeout(function(){ self.onStepAnimation(); }, this.interval);
		}
		else
		{
			this.stop();
			this.notifyObservers(&quot;onAnimationComplete&quot;);
		}
	}
};
</P><P>Spry.Effect.Animator.prototype.draw = function(elapsed, duration, easingConst)
{
	// The default draw method does nothing. It is assumed that
	// derived classes will provide their own implementation of this
	// method.
</P><P>	debug.log(&quot;elapsed: &quot; + elapsed + &quot; -- duration: &quot; + duration + &quot; -- easingConst: &quot; + easingConst);
};
</P><P>
///////////////////////////////////////////////////////////////////////////////
</P><P>Spry.Effect.CSSAnimator = function(elements, styleStr, opts)
{
	this.animationSets = [];
</P><P>	Spry.Effect.Animator.call(this, opts);
</P><P>	this.add(elements, styleStr);
};
</P><P>Spry.Effect.CSSAnimator.prototype = new Spry.Effect.Animator();
Spry.Effect.CSSAnimator.prototype.constructor = Spry.Effect.CSSAnimator;
</P><P>Spry.Effect.CSSAnimator.prototype.add = function(elements, styleStr)
{
	// The first argument for the CSSAnimator can be
	// the id of an element, an element node, or an array of
	// elements and/or ids.
</P><P>	elements = Spry.$$(elements);
</P><P>	if (elements.length &lt; 1)
		return;
</P><P>	var animSet = { elements: elements, cssProps: []};
</P><P>	this.animationSets.push(animSet);
</P><P>	// Convert the styleStr into an object.
</P><P>	var toObj = Spry.Utils.styleStringToObject(styleStr);
	for (var p in toObj)
	{
		var obj = new Object;
		var v = toObj[p];
		obj.value = new Number(v.replace(/[^-\d\.]+/g, &quot;&quot;));
		obj.units = v.replace(/[-\d+\.]/g, &quot;&quot;);
		toObj[p] = obj;
	}
</P><P>	for (var i = 0; i &lt; elements.length; i++)
	{
		var obj = animSet.cssProps[i] = new Object;
		for (var p in toObj)
		{
			var pFuncs = Spry.Effect.CSSAnimator.stylePropFuncs[p];
			if (!pFuncs)
				pFuncs = Spry.Effect.CSSAnimator.stylePropFuncs[&quot;default&quot;];
</P><P>			obj[p] = new Object;
			obj[p].from = new Number(pFuncs.get(elements[i], p).replace(/[^-\d\.]+/g, &quot;&quot;));
			obj[p].to = toObj[p].value;
			obj[p].distance = obj[p].to - obj[p].from;
			obj[p].units = toObj[p].units;
		}
	}
};
</P><P>Spry.Effect.CSSAnimator.prototype.start = function()
{
	for (var s = 0; s &lt; this.animationSets.length; s++)
	{
		var animSet = this.animationSets[s];
		var elements = animSet.elements;
		var cssProps = animSet.cssProps;
</P><P>		for (var i = 0; i &lt; elements.length; i++)
		{
			var ele = elements[i];
</P><P>			var eleProps = ele.spryCSSAnimatorProps;
			if (!eleProps)
				eleProps = ele.spryCSSAnimatorProps = new Object;
</P><P>			var obj = cssProps[i];
			for (var p in obj)
				eleProps[p] = this.animatorID;
		}
	}
</P><P>	return Spry.Effect.Animator.prototype.start.call(this);
};
</P><P>Spry.Effect.CSSAnimator.prototype.stop = function()
{
	for (var s = 0; s &lt; this.animationSets.length; s++)
	{
		var animSet = this.animationSets[s];
		var elements = animSet.elements;
		var cssProps = animSet.cssProps;
</P><P>		for (var i = 0; i &lt; elements.length; i++)
		{
			var ele = elements[i];
			var obj = cssProps[i];
</P><P>			var eleProps = ele.spryCSSAnimatorProps;
			for (var p in obj)
			{
				if (eleProps[p] == this.animatorID)
					delete eleProps[p];
			}
		}
	}
</P><P>	return Spry.Effect.Animator.prototype.stop.call(this);
};
</P><P>Spry.Effect.CSSAnimator.prototype.draw = function(elapsed, duration, easingConst)
{
	for (var s = 0; s &lt; this.animationSets.length; s++)
	{
		var animSet = this.animationSets[s];
		var elements = animSet.elements;
		var cssProps = animSet.cssProps;
</P><P>		for (var i = 0; i &lt; elements.length; i++)
		{
			var ele = elements[i];
			var eleProps = ele.spryCSSAnimatorProps;
			var obj = cssProps[i];
			for (var p in obj)
			{
				if (eleProps[p] == this.animatorID)
				{
					var pFuncs = Spry.Effect.CSSAnimator.stylePropFuncs[p];
					if (!pFuncs)
						pFuncs = Spry.Effect.CSSAnimator.stylePropFuncs[&quot;default&quot;];
</P><P>					if (elapsed &gt; duration)
						pFuncs.set(ele, p, obj[p].to + obj[p].units);
					else
						pFuncs.set(ele, p, obj[p].from + (obj[p].distance * easingConst) + obj[p].units);
				}
			}
		}
	}
};
</P><P>Spry.Effect.CSSAnimator.stylePropFuncs = {};
</P><P>Spry.Effect.CSSAnimator.stylePropFuncs[&quot;default&quot;] = {
	get: function(ele, prop)
	{
		return ele.style[prop];
	},
</P><P>	set: function(ele, prop, val)
	{
		ele.style[prop] = val;
	}
};
</P><P>Spry.Effect.CSSAnimator.stylePropFuncs[&quot;opacity&quot;] = {
	get: function(ele, prop)
	{
		var val = 1;
</P><P>		if (ele.style.opacity)
			val = ele.style.opacity;
		else if (ele.style.filter)
		{
			var strVal = ele.style.filter.replace(/.*alpha\(opacity=(\d+)\).*/, &quot;$1&quot;);
			if (strVal)
				val = parseInt(strVal) / 100;
		}
		return val + &quot;&quot;;
	},
</P><P>	set: function(ele, prop, val)
	{
		ele.style.opacity = &quot;&quot; + val;
		ele.style.filter = &quot;alpha(opacity=&quot; + (val * 100) + &quot;)&quot;;
	}
};
</P><P>///////////////////////////////////////////////////////////////////////////////
</P><P>Spry.$$.Results.defaultEaseFunc = function(time, begin, finish, duration) { time /= duration; return begin + ((2 - time) * time * finish); };
</P><P>Spry.$$.Results.animatePropertyTo = function(propName, to, options)
{
	var opts = { interval: 10, duration: 1000, onComplete: null, transition: Spry.$$.Results.defaultEaseFunc };
	Spry.Effect.Animator.copyProps(opts, options);
</P><P>	var objs = [];
	for (var i = 0; i &lt; this.length; i++)
	{
		var obj = objs[i] = new Object;
		obj.ele = this[i];
		obj.from = obj.ele[propName];
		obj.distance = to - obj.from;
	}
</P><P>	var startTime = (new Date).getTime();
</P><P>	var animateFunc = function()
	{
		var elapsedTime = ((new Date).getTime()) - startTime;
</P><P>		if (elapsedTime &gt; opts.duration)
		{
			for (var i = 0; i &lt; objs.length; i++)
				objs[i].ele[propName] = to;
			if (opts.onComplete)
				opts.onComplete();
		}
		else
		{
			for (var i = 0; i &lt; objs.length; i++)
			{
				var obj = objs[i];
				obj.ele[propName] = opts.transition(elapsedTime, obj.from, obj.distance, opts.duration);
			}
			setTimeout(animateFunc, opts.interval);
		}
	};
</P><P>	setTimeout(animateFunc, opts.interval);
	return this;
};
</P><P>Spry.$$.Results.animateStyleTo = function(styleStr, options)
{
	var a = new Spry.Effect.CSSAnimator(this, styleStr, options);
	a.start();
	return this;
};
</P><P>})(); // EndSpryComponent
</P><DIV class="printfooter">
Retrieved from &quot;<A href="http://2011.igem.org/Team:SYSU-China/temp/SpryDOMEffects.js">http://2011.igem.org/Team:SYSU-China/temp/SpryDOMEffects.js</A>&quot;</DIV></DIV></DIV><DIV id="footer-box" class="noprint"><DIV id="footer"><UL id="f-list"><LI id="t-recentchanges"><A href="/Special:RecentChanges" title="Recent changes">Recent changes</A></LI><LI id="t-whatlinkshere"><A href="/Special:WhatLinksHere/Team:SYSU-China/temp/SpryDOMEffects.js" title="List of all wiki pages that link here [j]" accesskey="j">What links here</A></LI><LI id="t-recentchangeslinked"><A href="/Special:RecentChangesLinked/Team:SYSU-China/temp/SpryDOMEffects.js" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</A></LI><LI id="t-specialpages"><A href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</A></LI><LI><A href="/Special:Preferences">My preferences</A></LI></UL></DIV><DIV id="footer"><UL id="f-list"><LI id="t-print"><A href="/wiki/index.php?title=Team:SYSU-China/temp/SpryDOMEffects.js&amp;printable=yes" title="Printable version of this page [p]" accesskey="p">Printable version</A></LI><LI id="t-permalink"><A href="/wiki/index.php?title=Team:SYSU-China/temp/SpryDOMEffects.js&amp;oldid=231560" title="Permanent link to this revision of the page">Permanent link</A></LI><LI id="privacy"><A href="/2011.igem.org:Privacy_policy" title="2011.igem.org:Privacy policy">Privacy policy</A></LI><LI id="disclaimer"><A href="/2011.igem.org:General_disclaimer" title="2011.igem.org:General disclaimer">Disclaimers</A></LI></UL></DIV></DIV></DIV></BODY></HTML>