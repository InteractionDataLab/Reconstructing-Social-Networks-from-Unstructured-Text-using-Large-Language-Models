<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_EPF_Lausanne_Software skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:EPF Lausanne/Software</SPAN></H1><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><P><TITLE>EPFL 2015 iGEM bioLogic Logic Orthogonal gRNA Implemented Circuits</TITLE><TITLE>EPFL 2015 iGEM bioLogic Logic Orthogonal gRNA Implemented Circuits</TITLE></P><DIV class="container"><NAV class="collapse navbar-collapse navHeaderCollapse" role="navigation"><UL class="nav navbar-nav"><LI><A href="https://2015.igem.org/Team:EPF_Lausanne">Home</A></LI><LI class="dropdown"><A href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Project </A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Project/Description">Description</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Design">Prototype Design</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Modeling">Modeling</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Software">Software</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Interlab">Interlab Study</A></LI></UL><LI class="dropdown"><A href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Achievements </A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Results">Results</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Achievements/Parts">Parts</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Judging">Judging</A></LI><LI class="dropdown"><A href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Wet Lab </A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Notebook/Ecoli">E. coli notebook</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Notebook/Yeast">S. cerevisiae notebook</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Notebook/Protocols">Protocols</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Safety">Safety</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Practices">Human Practices</A></LI><LI class="dropdown"><A href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Team </A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Team/Meet">Meet us</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Attributions">Attributions</A></LI><LI><A href="https://2015.igem.org/Team:EPF_Lausanne/Collaborations">Collaborations</A></LI><LI><A href="https://igem.org" target="_blank">iGEM</A></LI></NAV></DIV><DIV class="classy-bar"><DIV class="container"><DIV class="row"><DIV class="col-md-12 text-center"><H2>Software</H2></DIV></DIV></DIV></DIV><DIV class="soft-section"><DIV class="container"><DIV class="row"><DIV class="col-md-10 col-centered col-md-offset-1"><P>The following table resumes the programs written by members of our team. All the software is released under the GNU General Public License (<A href="https://gnu.org/licenses/gpl.html" target="blank">GPLv3</A>). This means that the software is free, open source and can be modified and redistributed under the terms of the license.</P><P>Original source code is downloadable directly from the following table. Below you can find a brief explanation for each program and the source code.</P><TABLE cellspacing="0" style="width:90%"><THEAD><TR><TH>Name</TH><TH>Description</TH></TR></THEAD><TBODY><TR class="clickable-row" data-href="#code2html"><TD>code2html</TD><TD>Script that automatically generates HTML and CSS code from source files in Python, C++ or BASH.</TD><TD><A href="https://static.igem.org/mediawiki/2015/d/db/Code2htm.zip" class="btn btn-default"> Download</A></TD></TR><TR class="clickable-row" data-href="#ODEsolv"><TD>ODE Solver</TD><TD>Class solving a system of non-linear ODEs given the initial condition.</TD><TD><A href="https://static.igem.org/mediawiki/2015/3/3a/Integrator.zip" class="btn btn-default"> Download</A></TD></TR><TR class="even" class="clickable-row" data-href="#ODEfit"><TD>ODE Fit</TD><TD>Class fitting the parameter of a system of ODEs to experimental data.</TD><TD><A href="https://static.igem.org/mediawiki/2015/b/bf/Fit.zip" class="btn btn-default"> Download</A></TD></TR><TR class="even" class="clickable-row" data-href="#HumanBlaster"><TD>Human Blaster</TD><TD>Script blasting gRNAs versus the human genome.</TD><TD><A href="https://static.igem.org/mediawiki/2015/5/5b/EPF_Lausanne_HumanBlaster.zip" class="btn btn-default"> Download</A></TD></TR></TBODY></TABLE></DIV></DIV></DIV></DIV><DIV class="container"><UL class="nav nav-tabs nav-justified"><LI class="active"><A data-toggle="tab" href="#code2html">code2html</A></LI><LI><A data-toggle="tab" href="#ODEsolv">ODE Solver</A></LI><LI><A data-toggle="tab" href="#ODEfit">ODE Fit</A></LI><LI><A data-toggle="tab" href="#HB">Human Blaster</A></LI></UL><DIV class="tab-content background-section"><DIV id="code2html" class="tab-pane fade in active"><DIV class="row"><DIV class="col-md-10 col-md-offset-1 text-justify"><H3>code2html</H3><P>The following Python script allows to generate HTML (and CSS) code from source files in C++ and Python languages. It is based on <A href="http://pygments.org/" target="blank">Pygment</A>, a Python syntax highlighter. All code in our Wiki is formatted using this script.

</P><P>This script accepts two command line arguments: the first argument is the name of the file to convert, the second one (optional) is to ask for separate HTML and CSS files.</P><P>The style is hard coded, but it can be changed easily by modifying the style string. <A href="http://pygments.org/docs/styles/" target="blank">Pygment</A> documentation lists available themes and explains how to create new ones.</P><DIV class="highlight"><PRE><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">Copyright (C) 2015 iGEM Team EPF_Lausanne</SPAN><SPAN class="sd">This program is free software: you can redistribute it and/or modify</SPAN><SPAN class="sd">it under the terms of the GNU General Public License as published by</SPAN><SPAN class="sd">the Free Software Foundation, either version 3 of the License, or</SPAN><SPAN class="sd">(at your option) any later version.</SPAN><SPAN class="sd">This program is distributed in the hope that it will be useful,</SPAN><SPAN class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</SPAN><SPAN class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</SPAN><SPAN class="sd">GNU General Public License for more details.</SPAN><SPAN class="sd">You should have received a copy of the GNU General Public License</SPAN><SPAN class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</SPAN><SPAN class="sd">Command:</SPAN><SPAN class="sd">######################################</SPAN><SPAN class="sd">    python code2html INPUTFILE [CSS]</SPAN><SPAN class="sd">######################################</SPAN><SPAN class="sd">INPUTFILE: name (with path) of the file to convert to html</SPAN><SPAN class="sd">CSS: write &quot;true&quot; (ot &quot;t&quot;, &quot;yes&quot;, &quot;y&quot;) in order to obtain separate .html and .css files (&quot;false&quot; by default)</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">pygments</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">highlight</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">pygments.lexers</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">PythonLexer</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">pygments.lexers</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">CppLexer</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">pygments.lexers</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">BashLexer</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">pygments.formatters</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">HtmlFormatter</SPAN><SPAN class="c"># Code formatting style</SPAN><SPAN class="n">style</SPAN><SPAN class="o">=</SPAN><SPAN class="s">&quot;monokai&quot;</SPAN><SPAN class="c"># C++ extensions</SPAN><SPAN class="n">cpp</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[</SPAN><SPAN class="s">&quot;cpp&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">&quot;cxx&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">&quot;cc&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">&quot;h&quot;</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Python extensions</SPAN><SPAN class="n">py</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[</SPAN><SPAN class="s">&quot;py&quot;</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Bash extensions</SPAN><SPAN class="n">bash</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[</SPAN><SPAN class="s">&quot;sh&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">&quot;bash&quot;</SPAN><SPAN class="p">]</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">load_file_as_sting</SPAN><SPAN class="p">(</SPAN><SPAN class="n">fname</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Open the file FNAME and save all its content in an unformatted string</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="n">content</SPAN><SPAN class="o">=</SPAN><SPAN class="s">&quot;&quot;</SPAN><SPAN class="k">with</SPAN><SPAN class="nb">open</SPAN><SPAN class="p">(</SPAN><SPAN class="n">fname</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'r'</SPAN><SPAN class="p">)</SPAN><SPAN class="k">as</SPAN><SPAN class="n">f</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Open the file (read only)</SPAN><SPAN class="n">content</SPAN><SPAN class="o">=</SPAN><SPAN class="n">f</SPAN><SPAN class="o">.</SPAN><SPAN class="n">read</SPAN><SPAN class="p">()</SPAN><SPAN class="c"># Read file and store it in an unformatted string</SPAN><SPAN class="c"># The file is automatically closed</SPAN><SPAN class="k">return</SPAN><SPAN class="n">content</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">save_string_as_file</SPAN><SPAN class="p">(</SPAN><SPAN class="n">fname</SPAN><SPAN class="p">,</SPAN><SPAN class="n">string</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Save the unformatted string STRING into the file FNAME</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="k">with</SPAN><SPAN class="nb">open</SPAN><SPAN class="p">(</SPAN><SPAN class="n">fname</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'w'</SPAN><SPAN class="p">)</SPAN><SPAN class="k">as</SPAN><SPAN class="n">f</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Open the file (write only)</SPAN><SPAN class="n">f</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="n">string</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># The file is automatically closed</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">lexer_formatter</SPAN><SPAN class="p">(</SPAN><SPAN class="n">language</SPAN><SPAN class="p">,</SPAN><SPAN class="n">css</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">False</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Return the lexer for the appropriate language and the HTML formatter</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="n">L</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">None</SPAN><SPAN class="k">if</SPAN><SPAN class="n">language</SPAN><SPAN class="ow">in</SPAN><SPAN class="n">py</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Python Lexer</SPAN><SPAN class="n">L</SPAN><SPAN class="o">=</SPAN><SPAN class="n">PythonLexer</SPAN><SPAN class="p">()</SPAN><SPAN class="k">elif</SPAN><SPAN class="n">language</SPAN><SPAN class="ow">in</SPAN><SPAN class="n">cpp</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># C++ Lexer</SPAN><SPAN class="n">L</SPAN><SPAN class="o">=</SPAN><SPAN class="n">CppLexer</SPAN><SPAN class="p">()</SPAN><SPAN class="k">elif</SPAN><SPAN class="n">language</SPAN><SPAN class="ow">in</SPAN><SPAN class="n">bash</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Bash Lexer</SPAN><SPAN class="n">L</SPAN><SPAN class="o">=</SPAN><SPAN class="n">BashLexer</SPAN><SPAN class="p">()</SPAN><SPAN class="k">else</SPAN><SPAN class="p">:</SPAN><SPAN class="k">raise</SPAN><SPAN class="ne">NameError</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;Invalid language.&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">HF</SPAN><SPAN class="o">=</SPAN><SPAN class="n">HtmlFormatter</SPAN><SPAN class="p">(</SPAN><SPAN class="n">full</SPAN><SPAN class="o">=</SPAN><SPAN class="ow">not</SPAN><SPAN class="n">css</SPAN><SPAN class="p">,</SPAN><SPAN class="n">style</SPAN><SPAN class="o">=</SPAN><SPAN class="n">style</SPAN><SPAN class="p">)</SPAN><SPAN class="k">return</SPAN><SPAN class="n">L</SPAN><SPAN class="p">,</SPAN><SPAN class="n">HF</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">code_to_htmlcss</SPAN><SPAN class="p">(</SPAN><SPAN class="n">code</SPAN><SPAN class="p">,</SPAN><SPAN class="n">language</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Transform CODE into html and css (separate files)</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># Obtain lexer and HtmlFormatter</SPAN><SPAN class="n">L</SPAN><SPAN class="p">,</SPAN><SPAN class="n">HF</SPAN><SPAN class="o">=</SPAN><SPAN class="n">lexer_formatter</SPAN><SPAN class="p">(</SPAN><SPAN class="n">language</SPAN><SPAN class="p">,</SPAN><SPAN class="n">css</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">True</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Create html code</SPAN><SPAN class="n">html</SPAN><SPAN class="o">=</SPAN><SPAN class="n">highlight</SPAN><SPAN class="p">(</SPAN><SPAN class="n">code</SPAN><SPAN class="p">,</SPAN><SPAN class="n">L</SPAN><SPAN class="p">,</SPAN><SPAN class="n">HF</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Create css code</SPAN><SPAN class="n">css</SPAN><SPAN class="o">=</SPAN><SPAN class="n">HF</SPAN><SPAN class="o">.</SPAN><SPAN class="n">get_style_defs</SPAN><SPAN class="p">(</SPAN><SPAN class="s">'.highlight'</SPAN><SPAN class="p">)</SPAN><SPAN class="k">return</SPAN><SPAN class="n">html</SPAN><SPAN class="p">,</SPAN><SPAN class="n">css</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">code_to_html</SPAN><SPAN class="p">(</SPAN><SPAN class="n">code</SPAN><SPAN class="p">,</SPAN><SPAN class="n">language</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Transform CODE into html and css (all in the same file)</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># Obtain lexer and HtmlFormatter</SPAN><SPAN class="n">L</SPAN><SPAN class="p">,</SPAN><SPAN class="n">HF</SPAN><SPAN class="o">=</SPAN><SPAN class="n">lexer_formatter</SPAN><SPAN class="p">(</SPAN><SPAN class="n">language</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Create fill html code</SPAN><SPAN class="n">html</SPAN><SPAN class="o">=</SPAN><SPAN class="n">highlight</SPAN><SPAN class="p">(</SPAN><SPAN class="n">code</SPAN><SPAN class="p">,</SPAN><SPAN class="n">L</SPAN><SPAN class="p">,</SPAN><SPAN class="n">HF</SPAN><SPAN class="p">)</SPAN><SPAN class="k">return</SPAN><SPAN class="n">html</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">sys</SPAN><SPAN class="k">if</SPAN><SPAN class="n">__name__</SPAN><SPAN class="o">==</SPAN><SPAN class="s">&quot;__main__&quot;</SPAN><SPAN class="p">:</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Command:</SPAN><SPAN class="sd">    ######################################</SPAN><SPAN class="sd">        python code2html INPUTFILE [CSS]</SPAN><SPAN class="sd">    ######################################</SPAN><SPAN class="sd">    INPUTFILE: name (with path) of the file to convert to html</SPAN><SPAN class="sd">    CSS: write &quot;true&quot; (ot &quot;t&quot;, &quot;yes&quot;, &quot;y&quot;) in order to obtain separate .html and .css files (&quot;false&quot; by default)</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># Command line arguments</SPAN><SPAN class="n">args</SPAN><SPAN class="o">=</SPAN><SPAN class="n">sys</SPAN><SPAN class="o">.</SPAN><SPAN class="n">argv</SPAN><SPAN class="c"># Check command line arguments</SPAN><SPAN class="n">ncla</SPAN><SPAN class="o">=</SPAN><SPAN class="nb">len</SPAN><SPAN class="p">(</SPAN><SPAN class="n">args</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># number of command line arguments</SPAN><SPAN class="k">if</SPAN><SPAN class="n">ncla</SPAN><SPAN class="o">!=</SPAN><SPAN class="mi">2</SPAN><SPAN class="ow">and</SPAN><SPAN class="n">ncla</SPAN><SPAN class="o">!=</SPAN><SPAN class="mi">3</SPAN><SPAN class="p">:</SPAN><SPAN class="k">raise</SPAN><SPAN class="ne">TypeError</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;Invalid number of command line arguments.&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">css_bool</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">False</SPAN><SPAN class="k">if</SPAN><SPAN class="n">ncla</SPAN><SPAN class="o">==</SPAN><SPAN class="mi">3</SPAN><SPAN class="ow">and</SPAN><SPAN class="n">args</SPAN><SPAN class="p">[</SPAN><SPAN class="o">-</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">]</SPAN><SPAN class="o">.</SPAN><SPAN class="n">lower</SPAN><SPAN class="p">()</SPAN><SPAN class="ow">in</SPAN><SPAN class="p">[</SPAN><SPAN class="s">&quot;true&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'t'</SPAN><SPAN class="p">,</SPAN><SPAN class="s">&quot;yes&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'y'</SPAN><SPAN class="p">]:</SPAN><SPAN class="n">css_bool</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">True</SPAN><SPAN class="c"># Export css separately</SPAN><SPAN class="c"># Input file</SPAN><SPAN class="n">fname_code</SPAN><SPAN class="o">=</SPAN><SPAN class="n">sys</SPAN><SPAN class="o">.</SPAN><SPAN class="n">argv</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Name of the file containing the code to convert in html</SPAN><SPAN class="c"># Input file extension</SPAN><SPAN class="n">language</SPAN><SPAN class="o">=</SPAN><SPAN class="n">fname_code</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">'.'</SPAN><SPAN class="p">)[</SPAN><SPAN class="o">-</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Output files</SPAN><SPAN class="n">fname_html</SPAN><SPAN class="o">=</SPAN><SPAN class="n">fname_code</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">'.'</SPAN><SPAN class="p">)[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;.html&quot;</SPAN><SPAN class="c"># Name of the file where the html code will be stored</SPAN><SPAN class="n">fname_css</SPAN><SPAN class="o">=</SPAN><SPAN class="n">fname_code</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">'.'</SPAN><SPAN class="p">)[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;.css&quot;</SPAN><SPAN class="c"># Name of the file where the css code will be stored</SPAN><SPAN class="c"># Save code into a unformatted string</SPAN><SPAN class="n">code</SPAN><SPAN class="o">=</SPAN><SPAN class="n">load_file_as_sting</SPAN><SPAN class="p">(</SPAN><SPAN class="n">fname_code</SPAN><SPAN class="p">)</SPAN><SPAN class="k">if</SPAN><SPAN class="n">css_bool</SPAN><SPAN class="o">==</SPAN><SPAN class="bp">False</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Convert to standalone html</SPAN><SPAN class="n">html</SPAN><SPAN class="o">=</SPAN><SPAN class="n">code_to_html</SPAN><SPAN class="p">(</SPAN><SPAN class="n">code</SPAN><SPAN class="p">,</SPAN><SPAN class="n">language</SPAN><SPAN class="p">)</SPAN><SPAN class="k">else</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Convert to html and css separately</SPAN><SPAN class="n">html</SPAN><SPAN class="p">,</SPAN><SPAN class="n">css</SPAN><SPAN class="o">=</SPAN><SPAN class="n">code_to_htmlcss</SPAN><SPAN class="p">(</SPAN><SPAN class="n">code</SPAN><SPAN class="p">,</SPAN><SPAN class="n">language</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Save html</SPAN><SPAN class="n">save_string_as_file</SPAN><SPAN class="p">(</SPAN><SPAN class="n">fname_html</SPAN><SPAN class="p">,</SPAN><SPAN class="n">html</SPAN><SPAN class="p">)</SPAN><SPAN class="k">if</SPAN><SPAN class="n">css_bool</SPAN><SPAN class="o">==</SPAN><SPAN class="bp">True</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Save css</SPAN><SPAN class="n">save_string_as_file</SPAN><SPAN class="p">(</SPAN><SPAN class="n">fname_css</SPAN><SPAN class="p">,</SPAN><SPAN class="n">css</SPAN><SPAN class="p">)</SPAN></PRE></DIV></DIV></DIV></DIV><DIV id="ODEsolv" class="tab-pane fade"><DIV class="row"><DIV class="col-md-10 col-md-offset-1 text-justify"><H3>ODE Solver</H3><P>Our kinetic model leads to a system of coupled fist-order, nonlinear, ordinary differential equations (ODEs). In order to solve this system we used an explicit Runge-Kutta method of order 4(5) with adaptative step size control and dense output due to Dormand and Prince, implemented by E. Hairer and G. Wanner [1] in the <A href="https://www.scipy.org/" target="blank">SciPy</A> Python library. To facilitate the use of this integrator, we created an utility class which is suited for our needs.</P><P>The Solver class needs the function defining the system of ODEs we want to solve, an initial condition and  the interval on which we want to integrate. Note that the time step \(\Delta t\) (which is also an argument of the constructor of the Solver class) is not the discretization step, because our algorithm is adaptative: \(\Delta t\) is the maximal allowed step and define the points where the solution of the ODEs system will be computed. </P><DIV class="highlight"><PRE><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">Copyright (C) 2015 iGEM Team EPF_Lausanne</SPAN><SPAN class="sd">This program is free software: you can redistribute it and/or modify</SPAN><SPAN class="sd">it under the terms of the GNU General Public License as published by</SPAN><SPAN class="sd">the Free Software Foundation, either version 3 of the License, or</SPAN><SPAN class="sd">(at your option) any later version.</SPAN><SPAN class="sd">This program is distributed in the hope that it will be useful,</SPAN><SPAN class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</SPAN><SPAN class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</SPAN><SPAN class="sd">GNU General Public License for more details.</SPAN><SPAN class="sd">You should have received a copy of the GNU General Public License</SPAN><SPAN class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">numpy</SPAN><SPAN class="kn">as</SPAN><SPAN class="nn">np</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">scipy.integrate</SPAN><SPAN class="kn">import</SPAN><SPAN class="o">*</SPAN><SPAN class="k">class</SPAN><SPAN class="nc">Solver</SPAN><SPAN class="p">:</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Class that allows the solution of a system of non-linear ODEs. The system is specified by the function fun</SPAN><SPAN class="sd">        dy/dt = fun(t,y)</SPAN><SPAN class="sd">    where t is a number and y and dy/dt are numpy arrays or lists.</SPAN><SPAN class="sd">    The solution is performed with the dopri5 method, an explicit Runge-Kutta method of order (4)5.</SPAN><SPAN class="sd">    The method is due to Dormand &amp; Prince, and is implemented by E. Hairer and G. Wanner.</SPAN><SPAN class="sd">    See</SPAN><SPAN class="sd">        http://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.integrate.ode.html</SPAN><SPAN class="sd">    for more details.</SPAN><SPAN class="sd">    NOTE:</SPAN><SPAN class="sd">    Our Solver can take a function of the form</SPAN><SPAN class="sd">        f(t,y,pars)</SPAN><SPAN class="sd">    where PARS are parameters. PARS can be eventually passed to the constructor of the Solver.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">__init__</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">,</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">T</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">pars</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[]):</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">dt</SPAN><SPAN class="o">=</SPAN><SPAN class="n">dt</SPAN><SPAN class="c"># Time step</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fun</SPAN><SPAN class="o">=</SPAN><SPAN class="n">fun</SPAN><SPAN class="c"># Function representing the ODE</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t0</SPAN><SPAN class="o">=</SPAN><SPAN class="n">t0</SPAN><SPAN class="c"># Initial time</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">T</SPAN><SPAN class="o">=</SPAN><SPAN class="n">T</SPAN><SPAN class="c"># Final time</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y0</SPAN><SPAN class="o">=</SPAN><SPAN class="n">y0</SPAN><SPAN class="c"># Initial condition</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="o">=</SPAN><SPAN class="n">pars</SPAN><SPAN class="c"># Parameters of the system of ODEs</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">solve</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Solve the system of ODEs</SPAN><SPAN class="sd">            dy/dt = fun(t,y)</SPAN><SPAN class="sd">        on the interval [t0,T], with the initial condition y(0)=y0.</SPAN><SPAN class="sd">        Returns two lists, time and solution, containing time points and the solution at these time points.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># Choose integrator type</SPAN><SPAN class="n">r</SPAN><SPAN class="o">=</SPAN><SPAN class="n">ode</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">set_integrator</SPAN><SPAN class="p">(</SPAN><SPAN class="s">'dopri5'</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Initialize the integrator</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">set_initial_value</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">,</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Set parameters for the ODE function</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">set_f_params</SPAN><SPAN class="p">(</SPAN><SPAN class="o">*</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Initialize solution list and time points list</SPAN><SPAN class="n">solution</SPAN><SPAN class="o">=</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">)</SPAN><SPAN class="n">time</SPAN><SPAN class="o">=</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">)</SPAN><SPAN class="k">while</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">successful</SPAN><SPAN class="p">()</SPAN><SPAN class="ow">and</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="o">&lt;</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">T</SPAN><SPAN class="p">:</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">integrate</SPAN><SPAN class="p">(</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="o">+</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Perform one integration step, i.e. obtain the solution y at time t+dt</SPAN><SPAN class="n">time</SPAN><SPAN class="o">=</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">append</SPAN><SPAN class="p">(</SPAN><SPAN class="n">time</SPAN><SPAN class="p">,</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Append the new time</SPAN><SPAN class="n">solution</SPAN><SPAN class="o">=</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">vstack</SPAN><SPAN class="p">((</SPAN><SPAN class="n">solution</SPAN><SPAN class="p">,</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y</SPAN><SPAN class="p">))</SPAN><SPAN class="c"># Append the new solution</SPAN><SPAN class="k">return</SPAN><SPAN class="n">time</SPAN><SPAN class="p">,</SPAN><SPAN class="n">solution</SPAN><SPAN class="c"># Return time and solution vectors</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">solve_for_t</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Solve the system of ODEs</SPAN><SPAN class="sd">            dy/dt = fun(t,y)</SPAN><SPAN class="sd">        on the interval [t0,T], with the initial condition y(0)=y0.</SPAN><SPAN class="sd">        Returns two lists, solution and time, containing time points and the solution at these time points.</SPAN><SPAN class="sd">        The solution is computed at the points specified in t, i.e. the time step dt is ignored.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># Choose integrator type: dopri5 in this case</SPAN><SPAN class="n">r</SPAN><SPAN class="o">=</SPAN><SPAN class="n">ode</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">set_integrator</SPAN><SPAN class="p">(</SPAN><SPAN class="s">'dopri5'</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Initialize the integrator</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">set_initial_value</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">,</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Set parameters for the ODE function</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">set_f_params</SPAN><SPAN class="p">(</SPAN><SPAN class="o">*</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Initialize solution list and time points list</SPAN><SPAN class="n">solution</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[]</SPAN><SPAN class="n">time</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[]</SPAN><SPAN class="k">for</SPAN><SPAN class="n">tt</SPAN><SPAN class="ow">in</SPAN><SPAN class="n">t</SPAN><SPAN class="p">:</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">integrate</SPAN><SPAN class="p">(</SPAN><SPAN class="n">tt</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Perform one integration step</SPAN><SPAN class="n">time</SPAN><SPAN class="o">.</SPAN><SPAN class="n">append</SPAN><SPAN class="p">(</SPAN><SPAN class="n">tt</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Append the new time</SPAN><SPAN class="n">solution</SPAN><SPAN class="o">.</SPAN><SPAN class="n">append</SPAN><SPAN class="p">(</SPAN><SPAN class="n">r</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Append the new solution</SPAN><SPAN class="k">return</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="n">time</SPAN><SPAN class="p">),</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="n">solution</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Return time and solution vectors</SPAN><SPAN class="k">if</SPAN><SPAN class="n">__name__</SPAN><SPAN class="o">==</SPAN><SPAN class="s">&quot;__main__&quot;</SPAN><SPAN class="p">:</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Our test functions:</SPAN><SPAN class="sd">       rapid_equilibrium (standard function)</SPAN><SPAN class="sd">       rapid_equilibrium_from_string() (returns a function compiled from a string)</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">matplotlib.pylab</SPAN><SPAN class="kn">as</SPAN><SPAN class="nn">plt</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">test</SPAN><SPAN class="kn">import</SPAN><SPAN class="o">*</SPAN><SPAN class="c"># Import test functions for the ODE integrator</SPAN><SPAN class="n">dt</SPAN><SPAN class="o">=</SPAN><SPAN class="mf">0.1</SPAN><SPAN class="n">t0</SPAN><SPAN class="o">=</SPAN><SPAN class="mi">0</SPAN><SPAN class="n">T</SPAN><SPAN class="o">=</SPAN><SPAN class="mi">100</SPAN><SPAN class="n">y0</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Store the funtion compiled from a string</SPAN><SPAN class="n">rapid_equilibrium_s</SPAN><SPAN class="o">=</SPAN><SPAN class="n">rapid_equilibrium_from_string</SPAN><SPAN class="p">()</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">=</SPAN><SPAN class="n">Solver</SPAN><SPAN class="p">(</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">rapid_equilibrium</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">T</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">)</SPAN><SPAN class="n">mysolver_string</SPAN><SPAN class="o">=</SPAN><SPAN class="n">Solver</SPAN><SPAN class="p">(</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">rapid_equilibrium_s</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">T</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">)</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="o">=</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">solve</SPAN><SPAN class="p">()</SPAN><SPAN class="n">tt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">yt</SPAN><SPAN class="o">=</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">solve_for_t</SPAN><SPAN class="p">(</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">linspace</SPAN><SPAN class="p">(</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">T</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">10</SPAN><SPAN class="p">))</SPAN><SPAN class="n">ts</SPAN><SPAN class="p">,</SPAN><SPAN class="n">ys</SPAN><SPAN class="o">=</SPAN><SPAN class="n">mysolver_string</SPAN><SPAN class="o">.</SPAN><SPAN class="n">solve</SPAN><SPAN class="p">()</SPAN><SPAN class="n">plt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">plot</SPAN><SPAN class="p">(</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="p">)</SPAN><SPAN class="n">plt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">plot</SPAN><SPAN class="p">(</SPAN><SPAN class="n">tt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">yt</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'x'</SPAN><SPAN class="p">)</SPAN><SPAN class="n">plt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">plot</SPAN><SPAN class="p">(</SPAN><SPAN class="n">ts</SPAN><SPAN class="p">,</SPAN><SPAN class="n">ys</SPAN><SPAN class="p">)</SPAN><SPAN class="n">plt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">show</SPAN><SPAN class="p">()</SPAN></PRE></DIV><H4>References</H4>
            [1] E. Hairer et al., Solving Ordinary Differential Equations, 2nd edition, Springer-Verlag, 1993.
        </DIV></DIV></DIV><DIV id="ODEfit" class="tab-pane fade"><DIV class="row"><DIV class="col-md-10 col-md-offset-1 text-justify"><H3>ODE Fit</H3><P>The system of first-order, nonlinear, ordinary differential equations (ODEs) which represents the kinetic model of our system contains a vast variety of parameters. The majority of them has been found on the literature, while the others have simply been estimated. Some parameters, however, are so specific to our system that need to be fitted to experimental data.</P><P>Fitting parameters of a system of ODEs to experimental curves is a non-trivial task: the system of ODEs need to be solved for each value of the parameters during the optimization. In order to solve the system of ODEs for a fixed set of parameters we used our ODE Solver. Parameter optimization is performed by minimizing the square difference between experimental points and the numerical solution.</P><P>Our ODEFit class needs the function defining the system of ODEs we want to optimize, experimental data and initial guess for the initial conditions and for the parameters. Note that in order to have a general code, initial conditions are also free parameters since experimental data does not allow for their exact determination.</P><DIV class="highlight"><PRE><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">Copyright (C) 2015 iGEM Team EPF_Lausanne</SPAN><SPAN class="sd">This program is free software: you can redistribute it and/or modify</SPAN><SPAN class="sd">it under the terms of the GNU General Public License as published by</SPAN><SPAN class="sd">the Free Software Foundation, either version 3 of the License, or</SPAN><SPAN class="sd">(at your option) any later version.</SPAN><SPAN class="sd">This program is distributed in the hope that it will be useful,</SPAN><SPAN class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</SPAN><SPAN class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</SPAN><SPAN class="sd">GNU General Public License for more details.</SPAN><SPAN class="sd">You should have received a copy of the GNU General Public License</SPAN><SPAN class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">numpy</SPAN><SPAN class="kn">as</SPAN><SPAN class="nn">np</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">warnings</SPAN><SPAN class="kn">as</SPAN><SPAN class="nn">w</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">integrator</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">Solver</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">scipy.optimize</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">minimize</SPAN><SPAN class="k">class</SPAN><SPAN class="nc">ODEFit</SPAN><SPAN class="p">:</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Class that allows the fit of the solution (experimental data) of a system of ODEs</SPAN><SPAN class="sd">        dy/dt = fun(t,y,pars)</SPAN><SPAN class="sd">    where PARS are the parameters to fit.</SPAN><SPAN class="sd">    This class relay on the ODE Solver class in order to solve the system of ODEs.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">__init__</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">,</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">pars0</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        The constructor need the function FUN defining the system of ODEs.</SPAN><SPAN class="sd">        t and y are experimental data (y can contain a list with the data of different species).</SPAN><SPAN class="sd">        y0 is the initial guess for the initial conditions.</SPAN><SPAN class="sd">        pars0 is the initial guess for the parameters.</SPAN><SPAN class="sd">        NOTE:</SPAN><SPAN class="sd">        The initial condition y0 is free, i.e. it is a parameter as well.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># Function defining the system of ODEs</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fun</SPAN><SPAN class="o">=</SPAN><SPAN class="n">fun</SPAN><SPAN class="c"># Initial guess for parameters and initial conditions</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars0</SPAN><SPAN class="o">=</SPAN><SPAN class="n">pars0</SPAN><SPAN class="o">+</SPAN><SPAN class="n">y0</SPAN><SPAN class="c"># Merge all parameters to optimize in a single list</SPAN><SPAN class="c"># Data to fit (convert to Numpy arrays)</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="o">=</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="n">t</SPAN><SPAN class="p">)</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y</SPAN><SPAN class="o">=</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="n">y</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Number of ODEs composing the system</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">n</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y</SPAN><SPAN class="o">.</SPAN><SPAN class="n">shape</SPAN><SPAN class="p">[</SPAN><SPAN class="o">-</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Fitted parameters (initialized to initial guess)</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars0</SPAN><SPAN class="c"># Index of separation between real parameters and (free) initial conditions</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">index</SPAN><SPAN class="o">=</SPAN><SPAN class="nb">len</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">)</SPAN><SPAN class="o">-</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">n</SPAN><SPAN class="c"># Keep trak of FIT routine call (if True, self.pars contains the optimized parameters)</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fitted</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">False</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">_solve_for_pars</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">,</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Solve the system of ODEs for a given set of parameters.</SPAN><SPAN class="sd">        Solution is computed at experimental data points.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># pars[:self.index] : fun parameters</SPAN><SPAN class="c"># pars[self.index:] : inital conditions (last entries)</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">=</SPAN><SPAN class="n">Solver</SPAN><SPAN class="p">(</SPAN><SPAN class="mf">0.1</SPAN><SPAN class="p">,</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">,</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">],</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="p">[</SPAN><SPAN class="o">-</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">],</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">[</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">index</SPAN><SPAN class="p">:],</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">[:</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">index</SPAN><SPAN class="p">])</SPAN><SPAN class="c"># Solve the system of ODEs at experimental data points</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="o">=</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">solve_for_t</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="p">)</SPAN><SPAN class="k">return</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="n">t</SPAN><SPAN class="p">),</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="n">y</SPAN><SPAN class="p">)</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">_resid</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y_model</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y_data</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Compute the square of the difference between the ODE solution and the data to fit.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="k">return</SPAN><SPAN class="p">((</SPAN><SPAN class="n">y_model</SPAN><SPAN class="o">-</SPAN><SPAN class="n">y_data</SPAN><SPAN class="p">)</SPAN><SPAN class="o">**</SPAN><SPAN class="mi">2</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">sum</SPAN><SPAN class="p">()</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">_score</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">,</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        The score is defined as the sum of residuals for each ODE composing the system.</SPAN><SPAN class="sd">        The score function is minimized in order to optimize the parameters (least squares of residuals).</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="c"># Solve the system of ODEs for a given set of parameters</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y_model</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">_solve_for_pars</SPAN><SPAN class="p">(</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">)</SPAN><SPAN class="n">score</SPAN><SPAN class="o">=</SPAN><SPAN class="mi">0</SPAN><SPAN class="c"># Compute the score of the current set of parameters</SPAN><SPAN class="k">for</SPAN><SPAN class="n">i</SPAN><SPAN class="ow">in</SPAN><SPAN class="nb">range</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">n</SPAN><SPAN class="p">):</SPAN><SPAN class="n">score</SPAN><SPAN class="o">+=</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">_resid</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">y</SPAN><SPAN class="p">[:,</SPAN><SPAN class="n">i</SPAN><SPAN class="p">],</SPAN><SPAN class="n">y_model</SPAN><SPAN class="p">[:,</SPAN><SPAN class="n">i</SPAN><SPAN class="p">])</SPAN><SPAN class="c"># The score is the sum of residuals for each ODE</SPAN><SPAN class="k">return</SPAN><SPAN class="n">score</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">fit</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Fit data in order to obtain the best parameter estimation.</SPAN><SPAN class="sd">        The best parameter set is obtained by minimizing the score function, i.e. the sum of residuals.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="n">opt</SPAN><SPAN class="o">=</SPAN><SPAN class="n">minimize</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">_score</SPAN><SPAN class="p">,</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars0</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Extract the optimized parameters</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="o">=</SPAN><SPAN class="n">opt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">x</SPAN><SPAN class="c"># The fit function has been called</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fitted</SPAN><SPAN class="o">=</SPAN><SPAN class="bp">True</SPAN><SPAN class="k">if</SPAN><SPAN class="n">opt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">success</SPAN><SPAN class="o">==</SPAN><SPAN class="bp">True</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Check the success of the minimization process</SPAN><SPAN class="k">return</SPAN><SPAN class="n">opt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">x</SPAN><SPAN class="p">[:</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">index</SPAN><SPAN class="p">],</SPAN><SPAN class="n">opt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">x</SPAN><SPAN class="p">[</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">index</SPAN><SPAN class="p">:]</SPAN><SPAN class="k">else</SPAN><SPAN class="p">:</SPAN><SPAN class="k">raise</SPAN><SPAN class="ne">RuntimeError</SPAN><SPAN class="p">(</SPAN><SPAN class="n">opt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">message</SPAN><SPAN class="p">)</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">solve_fitted</SPAN><SPAN class="p">(</SPAN><SPAN class="bp">self</SPAN><SPAN class="p">,</SPAN><SPAN class="n">dt</SPAN><SPAN class="o">=</SPAN><SPAN class="mf">0.1</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Solve the system of ODEs with the optimal parameters with a dense output.</SPAN><SPAN class="sd">        dt is the discretization step, which can be changed manually.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="k">if</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fitted</SPAN><SPAN class="o">==</SPAN><SPAN class="bp">False</SPAN><SPAN class="p">:</SPAN><SPAN class="c"># Warning: the FIT function has never been called</SPAN><SPAN class="n">w</SPAN><SPAN class="o">.</SPAN><SPAN class="n">warn</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;Warning: model not fitted, parameters are the initial ones.&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Solve for the optimal set of parameters</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">=</SPAN><SPAN class="n">Solver</SPAN><SPAN class="p">(</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">,</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">,</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">],</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">t</SPAN><SPAN class="p">[</SPAN><SPAN class="o">-</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">],</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">[</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">index</SPAN><SPAN class="p">:],</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">[:</SPAN><SPAN class="bp">self</SPAN><SPAN class="o">.</SPAN><SPAN class="n">index</SPAN><SPAN class="p">])</SPAN><SPAN class="c"># Solve for a dense grid, not for data points</SPAN><SPAN class="k">return</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">solve</SPAN><SPAN class="p">()</SPAN><SPAN class="k">if</SPAN><SPAN class="n">__name__</SPAN><SPAN class="o">==</SPAN><SPAN class="s">&quot;__main__&quot;</SPAN><SPAN class="p">:</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">integrator</SPAN><SPAN class="kn">import</SPAN><SPAN class="o">*</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">test</SPAN><SPAN class="kn">import</SPAN><SPAN class="o">*</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">numpy</SPAN><SPAN class="kn">as</SPAN><SPAN class="nn">np</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">numpy.random</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">randn</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">matplotlib.pylab</SPAN><SPAN class="kn">as</SPAN><SPAN class="nn">plt</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">randomize</SPAN><SPAN class="p">(</SPAN><SPAN class="n">lst</SPAN><SPAN class="p">,</SPAN><SPAN class="n">scale</SPAN><SPAN class="o">=</SPAN><SPAN class="mf">100.</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Randomize the data contained in lst (displacement along y axis)</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="k">for</SPAN><SPAN class="n">i</SPAN><SPAN class="ow">in</SPAN><SPAN class="nb">range</SPAN><SPAN class="p">(</SPAN><SPAN class="nb">len</SPAN><SPAN class="p">(</SPAN><SPAN class="n">lst</SPAN><SPAN class="p">)):</SPAN><SPAN class="n">lst</SPAN><SPAN class="p">[</SPAN><SPAN class="n">i</SPAN><SPAN class="p">]</SPAN><SPAN class="o">+=</SPAN><SPAN class="n">randn</SPAN><SPAN class="p">()</SPAN><SPAN class="o">/</SPAN><SPAN class="n">scale</SPAN><SPAN class="k">return</SPAN><SPAN class="n">lst</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">random_data</SPAN><SPAN class="p">(</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">T</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">sel</SPAN><SPAN class="o">=</SPAN><SPAN class="mi">10</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">        Create random data for the system of ODEs</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">=</SPAN><SPAN class="n">Solver</SPAN><SPAN class="p">(</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">fun</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">T</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Solve the system of ODEs</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="o">=</SPAN><SPAN class="n">mysolver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">solve</SPAN><SPAN class="p">()</SPAN><SPAN class="n">t_stripped</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[]</SPAN><SPAN class="n">y_stripped</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[]</SPAN><SPAN class="c"># Select one out of SEL points from the solution</SPAN><SPAN class="k">for</SPAN><SPAN class="n">i</SPAN><SPAN class="ow">in</SPAN><SPAN class="nb">range</SPAN><SPAN class="p">(</SPAN><SPAN class="nb">len</SPAN><SPAN class="p">(</SPAN><SPAN class="n">y</SPAN><SPAN class="p">)):</SPAN><SPAN class="k">if</SPAN><SPAN class="n">i</SPAN><SPAN class="o">%</SPAN><SPAN class="n">sel</SPAN><SPAN class="o">==</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">:</SPAN><SPAN class="n">t_stripped</SPAN><SPAN class="o">.</SPAN><SPAN class="n">append</SPAN><SPAN class="p">(</SPAN><SPAN class="n">t</SPAN><SPAN class="p">[</SPAN><SPAN class="n">i</SPAN><SPAN class="p">])</SPAN><SPAN class="n">y_stripped</SPAN><SPAN class="o">.</SPAN><SPAN class="n">append</SPAN><SPAN class="p">(</SPAN><SPAN class="n">y</SPAN><SPAN class="p">[</SPAN><SPAN class="n">i</SPAN><SPAN class="p">])</SPAN><SPAN class="n">y_random</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[]</SPAN><SPAN class="c"># Randomize the stripped set of data points (mimiks experimental noise)</SPAN><SPAN class="k">for</SPAN><SPAN class="n">i</SPAN><SPAN class="ow">in</SPAN><SPAN class="n">y_stripped</SPAN><SPAN class="p">:</SPAN><SPAN class="n">y_random</SPAN><SPAN class="o">.</SPAN><SPAN class="n">append</SPAN><SPAN class="p">(</SPAN><SPAN class="n">randomize</SPAN><SPAN class="p">(</SPAN><SPAN class="n">i</SPAN><SPAN class="p">))</SPAN><SPAN class="k">return</SPAN><SPAN class="n">t_stripped</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y_random</SPAN><SPAN class="c"># Test function representing the system of ODEs</SPAN><SPAN class="n">test_function</SPAN><SPAN class="o">=</SPAN><SPAN class="n">rapid_equilibrium</SPAN><SPAN class="n">dt</SPAN><SPAN class="o">=</SPAN><SPAN class="mf">0.1</SPAN><SPAN class="n">t0</SPAN><SPAN class="o">=</SPAN><SPAN class="mi">0</SPAN><SPAN class="n">T</SPAN><SPAN class="o">=</SPAN><SPAN class="mi">100</SPAN><SPAN class="n">y0</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Creates noisy data</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="o">=</SPAN><SPAN class="n">random_data</SPAN><SPAN class="p">(</SPAN><SPAN class="n">dt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">test_function</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">T</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">)</SPAN><SPAN class="n">y</SPAN><SPAN class="o">=</SPAN><SPAN class="n">np</SPAN><SPAN class="o">.</SPAN><SPAN class="n">asarray</SPAN><SPAN class="p">(</SPAN><SPAN class="n">y</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Initial guess for the parameters</SPAN><SPAN class="n">pars0</SPAN><SPAN class="o">=</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">,</SPAN><SPAN class="mf">0.01</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Crate a ODEFit object: data points are the noisy solution</SPAN><SPAN class="n">myfit</SPAN><SPAN class="o">=</SPAN><SPAN class="n">ODEFit</SPAN><SPAN class="p">(</SPAN><SPAN class="n">test_function</SPAN><SPAN class="p">,</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y0</SPAN><SPAN class="p">,</SPAN><SPAN class="n">pars0</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Fit noisy data points</SPAN><SPAN class="n">pars</SPAN><SPAN class="o">=</SPAN><SPAN class="n">myfit</SPAN><SPAN class="o">.</SPAN><SPAN class="n">fit</SPAN><SPAN class="p">()[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="c"># Extracts only the real parameters and not initial conditions</SPAN><SPAN class="c"># Print parameters</SPAN><SPAN class="k">print</SPAN><SPAN class="p">(</SPAN><SPAN class="n">pars</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Solve the system of ODEs using optimal parameters</SPAN><SPAN class="n">tt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">yy</SPAN><SPAN class="o">=</SPAN><SPAN class="n">myfit</SPAN><SPAN class="o">.</SPAN><SPAN class="n">solve_fitted</SPAN><SPAN class="p">()</SPAN><SPAN class="n">plt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">plot</SPAN><SPAN class="p">(</SPAN><SPAN class="n">t</SPAN><SPAN class="p">,</SPAN><SPAN class="n">y</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'x'</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Plot noisy data</SPAN><SPAN class="n">plt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">plot</SPAN><SPAN class="p">(</SPAN><SPAN class="n">tt</SPAN><SPAN class="p">,</SPAN><SPAN class="n">yy</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Plot fiting function</SPAN><SPAN class="n">plt</SPAN><SPAN class="o">.</SPAN><SPAN class="n">show</SPAN><SPAN class="p">()</SPAN></PRE></DIV></DIV></DIV></DIV><DIV id="HB" class="tab-pane fade"><DIV class="row"><DIV class="col-md-10 col-md-offset-1 text-justify"><H3>Human Blaster</H3><P>The Human blaster allows the user to check if a gRNA complementary sequence is present in the human genome.</P><P>This program can help iGEM teams that seek to implement the use of gRNAs in their project.</P><DIV class="highlight"><PRE><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">Copyright (C) 2015 iGEM Team EPF_Lausanne</SPAN><SPAN class="sd">This program is free software: you can redistribute it and/or modify</SPAN><SPAN class="sd">it under the terms of the GNU General Public License as published by</SPAN><SPAN class="sd">the Free Software Foundation, either version 3 of the License, or</SPAN><SPAN class="sd">(at your option) any later version.</SPAN><SPAN class="sd">This program is distributed in the hope that it will be useful,</SPAN><SPAN class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</SPAN><SPAN class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</SPAN><SPAN class="sd">GNU General Public License for more details.</SPAN><SPAN class="sd">You should have received a copy of the GNU General Public License</SPAN><SPAN class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</SPAN><SPAN class="sd">HumanBlaster.py -- blasts gRNAs against human genome</SPAN><SPAN class="sd">Requirements :</SPAN><SPAN class="sd">    - Install selenium on your computer:</SPAN><SPAN class="sd">        http://selenium-python.readthedocs.org/en/latest/installation.html</SPAN><SPAN class="sd">    - Save the gRNAs in a file named gRNAs like this : name:sequence</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">selenium</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">webdriver</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">selenium.webdriver.common.keys</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">Keys</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">selenium.webdriver.support.ui</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">Select</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">selenium.webdriver.common.by</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">By</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">selenium.webdriver.support.ui</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">WebDriverWait</SPAN><SPAN class="kn">from</SPAN><SPAN class="nn">selenium.webdriver.support</SPAN><SPAN class="kn">import</SPAN><SPAN class="n">expected_conditions</SPAN><SPAN class="k">as</SPAN><SPAN class="n">EC</SPAN><SPAN class="kn">import</SPAN><SPAN class="nn">os</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">skip</SPAN><SPAN class="p">(</SPAN><SPAN class="n">inp</SPAN><SPAN class="p">,</SPAN><SPAN class="n">nb</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Skip NB lines on INP file.</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="k">for</SPAN><SPAN class="n">_</SPAN><SPAN class="ow">in</SPAN><SPAN class="nb">range</SPAN><SPAN class="p">(</SPAN><SPAN class="n">nb</SPAN><SPAN class="p">):</SPAN><SPAN class="n">inp</SPAN><SPAN class="o">.</SPAN><SPAN class="n">readline</SPAN><SPAN class="p">()</SPAN><SPAN class="k">def</SPAN><SPAN class="nf">seqReader</SPAN><SPAN class="p">(</SPAN><SPAN class="n">inp</SPAN><SPAN class="p">,</SPAN><SPAN class="n">initSkip</SPAN><SPAN class="p">):</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="sd">    Analyse the blast sequence.</SPAN><SPAN class="sd">    This function will display the percentage of similarity with a sequence in</SPAN><SPAN class="sd">    the human genome.</SPAN><SPAN class="sd">    You can change the sensibility of the script by changing the conditions</SPAN><SPAN class="sd">        cond = (int(k[6]) == 1 and int(k[7]) &gt;= 23)</SPAN><SPAN class="sd">        cond = (int(k[7]) == 23 and int(k[6]) &lt;= 1)</SPAN><SPAN class="sd">&quot;&quot;&quot;</SPAN><SPAN class="n">skip</SPAN><SPAN class="p">(</SPAN><SPAN class="n">inp</SPAN><SPAN class="p">,</SPAN><SPAN class="n">initSkip</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Skip initial lines</SPAN><SPAN class="n">line</SPAN><SPAN class="o">=</SPAN><SPAN class="n">inp</SPAN><SPAN class="o">.</SPAN><SPAN class="n">readline</SPAN><SPAN class="p">()</SPAN><SPAN class="n">name</SPAN><SPAN class="o">=</SPAN><SPAN class="nb">str</SPAN><SPAN class="p">(</SPAN><SPAN class="n">line</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;:&quot;</SPAN><SPAN class="p">)[</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">][</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">:</SPAN><SPAN class="o">-</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">])</SPAN><SPAN class="n">skip</SPAN><SPAN class="p">(</SPAN><SPAN class="n">inp</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">4</SPAN><SPAN class="p">)</SPAN><SPAN class="c"># Skip four lines</SPAN><SPAN class="n">l</SPAN><SPAN class="o">=</SPAN><SPAN class="n">inp</SPAN><SPAN class="o">.</SPAN><SPAN class="n">readline</SPAN><SPAN class="p">()</SPAN><SPAN class="n">war</SPAN><SPAN class="o">=</SPAN><SPAN class="mi">0</SPAN><SPAN class="k">while</SPAN><SPAN class="n">l</SPAN><SPAN class="o">!=</SPAN><SPAN class="s">&quot;&quot;</SPAN><SPAN class="ow">and</SPAN><SPAN class="n">l</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="o">!=</SPAN><SPAN class="s">&quot;#&quot;</SPAN><SPAN class="p">:</SPAN><SPAN class="n">k</SPAN><SPAN class="o">=</SPAN><SPAN class="n">l</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\t</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="k">if</SPAN><SPAN class="nb">len</SPAN><SPAN class="p">(</SPAN><SPAN class="n">k</SPAN><SPAN class="p">)</SPAN><SPAN class="o">&lt;</SPAN><SPAN class="mi">7</SPAN><SPAN class="p">:</SPAN><SPAN class="k">return</SPAN><SPAN class="s">&quot;&quot;</SPAN><SPAN class="k">if</SPAN><SPAN class="p">(</SPAN><SPAN class="n">name</SPAN><SPAN class="p">[:</SPAN><SPAN class="mi">2</SPAN><SPAN class="p">]</SPAN><SPAN class="o">==</SPAN><SPAN class="s">&quot;CC&quot;</SPAN><SPAN class="p">):</SPAN><SPAN class="n">cond</SPAN><SPAN class="o">=</SPAN><SPAN class="p">(</SPAN><SPAN class="nb">int</SPAN><SPAN class="p">(</SPAN><SPAN class="n">k</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">6</SPAN><SPAN class="p">])</SPAN><SPAN class="o">==</SPAN><SPAN class="mi">1</SPAN><SPAN class="ow">and</SPAN><SPAN class="nb">int</SPAN><SPAN class="p">(</SPAN><SPAN class="n">k</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">7</SPAN><SPAN class="p">])</SPAN><SPAN class="o">&gt;=</SPAN><SPAN class="mi">23</SPAN><SPAN class="p">)</SPAN><SPAN class="k">else</SPAN><SPAN class="p">:</SPAN><SPAN class="n">cond</SPAN><SPAN class="o">=</SPAN><SPAN class="p">(</SPAN><SPAN class="nb">int</SPAN><SPAN class="p">(</SPAN><SPAN class="n">k</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">7</SPAN><SPAN class="p">])</SPAN><SPAN class="o">==</SPAN><SPAN class="mi">23</SPAN><SPAN class="ow">and</SPAN><SPAN class="nb">int</SPAN><SPAN class="p">(</SPAN><SPAN class="n">k</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">6</SPAN><SPAN class="p">])</SPAN><SPAN class="o">&lt;=</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">)</SPAN><SPAN class="k">if</SPAN><SPAN class="n">cond</SPAN><SPAN class="p">:</SPAN><SPAN class="k">print</SPAN><SPAN class="p">(</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;: &quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">k</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">]</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;|&quot;</SPAN><SPAN class="p">)[</SPAN><SPAN class="mi">3</SPAN><SPAN class="p">]</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot; with &quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">k</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">2</SPAN><SPAN class="p">]</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="si">% s</SPAN><SPAN class="s">imilarity, &quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">k</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">4</SPAN><SPAN class="p">]</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot; mismatches.&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">l</SPAN><SPAN class="o">=</SPAN><SPAN class="n">inp</SPAN><SPAN class="o">.</SPAN><SPAN class="n">readline</SPAN><SPAN class="p">()</SPAN><SPAN class="k">return</SPAN><SPAN class="n">l</SPAN><SPAN class="k">with</SPAN><SPAN class="nb">open</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;gRNAs&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'r'</SPAN><SPAN class="p">)</SPAN><SPAN class="k">as</SPAN><SPAN class="n">input1</SPAN><SPAN class="p">,</SPAN><SPAN class="nb">open</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;FASTA_gRNAs&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'w'</SPAN><SPAN class="p">)</SPAN><SPAN class="k">as</SPAN><SPAN class="n">output</SPAN><SPAN class="p">:</SPAN><SPAN class="n">text</SPAN><SPAN class="o">=</SPAN><SPAN class="s">&quot;&quot;</SPAN><SPAN class="k">for</SPAN><SPAN class="n">i</SPAN><SPAN class="ow">in</SPAN><SPAN class="n">input1</SPAN><SPAN class="p">:</SPAN><SPAN class="n">name</SPAN><SPAN class="o">=</SPAN><SPAN class="n">i</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;:&quot;</SPAN><SPAN class="p">)[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">=</SPAN><SPAN class="n">i</SPAN><SPAN class="o">.</SPAN><SPAN class="n">split</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;:&quot;</SPAN><SPAN class="p">)[</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">][:</SPAN><SPAN class="o">-</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">]</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_TGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;TGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_GGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;GGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_AGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;AGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_CGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_TGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;TGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_GGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;GGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_AGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;AGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;_CGG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CGG</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCG_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCC_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCC&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCA_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCA&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">text</SPAN><SPAN class="o">+=</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCT_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCT&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCG_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCG&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCC_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCC&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCA_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCA&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">output</SPAN><SPAN class="o">.</SPAN><SPAN class="n">write</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;&gt;&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCT_&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">name</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;CCT&quot;</SPAN><SPAN class="o">+</SPAN><SPAN class="n">seq</SPAN><SPAN class="o">+</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">=</SPAN><SPAN class="n">webdriver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">Firefox</SPAN><SPAN class="p">()</SPAN><SPAN class="c"># Will open Firefox</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">get</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;http://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&amp;PAGE_TYPE=BlastSearch&amp;LINK_LOC=blasthome&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="c">#Address</SPAN><SPAN class="k">assert</SPAN><SPAN class="s">&quot;Nucleotide BLAST: Search nucleotide databases using a nucleotide query&quot;</SPAN><SPAN class="ow">in</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">title</SPAN><SPAN class="n">elem</SPAN><SPAN class="o">=</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">find_element_by_id</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;seq&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="c">#Selects the place where the sequences will be written</SPAN><SPAN class="n">elem</SPAN><SPAN class="o">.</SPAN><SPAN class="n">send_keys</SPAN><SPAN class="p">(</SPAN><SPAN class="n">text</SPAN><SPAN class="p">)</SPAN><SPAN class="c">#Writes them</SPAN><SPAN class="n">elem</SPAN><SPAN class="o">=</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">find_element_by_id</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;qtitle&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">elem</SPAN><SPAN class="o">.</SPAN><SPAN class="n">send_keys</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;Our Blast&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="c">#Change here if you want to have another name for the BLAST</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">find_element_by_id</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;Rhc&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">click</SPAN><SPAN class="p">()</SPAN><SPAN class="c">#Chooses human genome</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">find_element_by_id</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;b1&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">click</SPAN><SPAN class="p">()</SPAN><SPAN class="c">#Starts the BLAST</SPAN><SPAN class="c">#Will wait 500000 seconds or until the download page is ready</SPAN><SPAN class="k">try</SPAN><SPAN class="p">:</SPAN><SPAN class="n">element</SPAN><SPAN class="o">=</SPAN><SPAN class="n">WebDriverWait</SPAN><SPAN class="p">(</SPAN><SPAN class="n">driver</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">500000</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">until</SPAN><SPAN class="p">(</SPAN><SPAN class="n">EC</SPAN><SPAN class="o">.</SPAN><SPAN class="n">presence_of_element_located</SPAN><SPAN class="p">((</SPAN><SPAN class="n">By</SPAN><SPAN class="o">.</SPAN><SPAN class="n">XPATH</SPAN><SPAN class="p">,</SPAN><SPAN class="s">&quot;/html/body/div[1]/div[2]/div[3]/div[2]/form/table/tbody/tr[2]/td[1]/div[2]/a[5]&quot;</SPAN><SPAN class="p">)))</SPAN><SPAN class="k">finally</SPAN><SPAN class="p">:</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">close</SPAN><SPAN class="p">()</SPAN><SPAN class="c">#Will leave if it takes too long (13 hours max, should be enough)</SPAN><SPAN class="n">download</SPAN><SPAN class="o">=</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">find_element_by_id</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;showDownload&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">click</SPAN><SPAN class="p">()</SPAN><SPAN class="c">#Will start the download</SPAN><SPAN class="n">download</SPAN><SPAN class="o">=</SPAN><SPAN class="n">driver</SPAN><SPAN class="o">.</SPAN><SPAN class="n">find_element_by_id</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;hitText&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="o">.</SPAN><SPAN class="n">click</SPAN><SPAN class="p">()</SPAN><SPAN class="k">print</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;You need to save the file in this folder using the name resultat.txt&quot;</SPAN><SPAN class="p">)</SPAN><SPAN class="n">continuation</SPAN><SPAN class="o">=</SPAN><SPAN class="nb">input</SPAN><SPAN class="p">(</SPAN><SPAN class="s">'When you are done press 1</SPAN><SPAN class="se">\n</SPAN><SPAN class="s">'</SPAN><SPAN class="p">)</SPAN><SPAN class="k">if</SPAN><SPAN class="n">continuation</SPAN><SPAN class="p">:</SPAN><SPAN class="k">with</SPAN><SPAN class="nb">open</SPAN><SPAN class="p">(</SPAN><SPAN class="s">&quot;resultat.txt&quot;</SPAN><SPAN class="p">,</SPAN><SPAN class="s">'r'</SPAN><SPAN class="p">)</SPAN><SPAN class="k">as</SPAN><SPAN class="n">inp</SPAN><SPAN class="p">:</SPAN><SPAN class="n">l</SPAN><SPAN class="o">=</SPAN><SPAN class="n">seqReader</SPAN><SPAN class="p">(</SPAN><SPAN class="n">inp</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">2</SPAN><SPAN class="p">)</SPAN><SPAN class="k">while</SPAN><SPAN class="p">(</SPAN><SPAN class="n">l</SPAN><SPAN class="o">!=</SPAN><SPAN class="s">&quot;&quot;</SPAN><SPAN class="ow">and</SPAN><SPAN class="n">l</SPAN><SPAN class="p">[</SPAN><SPAN class="mi">0</SPAN><SPAN class="p">]</SPAN><SPAN class="o">==</SPAN><SPAN class="s">&quot;#&quot;</SPAN><SPAN class="p">):</SPAN><SPAN class="n">l</SPAN><SPAN class="o">=</SPAN><SPAN class="n">seqReader</SPAN><SPAN class="p">(</SPAN><SPAN class="n">inp</SPAN><SPAN class="p">,</SPAN><SPAN class="mi">1</SPAN><SPAN class="p">)</SPAN></PRE></DIV></DIV></DIV></DIV></DIV></DIV><TITLE>EPFL 2015 iGEM bioLogic Logic Orthogonal gRNA Implemented Circuits</TITLE></DIV></DIV></DIV></DIV></BODY></HTML>