<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_WashU_StLouis_js_module-manager_js skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:WashU StLouis/js/module-manager.js</SPAN></H1><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><P>var addModule = (function(){
</P><PRE> var modules = []
</PRE><PRE> calcPositions = _.throttle(function(){
   modules.forEach(function(d){
     d.bbox     = d.sel.node().getBoundingClientRect()
     d.startPos = d.bbox.top    + pageYOffset - innerHeight
     d.endPos   = d.bbox.bottom + pageYOffset
   })
 }, 1000)
</PRE><PRE> d3.select(window).on('scroll.module', _.debounce(function(d){
   modules.forEach(function(d){
     //exit early if calcPositions hasn't run yet
     if (!d.startPos) return
</PRE><PRE>     var wasActive = !!d.active;
     d.active = d.startPos &lt; pageYOffset &amp;&amp; pageYOffset &lt; d.endPos
     d.active = d.active &amp;&amp; innerWidth &gt; d.minWidth
     d.active = d.active
</PRE><PRE>     // if module hasn't yet been initiated, call init function
     if(d.active &amp;&amp; !d.initiated) {
       d.initiated = true;
       d.oninit ? d.oninit() : null;
     }
</PRE><PRE>     // if active changed, call load / unload function
     if (d.active != wasActive) {
       d.active &amp;&amp; d.onload ? d.onload(d) : null;
       !d.active &amp;&amp; d.onunload ? d.onunload(d) : null;
     }
   })
 }, 50))
</PRE><PRE> setTimeout(d3.select(window).on('scroll.module'), 1000)
</PRE><PRE> d3.select(window).on('resize.module', calcPositions)
</PRE><PRE> //content on page moves without trigging any resizing...?
 setInterval(calcPositions, 20000)
</PRE><PRE> return function(d){
   // if (!d.sel.node()) debugger
   d.minWidth = d.minWidth || 1020
   modules.push(d)
   calcPositions()
 }
</PRE><P>})()
</P><P>//random global varibles go here?
var blue  = '#2800d7'
var Lblue = '#6381ff'
var purple = '#c63eff'
var Lpurple = '#fc99ff'
var green = '#00c770'
var Lgreen = '#91f29b'
var red = '#f94600'
</P><P>var orange = 'rgb(252, 192, 73)'
</P><P>var colorArray = [blue, purple, green, red, Lblue, Lpurple, Lgreen]
</P></DIV></DIV></DIV></DIV></BODY></HTML>