<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_KU_Leuven_Modeling_1dsource skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:KU Leuven/Modeling/1dsource</SPAN></H1><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><P><TITLE>script1.m</TITLE><PRE class="hl"><SPAN class="hl slc">% The matlab source code used to compute the 2d simulation at the top of</SPAN><SPAN class="hl slc">% the page. </SPAN><SPAN class="hl slc">% The 2015 Ku Leuven Igem team.</SPAN><SPAN class="hl slc">%% Load constants.</SPAN>
Da <SPAN class="hl opt">=</SPAN><SPAN class="hl num">0.072</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">3</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%1*10^(-6)*3600; %(cm)^2/h;</SPAN>
Db <SPAN class="hl opt">=</SPAN><SPAN class="hl num">2.376</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">3</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%5*10^(-6)*3600; %(cm)^2/h;</SPAN>
Dr <SPAN class="hl opt">=</SPAN><SPAN class="hl num">60</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">3</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%(cm)^2/h;</SPAN>
Dh <SPAN class="hl opt">=</SPAN><SPAN class="hl num">50</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">3</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%(cm)^2/h;</SPAN>

dt <SPAN class="hl opt">=</SPAN><SPAN class="hl num">0.015</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">%h</SPAN>
tend <SPAN class="hl opt">=</SPAN><SPAN class="hl num">121</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">%h</SPAN>
Xlen <SPAN class="hl opt">=</SPAN><SPAN class="hl num">8.0</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">%cm</SPAN>
J <SPAN class="hl opt">=</SPAN><SPAN class="hl num">40</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">%#</SPAN>

dx <SPAN class="hl opt">=</SPAN> Xlen<SPAN class="hl opt">/</SPAN>J<SPAN class="hl opt">;</SPAN><SPAN class="hl slc">%cm</SPAN>
steps <SPAN class="hl opt">=</SPAN> tend<SPAN class="hl opt">/</SPAN>dt <SPAN class="hl slc">%#</SPAN>
mu <SPAN class="hl opt">=</SPAN> dt<SPAN class="hl opt">/</SPAN>dx^<SPAN class="hl num">2</SPAN><SPAN class="hl slc">%s/cm^2</SPAN>

A <SPAN class="hl opt">=</SPAN> zeros<SPAN class="hl opt">(</SPAN>int32<SPAN class="hl opt">(</SPAN>steps<SPAN class="hl opt">),</SPAN>J<SPAN class="hl opt">);</SPAN>
B <SPAN class="hl opt">=</SPAN> zeros<SPAN class="hl opt">(</SPAN>int32<SPAN class="hl opt">(</SPAN>steps<SPAN class="hl opt">),</SPAN>J<SPAN class="hl opt">);</SPAN>
R <SPAN class="hl opt">=</SPAN> zeros<SPAN class="hl opt">(</SPAN>int32<SPAN class="hl opt">(</SPAN>steps<SPAN class="hl opt">),</SPAN>J<SPAN class="hl opt">);</SPAN>
H <SPAN class="hl opt">=</SPAN> zeros<SPAN class="hl opt">(</SPAN>int32<SPAN class="hl opt">(</SPAN>steps<SPAN class="hl opt">),</SPAN>J<SPAN class="hl opt">);</SPAN>

preDif <SPAN class="hl opt">=</SPAN> zeros<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN>J<SPAN class="hl opt">);</SPAN>

Kc <SPAN class="hl opt">=</SPAN><SPAN class="hl num">0.015</SPAN><SPAN class="hl opt">;</SPAN>
gamma <SPAN class="hl opt">=</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">5</SPAN><SPAN class="hl opt">);</SPAN>
As <SPAN class="hl opt">=</SPAN><SPAN class="hl num">1.0</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">% (cl)^(-1);</SPAN>
Bs <SPAN class="hl opt">=</SPAN><SPAN class="hl num">1.0</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">% (cl)^(-1);</SPAN>
kr <SPAN class="hl opt">=</SPAN><SPAN class="hl num">1.584</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">4</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%nmol/h</SPAN>
kh <SPAN class="hl opt">=</SPAN><SPAN class="hl num">1.5</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">1.584</SPAN><SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">4</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%nmol/h</SPAN>
KAbsorbR <SPAN class="hl opt">=</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">5</SPAN><SPAN class="hl opt">);</SPAN>
KAbsorbH <SPAN class="hl opt">=</SPAN><SPAN class="hl num">10</SPAN>^<SPAN class="hl opt">(-</SPAN><SPAN class="hl num">5</SPAN><SPAN class="hl opt">);</SPAN>
idx <SPAN class="hl opt">=</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">:</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">:(</SPAN>J<SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%% Set intial condition.</SPAN>
x <SPAN class="hl opt">=</SPAN> meshgrid<SPAN class="hl opt">(</SPAN>linspace<SPAN class="hl opt">(</SPAN><SPAN class="hl num">0</SPAN><SPAN class="hl opt">,</SPAN>Xlen<SPAN class="hl opt">,</SPAN>J<SPAN class="hl opt">));</SPAN>
x <SPAN class="hl opt">= -</SPAN><SPAN class="hl num">100</SPAN><SPAN class="hl opt">*(</SPAN>x <SPAN class="hl opt">-</SPAN> x.^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">)</SPAN>.<SPAN class="hl opt">*</SPAN><SPAN class="hl kwb">exp</SPAN><SPAN class="hl opt">(-</SPAN><SPAN class="hl num">1</SPAN> .<SPAN class="hl opt">*((</SPAN>x <SPAN class="hl opt">-</SPAN><SPAN class="hl num">4</SPAN><SPAN class="hl opt">)</SPAN>.^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">));</SPAN><SPAN class="hl slc">%Cell density of celly type A.</SPAN>
A<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:) =</SPAN> x<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:) +</SPAN><SPAN class="hl kwb">abs</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl num">0.01</SPAN><SPAN class="hl opt">*</SPAN>randn<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">length</SPAN><SPAN class="hl opt">(</SPAN>x<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:))));</SPAN><SPAN class="hl slc">%A(1,(J/2-2):(J/2+2)) = 2;</SPAN><SPAN class="hl slc">%Cell density of cell type B.</SPAN>
B<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:) =</SPAN> x<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:) +</SPAN><SPAN class="hl kwb">abs</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl num">0.01</SPAN><SPAN class="hl opt">*</SPAN>randn<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">length</SPAN><SPAN class="hl opt">(</SPAN>x<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:))));</SPAN><SPAN class="hl slc">%B(1,(J/2-2):(J/2+2)) = 2;</SPAN><SPAN class="hl slc">%Concentration of the replellant.</SPAN>
R<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:) =</SPAN><SPAN class="hl num">0.01</SPAN><SPAN class="hl opt">;</SPAN>
H<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,:) =</SPAN><SPAN class="hl num">0.01</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">%% run simulation.</SPAN><SPAN class="hl kwa">for</SPAN> t <SPAN class="hl opt">=</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">:</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">:</SPAN>steps
    
    <SPAN class="hl slc">%% Compute the next time step of the A-Type cells:</SPAN><SPAN class="hl slc">%A(t+1,:) = A(t,:);</SPAN>
    A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) =</SPAN> A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) + (</SPAN>dt.<SPAN class="hl opt">* (</SPAN>Da<SPAN class="hl opt">/</SPAN>dx^<SPAN class="hl num">2</SPAN>  .<SPAN class="hl opt">* (</SPAN> A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN><SPAN class="hl num">2</SPAN>.<SPAN class="hl opt">*</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">)))</SPAN> ...
                 <SPAN class="hl opt">+</SPAN>gamma.<SPAN class="hl opt">*</SPAN> A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">)</SPAN> .<SPAN class="hl opt">* (</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">-</SPAN> A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">)</SPAN>.<SPAN class="hl opt">/</SPAN>As<SPAN class="hl opt">));</SPAN><SPAN class="hl slc">%% Compute the next time step of the B-Type cells:</SPAN><SPAN class="hl slc">%Xn =  -B(t,:) .* (Db.*Kc1./(Kc2 + Kc3.*H(t,:).*R(t,:)));</SPAN>
    Xn <SPAN class="hl opt">= -</SPAN>B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,:)</SPAN> .<SPAN class="hl opt">*</SPAN> Kc .<SPAN class="hl opt">*</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,:)</SPAN>.<SPAN class="hl opt">/(</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,:));</SPAN>
   
    betaP <SPAN class="hl opt">= (</SPAN>Xn<SPAN class="hl opt">(</SPAN>idx<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> Xn<SPAN class="hl opt">(</SPAN>idx<SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">;</SPAN> 
    betaN <SPAN class="hl opt">= (</SPAN>Xn<SPAN class="hl opt">(</SPAN>idx<SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> Xn<SPAN class="hl opt">(</SPAN>idx<SPAN class="hl opt">))</SPAN> .<SPAN class="hl opt">/</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">;</SPAN>
        
    B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) =</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) +</SPAN>  ...
                 dt .<SPAN class="hl opt">* (</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">/</SPAN>dx^<SPAN class="hl num">2</SPAN>  .<SPAN class="hl opt">* (</SPAN>Db.<SPAN class="hl opt">*(</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN><SPAN class="hl num">2</SPAN>.<SPAN class="hl opt">*</SPAN>B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">))</SPAN> ...
                     <SPAN class="hl opt">- (</SPAN>betaP .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">))</SPAN> ...
                     <SPAN class="hl opt">-</SPAN>  betaN .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">)-</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">))))</SPAN>...
                     <SPAN class="hl opt">+</SPAN> gamma .<SPAN class="hl opt">*</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">)</SPAN> .<SPAN class="hl opt">* (</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">-</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">)</SPAN>.<SPAN class="hl opt">/</SPAN>Bs<SPAN class="hl opt">));</SPAN><SPAN class="hl slc">%% Compute the repellant:</SPAN>
    R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) =</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) +</SPAN> dt<SPAN class="hl opt">*(</SPAN> Dr .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN>  ...
                 <SPAN class="hl num">2</SPAN><SPAN class="hl opt">*</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/(</SPAN>dx^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">) +</SPAN> kr.<SPAN class="hl opt">*</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) -</SPAN> KAbsorbR <SPAN class="hl opt">*</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">));</SPAN><SPAN class="hl slc">%% Compute the AHL    </SPAN>
    H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) =</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) +</SPAN> dt<SPAN class="hl opt">*(</SPAN> Dh .<SPAN class="hl opt">* (</SPAN>H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN>  ...
                 <SPAN class="hl num">2</SPAN><SPAN class="hl opt">*</SPAN>H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/(</SPAN>dx^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">) +</SPAN> kh.<SPAN class="hl opt">*</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">) -</SPAN> KAbsorbH <SPAN class="hl opt">*</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN>idx<SPAN class="hl opt">));</SPAN><SPAN class="hl slc">%% Symmetric boundary conditions:</SPAN><SPAN class="hl slc">%A</SPAN><SPAN class="hl slc">%A(t+1,1)   = A(t,1) + dt/dx^2 * (Da*( A(t,2)+A(t,end) - 2*A(t,1)));</SPAN><SPAN class="hl slc">%A(t+1,end) = B(t,end) + dt/dx^2 * (Da*(A(t,end-1)+A(t,1) - 2*A(t,end)));</SPAN>
    A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) =</SPAN><SPAN class="hl num">0</SPAN><SPAN class="hl opt">;</SPAN>
    A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) =</SPAN><SPAN class="hl num">0</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">%B</SPAN>
    betaP    <SPAN class="hl opt">= (</SPAN>Xn<SPAN class="hl opt">(</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">) +</SPAN> Xn<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">;</SPAN>
    betaBeam <SPAN class="hl opt">= (</SPAN>Xn<SPAN class="hl opt">(</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) +</SPAN> Xn<SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">;</SPAN>
    B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">)   =</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> ...
                     dt .<SPAN class="hl opt">* (</SPAN>Db<SPAN class="hl opt">/</SPAN>dx^<SPAN class="hl num">2</SPAN> .<SPAN class="hl opt">* (</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) +</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">) -</SPAN><SPAN class="hl num">2</SPAN>.<SPAN class="hl opt">*</SPAN>B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">))</SPAN> ...
                     <SPAN class="hl opt">- (</SPAN>betaP .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">) -</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">))</SPAN> ...
                     <SPAN class="hl opt">-</SPAN>  betaBeam .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">)-</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">))))</SPAN> ...
                    <SPAN class="hl opt">+</SPAN> gamma .<SPAN class="hl opt">*</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">)</SPAN> .<SPAN class="hl opt">* (</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">-</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">)</SPAN>.<SPAN class="hl opt">/</SPAN>Bs<SPAN class="hl opt">);</SPAN>
    betaN   <SPAN class="hl opt">= (</SPAN>Xn<SPAN class="hl opt">(</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> Xn<SPAN class="hl opt">(</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">;</SPAN>
    B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) =</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) +</SPAN> ...
                     dt .<SPAN class="hl opt">* (</SPAN>Db<SPAN class="hl opt">/</SPAN>dx^<SPAN class="hl num">2</SPAN> .<SPAN class="hl opt">* (</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN><SPAN class="hl num">2</SPAN>.<SPAN class="hl opt">*</SPAN>B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">))</SPAN> ...
                     <SPAN class="hl opt">- (</SPAN>betaBeam .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">))</SPAN> ...
                     <SPAN class="hl opt">-</SPAN>  betaN .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">)-</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">)))</SPAN> ...
                     <SPAN class="hl opt">+</SPAN> gamma .<SPAN class="hl opt">*</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">)</SPAN> .<SPAN class="hl opt">* (</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">-</SPAN> B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">)</SPAN>.<SPAN class="hl opt">/</SPAN>Bs<SPAN class="hl opt">));</SPAN><SPAN class="hl slc">%Repellant             </SPAN>
    R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) =</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> dt<SPAN class="hl opt">*(</SPAN> Dr .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">) +</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">)</SPAN>...
                 <SPAN class="hl opt">-</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">*</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/(</SPAN>dx^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">) -</SPAN> kr.<SPAN class="hl opt">*</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">));</SPAN>
    R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) =</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) +</SPAN> dt<SPAN class="hl opt">*(</SPAN> Dr .<SPAN class="hl opt">* (</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">)</SPAN> ...
                 <SPAN class="hl opt">+</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">*</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/(</SPAN>dx^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">)</SPAN> ...
                 <SPAN class="hl opt">+</SPAN> kr.<SPAN class="hl opt">*</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) -</SPAN> KAbsorbR <SPAN class="hl opt">*</SPAN> R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">));</SPAN><SPAN class="hl slc">%AHL</SPAN>
    H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) =</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) +</SPAN> dt<SPAN class="hl opt">*(</SPAN> Dh .<SPAN class="hl opt">* (</SPAN>H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">) +</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">)</SPAN>...
                 <SPAN class="hl opt">-</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">*</SPAN>H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/(</SPAN>dx^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">) -</SPAN> kh.<SPAN class="hl opt">*</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">));</SPAN>
    H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">+</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) =</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) +</SPAN> dt<SPAN class="hl opt">*(</SPAN> Dh .<SPAN class="hl opt">* (</SPAN>H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">)</SPAN> ...
                 <SPAN class="hl opt">+</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">-</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">) -</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">*</SPAN>H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">))</SPAN>.<SPAN class="hl opt">/(</SPAN>dx^<SPAN class="hl num">2</SPAN><SPAN class="hl opt">)</SPAN> ...
                 <SPAN class="hl opt">+</SPAN> kh.<SPAN class="hl opt">*</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">) -</SPAN> KAbsorbH <SPAN class="hl opt">*</SPAN> H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl opt">));</SPAN><SPAN class="hl kwa">end</SPAN><SPAN class="hl kwb">figure</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">clf</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl kwb">surf</SPAN><SPAN class="hl opt">(</SPAN>A<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">shading</SPAN><SPAN class="hl opt">(</SPAN>'flat'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">xlabel</SPAN><SPAN class="hl opt">(</SPAN>'x'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">ylabel</SPAN><SPAN class="hl opt">(</SPAN>'time'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">title</SPAN><SPAN class="hl opt">(</SPAN>'<SPAN class="hl kwa">cell</SPAN> A'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">zlabel</SPAN><SPAN class="hl opt">(</SPAN>'<SPAN class="hl kwa">cell</SPAN> density'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">figure</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl num">2</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">clf</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl kwb">surf</SPAN><SPAN class="hl opt">(</SPAN>B<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">shading</SPAN><SPAN class="hl opt">(</SPAN>'flat'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">xlabel</SPAN><SPAN class="hl opt">(</SPAN>'x'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">ylabel</SPAN><SPAN class="hl opt">(</SPAN>'time'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">title</SPAN><SPAN class="hl opt">(</SPAN>'<SPAN class="hl kwa">cell</SPAN> B'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">zlabel</SPAN><SPAN class="hl opt">(</SPAN>'<SPAN class="hl kwa">cell</SPAN> density'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">figure</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl num">3</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">clf</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl kwb">surf</SPAN><SPAN class="hl opt">(</SPAN>R<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">shading</SPAN><SPAN class="hl opt">(</SPAN>'flat'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">xlabel</SPAN><SPAN class="hl opt">(</SPAN>'x'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">ylabel</SPAN><SPAN class="hl opt">(</SPAN>'time'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">title</SPAN><SPAN class="hl opt">(</SPAN>'repellant'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">zlabel</SPAN><SPAN class="hl opt">(</SPAN>'concentration'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">figure</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl num">4</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">clf</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl kwb">surf</SPAN><SPAN class="hl opt">(</SPAN>H<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">shading</SPAN><SPAN class="hl opt">(</SPAN>'flat'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">xlabel</SPAN><SPAN class="hl opt">(</SPAN>'x'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">ylabel</SPAN><SPAN class="hl opt">(</SPAN>'time'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">title</SPAN><SPAN class="hl opt">(</SPAN>'AHL'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">zlabel</SPAN><SPAN class="hl opt">(</SPAN>'concentration'<SPAN class="hl opt">);</SPAN><SPAN class="hl slc">%% make movie:</SPAN>
 vidObj<SPAN class="hl opt">=</SPAN>VideoWriter<SPAN class="hl opt">(</SPAN>'simulation_Hours2.avi'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">set</SPAN><SPAN class="hl opt">(</SPAN>vidObj<SPAN class="hl opt">,</SPAN>'FrameRate'<SPAN class="hl opt">,</SPAN><SPAN class="hl num">16</SPAN><SPAN class="hl opt">);</SPAN>
 open<SPAN class="hl opt">(</SPAN>vidObj<SPAN class="hl opt">);</SPAN><SPAN class="hl kwa">for</SPAN> t <SPAN class="hl opt">=</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">:</SPAN><SPAN class="hl num">10</SPAN><SPAN class="hl opt">:</SPAN>steps
     <SPAN class="hl kwb">figure</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl num">1</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">clf</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl kwb">plot</SPAN><SPAN class="hl opt">(</SPAN>A<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,:));</SPAN><SPAN class="hl kwb">xlabel</SPAN><SPAN class="hl opt">(</SPAN>'x'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">ylabel</SPAN><SPAN class="hl opt">(</SPAN>'#cells and concentration<SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN>'<SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">hold</SPAN> on<SPAN class="hl opt">;</SPAN><SPAN class="hl kwb">plot</SPAN><SPAN class="hl opt">(</SPAN>B<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,:))</SPAN><SPAN class="hl kwb">plot</SPAN><SPAN class="hl opt">(</SPAN>R<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,:)</SPAN>.<SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN><SPAN class="hl opt">);</SPAN><SPAN class="hl kwb">plot</SPAN><SPAN class="hl opt">(</SPAN>H<SPAN class="hl opt">(</SPAN>t<SPAN class="hl opt">,:)</SPAN>.<SPAN class="hl opt">*</SPAN><SPAN class="hl num">10</SPAN><SPAN class="hl opt">);</SPAN>
     ylim<SPAN class="hl opt">([</SPAN><SPAN class="hl num">0 1300</SPAN><SPAN class="hl opt">]);</SPAN><SPAN class="hl kwb">legend</SPAN><SPAN class="hl opt">(</SPAN>'A'<SPAN class="hl opt">,</SPAN>'B'<SPAN class="hl opt">,</SPAN>'rep'<SPAN class="hl opt">,</SPAN>'AHL'<SPAN class="hl opt">)</SPAN><SPAN class="hl slc">% Display the time.</SPAN>
    hours <SPAN class="hl opt">=</SPAN> dt<SPAN class="hl opt">*</SPAN>t<SPAN class="hl opt">;</SPAN>
    mFigure <SPAN class="hl opt">=</SPAN><SPAN class="hl kwb">gcf</SPAN><SPAN class="hl opt">;</SPAN><SPAN class="hl slc">% Create a uicontrol of type &quot;text&quot;</SPAN>
    mTextBox <SPAN class="hl opt">=</SPAN><SPAN class="hl kwb">uicontrol</SPAN><SPAN class="hl opt">(</SPAN>'style'<SPAN class="hl opt">,</SPAN>'<SPAN class="hl kwb">text</SPAN>'<SPAN class="hl opt">)</SPAN>
    string <SPAN class="hl opt">= [</SPAN><SPAN class="hl kwb">num2str</SPAN><SPAN class="hl opt">(</SPAN>hours<SPAN class="hl opt">)</SPAN> ' h'<SPAN class="hl opt">];</SPAN><SPAN class="hl kwb">set</SPAN><SPAN class="hl opt">(</SPAN>mTextBox<SPAN class="hl opt">,</SPAN>'string'<SPAN class="hl opt">,</SPAN>string<SPAN class="hl opt">);</SPAN>
    mTextBox.Position <SPAN class="hl opt">= [</SPAN><SPAN class="hl num">85 360 80 20</SPAN><SPAN class="hl opt">];</SPAN>
    mTextBox.BackgroundColor <SPAN class="hl opt">= [</SPAN><SPAN class="hl num">1 1 1</SPAN><SPAN class="hl opt">];</SPAN>
    mTextBox.FontWeight <SPAN class="hl opt">=</SPAN> 'bold'<SPAN class="hl opt">;</SPAN>
    writeVideo<SPAN class="hl opt">(</SPAN>vidObj<SPAN class="hl opt">,</SPAN><SPAN class="hl kwb">getframe</SPAN><SPAN class="hl opt">(</SPAN><SPAN class="hl kwb">gcf</SPAN><SPAN class="hl opt">));</SPAN> 
    hours
 <SPAN class="hl kwa">end</SPAN>
 vidObj.<SPAN class="hl kwb">close</SPAN><SPAN class="hl opt">();</SPAN></PRE></P></DIV></DIV></DIV></DIV></BODY></HTML>