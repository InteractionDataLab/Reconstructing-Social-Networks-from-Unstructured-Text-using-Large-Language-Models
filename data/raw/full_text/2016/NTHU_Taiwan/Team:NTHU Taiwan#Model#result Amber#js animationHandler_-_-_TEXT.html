Team:NTHU Taiwan/Model/result Amber/js animationHandler
var animTools = {  app: null,//製作模型時需要用到的物件  buildScene: null,//用於製作模型的函數  draw: null,//用於繪製模型的函數  models: null, //儲存了各個已經過buildScene函數製作好的模型的陣列物件(僅記錄一個結果的動畫)  interval: null, //紀錄window.setInterval()傳回的物件(每間格一段時間會改變畫布上顯示的模型)  resultContainer:[] }; //animTools:用來收集製作動畫時需要的物件。在html的腳本裡會安插幾段程序將物件收集進來 var btnImages = {  start:"
",  pause:"
" }; function startBtnClicked(){  var stBtn = document.getElementById("startBtn");
if(animTools.models){//檢查是否有讀入模型   if(stBtn.alt == "start"){//繼續動畫播放    startAnimation(getDelay());   }   else{//暫停播放    clearInterval(animTools.interval);    setInputReadOnly(false);   }  }  else{   alert("You haven't load a result.");  }
if(stBtn.alt == "start"){   stBtn.src = btnImages.pause;   stBtn.alt = "pause";  }  else{   stBtn.src = btnImages.start;   stBtn.alt = "start";  } }
function getDelay(){//檢查並顯示delay的值，delay必須大於0;  var inputdelay = document.getElementById("inputDelay");  var d = inputdelay.value;  inputdelay.value = (d > 0 && d <= 2147483647) ? d : 100;  return inputdelay.value; } function getFrameNumber(){//取得並回傳當前畫格，並檢查是否為有效數字  var inputFrameN = document.getElementById("inputFrameNum");  var frameN = inputFrameN.value - 1;  frameN = (frameN%40+40)%40;  inputFrameN.value = frameN + 1;  return frameN; }
function buttonUp(btn){  document.getElementById(btn).className = "BtnUp"; } function buttonDown(btn){  document.getElementById(btn).className = "BtnDown"; }
function startAnimation(delay){  animTools.interval = setInterval(function(){   document.getElementById("inputFrameNum").value++;   updateDisplayedModel();  },delay);  setInputReadOnly(true); } function setInputReadOnly(stat){  document.getElementById("inputDelay").readOnly = stat;  document.getElementById("inputFrameNum").readOnly = stat; } function loadModels(name , jModelCollator){//將所有分子模型讀入並儲存的函數。  animTools.models = [];  var scene = animTools.app.scene;  for(var i = 0 ; i < jModelCollator.length ; i++){   for(var j = 0 ; j < jModelCollator[i].length ; j++){    scene.models = [];    animTools.buildScene(animTools.app,jModelCollator[i][j]);    animTools.models.push(scene.models);    }  }  animTools.resultContainer.push([name,animTools.models]); } function checkModelExist(name){  for(var i = 0 ; i < animTools.resultContainer.length ; i++){//檢查是否已經有建好的模型，以name判斷。若有則將此模型指定為被瀏覽的模型   if(animTools.resultContainer[i][0] == name){    animTools.models = animTools.resultContainer[i][1];    return true;   }  }  return false; } function updateDisplayedModel(){  var i = getFrameNumber();  var scene = animTools.app.scene;  scene.models = animTools.models[i];  animTools.draw(animTools.app); }
