<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_Cornell_NY_hellodismycode skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><DIV id="top_title"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:Cornell NY/hellodismycode</SPAN></H1></DIV><DIV id="HQ_page"><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><P>/**
</P><UL><LI> Maplace.js</LI><LI> Copyright (c) 2013 Daniele Moraschi</LI><LI> Licensed under the MIT license</LI><LI> For all details and documentation:</LI><LI><A rel="nofollow" class="external free" href="http://maplacejs.com">http://maplacejs.com</A></LI><LI> @version  @VERSION</LI><LI> @preserve</LI><LI>/</LI></UL><DL><DT>(function(root, factory) {</DT></DL><PRE>   if (typeof define === 'function' &amp;&amp; define.amd) {
       define(['jquery'], factory);
   } else if (typeof exports === 'object') {
       module.exports = factory(require('jquery'));
   } else {
       root.Maplace = factory(root.jQuery);
   }
</PRE><P>}(this, function($) {
</P><PRE>   'use strict';
</PRE><PRE>   var html_dropdown,
       html_ullist;
</PRE><PRE>   //dropdown menu type
   html_dropdown = {
       activateCurrent: function(index) {
           this.html_element.find('select').val(index);
       },
</PRE><PRE>       getHtml: function() {
           var self = this,
               html = <I>,</I>
               title,
               a;
</PRE><PRE>           if (this.ln &gt; 1) {
               html += '&lt;select class=&quot;dropdown controls ' + this.o.controls_cssclass + '&quot;&gt;';
</PRE><PRE>               if (this.ShowOnMenu(this.view_all_key)) {
                   html += '&lt;option value=&quot;' + this.view_all_key + '&quot;&gt;' + this.o.view_all_text + '&lt;/option&gt;';
               }
</PRE><PRE>               for (a = 0; a &lt; this.ln; a += 1) {
                   if (this.ShowOnMenu(a)) {
                       html += '&lt;option value=&quot;' + (a + 1) + '&quot;&gt;' + (this.o.locations[a].title || ('#' + (a + 1))) + '&lt;/option&gt;';
                   }
               }
               html += '&lt;/select&gt;';
</PRE><PRE>               html = $(html).bind('change', function() {
                   self.ViewOnMap(this.value);
               });
           }
</PRE><PRE>           title = this.o.controls_title;
           if (this.o.controls_title) {
</PRE>
                title = $('').css(this.o.controls_applycss ? {
<PRE>                   fontWeight: 'bold',
                   fontSize: this.o.controls_on_map ? '12px' : 'inherit',
                   padding: '3px 10px 5px 0'
               } : {}).append(this.o.controls_title);
           }
</PRE>
            this.html_element = $('').append(title).append(html);
<PRE>           return this.html_element;
       }
   };
</PRE><PRE>   //ul list menu type
   html_ullist = {
       html_a: function(i, hash, ttl) {
           var self = this,
               index = hash || (i + 1),
               title = ttl || this.o.locations[i].title,
               el_a = $('&lt;a data-load=&quot;' + index + '&quot; id=&quot;ullist_a_' + index + '&quot; href=&quot;#' + index + '&quot; title=&quot;' + title + '&quot;&gt;<SPAN>' + (title || ('#' + (i + 1))) + '</SPAN>&lt;/a&gt;');
</PRE><PRE>           el_a.css(this.o.controls_applycss ? {
               color: '#666',
               display: 'block',
               padding: '5px',
               fontSize: this.o.controls_on_map ? '12px' : 'inherit',
               textDecoration: 'none'
           } : {});
</PRE><PRE>           el_a.on('click', function(e) {
               e.preventDefault();
               var i = $(this).attr('data-load');
               self.ViewOnMap(i);
           });
</PRE><PRE>           return el_a;
       },
</PRE><PRE>       activateCurrent: function(index) {
           this.html_element.find('li').removeClass('active');
           this.html_element.find('#ullist_a_' + index).parent().addClass('active');
       },
</PRE><PRE>       getHtml: function() {
</PRE>
            var html = $('').css(this.o.controls_applycss ? {
<PRE>               margin: 0,
               padding: 0,
               listStyleType: 'none'
           } : {}),
               title, a;
</PRE><PRE>           if (this.ShowOnMenu(this.view_all_key)) {
</PRE>
                html.append($('').append(html_ullist.html_a.call(this, false, this.view_all_key, this.o.view_all_text)));
<PRE>           }
</PRE><PRE>           for (a = 0; a &lt; this.ln; a++) {
               if (this.ShowOnMenu(a)) {
</PRE>
                    html.append($('').append(html_ullist.html_a.call(this, a)));
<PRE>               }
           }
</PRE><PRE>           title = this.o.controls_title;
           if (this.o.controls_title) {
</PRE>
                title = $('').css(this.o.controls_applycss ? {
<PRE>                   fontWeight: 'bold',
                   padding: '3px 10px 5px 0',
                   fontSize: this.o.controls_on_map ? '12px' : 'inherit'
               } : {}).append(this.o.controls_title);
           }
</PRE>
            this.html_element = $('').append(title).append(html);
<PRE>           return this.html_element;
       }
   };
</PRE><PRE>   /**
   * Create a new instance
   * @class Maplace
   * @constructor
   */
   function Maplace(args) {
       this.VERSION = '@VERSION';
       this.loaded = false;
       this.markers = [];
       this.circles = [];
       this.oMap = false;
       this.view_all_key = 'all';
</PRE><PRE>       this.infowindow = null;
       this.maxZIndex = 0;
       this.ln = 0;
       this.oMap = false;
       this.oBounds = null;
       this.map_div = null;
       this.canvas_map = null;
       this.controls_wrapper = null;
       this.current_control = null;
       this.current_index = null;
       this.Polyline = null;
       this.Polygon = null;
       this.Fusion = null;
       this.directionsService = null;
       this.directionsDisplay = null;
</PRE><PRE>       //default options
       this.o = {
           debug: false,
           map_div: '#gmap',
           controls_div: '#controls',
           generate_controls: true,
           controls_type: 'dropdown',
           controls_cssclass: <I>,</I>
           controls_title: <I>,</I>
           controls_on_map: true,
           controls_applycss: true,
           controls_position: google.maps.ControlPosition.RIGHT_TOP,
           type: 'marker',
           view_all: true,
           view_all_text: 'View All',
           pan_on_click: true,
           start: 0,
           locations: [],
           shared: {},
           map_options: {
               mapTypeId: google.maps.MapTypeId.ROADMAP
           },
           stroke_options: {
               strokeColor: '#0000FF',
               strokeOpacity: 0.8,
               strokeWeight: 2,
               fillColor: '#0000FF',
               fillOpacity: 0.4
           },
           directions_options: {
               travelMode: google.maps.TravelMode.DRIVING,
               unitSystem: google.maps.UnitSystem.METRIC,
               optimizeWaypoints: false,
               provideRouteAlternatives: false,
               avoidHighways: false,
               avoidTolls: false
           },
           circle_options: {
               radius: 100,
               visible: true
           },
           styles: {},
           fusion_options: {},
           directions_panel: null,
           draggable: false,
           editable: false,
           show_infowindows: true,
           show_markers: true,
           infowindow_type: 'bubble',
           listeners: {},
</PRE><PRE>           //events
           beforeViewAll: function() {},
           afterViewAll: function() {},
           beforeShow: function(index, location, marker) {},
           afterShow: function(index, location, marker) {},
           afterCreateMarker: function(index, location, marker) {},
</PRE><PRE>           beforeCloseInfowindow: function(index, location) {},
           afterCloseInfowindow: function(index, location) {},
           beforeOpenInfowindow: function(index, location, marker) {},
           afterOpenInfowindow: function(index, location, marker) {},
</PRE><PRE>           afterRoute: function(distance, status, result) {},
           onPolylineClick: function(obj) {},
           onPolygonClick: function(obj) {},
</PRE><PRE>           circleRadiusChanged: function(index, circle, marker) {},
           circleCenterChanged: function(index, circle, marker) {},
</PRE><PRE>           drag: function(index, location, marker) {},
           dragEnd: function(index, location, marker) {},
           dragStart: function(index, location, marker) {}
       };
</PRE><PRE>       //default menu types
       this.AddControl('dropdown', html_dropdown);
       this.AddControl('list', html_ullist);
</PRE><PRE>       if (args &amp;&amp; args.type === 'directions') {
           !args.show_markers &amp;&amp; (args.show_markers = false);
           !args.show_infowindows &amp;&amp; (args.show_infowindows = false);
       }
</PRE><PRE>       //init
       $.extend(true, this.o, args);
   }
</PRE><PRE>   //where to store the menu types
   Maplace.prototype.controls = {};
</PRE><PRE>   //initialize google map object
   Maplace.prototype.create_objMap = function() {
       var self = this,
           count = 0,
           i;
</PRE><PRE>       //if styled
       for (i in this.o.styles) {
           if (this.o.styles.hasOwnProperty(i)) {
               if (count === 0) {
                   this.o.map_options.mapTypeControlOptions = {
                       mapTypeIds: [google.maps.MapTypeId.ROADMAP]
                   };
               }
               count++;
               this.o.map_options.mapTypeControlOptions.mapTypeIds.push('map_style_' + count);
           }
       }
</PRE><PRE>       //if init
       if (!this.loaded) {
           try {
               this.map_div.css({
                   position: 'relative',
                   overflow: 'hidden'
               });
</PRE><PRE>               //create the container div into map_div
</PRE>
                this.canvas_map = $('<DIV>').addClass('canvas_map').css({
<PRE>                   width: '100%',
                   height: '100%'
               }).appendTo(this.map_div);
</PRE><PRE>               this.oMap = new google.maps.Map(this.canvas_map.get(0), this.o.map_options);
</PRE><PRE>           } catch (err) {
               this.debug('create_objMap::' + this.map_div.selector, err.toString());
           }
</PRE><PRE>       //else loads the new optionsl
       } else {
           self.oMap.setOptions(this.o.map_options);
       }
</PRE><PRE>       //if styled
       count = 0;
       for (i in this.o.styles) {
           if (this.o.styles.hasOwnProperty(i)) {
               count++;
               this.oMap.mapTypes.set('map_style_' + count, new google.maps.StyledMapType(this.o.styles[i], {
                   name: i
               }));
               this.oMap.setMapTypeId('map_style_' + count);
           }
       }
   };
</PRE><PRE>   //adds markers to the map
   Maplace.prototype.add_markers_to_objMap = function() {
       var a,
           point,
           type = this.o.type || 'marker';
</PRE><PRE>       //switch how to display the locations
       switch (type) {
           case 'marker':
               for (a = 0; a &lt; this.ln; a++) {
                   point = this.create_objPoint(a);
                   this.create.marker.call(this, a, point);
               }
               break;
           default:
               this.create[type].apply(this);
               break;
       }
   };
</PRE><PRE>   //create the main object point
   Maplace.prototype.create_objPoint = function(index) {
       var point = $.extend({}, this.o.locations[index]),
           visibility = point.visible === undefined ? undefined : point.visible;
</PRE><PRE> !point.type &amp;&amp; (point.type = this.o.type);
</PRE><PRE>       //set obj map
       point.map = this.oMap;
       point.position = new google.maps.LatLng(point.lat, point.lon);
       point.zIndex = point.zIndex === undefined ? 10000 : (point.zIndex + 100);
       point.visible = visibility === undefined  ? this.o.show_markers : visibility;
</PRE><PRE>       this.o.maxZIndex = point.zIndex &gt; this.maxZIndex ? point.zIndex : this.maxZIndex;
</PRE><PRE>       if (point.image) {
           point.icon = new google.maps.MarkerImage(
               point.image,
               new google.maps.Size(point.image_w || 32, point.image_h || 32),
               new google.maps.Point(0, 0),
               new google.maps.Point((point.image_w || 32) / 2, (point.image_h || 32)  / 2)
           );
       }
</PRE><PRE>       return point;
   };
</PRE><PRE>   //create the main object circle
   Maplace.prototype.create_objCircle = function(point) {
       var def_stroke_opz,
           def_circle_opz,
           circle;
</PRE><PRE>       circle = $.extend({}, point);
       def_stroke_opz = $.extend({}, this.o.stroke_options);
       def_circle_opz = $.extend({}, this.o.circle_options);
</PRE><PRE>       $.extend(def_stroke_opz, point.stroke_options || {});
       $.extend(circle, def_stroke_opz);
</PRE><PRE>       $.extend(def_circle_opz, point.circle_options || {});
       $.extend(circle, def_circle_opz);
</PRE><PRE>       circle.center = point.position;
       circle.draggable = false;
       circle.zIndex = point.zIndex &gt; 0 ? point.zIndex - 10 : 1;
</PRE><PRE>       return circle;
   };
</PRE><PRE>   //create the main object point
   Maplace.prototype.add_markerEv = function(index, point, marker) {
       var self = this;
</PRE><PRE>       google.maps.event.addListener(marker, 'click', function(ev) {
           self.o.beforeShow(index, point, marker);
</PRE><PRE>           //show infowindow?
           if (self.o.show_infowindows &amp;&amp; (point.show_infowindow === false ? false : true)) {
               self.open_infowindow(index, marker, ev);
           }
</PRE><PRE>           //pan and zoom the map
           if (self.o.pan_on_click &amp;&amp; (point.pan_on_click === false ? false : true)) {
               self.oMap.panTo(point.position);
               point.zoom &amp;&amp; self.oMap.setZoom(point.zoom);
           }
</PRE><PRE>           //activate related menu link
           if (self.current_control &amp;&amp; self.o.generate_controls &amp;&amp; self.current_control.activateCurrent) {
               self.current_control.activateCurrent.call(self, index + 1);
           }
</PRE><PRE>           //update current location index
           self.current_index = index;
</PRE><PRE>           self.o.afterShow(index, point, marker);
       });
</PRE><PRE>       if (point.draggable) {
           this.add_dragEv(index, point, marker);
       }
   };
</PRE><PRE>   //add events to circles objs
   Maplace.prototype.add_circleEv = function(index, circle, marker) {
       var self = this;
</PRE><PRE>       google.maps.event.addListener(marker, 'click', function() {
           self.ViewOnMap(index + 1);
       });
</PRE><PRE>       google.maps.event.addListener(marker, 'center_changed', function() {
           self.o.circleCenterChanged(index, circle, marker);
       });
</PRE><PRE>       google.maps.event.addListener(marker, 'radius_changed', function() {
           self.o.circleRadiusChanged(index, circle, marker);
       });
</PRE><PRE>       if (circle.draggable) {
           this.add_dragEv(index, circle, marker);
       }
   };
</PRE><PRE>   //add drag events
   Maplace.prototype.add_dragEv = function(index, obj, marker) {
       var self = this;
</PRE><PRE>       google.maps.event.addListener(marker, 'drag', function(ev) {
           var pos,
               extraType;
</PRE><PRE>           if (marker.getPosition) {
               pos = marker.getPosition();
           } else if (marker.getCenter) {
               pos = marker.getCenter();
           } else {
               return;
           }
</PRE><PRE>           //update circle position
           if (self.circles[index]) {
               self.circles[index].setCenter(pos);
           }
</PRE><PRE>           //update polygon or polyline if defined
           if (self.Polyline) {
               extraType = 'Polyline';
           } else if (self.Polygon) {
               extraType = 'Polygon';
           }
</PRE><PRE>           if (extraType) {
               var path = self[extraType].getPath(),
                   pathArray = path.getArray(),
                   arr = [],
                   i = 0;
</PRE><PRE>               for (; i &lt; pathArray.length; ++i) {
                   arr[i] = (index === i) ?
                       new google.maps.LatLng(pos.lat(), pos.lng())
                       : new google.maps.LatLng(pathArray[i].lat(), pathArray[i].lng());
               }
</PRE><PRE>               self[extraType].setPath(new google.maps.MVCArray(arr));
               self.add_polyEv(extraType);
           }
</PRE><PRE>           //fire drag event
           self.o.drag(index, obj, marker);
       });
</PRE><PRE>       google.maps.event.addListener(marker, 'dragend', function() {
           self.o.dragEnd(index, obj, marker);
       });
</PRE><PRE>       google.maps.event.addListener(marker, 'dragstart', function() {
           self.o.dragStart(index, obj, marker);
       });
</PRE><PRE>       google.maps.event.addListener(marker, 'center_changed', function() {
           //update marker position
           if (self.markers[index] &amp;&amp; marker.getCenter) {
               self.markers[index].setPosition(marker.getCenter());
           }
</PRE><PRE>           self.o.drag(index, obj, marker);
       });
   };
</PRE><PRE>   //add events to poly objs
   Maplace.prototype.add_polyEv = function(typeName) {
       var self = this;
</PRE><PRE>       google.maps.event.addListener(this[typeName].getPath(), 'set_at', function(index, obj) {
           var item = self[typeName].getPath().getAt(index),
               newPos = new google.maps.LatLng(item.lat(), item.lng());
</PRE><PRE>           self.markers[index] &amp;&amp; self.markers[index].setPosition(newPos);
           self.circles[index] &amp;&amp; self.circles[index].setCenter(newPos);
</PRE><PRE>           self.o['on' + typeName + 'Changed'](index, obj, self[typeName].getPath().getArray());
       });
   };
</PRE><PRE>   //wrapper for the map types
   Maplace.prototype.create = {
</PRE><PRE>       //single marker
       marker: function(index, point, marker) {
           var self = this,
               circle;
</PRE><PRE>           //allow mix circles with markers
           if (point.type === 'circle'&amp;&amp; !marker) {
               circle = this.create_objCircle(point);
</PRE><PRE>               if (!point.visible) {
                   circle.draggable = point.draggable;
               }
</PRE><PRE>               marker = new google.maps.Circle(circle);
               this.add_circleEv(index, circle, marker);
</PRE><PRE>               //store the new circle
               this.circles[index] = marker;
           }
</PRE><PRE>           point.type = 'marker';
</PRE><PRE>           //create the marker and add click event
           marker = new google.maps.Marker(point);
           this.add_markerEv(index, point, marker);
</PRE><PRE>           //extends bounds with this location
           this.oBounds.extend(point.position);
</PRE><PRE>           //store the new marker
           this.markers[index] = marker;
</PRE><PRE>           this.o.afterCreateMarker(index, point, marker);
</PRE><PRE>           return marker;
       },
</PRE><PRE>       //circle mode
       circle: function() {
           var self = this,
               a,
               point,
               circle,
               marker;
</PRE><PRE>           for (a = 0; a &lt; this.ln; a++) {
               point = this.create_objPoint(a);
</PRE><PRE>               //allow mix markers with circles
               if (point.type === 'circle') {
                   circle = this.create_objCircle(point);
</PRE><PRE>                   if (!point.visible) {
                       circle.draggable = point.draggable;
                   }
</PRE><PRE>                   marker = new google.maps.Circle(circle);
                   this.add_circleEv(a, circle, marker);
</PRE><PRE>                   //store the new circle
                   this.circles[a] = marker;
               }
</PRE><PRE>               point.type = 'marker';
               this.create.marker.call(this, a, point, marker);
           }
       },
</PRE><PRE>       //polyline mode
       polyline: function() {
           var self = this,
               a,
               point,
               stroke = $.extend({}, this.o.stroke_options);
</PRE><PRE>           stroke.path = [];
           stroke.draggable = this.o.draggable;
           stroke.editable = this.o.editable;
           stroke.map = this.oMap;
           stroke.zIndex = this.o.maxZIndex + 100;
</PRE><PRE>           //create the path and location marker
           for (a = 0; a &lt; this.ln; a++) {
               point = this.create_objPoint(a);
               this.create.marker.call(this, a, point);
</PRE><PRE>               stroke.path.push(point.position);
           }
</PRE><PRE>           this.Polyline ?
               this.Polyline.setOptions(stroke)
               : this.Polyline = new google.maps.Polyline(stroke);
</PRE><PRE>           this.add_polyEv('Polyline');
       },
</PRE><PRE>       //polygon mode
       polygon: function() {
           var self = this,
               a,
               point,
               stroke = $.extend({}, this.o.stroke_options);
</PRE><PRE>           stroke.path = [];
           stroke.draggable = this.o.draggable;
           stroke.editable = this.o.editable;
           stroke.map = this.oMap;
           stroke.zIndex = this.o.maxZIndex + 100;
</PRE><PRE>           //create the path and location marker
           for (a = 0; a &lt; this.ln; a++) {
               point = this.create_objPoint(a);
               this.create.marker.call(this, a, point);
</PRE><PRE>               stroke.path.push(point.position);
           }
</PRE><PRE>           this.Polygon ?
               this.Polygon.setOptions(stroke)
               : this.Polygon = new google.maps.Polygon(stroke);
</PRE><PRE>           google.maps.event.addListener(this.Polygon, 'click', function(obj) {
               self.o.onPolygonClick(obj);
           });
</PRE><PRE>           this.add_polyEv('Polygon');
       },
</PRE><PRE>       //fusion tables
       fusion: function() {
           this.o.fusion_options.styles = [this.o.stroke_options];
           this.o.fusion_options.map = this.oMap;
</PRE><PRE>           this.Fusion ?
               this.Fusion.setOptions(this.o.fusion_options)
               : this.Fusion = new google.maps.FusionTablesLayer(this.o.fusion_options);
       },
</PRE><PRE>       //directions mode
       directions: function() {
           var self = this,
               a,
               point,
               stopover,
               origin,
               destination,
               waypoints = [],
               distance = 0;
</PRE><PRE>           //create the waypoints and location marker
           for (a = 0; a &lt; this.ln; a++) {
               point = this.create_objPoint(a);
</PRE><PRE>               //first location start point
               if (a === 0) {
                   origin = point.position;
</PRE><PRE>               //last location end point
               } else if (a === (this.ln - 1)) {
                   destination = point.position;
</PRE><PRE>               //waypoints in the middle
               } else {
                   stopover = this.o.locations[a].stopover === true ? true : false;
                   waypoints.push({
                       location: point.position,
                       stopover: stopover
                   });
               }
</PRE><PRE>               this.create.marker.call(this, a, point);
           }
</PRE><PRE>           this.o.directions_options.origin = origin;
           this.o.directions_options.destination = destination;
           this.o.directions_options.waypoints = waypoints;
</PRE><PRE>           this.directionsService || (this.directionsService = new google.maps.DirectionsService());
           this.directionsDisplay ?
               this.directionsDisplay.setOptions({draggable: this.o.draggable})
               : this.directionsDisplay = new google.maps.DirectionsRenderer({draggable: this.o.draggable});
</PRE><PRE>           this.directionsDisplay.setMap(this.oMap);
</PRE><PRE>           //show the directions panel
           if (this.o.directions_panel) {
               this.o.directions_panel = $(this.o.directions_panel);
               this.directionsDisplay.setPanel(this.o.directions_panel.get(0));
           }
</PRE><PRE>           if (this.o.draggable) {
               google.maps.event.addListener(this.directionsDisplay, 'directions_changed', function() {
                   distance = self.compute_distance(self.directionsDisplay.directions);
                   self.o.afterRoute(distance);
               });
           }
</PRE><PRE>           this.directionsService.route(this.o.directions_options, function(result, status) {
               //directions found
               if (status === google.maps.DirectionsStatus.OK) {
                   distance = self.compute_distance(result);
                   self.directionsDisplay.setDirections(result);
               }
               self.o.afterRoute(distance, status, result);
           });
       }
   };
</PRE><PRE>   //route distance
   Maplace.prototype.compute_distance = function(result) {
       var total = 0,
           i,
           myroute = result.routes[0],
           rlen = myroute.legs.length;
</PRE><PRE>       for (i = 0; i &lt; rlen; i++) {
           total += myroute.legs[i].distance.value;
       }
</PRE><PRE>       return total;
   };
</PRE><PRE>   //wrapper for the infowindow types
   Maplace.prototype.type_to_open = {
       //google default infowindow
       bubble: function(location) {
           this.infowindow = new google.maps.InfoWindow({
               content: location.html || 
           });
       }
   };
</PRE><PRE>   //open the infowindow
   Maplace.prototype.open_infowindow = function(index, marker, ev) {
       //close if any open
       this.CloseInfoWindow();
       var point = this.o.locations[index],
           type = this.o.infowindow_type;
</PRE><PRE>       //show if content and valid infowindow type provided
       if (point.html &amp;&amp; this.type_to_open[type]) {
           this.o.beforeOpenInfowindow(index, point, marker);
           this.type_to_open[type].call(this, point);
           this.infowindow.open(this.oMap, marker);
           this.o.afterOpenInfowindow(index, point, marker);
       }
   };
</PRE><PRE>   //gets the html for the menu
   Maplace.prototype.get_html_controls = function() {
       if (this.controls[this.o.controls_type] &amp;&amp; this.controls[this.o.controls_type].getHtml) {
           this.current_control = this.controls[this.o.controls_type];
</PRE><PRE>           return this.current_control.getHtml.apply(this);
       }
       return <I>;</I>
   };
</PRE><PRE>   //creates the controls menu
   Maplace.prototype.generate_controls = function() {
       //append menu on the div container
       if (!this.o.controls_on_map) {
           this.controls_wrapper.empty();
           this.controls_wrapper.append(this.get_html_controls());
           return;
       }
</PRE><PRE>       //else
       //controls in map
</PRE>
        var cntr = $('')
<PRE>           .css(this.o.controls_applycss ? {margin: '5px'} : {}),
</PRE><PRE>           inner = $(this.get_html_controls()).css(this.o.controls_applycss ? {
               background: '#fff',
               padding: '5px',
               border: '1px solid #eee',
               boxShadow: 'rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px',
               maxHeight: this.map_div.find('.canvas_map').outerHeight() - 80,
               minWidth: 100,
               overflowY: 'auto',
               overflowX: 'hidden'
           } : {});
</PRE><PRE>       cntr.append(inner);
</PRE><PRE>       //attach controls
       this.oMap.controls[this.o.controls_position].push(cntr.get(0));
   };
</PRE><PRE>   //resets obj map, markers, bounds, listeners, controllers
   Maplace.prototype.init_map = function() {
       var self = this;
</PRE><PRE>       this.Polyline &amp;&amp; this.Polyline.setMap(null);
       this.Polygon &amp;&amp; this.Polygon.setMap(null);
       this.Fusion &amp;&amp; this.Fusion.setMap(null);
       this.directionsDisplay &amp;&amp; this.directionsDisplay.setMap(null);
</PRE><PRE>       for (var i = this.markers.length - 1; i &gt;= 0; i -= 1) {
           try {
               this.markers[i] &amp;&amp; this.markers[i].setMap(null);
           } catch (err) {
               self.debug('init_map::markers::setMap', err.stack);
           }
       }
</PRE><PRE>       this.markers.length = 0;
       this.markers = [];
</PRE><PRE>       for (var e = this.circles.length - 1; e &gt;= 0; e -= 1) {
           try {
               this.circles[e] &amp;&amp; this.circles[e].setMap(null);
           } catch (err) {
               self.debug('init_map::circles::setMap', err.stack);
           }
       }
</PRE><PRE>       this.circles.length = 0;
       this.circles = [];
</PRE><PRE>       if (this.o.controls_on_map &amp;&amp; this.oMap.controls) {
           this.oMap.controls[this.o.controls_position].forEach(function(element, index) {
               try {
                   self.oMap.controls[this.o.controls_position].removeAt(index);
               } catch (err) {
                   self.debug('init_map::removeAt', err.stack);
               }
           });
       }
</PRE><PRE>       this.oBounds = new google.maps.LatLngBounds();
   };
</PRE><PRE>   //perform the first view of the map
   Maplace.prototype.perform_load = function() {
       //one location
       if (this.ln === 1) {
           if (this.o.map_options.set_center) {
               this.oMap.setCenter(new google.maps.LatLng(this.o.map_options.set_center[0], this.o.map_options.set_center[1]));
</PRE><PRE>           } else {
               this.oMap.fitBounds(this.oBounds);
               this.ViewOnMap(1);
           }
</PRE><PRE>           this.o.map_options.zoom &amp;&amp; this.oMap.setZoom(this.o.map_options.zoom);
</PRE><PRE>       //no locations
       } else if (this.ln === 0) {
           if (this.o.map_options.set_center) {
               this.oMap.setCenter(new google.maps.LatLng(this.o.map_options.set_center[0], this.o.map_options.set_center[1]));
</PRE><PRE>           } else {
               this.oMap.fitBounds(this.oBounds);
           }
</PRE><PRE>           this.oMap.setZoom(this.o.map_options.zoom || 1);
</PRE><PRE>       //n+ locations
       } else {
           this.oMap.fitBounds(this.oBounds);
</PRE><PRE>           //check the start option
           if (typeof (this.o.start - 0) === 'number' &amp;&amp; this.o.start &gt; 0 &amp;&amp; this.o.start &lt;= this.ln) {
               this.ViewOnMap(this.o.start);
</PRE><PRE>           //check if set_center exists
           } else if (this.o.map_options.set_center) {
               this.oMap.setCenter(new google.maps.LatLng(this.o.map_options.set_center[0], this.o.map_options.set_center[1]));
</PRE><PRE>           //view all
           } else {
               this.ViewOnMap(this.view_all_key);
           }
</PRE><PRE>           this.o.map_options.zoom &amp;&amp; this.oMap.setZoom(this.o.map_options.zoom);
       }
   };
</PRE><PRE>   Maplace.prototype.debug = function(code, msg) {
       this.o.debug &amp;&amp; console.log(code, msg);
       return this;
   };
</PRE><PRE>   /////////////////////////////////////////////////////////////////////////
   /////////////////////////////////////////////////////////////////////////
</PRE><PRE>   //adds a custom menu to the class
   Maplace.prototype.AddControl = function(name, func) {
       if (!name || !func) {
           self.debug('AddControl', 'Missing &quot;name&quot; and &quot;func&quot; callback.');
           return false;
       }
       this.controls[name] = func;
       return this;
   };
</PRE><PRE>   //close the infowindow
   Maplace.prototype.CloseInfoWindow = function() {
       if (this.infowindow &amp;&amp; (this.current_index || this.current_index === 0)) {
           this.o.beforeCloseInfowindow(this.current_index, this.o.locations[this.current_index]);
           this.infowindow.close();
           this.infowindow = null;
           this.o.afterCloseInfowindow(this.current_index, this.o.locations[this.current_index]);
       }
       return this;
   };
</PRE><PRE>   //checks if a location has to be in menu
   Maplace.prototype.ShowOnMenu = function(index) {
       if (index === this.view_all_key &amp;&amp; this.o.view_all &amp;&amp; this.ln &gt; 1) {
           return true;
       }
</PRE><PRE>       index = parseInt(index, 10);
       if (typeof (index - 0) === 'number' &amp;&amp; index &gt;= 0 &amp;&amp; index &lt; this.ln) {
           var on_menu = this.o.locations[index].on_menu === false ? false : true;
           if (on_menu) {
               return true;
           }
       }
</PRE><PRE>       return false;
   };
</PRE><PRE>   //triggers to show a location in map
   Maplace.prototype.ViewOnMap = function(index) {
       //view all
       if (index === this.view_all_key) {
           this.o.beforeViewAll();
           this.current_index = index;
           if (this.o.locations.length &gt; 0 &amp;&amp; this.o.generate_controls &amp;&amp; this.current_control &amp;&amp; this.current_control.activateCurrent) {
               this.current_control.activateCurrent.apply(this, [index]);
           }
           this.oMap.fitBounds(this.oBounds);
           this.CloseInfoWindow();
           this.o.afterViewAll();
</PRE><PRE>       //specific location
       } else {
           index = parseInt(index, 10);
           if (typeof (index - 0) === 'number' &amp;&amp; index &gt; 0 &amp;&amp; index &lt;= this.ln) {
               try {
                   google.maps.event.trigger(this.markers[index - 1], 'click');
               } catch (err) {
                   this.debug('ViewOnMap::trigger', err.stack);
               }
           }
       }
       return this;
   };
</PRE><PRE>   //replace current locations
   Maplace.prototype.SetLocations = function(locs, reload) {
       this.o.locations = locs;
       reload &amp;&amp; this.Load();
       return this;
   };
</PRE><PRE>   //adds one or more locations to the end of the array
   Maplace.prototype.AddLocations = function(locs, reload) {
       var self = this;
</PRE><PRE>       if ($.isArray(locs)) {
           $.each(locs, function(index, value) {
               self.o.locations.push(value);
           });
       }
</PRE><PRE>       if ($.isPlainObject(locs)) {
           this.o.locations.push(locs);
       }
</PRE><PRE>       reload &amp;&amp; this.Load();
       return this;
   };
</PRE><PRE>   //adds a location at the specific index
   Maplace.prototype.AddLocation = function(location, index, reload) {
       var self = this;
</PRE><PRE>       if ($.isPlainObject(location)) {
           this.o.locations.splice(index, 0, location);
       }
</PRE><PRE>       reload &amp;&amp; this.Load();
       return this;
   };
</PRE><PRE>   //remove one or more locations
   Maplace.prototype.RemoveLocations = function(locs, reload) {
       var self = this,
           k = 0;
</PRE><PRE>       if ($.isArray(locs)) {
           $.each(locs, function(index, value) {
               if ((value - k) &lt; self.ln) {
                   self.o.locations.splice(value - k, 1);
               }
               k++;
           });
       } else {
           if (locs &lt; this.ln) {
               this.o.locations.splice(locs, 1);
           }
       }
</PRE><PRE>       reload &amp;&amp; this.Load();
       return this;
   };
</PRE><PRE>   //check if already initialized with a Load()
   Maplace.prototype.Loaded = function() {
       return this.loaded;
   };
</PRE><PRE>   //loads the options
   Maplace.prototype._init = function() {
       //store the locations length
       this.ln = this.o.locations.length;
</PRE><PRE>       //update all locations with shared
       for (var i = 0; i &lt; this.ln; i++) {
           var common = $.extend({}, this.o.shared);
           this.o.locations[i] = $.extend(common, this.o.locations[i]);
           if (this.o.locations[i].html) {
               this.o.locations[i].html = this.o.locations[i].html.replace('%index', i + 1);
               this.o.locations[i].html = this.o.locations[i].html.replace('%title', (this.o.locations[i].title || <I>));</I>
           }
       }
</PRE><PRE>       //store dom references
       this.map_div = $(this.o.map_div);
       this.controls_wrapper = $(this.o.controls_div);
       return this;
   };
</PRE><PRE>   //creates the map and menu
   Maplace.prototype.Load = function(args) {
       $.extend(true, this.o, args);
       args &amp;&amp; args.locations &amp;&amp; (this.o.locations = args.locations);
       this._init();
</PRE><PRE>       //reset/init google map objects
       this.o.visualRefresh === false ? (google.maps.visualRefresh = false) : (google.maps.visualRefresh = true);
       this.init_map();
       this.create_objMap();
</PRE><PRE>       //add markers
       this.add_markers_to_objMap();
</PRE><PRE>       //generate controls
       if ((this.ln &gt; 1 &amp;&amp; this.o.generate_controls) || this.o.force_generate_controls)  {
           this.o.generate_controls = true;
           this.generate_controls();
       } else {
           this.o.generate_controls = false;
       }
</PRE><PRE>       var self = this;
</PRE><PRE>       //first call
       if (!this.loaded) {
           google.maps.event.addListenerOnce(this.oMap, 'idle', function() {
               self.perform_load();
           });
</PRE><PRE>           //add custom listeners
           for (var i in this.o.listeners) {
               if (this.o.listeners.hasOwnProperty(i)) {
                   google.maps.event.addListener(this.oMap, i, this.o.listeners[i]);
               }
           }
</PRE><PRE>       //all other calls
       } else {
           this.perform_load();
       }
</PRE><PRE>       this.loaded = true;
</PRE><PRE>       return this;
   };
</PRE><PRE>   return Maplace;
</PRE>
}));</DIV></DIV></DIV></DIV></DIV></DIV></BODY></HTML>