<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_Cornell_NY_scripts_js skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><DIV id="top_title"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:Cornell NY/scripts.js</SPAN></H1></DIV><DIV id="HQ_page"><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><P>var mr_firstSectionHeight,
</P><PRE>   mr_nav,
   mr_fixedAt,
   mr_navOuterHeight,
   mr_navScrolled = false,
   mr_navFixed = false,
   mr_outOfSight = false,
   mr_floatingProjectSections,
   mr_scrollTop = 0;
</PRE><P>$(document).ready(function() { 
</P><PRE>   &quot;use strict&quot;;
</PRE><PRE>   // Smooth scroll to inner links
   
   $('.inner-link').each(function(){
       var href = $(this).attr('href');
       if(href.charAt(0) !== &quot;#&quot;){
           $(this).removeClass('inner-link');
       }
   });
</PRE><P>	if($('.inner-link').length){
		$('.inner-link').smoothScroll({
			offset: -55,
			speed: 800
		});
</P><PRE>   }
</PRE><PRE>   // Update scroll variable for scrolling functions
</PRE><PRE>   addEventListener('scroll', function() {
       mr_scrollTop = window.pageYOffset;
   }, false);
</PRE><PRE>   // Append .background-image-holder &lt;img&gt;'s as CSS backgrounds
</PRE><PRE>   $('.background-image-holder').each(function() {
       var imgSrc = $(this).children('img').attr('src');
       $(this).css('background', 'url(&quot;' + imgSrc + '&quot;)');
       $(this).children('img').hide();
       $(this).css('background-position', 'initial');
   });
</PRE><PRE>   // Fade in background images
</PRE><PRE>   setTimeout(function() {
       $('.background-image-holder').each(function() {
           $(this).addClass('fadeIn');
       });
   }, 200);
</PRE><PRE>   // Initialize Tooltips
</PRE><PRE>   $('[data-toggle=&quot;tooltip&quot;]').tooltip();
</PRE><PRE>   // Icon bulleted lists
</PRE><PRE>   $('ul[data-bullet]').each(function(){
       var bullet = $(this).attr('data-bullet');
       $(this).find('li').prepend('');
   });
</PRE><PRE>   // Progress Bars
</PRE><PRE>   $('.progress-bar').each(function() {
       $(this).css('width', $(this).attr('data-progress') + '%');
   });
</PRE><PRE>   // Navigation
</PRE><PRE>   if (!$('nav').hasClass('fixed') &amp;&amp; !$('nav').hasClass('absolute')) {
</PRE><PRE>       // Make nav container height of nav
</PRE><PRE>       $('.nav-container').css('min-height', $('nav').outerHeight(true));
</PRE><PRE>       $(window).resize(function() {
           $('.nav-container').css('min-height', $('nav').outerHeight(true));
       });
</PRE><PRE>       // Compensate the height of parallax element for inline nav
</PRE><PRE>       if ($(window).width() &gt; 768) {
           $('.parallax:nth-of-type(1) .background-image-holder').css('top', -($('nav').outerHeight(true)));
       }
</PRE><PRE>       // Adjust fullscreen elements
</PRE><PRE>       if ($(window).width() &gt; 768) {
           $('section.fullscreen:nth-of-type(1)').css('height', ($(window).height() - $('nav').outerHeight(true)));
       }
</PRE><PRE>   } else {
       $('body').addClass('nav-is-overlay');
   }
</PRE><PRE>   if ($('nav').hasClass('bg-dark')) {
       $('.nav-container').addClass('bg-dark');
   }
</PRE><PRE>   // Fix nav to top while scrolling
</PRE><PRE>   mr_nav = $('body .nav-container nav:first');
   mr_navOuterHeight = $('body .nav-container nav:first').outerHeight();
       mr_fixedAt = typeof mr_nav.attr('data-fixed-at') !== typeof undefined ? parseInt(mr_nav.attr('data-fixed-at').replace('px', <I>)) : parseInt($('section:nth-of-type(1)').outerHeight());</I>
   window.addEventListener(&quot;scroll&quot;, updateNav, false);
</PRE><PRE>   // Menu dropdown positioning
</PRE><PRE>   $('.menu &gt; li &gt; ul').each(function() {
       var menu = $(this).offset();
       var farRight = menu.left + $(this).outerWidth(true);
       if (farRight &gt; $(window).width() &amp;&amp; !$(this).hasClass('mega-menu')) {
           $(this).addClass('make-right');
       } else if (farRight &gt; $(window).width() &amp;&amp; $(this).hasClass('mega-menu')) {
           var isOnScreen = $(window).width() - menu.left;
           var difference = $(this).outerWidth(true) - isOnScreen;
           $(this).css('margin-left', -(difference));
       }
   });
</PRE><PRE>   // Mobile Menu
</PRE><PRE>   $('.mobile-toggle').click(function() {
       $('.nav-bar').toggleClass('nav-open');
       $(this).toggleClass('active');
   });
</PRE><PRE>   $('.menu li').click(function(e) {
       if (!e) e = window.event;
       e.stopPropagation();
       if ($(this).find('ul').length) {
           $(this).toggleClass('toggle-sub');
       } else {
           $(this).parents('.toggle-sub').removeClass('toggle-sub');
       }
   });
</PRE><PRE>   $('.menu li a').click(function() {
       if ($(this).hasClass('inner-link')){
           $(this).closest('.nav-bar').removeClass('nav-open');
       }
   });
</PRE><PRE>   $('.module.widget-handle').click(function() {
       $(this).toggleClass('toggle-widget-handle');
   });
</PRE><PRE>   $('.search-widget-handle .search-form input').click(function(e){
       if (!e) e = window.event;
       e.stopPropagation();
   });
   
   // Offscreen Nav
   
   if($('.offscreen-toggle').length){
   	$('body').addClass('has-offscreen-nav');
   }
   else{
       $('body').removeClass('has-offscreen-nav');
   }
   
   $('.offscreen-toggle').click(function(){
   	$('.main-container').toggleClass('reveal-nav');
   	$('nav').toggleClass('reveal-nav');
   	$('.offscreen-container').toggleClass('reveal-nav');
   });
   
   $('.main-container').click(function(){
   	if($(this).hasClass('reveal-nav')){
   		$(this).removeClass('reveal-nav');
   		$('.offscreen-container').removeClass('reveal-nav');
   		$('nav').removeClass('reveal-nav');
   	}
   });
   
   $('.offscreen-container a').click(function(){
   	$('.offscreen-container').removeClass('reveal-nav');
   	$('.main-container').removeClass('reveal-nav');
   	$('nav').removeClass('reveal-nav');
   });
</PRE><PRE>   // Populate filters
   
   $('.projects').each(function() {
</PRE><PRE>       var filters = &quot;&quot;;
</PRE><PRE>       $(this).find('.project').each(function() {
</PRE><PRE>           var filterTags = $(this).attr('data-filter').split(',');
</PRE><PRE>           filterTags.forEach(function(tagName) {
               if (filters.indexOf(tagName) == -1) {
</PRE>
                    filters += '<LI data-filter="' + tagName + '">' + capitaliseFirstLetter(tagName) + '</LI>';
<PRE>               }
           });
           $(this).closest('.projects')
</PRE>
                .find('ul.filters').empty().append('<LI data-filter="all" class="active">All</LI>').append(filters);
<PRE>       });
   });
</PRE><PRE>   $('.filters li').click(function() {
       var filter = $(this).attr('data-filter');
       $(this).closest('.filters').find('li').removeClass('active');
       $(this).addClass('active');
</PRE><PRE>       $(this).closest('.projects').find('.project').each(function() {
           var filters = $(this).attr('data-filter');
</PRE><PRE>           if (filters.indexOf(filter) == -1) {
               $(this).addClass('inactive');
           } else {
               $(this).removeClass('inactive');
           }
       });
</PRE><PRE>       if (filter == 'all') {
           $(this).closest('.projects').find('.project').removeClass('inactive');
       }
   });
</PRE><PRE>   // Twitter Feed
      jQuery('.tweets-feed').each(function(index) {
          jQuery(this).attr('id', 'tweets-' + index);
      }).each(function(index) {
          
          var TweetConfig = {
              &quot;id&quot;: jQuery('#tweets-' + index).attr('data-widget-id'),
              &quot;domId&quot;: <I>,</I>
              &quot;maxTweets&quot;: jQuery('#tweets-' + index).attr('data-amount'),
              &quot;enableLinks&quot;: true,
              &quot;showUser&quot;: true,
              &quot;showTime&quot;: true,
              &quot;dateFunction&quot;: <I>,</I>
              &quot;showRetweet&quot;: false,
              &quot;customCallback&quot;: handleTweets
          };
          function handleTweets(tweets) {
              var x = tweets.length;
              var n = 0;
              var element = document.getElementById('tweets-' + index);
</PRE>
               var html = '<UL class="slides">';
               while (n &lt; x) {
                   html += '<LI>' + tweets[n] + '</LI>';
<PRE>                  n++;
              }
</PRE>
               html += '</UL>';
<PRE>              element.innerHTML = html;
              return html;
          }
          twitterFetcher.fetch(TweetConfig);
      });
</PRE><PRE>   // Instagram Feed
   
   if($('.instafeed').length){
   	jQuery.fn.spectragram.accessData = {
</PRE><P>			accessToken: '1406933036.dc95b96.2ed56eddc62f41cbb22c1573d58625a2',
			clientID: '87e6d2b8a0ef4c7ab8bc45e80ddd0c6a'
		};	
</P><PRE>       $('.instafeed').each(function() {
           var feedID = $(this).attr('data-user-name');
           $(this).children('ul').spectragram('getUserFeed', {
               query: feedID,
               max: 12
           });
       });
   }   
</PRE><PRE>   // Flickr Feeds
</PRE><PRE>   if($('.flickr-feed').length){
       $('.flickr-feed').each(function(){
           var userID = $(this).attr('data-user-id');
           var albumID = $(this).attr('data-album-id');
</PRE>
            $(this).flickrPhotoStream({ id: userID, setId: albumID, container: '<LI class="masonry-item">' });   
            setTimeout(function(){
                initializeMasonry();
                window.dispatchEvent(new Event('resize'));
            }, 1000); 
        });

    }

    // Image Sliders
    if($('.slider-all-controls, .slider-paging-controls, .slider-arrow-controls, .slider-thumb-controls, .logo-carousel').length){
        $('.slider-all-controls').flexslider({
            start: function(slider){
                if(slider.find('.slides li:first-child').find('.fs-vid-background video').length){
                   slider.find('.slides li:first-child').find('.fs-vid-background video').get(0).play(); 
                }
            },
            after: function(slider){
                if(slider.find('.fs-vid-background video').length){
                    if(slider.find('li:not(.flex-active-slide)').find('.fs-vid-background video').length){
                        slider.find('li:not(.flex-active-slide)').find('.fs-vid-background video').get(0).pause();
                    }
                    if(slider.find('.flex-active-slide').find('.fs-vid-background video').length){
                        slider.find('.flex-active-slide').find('.fs-vid-background video').get(0).play();
                    }
                }
            }
        });
        $('.slider-paging-controls').flexslider({
            animation: &quot;slide&quot;,
            directionNav: false
        });
        $('.slider-arrow-controls').flexslider({
            controlNav: false
        });
        $('.slider-thumb-controls .slides li').each(function() {
            var imgSrc = $(this).find('img').attr('src');
            $(this).attr('data-thumb', imgSrc);
        });
        $('.slider-thumb-controls').flexslider({
            animation: &quot;slide&quot;,
            controlNav: &quot;thumbnails&quot;,
            directionNav: true
        });
        $('.logo-carousel').flexslider({
            minItems: 1,
            maxItems: 4,
            move: 1,
            itemWidth: 200,
            itemMargin: 0,
            animation: &quot;slide&quot;,
            slideshow: true,
            slideshowSpeed: 3000,
            directionNav: false,
            controlNav: false
        });
    }
    
    // Lightbox gallery titles
    
    $('.lightbox-grid li a').each(function(){
    	var galleryTitle = $(this).closest('.lightbox-grid').attr('data-gallery-title');
    	$(this).attr('data-lightbox', galleryTitle);
    });

    // Prepare embedded video modals

    $('iframe[data-provider]').each(function(){
        var provider = jQuery(this).attr('data-provider');
        var videoID = jQuery(this).attr('data-video-id');
        var autoplay = jQuery(this).attr('data-autoplay');
        var vidURL = <I>;</I>

        if(provider == 'vimeo'){
            vidURL = &quot;<A rel="nofollow" class="external free" href="http://player.vimeo.com/video/">http://player.vimeo.com/video/</A>&quot;+videoID+&quot;?badge=0&amp;title=0&amp;byline=0&amp;title=0&amp;autoplay=&quot;+autoplay;
            $(this).attr('data-src', vidURL);
        }else if (provider == 'youtube'){
            vidURL = &quot;<A rel="nofollow" class="external free" href="https://www.youtube.com/embed/">https://www.youtube.com/embed/</A>&quot;+videoID+&quot;?showinfo=0&amp;autoplay=&quot;+autoplay;
            $(this).attr('data-src', vidURL);
        }else{
            console.log('Only Vimeo and Youtube videos are supported at this time');
        }
    });
    
    // Multipurpose Modals
    
    jQuery('.foundry_modal[modal-link]').remove();

    if($('.foundry_modal').length &amp;&amp; (!jQuery('.modal-screen').length)){
        // Add a div.modal-screen if there isn't already one there.
        var modalScreen = jQuery('&lt;div /&gt;').addClass('modal-screen').appendTo('body');

    }

    jQuery('.foundry_modal').click(function(){
        jQuery(this).addClass('modal-acknowledged');
    });

    jQuery(document).on('wheel mousewheel scroll', '.foundry_modal, .modal-screen', function(evt){
        $(this).get(0).scrollTop += (evt.originalEvent.deltaY); 
        return false;
    });
    
    $('.modal-container:not([modal-link])').each(function(index) {
        if(jQuery(this).find('iframe[src]').length){
        	jQuery(this).find('.foundry_modal').addClass('iframe-modal');
        	var iframe = jQuery(this).find('iframe');
        	iframe.attr('data-src',iframe.attr('src'));
            iframe.attr('src', <I>);</I>

        }
        jQuery(this).find('.btn-modal').attr('modal-link', index);

        // Only clone and append to body if there isn't already one there
        if(!jQuery('.foundry_modal[modal-link=&quot;'+index+'&quot;]').length){
            jQuery(this).find('.foundry_modal').clone().appendTo('body').attr('modal-link', index).prepend(jQuery('<I class="ti-close close-modal">'));
        }
    });
    
    $('.btn-modal').unbind('click').click(function(){
    	var linkedModal = jQuery('.foundry_modal[modal-link=&quot;' + jQuery(this).attr('modal-link') + '&quot;]'),
            autoplayMsg = &quot;&quot;;
        jQuery('.modal-screen').toggleClass('reveal-modal');
        if(linkedModal.find('iframe').length){
            if(linkedModal.find('iframe').attr('data-autoplay') === '1'){
                var autoplayMsg = '&amp;autoplay=1'
            }
        	linkedModal.find('iframe').attr('src', (linkedModal.find('iframe').attr('data-src') + autoplayMsg));
        }
        if(linkedModal.find('video').length){
            linkedModal.find('video').get(0).play();
        }
        linkedModal.toggleClass('reveal-modal');
        return false; 
    });
    
    // Autoshow modals
	
	$('.foundry_modal[data-time-delay]').each(function(){
		var modal = $(this);
		var delay = modal.attr('data-time-delay');
		modal.prepend($('&lt;i class=&quot;ti-close close-modal&quot;&gt;'));
    	if(typeof modal.attr('data-cookie') != &quot;undefined&quot;){
        	if(!mr_cookies.hasItem(modal.attr('data-cookie'))){
                setTimeout(function(){
        			modal.addClass('reveal-modal');
        			$('.modal-screen').addClass('reveal-modal');
        		},delay);
            }
        }else{
            setTimeout(function(){
                modal.addClass('reveal-modal');
                $('.modal-screen').addClass('reveal-modal');
            },delay);
        }
	});

    // Exit modals
    $('.foundry_modal[data-show-on-exit]').each(function(){
        var modal = $(this);
        var exitSelector = $(modal.attr('data-show-on-exit'));
        // If a valid selector is found, attach leave event to show modal.
        if($(exitSelector).length){
            modal.prepend($('&lt;i class=&quot;ti-close close-modal&quot;&gt;'));
            $(document).on('mouseleave', exitSelector, function(){
                if(!$('body .reveal-modal').length){
                    if(typeof modal.attr('data-cookie') !== typeof undefined){
                        if(!mr_cookies.hasItem(modal.attr('data-cookie'))){
                            modal.addClass('reveal-modal');
                            $('.modal-screen').addClass('reveal-modal');
                        }
                    }else{
                        modal.addClass('reveal-modal');
                        $('.modal-screen').addClass('reveal-modal');
                    }
                }
            });
        }
    });

    // Autoclose modals

    $('.foundry_modal[data-hide-after]').each(function(){
        var modal = $(this);
        var delay = modal.attr('data-hide-after');
        if(typeof modal.attr('data-cookie') != &quot;undefined&quot;){
            if(!mr_cookies.hasItem(modal.attr('data-cookie'))){
                setTimeout(function(){
                if(!modal.hasClass('modal-acknowledged')){
                    modal.removeClass('reveal-modal');
                    $('.modal-screen').removeClass('reveal-modal');
                }
                },delay); 
            }
        }else{
            setTimeout(function(){
                if(!modal.hasClass('modal-acknowledged')){
                    modal.removeClass('reveal-modal');
                    $('.modal-screen').removeClass('reveal-modal');
                }
            },delay); 
        }
    });
    
    jQuery('.close-modal:not(.modal-strip .close-modal)').unbind('click').click(function(){
    	var modal = jQuery(this).closest('.foundry_modal');
        modal.toggleClass('reveal-modal');
        if(typeof modal.attr('data-cookie') !== &quot;undefined&quot;){
            mr_cookies.setItem(modal.attr('data-cookie'), &quot;true&quot;, Infinity);
        }
    	if(modal.find('iframe').length){
            modal.find('iframe').attr('src', <I>);</I>
        }
        jQuery('.modal-screen').removeClass('reveal-modal');
    });
    
    jQuery('.modal-screen').unbind('click').click(function(){
        if(jQuery('.foundry_modal.reveal-modal').find('iframe').length){
            jQuery('.foundry_modal.reveal-modal').find('iframe').attr('src', <I>);</I>
        }
    	jQuery('.foundry_modal.reveal-modal').toggleClass('reveal-modal');
    	jQuery(this).toggleClass('reveal-modal');
    });
    
    jQuery(document).keyup(function(e) {
		 if (e.keyCode == 27) { // escape key maps to keycode `27`
            if(jQuery('.foundry_modal').find('iframe').length){
                jQuery('.foundry_modal').find('iframe').attr('src', <I>);</I>
            }
			jQuery('.foundry_modal').removeClass('reveal-modal');
			jQuery('.modal-screen').removeClass('reveal-modal');
		}
	});
    
    // Modal Strips
    
    jQuery('.modal-strip').each(function(){
    	if(!jQuery(this).find('.close-modal').length){
    		jQuery(this).append(jQuery('&lt;i class=&quot;ti-close close-modal&quot;&gt;'));
    	}
    	var modal = jQuery(this);

        if(typeof modal.attr('data-cookie') != &quot;undefined&quot;){
           
            if(!mr_cookies.hasItem(modal.attr('data-cookie'))){
            	setTimeout(function(){
            		modal.addClass('reveal-modal');
            	},1000);
            }
        }else{
            setTimeout(function(){
                    modal.addClass('reveal-modal');
            },1000);
        }
    });
    
    jQuery('.modal-strip .close-modal').click(function(){
        var modal = jQuery(this).closest('.modal-strip');
        if(typeof modal.attr('data-cookie') != &quot;undefined&quot;){
            mr_cookies.setItem(modal.attr('data-cookie'), &quot;true&quot;, Infinity);
        }
    	jQuery(this).closest('.modal-strip').removeClass('reveal-modal');
    	return false;
    });


    // Video Modals

    jQuery('.close-iframe').click(function() {
        jQuery(this).closest('.modal-video').removeClass('reveal-modal');
        jQuery(this).siblings('iframe').attr('src', <I>);</I>
        jQuery(this).siblings('video').get(0).pause();
    });

    // Checkboxes

    $('.checkbox-option').on(&quot;click&quot;,function() {
        $(this).toggleClass('checked');
        var checkbox = $(this).find('input');
        if (checkbox.prop('checked') === false) {
            checkbox.prop('checked', true);
        } else {
            checkbox.prop('checked', false);
        }
    });

    // Radio Buttons

    $('.radio-option').click(function() {

        var checked = $(this).hasClass('checked'); // Get the current status of the radio

        var name = $(this).find('input').attr('name'); // Get the name of the input clicked

        if (!checked) {

            $('input[name=&quot;'+name+'&quot;]').parent().removeClass('checked');

            $(this).addClass('checked');

            $(this).find('input').prop('checked', true);

        }

    });


    // Accordions

    $('.accordion li').click(function() {
        if ($(this).closest('.accordion').hasClass('one-open')) {
            $(this).closest('.accordion').find('li').removeClass('active');
            $(this).addClass('active');
        } else {
            $(this).toggleClass('active');
        }
        if(typeof window.mr_parallax !== &quot;undefined&quot;){
            setTimeout(mr_parallax.windowLoad, 500);
        }
    });

    // Tabbed Content

    $('.tabbed-content').each(function() {
        $(this).append('');
</I><PRE><I class="ti-close close-modal">   });
</I></PRE><PRE>   $('.tabs li').each(function() {
       var originalTab = $(this),
           activeClass = &quot;&quot;;
       if (originalTab.is('.tabs&gt;li:first-child')) {
           activeClass = ' class=&quot;active&quot;';
       }
       var tabContent = originalTab.find('.tab-content').detach().wrap('&lt;li' + activeClass + '&gt;&lt;/li&gt;').parent();
       originalTab.closest('.tabbed-content').find('.content').append(tabContent);
   });
</PRE><PRE>   $('.tabs li').click(function() {
       $(this).closest('.tabs').find('li').removeClass('active');
       $(this).addClass('active');
       var liIndex = $(this).index() + 1;
       $(this).closest('.tabbed-content').find('.content&gt;li').removeClass('active');
       $(this).closest('.tabbed-content').find('.content&gt;li:nth-of-type(' + liIndex + ')').addClass('active');
   });
</PRE><PRE>   // Local Videos
</PRE><PRE>   $('section').closest('body').find('.local-video-container .play-button').click(function() {
       $(this).siblings('.background-image-holder').removeClass('fadeIn');
       $(this).siblings('.background-image-holder').css('z-index', -1);
       $(this).css('opacity', 0);
       $(this).siblings('video').get(0).play();
   });
</PRE><PRE>   // Youtube Videos
</PRE><PRE>   $('section').closest('body').find('.player').each(function() {
       var section = $(this).closest('section');
       section.find('.container').addClass('fadeOut');
       var src = $(this).attr('data-video-id');
       var startat = $(this).attr('data-start-at');
       $(this).attr('data-property', &quot;{videoURL:'<A rel="nofollow" class="external free" href="http://youtu.be/">http://youtu.be/</A>&quot; + src + &quot;',containment:'self',autoPlay:true, mute:true, startAt:&quot; + startat + &quot;, opacity:1, showControls:false}&quot;);
   });
</PRE><P>	if($('.player').length){
</P><PRE>       $('.player').each(function(){
</PRE><PRE>           var section = $(this).closest('section');
           var player = section.find('.player');
           player.YTPlayer();
           player.on(&quot;YTPStart&quot;,function(e){
               section.find('.container').removeClass('fadeOut');
               section.find('.masonry-loader').addClass('fadeOut');
           });
</PRE><PRE>       });
   }
</PRE><PRE>   // Interact with Map once the user has clicked (to prevent scrolling the page = zooming the map
</PRE><PRE>   $('.map-holder').click(function() {
       $(this).addClass('interact');
   });
   
   if($('.map-holder').length){
   	$(window).scroll(function() {
</PRE><P>			if ($('.map-holder.interact').length) {
				$('.map-holder.interact').removeClass('interact');
			}
		});
</P><PRE>   }
   
   // Countdown Timers
</PRE><PRE>   if ($('.countdown').length) {
       $('.countdown').each(function() {
           var date = $(this).attr('data-date');
           $(this).countdown(date, function(event) {
               $(this).text(
                   event.strftime('%D days %H:%M:%S')
               );
           });
       });
   }
   
   //                                                            //
   //                                                            //
   // Contact form code                                          //
   //                                                            //
   //                                                            //
</PRE><PRE>   $('form.form-email, form.form-newsletter').submit(function(e) {
</PRE><PRE>       // return false so form submits through jQuery rather than reloading page.
       if (e.preventDefault) e.preventDefault();
       else e.returnValue = false;
</PRE><PRE>       var thisForm = $(this).closest('form.form-email, form.form-newsletter'),
           submitButton = thisForm.find('button[type=&quot;submit&quot;]'),
           error = 0,
           originalError = thisForm.attr('original-error'),
           preparedForm, iFrame, userEmail, userFullName, userFirstName, userLastName, successRedirect, formError, formSuccess;
</PRE><PRE>       // Mailchimp/Campaign Monitor Mail List Form Scripts
       iFrame = $(thisForm).find('iframe.mail-list-form');
</PRE><PRE>       thisForm.find('.form-error, .form-success').remove();
       submitButton.attr('data-text', submitButton.text());
</PRE>
        thisForm.append('<DIV class="form-error" style="display: none;">' + thisForm.attr('data-error') + '</DIV>');
        thisForm.append('<DIV class="form-success" style="display: none;">' + thisForm.attr('data-success') + '</DIV>');
<PRE>       formError = thisForm.find('.form-error');
       formSuccess = thisForm.find('.form-success');
       thisForm.addClass('attempted-submit');
</PRE><PRE>       // Do this if there is an iframe, and it contains usable Mail Chimp / Campaign Monitor iframe embed code
       if ((iFrame.length) &amp;&amp; (typeof iFrame.attr('srcdoc') !== &quot;undefined&quot;) &amp;&amp; (iFrame.attr('srcdoc') !== &quot;&quot;)) {
</PRE><PRE>           console.log('Mail list form signup detected.');
           if (typeof originalError !== typeof undefined &amp;&amp; originalError !== false) {
               formError.html(originalError);
           }
           userEmail = $(thisForm).find('.signup-email-field').val();
           userFullName = $(thisForm).find('.signup-name-field').val();
           if ($(thisForm).find('input.signup-first-name-field').length) {
               userFirstName = $(thisForm).find('input.signup-first-name-field').val();
           } else {
               userFirstName = $(thisForm).find('.signup-name-field').val();
           }
           userLastName = $(thisForm).find('.signup-last-name-field').val();
</PRE><PRE>      // validateFields returns 1 on error;
           if (validateFields(thisForm) !== 1) {
               preparedForm = prepareSignup(iFrame);
</PRE><PRE>               preparedForm.find('#mce-EMAIL, #fieldEmail').val(userEmail);
               preparedForm.find('#mce-LNAME, #fieldLastName').val(userLastName);
               preparedForm.find('#mce-FNAME, #fieldFirstName').val(userFirstName);
               preparedForm.find('#mce-NAME, #fieldName').val(userFullName);
               thisForm.removeClass('attempted-submit');
</PRE><PRE>               // Hide the error if one was shown
               formError.fadeOut(200);
               // Create a new loading spinner in the submit button.
               submitButton.html(jQuery('&lt;div /&gt;').addClass('form-loading')).attr('disabled', 'disabled');
               
               try{
                   $.ajax({
                       url: preparedForm.attr('action'),
                       crossDomain: true,
                       data: preparedForm.serialize(),
                       method: &quot;GET&quot;,
                       cache: false,
                       dataType: 'json',
                       contentType: 'application/json; charset=utf-8',
                       success: function(data){
                           // Request was a success, what was the response?
                           if (data.result != &quot;success&quot; &amp;&amp; data.Status != 200) {
                               
                               // Error from Mail Chimp or Campaign Monitor
</PRE><PRE>                               // Keep the current error text in a data attribute on the form
                               formError.attr('original-error', formError.text());
                               // Show the error with the returned error text.
                               formError.html(data.msg).fadeIn(1000);
                               formSuccess.fadeOut(1000);
</PRE><PRE>                               submitButton.html(submitButton.attr('data-text')).removeAttr('disabled');
                           } else {
                               
                               // Got Success from Mail Chimp
                               
                               submitButton.html(submitButton.attr('data-text')).removeAttr('disabled');
</PRE><PRE>                               successRedirect = thisForm.attr('success-redirect');
                               // For some browsers, if empty `successRedirect` is undefined; for others,
                               // `successRedirect` is false.  Check for both.
                               if (typeof successRedirect !== typeof undefined &amp;&amp; successRedirect !== false &amp;&amp; successRedirect !== &quot;&quot;) {
                                   window.location = successRedirect;
                               }
</PRE><PRE>                               thisForm.find('input[type=&quot;text&quot;]').val(&quot;&quot;);
                               thisForm.find('textarea').val(&quot;&quot;);
                               formSuccess.fadeIn(1000);
</PRE><PRE>                               formError.fadeOut(1000);
                               setTimeout(function() {
                                   formSuccess.fadeOut(500);
                               }, 5000);
                           }
                       }
                   });
               }catch(err){
                   // Keep the current error text in a data attribute on the form
                   formError.attr('original-error', formError.text());
                   // Show the error with the returned error text.
                   formError.html(err.message).fadeIn(1000);
                   formSuccess.fadeOut(1000);
                   setTimeout(function() {
                       formError.fadeOut(500);
                   }, 5000);
</PRE><PRE>                   submitButton.html(submitButton.attr('data-text')).removeAttr('disabled');
               }
           
</PRE><PRE>           } else {
               formError.fadeIn(1000);
               setTimeout(function() {
                   formError.fadeOut(500);
               }, 5000);
           }
       } else {
           // If no iframe detected then this is treated as an email form instead.
           console.log('Send email form detected.');
           if (typeof originalError !== typeof undefined &amp;&amp; originalError !== false) {
               formError.text(originalError);
           }
</PRE><PRE>           error = validateFields(thisForm);
</PRE><PRE>           if (error === 1) {
               formError.fadeIn(200);
               setTimeout(function() {
                   formError.fadeOut(500);
               }, 3000);
           } else {
</PRE><PRE>               thisForm.removeClass('attempted-submit');
</PRE><PRE>               // Hide the error if one was shown
               formError.fadeOut(200);
               
               // Create a new loading spinner in the submit button.
               submitButton.html(jQuery('&lt;div /&gt;').addClass('form-loading')).attr('disabled', 'disabled');
</PRE><PRE>               jQuery.ajax({
                   type: &quot;POST&quot;,
                   url: &quot;mail/mail.php&quot;,
                   data: thisForm.serialize()+&quot;&amp;url=&quot;+window.location.href,
                   success: function(response) {
                       // Swiftmailer always sends back a number representing numner of emails sent.
                       // If this is numeric (not Swift Mailer error text) AND greater than 0 then show success message.
</PRE><PRE>                       submitButton.html(submitButton.attr('data-text')).removeAttr('disabled');
</PRE><PRE>                       if ($.isNumeric(response)) {
                           if (parseInt(response) &gt; 0) {
                               // For some browsers, if empty 'successRedirect' is undefined; for others,
                               // 'successRedirect' is false.  Check for both.
                               successRedirect = thisForm.attr('success-redirect');
                               if (typeof successRedirect !== typeof undefined &amp;&amp; successRedirect !== false &amp;&amp; successRedirect !== &quot;&quot;) {
                                   window.location = successRedirect;
                               }
</PRE><PRE>                               thisForm.find('input[type=&quot;text&quot;]').val(&quot;&quot;);
                               thisForm.find('textarea').val(&quot;&quot;);
                               thisForm.find('.form-success').fadeIn(1000);
</PRE><PRE>                               formError.fadeOut(1000);
                               setTimeout(function() {
                                   formSuccess.fadeOut(500);
                               }, 5000);
                           }
                       }
                       // If error text was returned, put the text in the .form-error div and show it.
                       else {
                           // Keep the current error text in a data attribute on the form
                           formError.attr('original-error', formError.text());
                           // Show the error with the returned error text.
                           formError.text(response).fadeIn(1000);
                           formSuccess.fadeOut(1000);
                       }
                   },
                   error: function(errorObject, errorText, errorHTTP) {
                       // Keep the current error text in a data attribute on the form
                       formError.attr('original-error', formError.text());
                       // Show the error with the returned error text.
                       formError.text(errorHTTP).fadeIn(1000);
                       formSuccess.fadeOut(1000);
                       submitButton.html(submitButton.attr('data-text')).removeAttr('disabled');
                   }
               });
           }
       }
       return false;
   });
</PRE><PRE>   $('.validate-required, .validate-email').on('blur change', function() {
       validateFields($(this).closest('form'));
   });
</PRE><PRE>   $('form').each(function() {
       if ($(this).find('.form-error').length) {
           $(this).attr('original-error', $(this).find('.form-error').text());
       }
   });
</PRE><PRE>   function validateFields(form) {
           var name, error, originalErrorMessage;
</PRE><PRE>           $(form).find('.validate-required[type=&quot;checkbox&quot;]').each(function() {
               if (!$('[name=&quot;' + $(this).attr('name') + '&quot;]:checked').length) {
                   error = 1;
                   name = $(this).attr('name').replace('[]', <I>);</I>
                   form.find('.form-error').text('Please tick at least one ' + name + ' box.');
               }
           });
</PRE><PRE>           $(form).find('.validate-required').each(function() {
               if ($(this).val() === <I>) {</I>
                   $(this).addClass('field-error');
                   error = 1;
               } else {
                   $(this).removeClass('field-error');
               }
           });
</PRE><PRE>           $(form).find('.validate-email').each(function() {
               if (!(/(.+)@(.+){2,}\.(.+){2,}/.test($(this).val()))) {
                   $(this).addClass('field-error');
                   error = 1;
               } else {
                   $(this).removeClass('field-error');
               }
           });
</PRE><PRE>           if (!form.find('.field-error').length) {
               form.find('.form-error').fadeOut(1000);
           }
</PRE><PRE>           return error;
       }
</PRE><PRE>   //
   //    
   // End contact form code
   //
   //
</PRE><PRE>   // Get referrer from URL string 
   if (getURLParameter(&quot;ref&quot;)) {
       $('form.form-email').append('&lt;input type=&quot;text&quot; name=&quot;referrer&quot; class=&quot;hidden&quot; value=&quot;' + getURLParameter(&quot;ref&quot;) + '&quot;/&gt;');
   }
</PRE><PRE>   function getURLParameter(name) {
       return decodeURIComponent((new RegExp('[?|&amp;]' + name + '=' + '([^&amp;;]+?)(&amp;|#|;|$)').exec(location.search) || [, &quot;&quot;])[1].replace(/\+/g, '%20')) || null;
   }
</PRE><PRE>   // Disable parallax on mobile
</PRE><PRE>   if ((/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i).test(navigator.userAgent || navigator.vendor || window.opera)) {
       $('section').removeClass('parallax');
   }
   
   // Disqus Comments
   
   if($('.disqus-comments').length){
</PRE><P>		/* * * CONFIGURATION VARIABLES * * */
		var disqus_shortname = $('.disqus-comments').attr('data-shortname');
</P><P>		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
</P><PRE>   }
</PRE><PRE>   // Load Google MAP API JS with callback to initialise when fully loaded
   if(document.querySelector('[data-maps-api-key]') &amp;&amp; !document.querySelector('.gMapsAPI')){
       if($('[data-maps-api-key]').length){
           var script = document.createElement('script');
           var apiKey = $('[data-maps-api-key]:first').attr('data-maps-api-key');
           script.type = 'text/javascript';
           script.src = '<A rel="nofollow" class="external free" href="https://maps.googleapis.com/maps/api/js?key='+apiKey+'&amp;callback=initializeMaps'">https://maps.googleapis.com/maps/api/js?key='+apiKey+'&amp;callback=initializeMaps'</A>;
           script.className = 'gMapsAPI';
           document.body.appendChild(script);  
       } 
   }
</PRE><P>}); 
</P><P>$(window).load(function() { 
</P><PRE>   &quot;use strict&quot;;
</PRE><PRE>   // Initialize Masonry
</PRE><PRE>   setTimeout(initializeMasonry, 1000);
</PRE><PRE>   // Initialize twitter feed
</PRE><PRE>   var setUpTweets = setInterval(function() {
       if ($('.tweets-slider').find('li.flex-active-slide').length) {
           clearInterval(setUpTweets);
           return;
       } else {
           if ($('.tweets-slider').length) {
               $('.tweets-slider').flexslider({
                   directionNav: false,
                   controlNav: false
               });
           }
       }
   }, 500);
</PRE><PRE>   mr_firstSectionHeight = $('.main-container section:nth-of-type(1)').outerHeight(true);
</PRE><P>
}); 
function updateNav() {
</P><PRE>   var scrollY = mr_scrollTop;
</PRE><PRE>   if (scrollY &lt;= 0) {
       if (mr_navFixed) {
           mr_navFixed = false;
           mr_nav.removeClass('fixed');
       }
       if (mr_outOfSight) {
           mr_outOfSight = false;
           mr_nav.removeClass('outOfSight');
       }
       if (mr_navScrolled) {
           mr_navScrolled = false;
           mr_nav.removeClass('scrolled');
       }
       return;
   }
</PRE><PRE>   if (scrollY &gt; mr_navOuterHeight + mr_fixedAt) {
       if (!mr_navScrolled) {
           mr_nav.addClass('scrolled');
           mr_navScrolled = true;
           return;
       }
   } else {
       if (scrollY &gt; mr_navOuterHeight) {
          if (!mr_navFixed) {
               mr_nav.addClass('fixed');
               mr_navFixed = true;
           }
</PRE><PRE>           if (scrollY &gt; mr_navOuterHeight +10) {
               if (!mr_outOfSight) {
                   mr_nav.addClass('outOfSight');
                   mr_outOfSight = true;
               }
           } else {
               if (mr_outOfSight) {
                   mr_outOfSight = false;
                   mr_nav.removeClass('outOfSight');
               }
           }
       } else {
           if (mr_navFixed) {
               mr_navFixed = false;
               mr_nav.removeClass('fixed');
           }
           if (mr_outOfSight) {
               mr_outOfSight = false;
               mr_nav.removeClass('outOfSight');
           }
       }
</PRE><PRE>       if (mr_navScrolled) {
           mr_navScrolled = false;
           mr_nav.removeClass('scrolled');
       }
</PRE><PRE>   }
</PRE><P>}
</P><P>
function capitaliseFirstLetter(string) {
</P><PRE>   return string.charAt(0).toUpperCase() + string.slice(1);
</PRE><P>}
</P><P>function initializeMasonry(){
</P><PRE>   $('.masonry').each(function(){
       var container = $(this).get(0);
       var msnry = new Masonry(container, {
           itemSelector: '.masonry-item'
       });
</PRE><PRE>       msnry.on('layoutComplete', function() {
</PRE><PRE>           mr_firstSectionHeight = $('.main-container section:nth-of-type(1)').outerHeight(true);
</PRE><PRE>           // Fix floating project filters to bottom of projects container
</PRE><PRE>           if ($('.filters.floating').length) {
               setupFloatingProjectFilters();
               updateFloatingFilters();
               window.addEventListener(&quot;scroll&quot;, updateFloatingFilters, false);
           }
</PRE><PRE>           $('.masonry').addClass('fadeIn');
           $('.masonry-loader').addClass('fadeOut');
           if ($('.masonryFlyIn').length) {
               masonryFlyIn();
           }
       });
</PRE><PRE>       msnry.layout();
   });
</PRE><P>}
</P><P>function masonryFlyIn() {
</P><PRE>   var $items = $('.masonryFlyIn .masonry-item');
   var time = 0;
</PRE><PRE>   $items.each(function() {
       var item = $(this);
       setTimeout(function() {
           item.addClass('fadeIn');
       }, time);
       time += 170;
   });
</PRE><P>}
</P><P>function setupFloatingProjectFilters() {
</P><PRE>   mr_floatingProjectSections = [];
   $('.filters.floating').closest('section').each(function() {
       var section = $(this);
</PRE><PRE>       mr_floatingProjectSections.push({
           section: section.get(0),
           outerHeight: section.outerHeight(),
           elemTop: section.offset().top,
           elemBottom: section.offset().top + section.outerHeight(),
           filters: section.find('.filters.floating'),
           filersHeight: section.find('.filters.floating').outerHeight(true)
       });
   });
</PRE><P>}
</P><P>function updateFloatingFilters() {
</P><PRE>   var l = mr_floatingProjectSections.length;
   while (l--) {
       var section = mr_floatingProjectSections[l];
</PRE><PRE>       if ((section.elemTop &lt; mr_scrollTop) &amp;&amp; typeof window.mr_variant == &quot;undefined&quot; ) {
           section.filters.css({
               position: 'fixed',
               top: '16px',
               bottom: 'auto'
           });
           if (mr_navScrolled) {
               section.filters.css({
                   transform: 'translate3d(-50%,48px,0)'
               });
           }
           if (mr_scrollTop &gt; (section.elemBottom - 70)) {
               section.filters.css({
                   position: 'absolute',
                   bottom: '16px',
                   top: 'auto'
               });
               section.filters.css({
                   transform: 'translate3d(-50%,0,0)'
               });
           }
       } else {
           section.filters.css({
               position: 'absolute',
               transform: 'translate3d(-50%,0,0)'
           });
       }
   }
</PRE><P>}
</P><P>window.initializeMaps = function(){
</P><PRE>   if(typeof google !== &quot;undefined&quot;){
       if(typeof google.maps !== &quot;undefined&quot;){
           $('.map-canvas[data-maps-api-key]').each(function(){
                   var mapInstance   = this,
                       mapJSON       = typeof $(this).attr('data-map-style') !== &quot;undefined&quot; ? $(this).attr('data-map-style'): false,
                       mapStyle      = JSON.parse(mapJSON) || [{&quot;featureType&quot;:&quot;landscape&quot;,&quot;stylers&quot;:[{&quot;saturation&quot;:-100},{&quot;lightness&quot;:65},{&quot;visibility&quot;:&quot;on&quot;}]},{&quot;featureType&quot;:&quot;poi&quot;,&quot;stylers&quot;:[{&quot;saturation&quot;:-100},{&quot;lightness&quot;:51},{&quot;visibility&quot;:&quot;simplified&quot;}]},{&quot;featureType&quot;:&quot;road.highway&quot;,&quot;stylers&quot;:[{&quot;saturation&quot;:-100},{&quot;visibility&quot;:&quot;simplified&quot;}]},{&quot;featureType&quot;:&quot;road.arterial&quot;,&quot;stylers&quot;:[{&quot;saturation&quot;:-100},{&quot;lightness&quot;:30},{&quot;visibility&quot;:&quot;on&quot;}]},{&quot;featureType&quot;:&quot;road.local&quot;,&quot;stylers&quot;:[{&quot;saturation&quot;:-100},{&quot;lightness&quot;:40},{&quot;visibility&quot;:&quot;on&quot;}]},{&quot;featureType&quot;:&quot;transit&quot;,&quot;stylers&quot;:[{&quot;saturation&quot;:-100},{&quot;visibility&quot;:&quot;simplified&quot;}]},{&quot;featureType&quot;:&quot;administrative.province&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;}]},{&quot;featureType&quot;:&quot;water&quot;,&quot;elementType&quot;:&quot;labels&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;on&quot;},{&quot;lightness&quot;:-25},{&quot;saturation&quot;:-100}]},{&quot;featureType&quot;:&quot;water&quot;,&quot;elementType&quot;:&quot;geometry&quot;,&quot;stylers&quot;:[{&quot;hue&quot;:&quot;#ffff00&quot;},{&quot;lightness&quot;:-25},{&quot;saturation&quot;:-97}]}],
                       zoomLevel     = (typeof $(this).attr('data-map-zoom') !== &quot;undefined&quot; &amp;&amp; $(this).attr('data-map-zoom') !== &quot;&quot;) ? $(this).attr('data-map-zoom') * 1: 17,
                       latlong       = typeof $(this).attr('data-latlong') != &quot;undefined&quot; ? $(this).attr('data-latlong') : false,
                       latitude      = latlong ? 1 *latlong.substr(0, latlong.indexOf(',')) : false,
                       longitude     = latlong ? 1 * latlong.substr(latlong.indexOf(&quot;,&quot;) + 1) : false,
                       geocoder      = new google.maps.Geocoder(),
                       address       = typeof $(this).attr('data-address') !== &quot;undefined&quot; ? $(this).attr('data-address').split(';'): [&quot;&quot;],
                       markerTitle   = &quot;We Are Here&quot;,
                       isDraggable = $(document).width() &gt; 766 ? true : false,
                       map, marker, markerImage,
                       mapOptions = {
                           draggable: isDraggable,
                           scrollwheel: false,
                           zoom: zoomLevel,
                           disableDefaultUI: true,
                           styles: mapStyle
                       };
</PRE><PRE>                   if($(this).attr('data-marker-title') != undefined &amp;&amp; $(this).attr('data-marker-title') != &quot;&quot; )
                   {
                       markerTitle = $(this).attr('data-marker-title');
                   }
</PRE><PRE>                   if(address != undefined &amp;&amp; address[0] != &quot;&quot;){
                           geocoder.geocode( { 'address': address[0].replace('[nomarker]',<I>)}, function(results, status) {</I>                      if (status == google.maps.GeocoderStatus.OK) {
                               var map = new google.maps.Map(mapInstance, mapOptions); 
                               map.setCenter(results[0].geometry.location);
                               
                               address.forEach(function(address){
                                   var markerGeoCoder;
                                   
                                   markerImage = {url: window.mr_variant == undefined ? 'img/mapmarker.png' : '../img/mapmarker.png', size: new google.maps.Size(50,50), scaledSize: new google.maps.Size(50,50)};
                                   if(/(\-?\d+(\.\d+)?),\s*(\-?\d+(\.\d+)?)/.test(address) ){
                                       var latlong = address.split(','),
                                       marker = new google.maps.Marker({
                                                       position: { lat: 1*latlong[0], lng: 1*latlong[1] },
                                                       map: map,
                                                       icon: markerImage,
                                                       title: markerTitle,
                                                       optimised: false
                                                   });
                                   }
                                   else if(address.indexOf('[nomarker]') &lt; 0){
                                       markerGeoCoder = new google.maps.Geocoder();
                                       markerGeoCoder.geocode( { 'address': address.replace('[nomarker]',<I>)}, function(results, status) {</I>
                                           if (status == google.maps.GeocoderStatus.OK) {
                                               marker = new google.maps.Marker({
                                                   map: map,
                                                   icon: markerImage,
                                                   title: markerTitle,
                                                   position: results[0].geometry.location,
                                                   optimised: false
                                               });
                                           }
                                       });
                                   }
</PRE><PRE>                               });
                           } else {
                               console.log('There was a problem geocoding the address.');
                           }
                       });
                   }
                   else if(latitude != undefined &amp;&amp; latitude != &quot;&quot; &amp;&amp; latitude != false &amp;&amp; longitude != undefined &amp;&amp; longitude != &quot;&quot; &amp;&amp; longitude != false ){
                       mapOptions.center   = { lat: latitude, lng: longitude};
                       map = new google.maps.Map(mapInstance, mapOptions); 
                       marker              = new google.maps.Marker({
                                                   position: { lat: latitude, lng: longitude },
                                                   map: map,
                                                   icon: markerImage,
                                                   title: markerTitle
                                               });
</PRE><PRE>                   }
</PRE><PRE>               }); 
       }
   }
</PRE><P>}
initializeMaps();
</P><P>// End of Maps
</P><P>
// Prepare Signup Form - It is used to retrieve form details from an iframe Mail Chimp or Campaign Monitor form.
</P><P>function prepareSignup(iFrame){
</P><PRE>   var form   = jQuery('&lt;form /&gt;'),
       div    = jQuery('&lt;div /&gt;'),
       action;
</PRE><PRE>   jQuery(div).html(iFrame.attr('srcdoc'));
   action = jQuery(div).find('form').attr('action');
</PRE><PRE>   // Alter action for a Mail Chimp-compatible ajax request url.
   if(/list-manage\.com/.test(action)){
      action = action.replace('/post?', '/post-json?') + &quot;&amp;c=?&quot;;
      if(action.substr(0,2) == &quot;//&quot;){
          action = 'http:' + action;
      }
   }
</PRE><PRE>   // Alter action for a Campaign Monitor-compatible ajax request url.
   if(/createsend\.com/.test(action)){
      action = action + '?callback=?';
   }
</PRE><PRE>   // Set action on the form
   form.attr('action', action);
</PRE><PRE>   // Clone form input fields from 
   jQuery(div).find('input, select, textarea').not('input[type=&quot;submit&quot;]').each(function(){
       jQuery(this).clone().appendTo(form);
</PRE><PRE>   });
</PRE><PRE>   return form;
       
</PRE><P>}
</P><P>/*\
|*|  COOKIE LIBRARY THANKS TO MDN
|*|
|*|  A complete cookies reader/writer framework with full unicode support.
|*|
|*|  Revision #1 - September 4, 2014
|*|
|*|  <A rel="nofollow" class="external free" href="https://developer.mozilla.org/en-US/docs/Web/API/document.cookie">https://developer.mozilla.org/en-US/docs/Web/API/document.cookie</A>
|*|  <A rel="nofollow" class="external free" href="https://developer.mozilla.org/User:fusionchess">https://developer.mozilla.org/User:fusionchess</A>
|*|
|*|  This framework is released under the GNU Public License, version 3 or later.
|*|  <A rel="nofollow" class="external free" href="http://www.gnu.org/licenses/gpl-3.0-standalone.html">http://www.gnu.org/licenses/gpl-3.0-standalone.html</A>
|*|
|*|  Syntaxes:
|*|
|*|  * mr_cookies.setItem(name, value[, end[, path[, domain[, secure]]]])
|*|  * mr_cookies.getItem(name)
|*|  * mr_cookies.removeItem(name[, path[, domain]])
|*|  * mr_cookies.hasItem(name)
|*|  * mr_cookies.keys()
|*|
\*/
</P><P>var mr_cookies = {
</P><PRE> getItem: function (sKey) {
   if (!sKey) { return null; }
   return decodeURIComponent(document.cookie.replace(new RegExp(&quot;(?:(?:^|.*;)\\s*&quot; + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, &quot;\\$&amp;&quot;) + &quot;\\s*\\=\\s*([^;]*).*$)|^.*$&quot;), &quot;$1&quot;)) || null;
 },
 setItem: function (sKey, sValue, vEnd, sPath, sDomain, bSecure) {
   if (!sKey || /^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)) { return false; }
   var sExpires = &quot;&quot;;
   if (vEnd) {
     switch (vEnd.constructor) {
       case Number:
         sExpires = vEnd === Infinity ? &quot;; expires=Fri, 31 Dec 9999 23:59:59 GMT&quot; : &quot;; max-age=&quot; + vEnd;
         break;
       case String:
         sExpires = &quot;; expires=&quot; + vEnd;
         break;
       case Date:
         sExpires = &quot;; expires=&quot; + vEnd.toUTCString();
         break;
     }
   }
   document.cookie = encodeURIComponent(sKey) + &quot;=&quot; + encodeURIComponent(sValue) + sExpires + (sDomain ? &quot;; domain=&quot; + sDomain : &quot;&quot;) + (sPath ? &quot;; path=&quot; + sPath : &quot;&quot;) + (bSecure ? &quot;; secure&quot; : &quot;&quot;);
   return true;
 },
 removeItem: function (sKey, sPath, sDomain) {
   if (!this.hasItem(sKey)) { return false; }
   document.cookie = encodeURIComponent(sKey) + &quot;=; expires=Thu, 01 Jan 1970 00:00:00 GMT&quot; + (sDomain ? &quot;; domain=&quot; + sDomain : &quot;&quot;) + (sPath ? &quot;; path=&quot; + sPath : &quot;&quot;);
   return true;
 },
 hasItem: function (sKey) {
   if (!sKey) { return false; }
   return (new RegExp(&quot;(?:^|;\\s*)&quot; + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, &quot;\\$&amp;&quot;) + &quot;\\s*\\=&quot;)).test(document.cookie);
 },
 keys: function () {
   var aKeys = document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g, &quot;&quot;).split(/\s*(?:\=[^;]*)?;\s*/);
   for (var nLen = aKeys.length, nIdx = 0; nIdx &lt; nLen; nIdx++) { aKeys[nIdx] = decodeURIComponent(aKeys[nIdx]); }
   return aKeys;
 }
</PRE><P>};
</P><P>/*\
|*|  END COOKIE LIBRARY
\*/</P></LI></DIV></DIV></DIV></DIV></DIV></BODY></HTML>