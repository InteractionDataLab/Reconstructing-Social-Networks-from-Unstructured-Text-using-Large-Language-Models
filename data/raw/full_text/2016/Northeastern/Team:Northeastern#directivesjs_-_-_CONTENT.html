<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_Northeastern_directivesjs skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><DIV id="top_title"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:Northeastern/directivesjs</SPAN></H1></DIV><DIV id="HQ_page"><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><P>/*global angular*/
(function () {
</P><PRE>   'use strict';
</PRE><PRE>   angular.module(&quot;angularplasmid&quot;, [&quot;angularplasmid.services&quot;, &quot;ngMaterial&quot;, &quot;ngAnimate&quot;, &quot;ui.bootstrap&quot;, &quot;colorpicker.module&quot;])
</PRE><PRE>       .config(function($mdThemingProvider) {
           $mdThemingProvider.theme('default')
               .primaryPalette('blue')
               .accentPalette('indigo');
       })
</PRE><PRE>       // Custom controller for user interface
       .controller('PlasmidCtrl', ['$scope', 'SVGUtil', function ($scope, SVGUtil, DataSource) {
</PRE><PRE>           var xmlTransform = [];
           $scope.URLinputform = true;
           $scope.URLinputform2 = true;
           $scope.PartendOption = true;
           $scope.font_size=<I>;</I>
           $scope.labe_direction ='in';
           $scope.tick_color = &quot;#ff0000&quot;;
           $scope.minor_tick_color = &quot;#d3d3d3&quot;;
           $scope.label_color = &quot;#000000&quot;;
           $scope.track_color = &quot;#f0f0f0&quot;;
           $scope.part_label_color = &quot;#000000&quot;;
           $scope.label_direction = &quot;in&quot;;
           $scope.font_choice = &quot;Arial&quot;;
           $scope.minorinterval= 50;
</PRE><PRE>           // List of fonts, default is Arial
           $scope.fonts = [
               { face: &quot;Arial&quot; },
               { face: &quot;Tahoma&quot; },
               { face: &quot;Trebuchet MS&quot; },
               { face: &quot;Verdana&quot; },
               { face: &quot;Times&quot; },
               { face: &quot;Georgia&quot; },
               { face: &quot;Courier&quot; },
                   ];
           $scope.font = $scope.fonts[0];
</PRE><PRE>           $scope.isInputFormCollapsed = true;
           $scope.isDataCollapsed = true;
           $scope.plasmidname = <I>;</I>
           var inputMin = 1;
</PRE><PRE>           $scope.otherend;
</PRE><PRE>           // The input list is also empty at the start
           $scope.part = [
               {
               'name':<I>,</I>
               'start':<I>,</I>
               'basepairs':<I>,</I>
               'height':<I>,</I>
               'color':<I>,</I>
               'fwdarrow':<I>,</I>
               'revarrow':<I>,</I>
               'line':<I>,</I>
               'curve':<I>, </I>
               'link': <I>,</I>
               'end': <I>,           </I>
               }];
</PRE><PRE>           // The list of parts starts off empty
           $scope.parts = [
</PRE><PRE>               {
               'name':<I>,</I>
               'start':<I>,</I>
               'basepairs':<I>,</I>
               'height':<I>,</I>
               'color':<I>,</I>
               'fwdarrow':<I>,</I>
               'revarrow':<I>,</I>
               'line':<I>,</I>
               'curve':<I>,</I>
               'link':<I>,                  </I>
               }];
</PRE><PRE>           // Add each of the part attirbutes to the parts list and clear its value
           $scope.addRow = function () {
</PRE><PRE>               if($scope.part.end &gt; 0) {
                   $scope.part.basepairs = $scope.part.end - $scope.part.start;
               }
</PRE><PRE>               {
                   $scope.parts.push({ 'name':$scope.part.name, 'start':$scope.part.start, 'basepairs':$scope.part.basepairs, 'height':$scope.part.height, 'color':$scope.part.color, 'fwdarrow':$scope.part.fwdarrow, 'revarrow':$scope.part.revarrow, 'curve':$scope.part.curve, 'line':$scope.part.line, 'link':$scope.part.link });
                   $scope.part.name=<I>;</I>
                   $scope.part.start=<I>;</I>
                   $scope.part.basepairs=<I>;</I>
                   $scope.part.height=<I>;</I>
                   $scope.part.color=<I>;</I>
                   $scope.part.fwdarrow=<I>;</I>
                   $scope.part.revarrow=<I>;</I>
                   $scope.part.line=<I>;</I>
                   $scope.part.curve=<I>;</I>
                   $scope.part.link=<I>;</I>
                   $scope.part.end=<I>;</I>
                   $scope.URLinputform = true;
               }
</PRE><PRE>               };
</PRE><PRE>           // Remove the current row
           $scope.removeRow = function(index) {
               $scope.parts.splice( index, 1 );
               };
</PRE><PRE>           $scope.toggle_options = false;
           $scope.toggleOptions = function () {
               $scope.toggle_options = $scope.toggle_options === false ? true: false;
           }
</PRE><PRE>           $scope.toggle_value = true;
           $scope.exported_svg = <I>;</I>
           $scope.exportSVG = function () {
               $scope.toggle_value = $scope.toggle_value === false ? true: false;
               $scope.exported_svg = document.getElementById(&quot;plasmid-view&quot;).outerHTML;
           };
</PRE><PRE>           this.selectedMode = 'md-fling';
</PRE><PRE>       }])
</PRE><PRE>       .directive(&quot;plasmidapi&quot;, ['SVGUtil', function (SVGUtil) {
           return {
               restrict: &quot;AE&quot;,
               link : function (scope, elem, attr) {
                   scope[attr.name] = SVGUtil.api;
               }
           };
       }])
</PRE><PRE>       .directive(&quot;plasmid&quot;, ['SVGUtil', function (SVGUtil) {
           return {
               restrict: 'AE',
               type : 'svg',
               template : '&lt;svg xmlns=&quot;<A rel="nofollow" class="external free" href="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</A>&quot; xmlns:xlink=&quot;<A rel="nofollow" class="external free" href="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</A>&quot;&gt;&lt;/svg&gt;',
               replace : true,
               transclude: true,
               require: 'plasmid',
               scope: {
                   plasmidheight : '@',
                   plasmidwidth : '@',
                   sequencelength : '@',
                   sequence : '@',
                   plasmidclass : '@',
                   plasmidstyle : '@'
               },
               link : {
                   pre : function (scope, elem, attr, plasmidController) {
                       plasmidController.init(elem);
                   },
                   post : function (scope, elem, attrs, plasmidController, transcludeFn) {
</PRE><PRE>                       // Manually transclude children elements
                       transcludeFn(scope.$parent, function (content) {
                           elem.append(content);
                       });
</PRE><PRE>                       // Watch for changes to plasmid
                       scope.$watchGroup(['plasmidheight', 'plasmidwidth', 'sequencelength', 'sequence', 'plasmidclass', 'plasmidstyle'], function () {plasmidController.draw(); });
                   }
               },
               controller : ['$scope', 'SVGUtil', function ($scope, SVGUtil) {
                   var element, plasmid, tracks = [];
</PRE><PRE>                   plasmid = this;
                   
                   plasmid.elementtype = &quot;plasmid&quot;;
</PRE><PRE>                   plasmid.init = function (elem) {
                       SVGUtil.api.addPlasmid(plasmid);
                       element = elem;
                       plasmid.id = element.attr(&quot;id&quot;);
                   };
</PRE><PRE>                   plasmid.draw = function () {
                       var d = plasmid.dimensions, plasmidclass = element.plasmidclass, plasmidstyle = element.plasmidstyle;
                       element.attr(&quot;height&quot;, d.height);
                       element.attr(&quot;width&quot;, d.width);
                       if (plasmidclass) {element.attr(&quot;class&quot;,plasmidclass);}
                       if (plasmidstyle) {element.attr(&quot;style&quot;, plasmidstyle);}
</PRE><PRE>                       angular.forEach(tracks, function (t) {
                           t.draw();
                       });
                   };
</PRE><PRE>                   plasmid.addTrack = function (track) {
                       tracks.push(track);
                   };
</PRE><PRE>                   Object.defineProperty(plasmid, &quot;center&quot;, {
                       get: function () {
                           var d = plasmid.dimensions;
                           return {
                               x : d.width / 2,
                               y : d.height / 2
                           };
                       }
                   });
                   Object.defineProperty(plasmid, &quot;dimensions&quot;, {
                       get: function () {
                           return {
                               height : SVGUtil.util.Numeric($scope.plasmidheight, 300),
                               width : SVGUtil.util.Numeric($scope.plasmidwidth, 300)
                           };
                       }
                   });
                   Object.defineProperty(plasmid, &quot;sequencelength&quot;, {
                       get: function () {
                           return (plasmid.sequence ? plasmid.sequence.length : SVGUtil.util.Numeric($scope.sequencelength));
                       }
                   });
                   Object.defineProperty(plasmid, &quot;sequence&quot;, {
                       get: function () {
                           return $scope.sequence;
                       }
                   });
                   Object.defineProperty(plasmid, &quot;plasmidclass&quot;, {
                       get: function () {
                           return $scope.plasmidclass;
                       }
                   });
                   Object.defineProperty(plasmid, &quot;plasmidstyle&quot;, {
                       get: function () {
                           return $scope.plasmidstyle;
                       }
                   });                    
                   plasmid.tracks = tracks;
               }]
           };
       }])
</PRE><PRE>       .directive(&quot;plasmidtrack&quot;, ['SVGUtil', '$compile', function (SVGUtil, $compile) {
           return {
               restrict: 'AE',
               type : 'svg',
               template: '&lt;g&gt;&lt;path&gt;&lt;/path&gt;&lt;/g&gt;',
               replace : true,
               transclude: true,
               require: ['plasmidtrack', '^plasmid'],
               scope: {
                   radius: '@',
                   width: '@',
                   trackclass: '@',
                   trackstyle: '@',
                   trackclick: '&amp;'
               },
               link : {
                   pre : function (scope, elem, attr, controllers, transcludeFn) {
                       var trackController = controllers[0], plasmidController = controllers[1], pathElem = angular.element(elem.children()[0]);
                       trackController.init(pathElem, plasmidController);
                   },
                   post : function (scope, elem, attr, controllers, transcludeFn) {
</PRE><PRE>                       // Manually transclude children elements
                       transcludeFn(scope.$parent, function (content) {
                           elem.append(content);
                       });
</PRE><PRE>                       // Apply special style to path to allow for correct display and apply directive's properties (class, style, id, name) to the path instead of the g
                       var g = angular.element(elem), path  = angular.element(elem.children()[0]), trackController = controllers[0];
                       SVGUtil.util.swapProperties(g, path);
                       path.attr(&quot;fill-rule&quot;, &quot;evenodd&quot;);
                       $compile(path)(scope.$parent);
</PRE><PRE>                       //Attach event handlers
                       path.on(&quot;click&quot;, function (e) {
                           scope.trackclick({
                               $event: e,
                               $track: trackController
                           });
                       });
</PRE><PRE>                       // Watch for changes in the track
                       scope.$watchGroup(['radius', 'width', 'trackstyle', 'trackclass'], function () {trackController.draw(); });
                   }
               },
                   
               controller : ['$scope', function ($scope) {
                   var plasmid, element, plasmidTrack, markers = [], scales = [], labels = [];
</PRE><PRE>                   plasmidTrack = this;
                   
                   plasmidTrack.elementtype = &quot;plasmidtrack&quot;;
</PRE><PRE>                   plasmidTrack.init = function (elem, plasmidCtrl) {
                       plasmid = plasmidCtrl;
                       plasmid.addTrack(plasmidTrack);
                       plasmidTrack.plasmid = plasmid;
                       element = elem;
                   };
</PRE><PRE>                   plasmidTrack.draw = function () {
                       var center = plasmidTrack.center,
                           path = SVGUtil.svg.path.donut(center.x, center.y, plasmidTrack.radius, plasmidTrack.width),
                           trackclass = plasmidTrack.trackclass, 
                           trackstyle = plasmidTrack.trackstyle;
                       
                       element.attr(&quot;d&quot;, path);
                       if (trackclass) {element.attr(&quot;class&quot;,trackclass);}
                       if (trackstyle) {element.attr(&quot;style&quot;, trackstyle);}
                       
                       angular.forEach(markers, function (m) {
                           m.draw();
                       });
                       angular.forEach(scales, function (s) {
                           s.draw();
                       });
                       angular.forEach(labels, function (l) {
                           l.draw();
                       });
                   };
</PRE><PRE>                   plasmidTrack.addMarker = function (marker) {
                       markers.push(marker);
                   };
</PRE><PRE>                   plasmidTrack.addScale = function (scale) {
                       scales.push(scale);
                   };
                   
                   plasmidTrack.addLabel = function (label) {
                       labels.push(label);
                   };
</PRE><PRE>                   plasmidTrack.markergroup = function (groupName) {
                       var items = [];
                       angular.forEach(markers, function (marker) {
                           if (marker.markergroup === groupName) {
                               items.push(marker);
                           }
                       });
                       return items;
                   };
</PRE><PRE>                   plasmidTrack.getPosition = function (pos, positionOption, radiusAdjust) {
                       radiusAdjust = Number(radiusAdjust || 0);
                       pos = Number(pos);
</PRE><PRE>                       var POSITION_OPTION_MID = 0, POSITION_OPTION_INNER = 1, POSITION_OPTION_OUTER = 2,
                           radius, angle, center = plasmidTrack.center,
                           seqLen = plasmid.sequencelength;
</PRE><PRE>                       if (seqLen &gt; 0) {
                           angle = (pos / seqLen) * 360;
</PRE><PRE>                           switch (positionOption) {
                           case POSITION_OPTION_INNER:
                               radius = plasmidTrack.radius + radiusAdjust;
                               break;
                           case POSITION_OPTION_OUTER:
                               radius = plasmidTrack.radius + plasmidTrack.width + radiusAdjust;
                               break;
                           default:
                               radius = plasmidTrack.radius + (plasmidTrack.width / 2) + radiusAdjust;
                               break;
                           }
                           return SVGUtil.util.polarToCartesian(center.x, center.y, radius, angle);
                       }
                   };
                   Object.defineProperty(plasmidTrack, &quot;center&quot;, {
                       get: function () {
                           return plasmid.center;
                       }
                   });
                   Object.defineProperty(plasmidTrack, &quot;radius&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.radius, 100);
                       }
                   });
                   Object.defineProperty(plasmidTrack, &quot;width&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.width, 25);
                       }
                   });
                   Object.defineProperty(plasmidTrack, &quot;trackclass&quot;, {
                       get: function () {
                           return $scope.trackclass;
                       }
                   });
                   Object.defineProperty(plasmidTrack, &quot;trackstyle&quot;, {
                       get: function () {
                           return $scope.trackstyle;
                       }
                   });
</PRE><PRE>                   plasmidTrack.markers = markers;
                   plasmidTrack.scales = scales;
                   plasmidTrack.labels = labels;
</PRE><PRE>               }]
           };
       }])
</PRE><PRE>       .directive(&quot;trackscale&quot;, ['SVGUtil', '$compile', function (SVGUtil, $compile) {
           return {
               restrict: 'AE',
               type : 'svg',
               template: '&lt;g&gt;&lt;path&gt;&lt;/path&gt;&lt;g&gt;&lt;/g&gt;&lt;/g&gt;',
               replace : true,
               transclude: true,
               require: ['trackscale', '^plasmidtrack'],
               scope: {
                   interval: &quot;@&quot;,
                   vadjust: &quot;@&quot;,
                   ticksize: &quot;@&quot;,
                   direction: &quot;@&quot;,
                   showlabels : &quot;@&quot;,
                   labelvadjust : &quot;@&quot;,
                   labelclass : &quot;@&quot;,
                   labelstyle : &quot;@&quot;,
                   tickclass : &quot;@&quot;,
                   tickstyle : &quot;@&quot;,
                   scaleclick : &quot;&amp;&quot;
               },
               link : {
                   pre : function (scope, elem, attr, controllers, transcludeFn) {
                       var scaleController = controllers[0], trackController = controllers[1], pathElem = angular.element(elem.children()[0]), groupElem = angular.element(elem.children()[1]);
                       scaleController.init(pathElem, groupElem, trackController);
                   },
                   post : function (scope, elem, attr, controllers, transcludeFn) {
</PRE><PRE>                       var g, path, scaleController;
</PRE><PRE>                       //Manually transclude children elements
                       transcludeFn(scope.$parent, function (content) {
                           elem.append(content);
                       });
</PRE><PRE>                       //Apply directive's properties (class, style, id, name) to the path instead of the g
                       g = angular.element(elem);
                       path  = angular.element(elem.children()[0]);
                       SVGUtil.util.swapProperties(g, path);
                       $compile(path)(scope.$parent);
</PRE><PRE>                       //Attach event handlers
                       path.on(&quot;click&quot;, function (e) {
                           scope.scaleclick({
                               $event: e,
                               $scale: scaleController
                           });
                       });
                       
                       // Watch for changes to scale
                       scaleController = controllers[0];
                       scope.$watchGroup(['interval', 'vadjust', 'ticksize', 'labelvadjust', 'direction', 'showlabels', 'labelstyle', 'labelclass','tickstyle','tickclass'], function () {scaleController.draw(); });
</PRE><PRE>                   }
               },
               controller : ['$scope', function ($scope) {
                   var track, trackScale, element, groupElement,
                       DEFAULT_LABELVADJUST = 15, DEFAULT_TICKSIZE = 3;
</PRE><PRE>                   trackScale = this;
                   trackScale.elementtype = &quot;trackscale&quot;;
                   
                   trackScale.init = function (elem, groupElem, trackCtrl) {
                       track = trackCtrl;
                       track.addScale(trackScale);
                       trackScale.track = track;
                       element = elem;
                       groupElement = groupElem;
                   };
</PRE><PRE>                   trackScale.draw = function () {
                       var tickclass = trackScale.tickclass,
                           tickstyle = trackScale.tickstyle,
                           center = track.center,
                           path = SVGUtil.svg.path.scale(center.x, center.y, trackScale.radius, trackScale.interval, trackScale.total, trackScale.ticksize);
</PRE><PRE>                       element.attr(&quot;d&quot;, path);
                       if (tickclass) {element.attr(&quot;class&quot;,tickclass);}
                       if (tickstyle) {element.attr(&quot;style&quot;, tickstyle);}
</PRE><PRE>                       if (trackScale.showlabels) {
                           trackScale.drawLabel();
                       } else {
                           groupElement.empty();
                       }
                   };
</PRE><PRE>                   trackScale.drawLabel = function () {
                       var i, t, labels, center = track.center;
</PRE><PRE>                       function clickHandler(e) {
                           $scope.scaleclick({
                               $event: e,
                               $scale: trackScale
                           });
                       }
                       
                       labels = SVGUtil.svg.element.scalelabels(center.x, center.y, trackScale.labelradius, trackScale.interval, trackScale.total);
                       groupElement.empty();
                       for (i = 0; i &lt;= labels.length - 1; i += 1) {
                           t = angular.element(SVGUtil.svg.createNode('text'));
                           if (trackScale.labelclass) { t.attr('class', trackScale.labelclass); }
                           if (trackScale.labelstyle) { t.attr('style', trackScale.labelstyle); }
                           t.attr(&quot;x&quot;, labels[i].x);
                           t.attr(&quot;y&quot;, labels[i].y);
                           t.attr(&quot;text-anchor&quot;, &quot;middle&quot;);
                           t.attr(&quot;alignment-baseline&quot;, &quot;middle&quot;);
                           t.text(labels[i].text);
                           t.on(&quot;click&quot;, clickHandler);
                           groupElement.append(t);
                       }
                   };
                   Object.defineProperty(trackScale, &quot;radius&quot;, {
                       get: function () {
                           return (trackScale.inwardflg ? track.radius : track.radius + track.width) +  ((trackScale.inwardflg ? -1 : 1) * trackScale.vadjust) + (trackScale.inwardflg ? -(trackScale.ticksize) : 0);
                       }
                   });
                   Object.defineProperty(trackScale, &quot;interval&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.interval);
                       }
                   });
                   Object.defineProperty(trackScale, &quot;vadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.vadjust);
                       }
                   });
                   Object.defineProperty(trackScale, &quot;ticksize&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.ticksize, DEFAULT_TICKSIZE);
                       }
                   });
                   Object.defineProperty(trackScale, &quot;inwardflg&quot;, {
                       get: function () {
                           return $scope.direction === 'in' ? true : false;
                       }
                   });
                   Object.defineProperty(trackScale, &quot;total&quot;, {
                       get: function () {
                           return track.plasmid.sequencelength;
                       }
                   });
                   Object.defineProperty(trackScale, &quot;showlabels&quot;, {
                       get: function () {
                           return $scope.showlabels === &quot;1&quot; ? true : false;
                       }
                   });
                   Object.defineProperty(trackScale, &quot;labelvadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.labelvadjust, DEFAULT_LABELVADJUST);
                       }
                   });
                   Object.defineProperty(trackScale, &quot;tickclass&quot;, {
                       get: function () {
                           return $scope.tickclass;
                       }
                   });
                   Object.defineProperty(trackScale, &quot;tickstyle&quot;, {
                       get: function () {
                           return $scope.tickstyle;
                       }
                   });
                   Object.defineProperty(trackScale, &quot;labelclass&quot;, {
                       get: function () {
                           return $scope.labelclass;
                       }
                   });
                   Object.defineProperty(trackScale, &quot;labelstyle&quot;, {
                       get: function () {
                           return $scope.labelstyle;
                       }
                   });
                   Object.defineProperty(trackScale, &quot;labelradius&quot;, {
                       get: function () {
                           return trackScale.radius + (trackScale.labelvadjust * (trackScale.inwardflg ? -1 : 1));
                       }
                   });
               }]
           };
       }])
   
       .directive(&quot;tracklabel&quot;, ['SVGUtil', function (SVGUtil) {
           return {
               restrict: 'AE',
               type : 'svg',
               template: '&lt;text&gt;&lt;/text&gt;',
               replace : true,
               transclude: true,
               require: ['tracklabel', '^plasmidtrack'],
               scope: {
                   text: &quot;@&quot;,
                   hadjust : &quot;@&quot;,
                   vadjust : &quot;@&quot;,
                   labelclass: &quot;@&quot;,
                   labelstyle : '@',
                   labelclick : &quot;&amp;&quot;
               },
               link : {
                   pre : function (scope, elem, attr, controllers, transcludeFn) {
                       var labelController = controllers[0], trackController = controllers[1], textElem = angular.element(elem[0]);
                       labelController.init(textElem, trackController);
                   },
                   post : function (scope, elem, attr, controllers, transcludeFn) {
</PRE><PRE>                       var labelController;
</PRE><PRE>                       //Manually transclude children elements
                       transcludeFn(scope.$parent, function (content) {
                           elem.append(content);
                       });
</PRE><PRE>                       // Set some default properties for the label display
                       elem.attr(&quot;text-anchor&quot;, &quot;middle&quot;);
                       elem.attr(&quot;alignment-baseline&quot;, &quot;middle&quot;);
</PRE><PRE>                       //Attach event handlers
                       elem.on(&quot;click&quot;, function (e) {
                           scope.labelclick({
                               $event: e,
                               $label: labelController
                           });
                       });
</PRE><PRE>                       // Watch for changes to label
                       labelController = controllers[0];
                       scope.$watchGroup(['text', 'vadjust', 'hadjust','labelstyle','labelclass'], function () {labelController.draw(); });
                   }
               },
               controller : ['$scope', function ($scope) {
                   var track, trackLabel, element;
                   
                   trackLabel = this;
                   trackLabel.elementtype = &quot;tracklabel&quot;;
</PRE><PRE>                   trackLabel.init = function (elem, trackCtrl) {
                       track = trackCtrl;
                       track.addLabel(trackLabel);
                       trackLabel.track = track;
                       element = elem;
                   };
</PRE><PRE>                   trackLabel.draw = function () {
                       var center = track.center, startX, startY,
                           labelclass = trackLabel.labelclass,
                           labelstyle = trackLabel.labelstyle;
</PRE><PRE>                       element.attr(&quot;x&quot;, center.x + trackLabel.hadjust);
                       element.attr(&quot;y&quot;, center.y + trackLabel.vadjust);
                       element.text(trackLabel.text);
                       if (labelclass) {element.attr(&quot;class&quot;,labelclass);}
                       if (labelstyle) {element.attr(&quot;style&quot;, labelstyle);}
                   };
</PRE><PRE>                   Object.defineProperty(trackLabel, &quot;center&quot;, {
                       get: function () {
                           return track.center;
                       }
                   });
                   Object.defineProperty(trackLabel, &quot;text&quot;, {
                       get: function () {
                           return $scope.text;
                       }
                   });
                   Object.defineProperty(trackLabel, &quot;labelclass&quot;, {
                       get: function () {
                           return $scope.labelclass;
                       }
                   });
                   Object.defineProperty(trackLabel, &quot;labelstyle&quot;, {
                       get: function () {
                           return $scope.labelstyle;
                       }
                   });                    
                   Object.defineProperty(trackLabel, &quot;hadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.hadjust, 0);
                       }
                   });
                   Object.defineProperty(trackLabel, &quot;vadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.vadjust, 0);
                       }
                   });
                   Object.defineProperty(trackLabel, &quot;dimensions&quot;, {
                       get: function () {
                           return element[0].getBBox();
                       }
                   });
               }]
           };
       }])
</PRE><PRE>       .directive(&quot;trackmarker&quot;, ['SVGUtil', '$compile', function (SVGUtil, $compile) {
           return {
               restrict: 'AE',
               type : 'svg',
               template: '&lt;g&gt;&lt;path&gt;&lt;/path&gt;&lt;/g&gt;',
               replace : true,
               transclude: true,
               require: ['trackmarker', '^plasmidtrack'],
               scope: {
                   start: &quot;@&quot;,
                   end: &quot;@&quot;,
                   vadjust: &quot;@&quot;,
                   wadjust: &quot;@&quot;,
                   markergroup: &quot;@&quot;,
                   arrowstartlength : &quot;@&quot;,
                   arrowstartwidth : &quot;@&quot;,
                   arrowstartangle : &quot;@&quot;,
                   arrowendlength : &quot;@&quot;,
                   arrowendwidth : &quot;@&quot;,
                   arrowendangle : &quot;@&quot;,
                   markerclass : &quot;@&quot;,
                   markerstyle : &quot;@&quot;,
                   markerclick: &quot;&amp;&quot;
               },
               link : {
                   pre : function (scope, elem, attr, controllers, transcludeFn) {
                       var markerController = controllers[0], trackController = controllers[1], pathElem = angular.element(elem.children()[0]);
                       markerController.init(pathElem, trackController);
                   },
                   post : function (scope, elem, attr, controllers, transcludeFn) {
</PRE><PRE>                       var markerController = controllers[0], g, path;
</PRE><PRE>                       //Manually transclude children elements
                       transcludeFn(scope.$parent, function (content) {
                           elem.append(content);
                       });
</PRE><PRE>                       //Apply directive's properties (class, style, id, name) to the path instead of the g
                       g = angular.element(elem);
                       path  = angular.element(elem.children()[0]);
                       SVGUtil.util.swapProperties(g, path);
                       $compile(path)(scope.$parent);
</PRE><PRE>                       //Attach event handlers
                       path.on(&quot;click&quot;, function (e) {
                           scope.markerclick({
                               $event: e,
                               $marker: markerController
                           });
                       });
</PRE><PRE>                       // Watch for changes to marker
                       scope.$watchGroup(['start', 'end', 'vadjust', 'wadjust', 'markergroup', 'markerclass','markerstyle','arrowstartlength', 'arrowstartwidth', 'arrowstartangle', 'arrowendlength', 'arrowendwidth', 'arrowendangle'], function () {markerController.draw(); });
</PRE><PRE>                   }
               },
               controller : ['$scope', function ($scope) {
                   var track, marker, element, markerLabels = [];
</PRE><PRE>                   marker = this;
                   marker.elementtype = &quot;trackmarker&quot;;
</PRE><PRE>                   marker.init = function (elem, trackCtrl) {
                       track = trackCtrl;
                       track.addMarker(marker);
                       element = elem;
                       marker.track = track;
                   };
</PRE><PRE>                   marker.draw = function () {
                       var markerclass = marker.markerclass,
                           markerstyle = marker.markerstyle;
                       
                       element.attr(&quot;d&quot;, marker.getPath());
                       if (markerclass) {element.attr(&quot;class&quot;,markerclass);}
                       if (markerstyle) {element.attr(&quot;style&quot;, markerstyle);}
                       angular.forEach(markerLabels, function (markerLabel) {
                           markerLabel.draw();
                       });
                   };
</PRE><PRE>                 marker.addMarkerLabel = function (markerLabel) {
                       markerLabels.push(markerLabel);
                   };
</PRE><PRE>                   marker.getPath = function () {
                       var center = track.center, angle = marker.angle, radius = marker.radius;
                       return SVGUtil.svg.path.arc(center.x, center.y, radius.inner, angle.start, angle.end, marker.width, marker.arrowstart, marker.arrowend);
                   };
</PRE><PRE>                   marker.getPosition = function (hAdjust, vAdjust, hAlign, vAlign) {
                       var HALIGN_MIDDLE = &quot;middle&quot;, HALIGN_START = &quot;start&quot;, HALIGN_END = &quot;end&quot;,
                           VALIGN_MIDDLE = &quot;middle&quot;, VALIGN_INNER = &quot;inner&quot;, VALIGN_OUTER = &quot;outer&quot;,
                           center, radius, angle, markerRadius, markerAngle;
</PRE><PRE>                       center = track.center;
                       markerRadius = marker.radius;
                       markerAngle = marker.angle;
                       hAdjust = SVGUtil.util.Numeric(hAdjust);
                       vAdjust = SVGUtil.util.Numeric(vAdjust);
</PRE><PRE>                       if (vAlign !== undefined &amp;&amp; hAlign !== undefined) {
                           switch (vAlign) {
                           case VALIGN_INNER:
                               radius =  markerRadius.inner + vAdjust;
                               break;
                           case VALIGN_OUTER:
                               radius =  markerRadius.outer + vAdjust;
                               break;
                           default:
                               radius =  markerRadius.middle + vAdjust;
                               break;
                           }
</PRE><PRE>                           switch (hAlign) {
                           case HALIGN_START:
                               angle = markerAngle.start + hAdjust;
                               break;
                           case HALIGN_END:
                               angle = markerAngle.end + hAdjust;
                               break;
                           default:
                               angle = markerAngle.middle + hAdjust;
                               break;
                           }
</PRE><PRE>                           return SVGUtil.util.polarToCartesian(center.x, center.y, radius, angle);
                       } else {
</PRE><PRE>                           radius = {
                               outer : markerRadius.outer + vAdjust,
                               inner : markerRadius.inner + vAdjust,
                               middle : markerRadius.middle + vAdjust
                           };
</PRE><PRE>                           angle = {
                               begin : markerAngle.start + hAdjust,
                               end : markerAngle.end + hAdjust,
                               middle : markerAngle.middle + hAdjust
                           };
</PRE><PRE>                           return {
                               outer : {
                                   begin: SVGUtil.util.polarToCartesian(center.x, center.y, radius.outer, angle.begin),
                                   middle: SVGUtil.util.polarToCartesian(center.x, center.y, radius.outer, angle.middle),
                                   end: SVGUtil.util.polarToCartesian(center.x, center.y, radius.outer, angle.end)
                               },
                               middle : {
                                   begin: SVGUtil.util.polarToCartesian(center.x, center.y, radius.middle, angle.begin),
                                   middle: SVGUtil.util.polarToCartesian(center.x, center.y, radius.middle, angle.middle),
                                   end: SVGUtil.util.polarToCartesian(center.x, center.y, radius.middle, angle.end)
                               },
                               inner : {
                                   begin: SVGUtil.util.polarToCartesian(center.x, center.y, radius.inner, angle.begin),
                                   middle: SVGUtil.util.polarToCartesian(center.x, center.y, radius.inner, angle.middle),
                                   end: SVGUtil.util.polarToCartesian(center.x, center.y, radius.inner, angle.end)
                               }
                           };
                       }
</PRE><PRE>                   };
                   marker.fireClick = function (event) {
                       $scope.markerclick({
                           $event: event.$event,
                           $marker: event.$marker
                       });
                   };
                   Object.defineProperty(marker, &quot;center&quot;, {
                       get: function () {
                           return track.center;
                       }
                   });
                   Object.defineProperty(marker, &quot;radius&quot;, {
                       get: function () {
                           return {
                               inner : track.radius + marker.vadjust,
                               outer : track.radius + marker.vadjust + marker.width,
                               middle : track.radius + marker.vadjust + marker.width / 2
                           };
                       }
                   });
                   Object.defineProperty(marker, &quot;angle&quot;, {
                       get: function () {
                           var startAngle, endAngle, midAngle, end;
</PRE><PRE>                           startAngle = (marker.start / track.plasmid.sequencelength) * 360;
</PRE><PRE>                           end = $scope.end || $scope.start;
                           endAngle = (SVGUtil.util.Numeric(end) / track.plasmid.sequencelength) * 360;
                           endAngle += (endAngle &lt; startAngle) ? 360 : 0;
</PRE><PRE>                           midAngle = startAngle + ((endAngle - startAngle) / 2);
</PRE><PRE>                           return {
                               start : startAngle,
                               middle : midAngle,
                               end : endAngle
                           };
                       }
                   });
                   Object.defineProperty(marker, &quot;vadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.vadjust);
                       }
                   });
                   Object.defineProperty(marker, &quot;wadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.wadjust);
                       }
                   });
                   Object.defineProperty(marker, &quot;width&quot;, {
                       get: function () {
                           return track.width + marker.wadjust;
                       }
                   });
                   Object.defineProperty(marker, &quot;start&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.start);
                       }
                   });
                   Object.defineProperty(marker, &quot;end&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.end);
                       }
                   });
                   Object.defineProperty(marker, &quot;arrowstart&quot;, {
                       get: function () {
                           return {
                               width : SVGUtil.util.Numeric($scope.arrowstartwidth),
                               length : SVGUtil.util.Numeric($scope.arrowstartlength),
                               angle : SVGUtil.util.Numeric($scope.arrowstartangle)
                           };
                       }
                   });
                   Object.defineProperty(marker, &quot;arrowend&quot;, {
                       get: function () {
                           return {
                               width : SVGUtil.util.Numeric($scope.arrowendwidth),
                               length : SVGUtil.util.Numeric($scope.arrowendlength),
                               angle : SVGUtil.util.Numeric($scope.arrowendangle)
                           };
                       }
                   });
                   Object.defineProperty(marker, &quot;markergroup&quot;, {
                       get: function () {
                           return $scope.markergroup;
                       }
                   });
                   Object.defineProperty(marker, &quot;markerclass&quot;, {
                       get: function () {
                           return $scope.markerclass;
                       }
                   });
                   Object.defineProperty(marker, &quot;markerstyle&quot;, {
                       get: function () {
                           return $scope.markerstyle;
                       }
                   });                                        
                   Object.defineProperty(marker, &quot;sequence&quot;, {
                       get: function () {
                           var plasmidSeq = marker.track.plasmid.sequence,
                               markerSeq = <I>;</I>
                           
                           if (marker.start &gt; marker.end) {
                               return plasmidSeq.substring(marker.start - 1, plasmidSeq.length - 1) + plasmidSeq.substring(0, marker.end - 1);
                           } else {
                               return plasmidSeq.substring(marker.start - 1, marker.end - 1);
                           }
                       }
                   });
</PRE><PRE>                   marker.labels = markerLabels;
</PRE><PRE>               }]
           };
       }])
</PRE><PRE>       .directive(&quot;markerlabel&quot;, ['SVGUtil', '$compile', function (SVGUtil, $compile) {
</PRE><PRE>           return {
               restrict: 'AE',
               type : 'svg',
               transclude: true,
               template: '&lt;g&gt;&lt;path&gt;&lt;/path&gt;&lt;path id=&quot;&quot; style=&quot;fill:none;stroke:none&quot;&gt;&lt;/path&gt;&lt;text&gt;&lt;/text&gt;&lt;/g&gt;',
               require: ['markerlabel', '^trackmarker'],
               replace : true,
               scope: {
                   text : &quot;@&quot;,
                   valign : &quot;@&quot;,
                   vadjust : &quot;@&quot;,
                   halign : &quot;@&quot;,
                   hadjust : &quot;@&quot;,
                   type : &quot;@&quot;,
                   showline : &quot;@&quot;,
                   linestyle : &quot;@&quot;,
                   lineclass : &quot;@&quot;,
                   labelstyle : &quot;@&quot;,
                   labelclass : &quot;@&quot;,
                   linevadjust : &quot;@&quot;,
                   labelclick : &quot;&amp;&quot;
               },
               link: {
                   pre : function (scope, elem, attr, controllers, transcludeFn) {
                       var markerlabelController = controllers[0],
                           trackMarkerController = controllers[1],
                           groupElem = angular.element(elem[0]),
                           lineElem = angular.element(elem.children()[0]),
                           pathElem = angular.element(elem.children()[1]),
                           textElem = angular.element(elem.children()[2]);
</PRE><PRE>                       markerlabelController.init(textElem, groupElem, pathElem, lineElem, trackMarkerController);
                   },
                   post : function (scope, elem, attr, controllers, transcludeFn) {
                       transcludeFn(scope.$parent, function (content) {
                           elem.append(content);
                       });
</PRE><PRE>                       var markerlabelController = controllers[0],
                           trackMarkerController = controllers[1],
                           g = angular.element(elem),
                           text = angular.element(elem.children()[2]);
</PRE><PRE>                       //Apply directive's properties (class, style, id, name) to the text
                       text.attr(&quot;text-anchor&quot;, &quot;middle&quot;);
                       text.attr(&quot;alignment-baseline&quot;, &quot;middle&quot;);
                       SVGUtil.util.swapProperties(g, text);
                       $compile(text)(scope.$parent);
                       
                       //Attach event handlers
                       if (attr.labelclick) {
                           text.on(&quot;click&quot;, function (e) {
                               scope.labelclick({
                                   $event: e,
                                   $label: markerlabelController
                               });
                           });
                       // or bubble up events to the marker
                       } else {
                           text.on(&quot;click&quot;, function (e) {
                               trackMarkerController.fireClick({
                                   $event: e,
                                   $marker: trackMarkerController
                               });
                           });
                       }
                       
                       // Watch for changes to label
                       scope.$watchGroup(['text', 'type', 'valign', 'vadjust', 'halign', 'hadjust', 'showline', 'linevadjust', 'linestyle', 'labelclass','labelstyle'], function () {markerlabelController.draw(); });
</PRE><PRE>                   }
               },
               controller : ['$scope', '$compile', function ($scope, $compile) {
                   var marker, markerLabel, textElement, pathElement, textPathElement, textPathSVG, lineElement, groupElement;
</PRE><PRE>                   markerLabel = this;
                   markerLabel.elementtype = &quot;markerlabel&quot;;
</PRE><PRE>                   markerLabel.init = function (textElem, groupElem, pathElem, lineElem, markerCtrl) {
                       var id = 'TPATH' + (Math.random() + 1).toString(36).substring(3, 7);
</PRE><PRE>                       marker = markerCtrl;
                       marker.addMarkerLabel(markerLabel);
                       markerLabel.marker = marker;
                       textElement = textElem;
                       pathElement = pathElem;
                       lineElement = lineElem;
                       groupElement = groupElem;
                       
                       pathElement.attr(&quot;id&quot;, id);
</PRE><PRE>                   };
</PRE><PRE>                   markerLabel.draw = function () {
                       var VALIGN_MIDDLE = &quot;middle&quot;, VALIGN_INNER = &quot;inner&quot;, VALIGN_OUTER = &quot;outer&quot;,
                           HALIGN_MIDDLE = &quot;middle&quot;, HALIGN_START = &quot;start&quot;, HALIGN_END = &quot;end&quot;,
                           fontSize = 0, fontAdjust = 0,
                           labelclass = markerLabel.labelclass, labelstyle = markerLabel.labelstyle,
                           pos, markerAngle, src, dst, dstPos, dstV;
</PRE><PRE>                       if (labelclass) {textElement.attr(&quot;class&quot;,labelclass);}
                       if (labelstyle) {textElement.attr(&quot;style&quot;, labelstyle);}
</PRE><PRE>                       if (markerLabel.type === 'path') {
                           textElement.attr(&quot;x&quot;,<I>);</I>
                           textElement.attr(&quot;y&quot;,<I>);</I>
                           
                           if (!textPathElement){
                               textPathSVG = document.createElementNS('<A rel="nofollow" class="external free" href="http://www.w3.org/2000/svg','textPath'">http://www.w3.org/2000/svg','textPath'</A>);
                               textPathSVG.setAttributeNS(&quot;<A rel="nofollow" class="external free" href="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</A>&quot;, &quot;href&quot;, &quot;#&quot; + pathElement.attr(&quot;id&quot;));  
                               textPathElement = angular.element(textPathSVG);
                               $compile(textPathElement)($scope);
                               textElement.empty();
                               textElement.append(textPathElement);
                           }
                           
                           textPathSVG.textContent = markerLabel.text;
                           fontSize = window.getComputedStyle(textElement[0]).fontSize.replace(&quot;px&quot;, &quot;&quot;);
                           fontAdjust = (markerLabel.valign === VALIGN_OUTER) ? 0 : (markerLabel.valign === VALIGN_INNER) ? Number(fontSize || 0) : Number(fontSize || 0) / 2;
                           pathElement.attr(&quot;d&quot;, markerLabel.getPath(markerLabel.hadjust, markerLabel.vadjust - fontAdjust, markerLabel.halign, markerLabel.valign));
</PRE><PRE>                           switch (markerLabel.halign) {
                           case HALIGN_START:
                               textElement.attr(&quot;text-anchor&quot;, &quot;start&quot;);
                               textPathElement[0].setAttribute(&quot;startOffset&quot;, &quot;0%&quot;); //jQuery can't handle case sensitive names so can't use textPathElem.attr
                               break;
                           case HALIGN_END:
                               textElement.attr(&quot;text-anchor&quot;, &quot;end&quot;);
                               textPathElement[0].setAttribute(&quot;startOffset&quot;, &quot;100%&quot;);//jQuery can't handle case sensitive names so can't use textPathElem.attr
                               break;
                           default:
                               textElement.attr(&quot;text-anchor&quot;, &quot;middle&quot;);
                               textPathElement[0].setAttribute(&quot;startOffset&quot;, &quot;50%&quot;);//jQuery can't handle case sensitive names so can't use textPathElem.attr
                               break;
                           }
                       } else {
                           if (textPathElement){
                               textPathElement.remove();
                               textPathElement = null;
                           }
                           pos = marker.getPosition(markerLabel.hadjust, markerLabel.vadjust, markerLabel.halign, markerLabel.valign);
                           textElement.attr(&quot;x&quot;, pos.x);
                           textElement.attr(&quot;y&quot;, pos.y);
                           textElement.text(markerLabel.text);
                       }
</PRE><PRE>                       if (markerLabel.showlineflg) {
</PRE><PRE>                           src = marker.getPosition(markerLabel.hadjust, markerLabel.vadjust + markerLabel.linevadjust, markerLabel.halign, markerLabel.valign);
</PRE><PRE>                           dstPos = marker.getPosition();
                           dstV = markerLabel.valign === VALIGN_INNER ? dstPos.inner : markerLabel.valign === VALIGN_MIDDLE ? dstPos.middle : dstPos.outer;
                           dst = markerLabel.halign === HALIGN_START ? dstV.begin : markerLabel.halign === HALIGN_END ? dstV.end : dstV.middle;
</PRE><PRE>                           lineElement.attr(&quot;d&quot;, [&quot;M&quot;, src.x, src.y, &quot;L&quot;, dst.x, dst.y].join(&quot; &quot;));
                           if (!markerLabel.linestyle &amp;&amp; !markerLabel.lineclass) { lineElement.attr(&quot;style&quot;, &quot;stroke:#000&quot;); }
                           if (markerLabel.linestyle) { lineElement.attr(&quot;style&quot;, markerLabel.linestyle); }
                           if (markerLabel.lineclass) { lineElement.attr(&quot;class&quot;, markerLabel.lineclass); }
                       } else {
                           lineElement.removeAttr(&quot;d&quot;);
                       }
                   };
</PRE><PRE>                   markerLabel.getPath = function (hAdjust, vAdjust, hAlign, vAlign) {
                       var VALIGN_MIDDLE = &quot;middle&quot;, VALIGN_INNER = &quot;inner&quot;, VALIGN_OUTER = &quot;outer&quot;,
                           HALIGN_MIDDLE = &quot;middle&quot;, HALIGN_START = &quot;start&quot;, HALIGN_END = &quot;end&quot;,
                           center = marker.center,
                           radius, markerRadius, markerAngle, startAngle, endAngle;
</PRE><PRE>                       markerRadius = marker.radius;
                       switch (vAlign) {
                       case VALIGN_INNER:
                           radius = markerRadius.inner;
                           break;
                       case VALIGN_OUTER:
                           radius = markerRadius.outer;
                           break;
                       default:
                           radius = markerRadius.middle;
                           break;
                       }
</PRE><PRE>                       markerAngle = marker.angle;
                       switch (hAlign) {
                       case HALIGN_START:
                           startAngle = markerAngle.start;
                           endAngle = markerAngle.start + 359.99;
                           break;
                       case HALIGN_END:
                           startAngle = markerAngle.end + 1;
                           endAngle = markerAngle.end;
                           break;
                       default:
                           startAngle = markerAngle.middle + 180.05;
                           endAngle = markerAngle.middle + 179.95;
                           break;
                       }
</PRE><PRE>                       return SVGUtil.svg.path.arc(center.x, center.y, radius + Number(vAdjust || 0), startAngle + Number(hAdjust || 0), endAngle + Number(hAdjust || 0), 1);
                   };
                   Object.defineProperty(markerLabel, &quot;showlineflg&quot;, {
                       get: function () {
                           return ($scope.showline === &quot;1&quot; ? true : false);
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;halign&quot;, {
                       get: function () {
                           return $scope.halign || &quot;middle&quot;;
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;valign&quot;, {
                       get: function () {
                           return $scope.valign || &quot;middle&quot;;
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;hadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.hadjust);
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;vadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.vadjust);
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;type&quot;, {
                       get: function () {
                           return $scope.type;
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;linevadjust&quot;, {
                       get: function () {
                           return SVGUtil.util.Numeric($scope.linevadjust);
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;labelclass&quot;, {
                       get: function () {
                           return $scope.labelclass;
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;labelstyle&quot;, {
                       get: function () {
                           return $scope.labelstyle;
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;linestyle&quot;, {
                       get: function () {
                           return $scope.linestyle;
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;lineclass&quot;, {
                       get: function () {
                           return $scope.lineclass;
                       }
                   });
                   Object.defineProperty(markerLabel, &quot;text&quot;, {
                       get: function () {
                           return $scope.text;
                       }
                   });
               }]
           };
       }])
   
       .directive(&quot;svgelement&quot;, ['SVGUtil', function (SVGUtil) {
           return {
               restrict: 'AE',
               template: function(elem, attr){
                   return '&lt;' + attr.type + '&gt;&lt;/' + attr.type + '&gt;';
               },
               type : 'svg',
               replace : true,
               transclude: true,
               require: ['^plasmid'],
               scope: {},
               link: function (scope, elem, attr, controllers, transcludeFn) {
</PRE><PRE>                   //Manually transclude children elements
                   transcludeFn(scope.$parent, function (content) {
                       elem.append(content);
                   });
               }
           };
       }])
   
</PRE><P>}());
</P></DIV></DIV></DIV></DIV></DIV></BODY></HTML>