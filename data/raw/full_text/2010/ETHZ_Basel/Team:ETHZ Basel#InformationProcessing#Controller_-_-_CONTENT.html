<HTML xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki  ltr ns-0 ns-subject page-Team_ETHZ_Basel_InformationProcessing_Controller"><DIV id="globalWrapper"><DIV id="top-section"><DIV id="p-logo"><A href="/Main_Page" title="Main Page">&quot;
	    </A></DIV><DIV id="menubar" class="left-menu noprint"><UL><LI class="selected"><A href="/Team:ETHZ_Basel/InformationProcessing/Controller">Page               </A></LI><LI class="new"><A href="/wiki/index.php?title=Talk:Team:ETHZ_Basel/InformationProcessing/Controller&amp;action=edit&amp;redlink=1">Discussion               </A></LI><LI><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/Controller&amp;action=edit">View source               </A></LI><LI><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/Controller&amp;action=history">History               </A></LI><LI style="color:#808080;cursor:default">teams</LI></UL></DIV><DIV class="right-menu noprint" id="menubar"><UL><LI id="pt-login"><A href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Team:ETHZ_Basel/InformationProcessing/Controller" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</A></LI></UL></DIV><DIV id="search-controls" class="noprint"><FORM action="/Special:Search" id="searchform"> </FORM></DIV></DIV><DIV id="content"><H1 class="firstHeading">Team:ETHZ Basel/InformationProcessing/Controller</H1><DIV id="bodyContent"><H3 id="siteSub" class="noprint">From 2010.igem.org</H3><DIV id="navigation"><UL id="simple-menu"><LI><A href="https://2010.igem.org/Team:ETHZ_Basel" class="introduction"><SPAN>Introduction</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Biology" class="biology"><SPAN>Biology &amp; Wet Laboratory</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Modeling" class="modeling"><SPAN>Mathematical Modeling</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing" class="information_current"><SPAN>Information Processing</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Achievements" class="achievements"><SPAN>Achievements</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Team" class="team"><SPAN>Team</SPAN></A></LI></UL></DIV><DIV id="subnavigation" class="information"><UL id="sub-menu"><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing"><SPAN>Overview</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Microscope"><SPAN>Microscopy</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/InformationFlow"><SPAN>Information Flow</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/CellDetection"><SPAN>Cell Detection</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Visualization"><SPAN>Visualization</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Controller"><SPAN>Controller</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Game"><SPAN>E. lemming 2D Game</SPAN></A></LI></UL></DIV><H1><SPAN class="mw-headline" id="Controller"> Controller </SPAN></H1><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption">Block representation of the controller.</DIV></DIV></DIV><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption"><B>Simulation of the movement of the E. lemming under the supervision of the controller</B>. <I>Yellow dot</I>: the currently selected E. lemming. <I>Yellow cone</I>: the current swimming direction of E. lemming. <I>Red arrow</I>: the reference direction set by the controller. <I>Bright red background</I>: far-red light (inducing tumbling). <I>Dark red environment</I>: red light (inducing directed movement). <I>Gray environment</I>: both red and far-red light absent.  Note the small rectangle in the upper right corner of the image, along whose edges the E. lemming is forced to swim. As observed by the end of the simulation, the controller algorithm efficiently guides the E. lemming on the desired route.</DIV></DIV></DIV><H2><SPAN class="mw-headline" id="Introduction"> Introduction </SPAN></H2><P>In order to safely guide E. lemming towards any desired target, a controller algorithm had to be developed. The inputs were defined to be as the current direction followed by the E. lemming, the reference direction, set by the user and the time point of the simulation. The outputs were Boolean values for red and far-red light pulses, to be applied at every time point of the simulation. The controller function was executed with the same frequency as images are made in the microscope.
</P><P>The following properties of our network, consisting of both <I>in silico</I> and <I>in vivo</I> sub-parts, are making our task intractable for most theoretical controller design strategies:
</P><UL><LI> The chemotaxis network is highly nonlinear;
</LI><LI> Tumbling occurs stochastically;
</LI><LI> The angular change during tumbling is not predictable, neither the direction nor its absolute value;
</LI><LI> During directed movement periods, the angle is also changing stochastically (although not as much as during tumbling);
</LI><LI> Microscope, cell detection and tracking, and the approximation of the current angle of the E. lemming sum up to a time delay of approximately one second.
</LI><LI> The approximated angle is highly noisy.
</LI></UL><P>As far as we are aware of, no theoretical controller design algorithm exists that can tackle all these challenges. To nevertheless develop several implementations which afterward can be compared in terms of performance, we decided to start a controller design competition between the team members.
</P><P>In the following we first present the rules for the competition, which also include a measure for the performance of a controller, and afterward the different approaches developed by our team members together with their evaluation.
</P><H2><SPAN class="mw-headline" id="Controller_Design_Competition"> Controller Design Competition </SPAN></H2><P>The goal of the competition was to develop an implementation of a controller which performs best in forcing the E. lemming in swimming to a desired direction. Our instructor Jörg Stelling agreed, more or less voluntarily, to donate a bottle of highly expensive wine as a prize for the winner of the competition.
</P><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption">Sketch of the idea of the competition.</DIV></DIV></DIV>For the competition every participant had to force his or her E. lemming model to swim clockwise around a 1083×825μm large rectangle (approximately the size of 10 microscope images stringed together in each direction). Therefore, the reference direction send to the controller was set parallel to the axis of the coordinate system, and towards the next corner of the rectangle. Always when the Euclidean distance between the virtual E. lemming and the active corner was falling below 90μm (approximately the size of one microscope image), the next corner was activated.
<P>The current direction of the E. lemming obtained from the model was delayed for 0.9s and white noise was added, in order to simulate the conditions mentioned above. The controller algorithm was called every 0.3s and could either activate or deactivate the red and the far-red light. All other details for the construction of the controllers were left open.
</P><P>For the evaluation of the controllers we defined the cost function Γ as following:
</P><P>with T the evaluation time, φ<SUB>is</SUB> the direction of the E. lemming, φ<SUB>sh</SUB> the reference direction. The value of the cost function is always ∈[0,2] and can be interpreted as following: 
</P><UL><LI> If Γ=0, the E. lemming would always swim exactly in the reference direction.
</LI><LI> If Γ=2, the E. lemming would always swim exactly opposite to the reference direction.
</LI><LI> A controller which would set the red light and far-red light outputs independent of the current direction of the E. lemming will reach Γ≈1 for T&gt;&gt;1.
</LI></UL><P>The controllers of all participants of the competition were run until the cost function Γ reached approximately a steady state. The participant with the lowest long-time value of his/her cost function obtained the prize from Jörg. The results are summarized in the following section.
</P><H2><SPAN class="mw-headline" id="Implemented_Controllers"> Implemented Controllers </SPAN></H2><P>In the following we will list all controllers we implemented ordered increasing by the long-time value of the cost function they achieved. All controllers are nevertheless available in the Lemming Toolbox.
</P><H3><SPAN class="mw-headline" id="Threshold_Optimized_Controller_.28Winner_of_the_Control_Design_Competition.29"> Threshold Optimized Controller (Winner of the Control Design Competition) </SPAN></H3><P><B>Cost function value of Γ=0.7703. Implemented by Simona Constantinescu.</B></P><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption">Sketch of the idea of the competition, <B>after the competition</B></DIV></DIV></DIV><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption"><B>Sample path under the Threshold Optimized Controller</B>. The black lines represent the reference rectangle around which the E. lemming was forced to travel. The blue thick curve represents the actual path of the E. lemming.</DIV></DIV></DIV><P>In approaching the controller competition challenge and obtaining the bottle of highly expensive wine promised by Jörg, my strategy was the following:
</P><UL><LI> develop a simple and efficient control algorithm, based on the intuitive idea of keeping the current direction if the difference between it and the reference direction is within well - chosen error bounds (<I>i.e.</I> apply red light) and change the current direction otherwise (<I>i.e</I> apply far-red light).
</LI><LI> use the previously described simple algorithm as a reference and compare the implementation of the other, more complicated ideas, with this benchmark.
</LI></UL><P>The particular features of our system under study made it very difficult to theoretically address all the challenges of nonlinearity, delay and, most important, stochasticity. A basic probability principle says that the efficiency of any deterministic strategy in handling a random process increases with the sample size. Asymptotically, nice theories can be used to defend against randomness and even reduce it to single point estimates. On the contrary, when analyzing very small sample sizes, stochasticity plays a crucial role and, most often, complex deterministic strategies have little or no effect in controlling the random process. In our case, the sample size was always 1, as we had to decide, at every time point, what Boolean values red light and far red light should take. 
</P><P>As a first test, The Threshold Optimized Controller is checking whether the actual direction of the E. lemming is between 0 and 2π. Since Gaussian white noise is added to the received angle at every time point of the simulation, in some of the cases, the value of the angle might become negative or might exceed 2π. If this happens, the controller sets the negative values back to 0 and the large ones back to 2π, as a noise - suppressing measure. 
</P><P>Next, two error bounds are defined, one for the case in which both angles are on the same side of the zero axis of the unit trigonometric circle (threshold1 = 1.5 rad) and another one for the case in which the angles are on different sides (threshold2 = 4.7 rad). This corresponds to an approximately π acceptance region or to approximately 50% of the 2π possible angles values on the unit circle. If the difference between the reference and the current direction, modulo 2π, is within these error bounds, the current direction is kept. Otherwise, a new direction is sampled.
</P><P>The other algorithms I implemented were:
</P><UL><LI> Storing the angle values and taking more complex decisions given the current and the previous directions. This strategy came at the cost of being inefficient before the sample size was large enough. Furthermore, the reference direction of the E. lemming was also changing, so the sample size had to be reset at 0, maybe too soon after reaching a large - enough size. Before testing the algorithm, it was debatable whether the benefit of reaching a large - enough size and acting in accordance to the defined strategy could exceed the cost of losing the objectivity of treating each sample independently. 
</LI></UL><UL><LI> Fighting the microscope/image processing delay, by keeping the angle fixed and changing it only once every 0.9 seconds. This strategy came at the cost of keeping the same angle (maybe wrong) for 0.9 seconds, which is equivalent to 3 pulses. Before testing, it was also unclear whether the benefit of obtaining the real angle, without delay, would exceed the cost of not changing the angle every time the chance was given.
</LI></UL><P>As the system was subject to strong stochasticity, the benefits of none of the above strategies exceeded their costs, as compared to the Threshold Optimized Controller. Therefore, among all my tries, the minimal objective function value was obtained for the Threshold Optimized Controller.
</P><H3><SPAN class="mw-headline" id="Hysteresis_based_Sliding_Mode_Controller"> Hysteresis based Sliding Mode Controller </SPAN></H3><P><B>Cost function value of Γ=0.7727. Implemented by Moritz Lang.</B></P><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption">Typical path of the simulated E. lemming around the rectangle when using the hysteresis based sliding mode controller. Black solid: Path the E. lemming took when surrounding the rectangle once. Blue dotted: The reference rectangle. Please remark that the controller is supposed to rapidly reach the corners of the rectangle and not to stay in the proximity of the edges.</DIV></DIV></DIV>It is easy to calculate that the distance between the E. lemming and its destination decreases iff <CODE>|φ<SUB>is</SUB>-φ<SUB>sh</SUB>|mod 2π&lt;π/2</CODE>. However, this decrease can be small for larger differences in this set and especially near the destination a direction of the E. lemming only narrowly fulfilling this condition will soon get invalid due to the movement of the E. lemming nearly tangential to the reference direction. Furthermore, due to the slight changes in direction during swimming and the measurement error when determining the direction of the E. lemming, it can happen that, when the angle between the reference direction and the actual direction is near to π, the direction of the E. lemming &quot;enters&quot; and &quot;leaves&quot; this set very rapidly. A simple algorithm like &quot;red light when the difference of the directions is smaller than π, otherwise far-red light&quot; could then lead to rapid switching between the diodes, an effect not desirable in an experimental setup.
<P>I thus decided to define two sets, <CODE>S<SUB>on</SUB>={φ<SUB>is</SUB>∈[0,2π):|φ<SUB>is</SUB>-φ<SUB>sh</SUB>|mod 2π&lt;π/2}</CODE> and <CODE>S<SUB>off</SUB>={φ<SUB>is</SUB>∈[0,2π):|φ<SUB>is</SUB>-φ<SUB>sh</SUB>|mod 2π&lt;π/3}</CODE>. Furthermore the controller has two states, <CODE>ζ<SUB>on</SUB></CODE> and <CODE>ζ<SUB>off</SUB></CODE>, and the state of the controller is maintained between evaluations of the controller algorithm. 
</P><P>When the controller is in state <CODE>ζ<SUB>off</SUB></CODE>, it tests whether <CODE>φ<SUB>is</SUB></CODE> is in <CODE>S<SUB>off</SUB></CODE> or not. If the condition is fulfilled, a 2.4s (≈4 evaluations) red light pulse is send and the state is set to <CODE>S<SUB>on</SUB></CODE>.
</P><P>When the controller is in state <CODE>ζ<SUB>on</SUB></CODE>, it tests whether <CODE>φ<SUB>is</SUB></CODE> is in <CODE>S<SUB>on</SUB></CODE> or not. If the condition is not fulfilled, a 2.1s (≈3 evaluations) far-red light pulse is send and the state is set to <CODE>S<SUB>off</SUB></CODE>.
</P><P>Our evaluations showed that this controller forces the E. lemming successful around the rectangle (see Figure on the right), while minimizing both light pulses.
</P><H3><SPAN class="mw-headline" id="Noise_Refusing_Subspace_of_Trust_Controller"> Noise Refusing Subspace of Trust Controller </SPAN></H3><P><B>Cost function value of Γ=0.8089. Implemented by Christoph Hold.</B></P><P>The controller is a graduated response to the derivation of angles <CODE>φ<SUB>der</SUB>=|φ<SUB>set</SUB> - φ<SUB>is</SUB>|</CODE> that takes advantage of an additional input signal. As there is two input binary signals this gives 4 possible input combinations:
</P><TABLE border="1" style="text-align:center"><TBODY><TR><TD colspan="2"> Input
</TD><TD> Output
</TD></TR><TR><TD><B>red light</B></TD><TD><B>far red light</B></TD><TD><B>bias</B></TD></TR><TR><TD> 0
</TD><TD> 0
</TD><TD> as before
</TD></TR><TR><TD> 1
</TD><TD> 0
</TD><TD> high
</TD></TR><TR><TD> 0
</TD><TD> 1
</TD><TD> low
</TD></TR><TR><TD> 1
</TD><TD> 1
</TD><TD> medium
</TD></TR></TBODY></TABLE><P>
Additionally it is coupled with a noise suppression.
</P><P>1. If the derivation of angle <CODE>φ<SUB>der</SUB>&lt;α<SUB>narrow</SUB></CODE> is small then by red light emission the bias is shifted as high as possible in order to keep the bacterium on the right track.
</P><P>2. If the derivation of angle <CODE>φ<SUB>der</SUB>&lt;α<SUB>wide</SUB></CODE> is acceptable, a compromise between going further that direction and tumbling is achieved by the usage of both red and far red light.
</P><P>3. If the derivation of angle <CODE>φ<SUB>der</SUB>&gt;α<SUB>wide</SUB></CODE> tumbling is initiated by far red light.
</P><P>The angles of rules 1 and 2 are so chosen that the mean change in angle through tumbling will result in the optimal direction. A further element of the controller tries to distinguish between angle derivation due to the noisy angle signal and real tumbles and applies the last decision of rules 1 and 2 in order to prevent a wrong way induced by error.
</P><H3><SPAN class="mw-headline" id="Four_Zones_of_Preference_Controller"> Four Zones of Preference Controller </SPAN></H3><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption"><B>Schematics of the four zones controller.</B> Area 1 and 4 send a red or far-red light pulse of 1 time unit, whereas Area 2 is dark and Area 3 has a range from 3 to 1 time units.</DIV></DIV></DIV><P><B>Cost function value of Γ=0.8196. Implemented by George Rosenberger.</B></P><P>A core problem of the very simple &quot;red light when the difference of the directions is smaller than π, otherwise far-red light&quot; algorithm is, that the edge between red and far-red light is very sharp. Therefore, the controller often changes between these two states and because of the time delay of the microscope and image processing, prediction of best light pulse tends to be inaccurate at this threshold.
</P><P>The core concept of this controller is to extend the very basic algorithm in a way, that the edge between red and far-red light is avoided, e.g. it should be leaped. This is achieved by creating a dark area of 2 * 15° between red and far-red thresholds, in which no light pulse is being sent at all. Next to the far-red light zone, the repeating times are increased in an order to possibly leap the dark area and go to a different angle, better (or worse) than the dark area.
</P><H3><SPAN class="mw-headline" id="Majority_Vote_Proportional_-_Second_Derivative_Threshold_Controller"> Majority Vote Proportional - Second Derivative Threshold Controller</SPAN></H3><P><B>Cost function value of Γ=0.8379. Implemented by Thanuja Ambegoda.</B></P><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption"><B>Majority Vote and Derivative based Controller.</B> On the left, the challenges posed by the controlled model are posed. On the right, the tools implemented by the algorithm to overcome these obstacles are shown. The arrows indicate which tool handles which obstacle</DIV></DIV></DIV><P>What the controller needs to do boils down to the following:
When the cell is going in the wrong direction, make it tumble until each heads towards the right direction. When it is heading towards the right direction, try to keep it in the swimming mode. 
But, the task is slightly complicated by the presence of the following 'obstacles':
</P><UL><LI>Randomness of the motion – the direction changes slightly (randomly) when swimming and it changes rapidly with larger angles when tumbling.
</LI><LI>Noise in measurement: the error we measure is not the exact error
</LI><LI>Time delay of measurement – the measurement of error is not the current error. It's around 1 second before now.
</LI></UL><P>In the absence of the above three, the controller would have been trivial. This particular controller tries to minimize the effects of these by deploying an algorithm that incorporates the following features:
</P><UL><LI>Majority voting based on historical error - This is a way of fighting noise. When deciding if error correction needs to be deployed (force tumbling), the controller not only looks at the current error. But also, it tries to deduce if there is a real error by looking at the reported error of a few previous samples. Majority voting is also used with differential error prediction (described later) at different levels of control inside the algorithm.
</LI><LI>Rapid Checks - A slight variation to the above majority voting, used to detect larger errors, quickly. A slightly higher margin of error is allowed with a lower number of previous samples, when there is a need to detect a larger error quickly. A similar setting can be used with a lower threshold to detect quick returns to the correct direction
</LI><LI>Error prediction based on differential control - This is used to minimize the effects of the time delay of measurements. Differential error is considered in conjunction with the reported error evaluated using the majority voting scheme.
</LI></UL><DIV class="printfooter">
Retrieved from &quot;<A href="http://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Controller">http://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Controller</A>&quot;</DIV></DIV></DIV><DIV id="footer-box" class="noprint"><DIV id="footer"><UL id="f-list"><LI id="t-recentchanges"><A href="/Special:RecentChanges" title="Recent changes">Recent changes</A></LI><LI id="t-whatlinkshere"><A href="/Special:WhatLinksHere/Team:ETHZ_Basel/InformationProcessing/Controller" title="List of all wiki pages that link here [j]" accesskey="j">What links here</A></LI><LI id="t-recentchangeslinked"><A href="/Special:RecentChangesLinked/Team:ETHZ_Basel/InformationProcessing/Controller" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</A></LI><LI id="t-specialpages"><A href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</A></LI><LI><A href="/Special:Preferences">My preferences</A></LI></UL></DIV><DIV id="footer"><UL id="f-list"><LI id="t-print"><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/Controller&amp;printable=yes" title="Printable version of this page [p]" accesskey="p">Printable version</A></LI><LI id="t-permalink"><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/Controller&amp;oldid=208720" title="Permanent link to this revision of the page">Permanent link</A></LI><LI id="privacy"><A href="/2010.igem.org:Privacy_policy" title="2010.igem.org:Privacy policy">Privacy policy</A></LI><LI id="disclaimer"><A href="/2010.igem.org:General_disclaimer" title="2010.igem.org:General disclaimer">Disclaimers</A></LI></UL></DIV></DIV></DIV></BODY></HTML>