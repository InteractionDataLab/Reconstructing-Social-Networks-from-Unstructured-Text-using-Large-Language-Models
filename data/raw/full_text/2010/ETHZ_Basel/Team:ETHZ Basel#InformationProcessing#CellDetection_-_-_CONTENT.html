<HTML xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki  ltr ns-0 ns-subject page-Team_ETHZ_Basel_InformationProcessing_CellDetection"><DIV id="globalWrapper"><DIV id="top-section"><DIV id="p-logo"><A href="/Main_Page" title="Main Page">&quot;
	    </A></DIV><DIV id="menubar" class="left-menu noprint"><UL><LI class="selected"><A href="/Team:ETHZ_Basel/InformationProcessing/CellDetection">Page               </A></LI><LI class="new"><A href="/wiki/index.php?title=Talk:Team:ETHZ_Basel/InformationProcessing/CellDetection&amp;action=edit&amp;redlink=1">Discussion               </A></LI><LI><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/CellDetection&amp;action=edit">View source               </A></LI><LI><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/CellDetection&amp;action=history">History               </A></LI><LI style="color:#808080;cursor:default">teams</LI></UL></DIV><DIV class="right-menu noprint" id="menubar"><UL><LI id="pt-login"><A href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Team:ETHZ_Basel/InformationProcessing/CellDetection" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</A></LI></UL></DIV><DIV id="search-controls" class="noprint"><FORM action="/Special:Search" id="searchform">Â </FORM></DIV></DIV><DIV id="content"><H1 class="firstHeading">Team:ETHZ Basel/InformationProcessing/CellDetection</H1><DIV id="bodyContent"><H3 id="siteSub" class="noprint">From 2010.igem.org</H3><DIV id="navigation"><UL id="simple-menu"><LI><A href="https://2010.igem.org/Team:ETHZ_Basel" class="introduction"><SPAN>Introduction</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Biology" class="biology"><SPAN>Biology &amp; Wet Laboratory</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Modeling" class="modeling"><SPAN>Mathematical Modeling</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing" class="information_current"><SPAN>Information Processing</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Achievements" class="achievements"><SPAN>Achievements</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/Team" class="team"><SPAN>Team</SPAN></A></LI></UL></DIV><DIV id="subnavigation" class="information"><UL id="sub-menu"><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing"><SPAN>Overview</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Microscope"><SPAN>Microscopy</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/InformationFlow"><SPAN>Information Flow</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/CellDetection"><SPAN>Cell Detection</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Visualization"><SPAN>Visualization</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Controller"><SPAN>Controller</SPAN></A></LI><LI><A href="https://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/Game"><SPAN>E. lemming 2D Game</SPAN></A></LI></UL></DIV><H1><SPAN class="mw-headline" id="Cell_Detection_and_Tracking"> Cell Detection and Tracking </SPAN></H1><H2><SPAN class="mw-headline" id="Background"> Background </SPAN></H2><DIV class="thumb tright"><DIV class="thumbinner" style="width:402px;"><DIV class="thumbcaption"><B>Short movie of an ''E. coli'' cell switching between the tumbling and the directed movement modes.</B><I>Blue dots</I>: the detected <I>E. coli</I> cells. <I>Yellow dot</I>: the currently selected E. lemming. <I>Yellow cone</I>: the current swimming direction of E. lemming. <I>Red thin line</I>: reference direction. <I>Yellow dotted line</I>: the current path of the E. lemming. Note that the movement process is currently not under the influence of the controller.</DIV></DIV></DIV>
One important input of the controller is the current location and the swimming direction of the E. lemming that we decide to control. However, due to experimental limitations, also other <I>E. coli</I> cells will by chance be on the microscope image. We therefore decided to implement a cell detection algorithm which detects all cells in the current frame and combines it with a cell tracking algorithm that aligns the cells in the adjacent frames. Thus it is possible to keep track of the E. lemming without confusing it with other cells. Since the controller has to react in real-time on changes of the direction of the E. lemming, an important requirement for the development of both algorithms was a fast processing time. This requirement is fulfilled by our implementations, which together require around 0.2s of processing time on a Intel Core 2 Duo 3.16 GHz CPU with 1.95 GB RAM. Since the main steps depend on each other and thus can not be parallelized, we applied only one of the cores for Cell Detection and Tracking, and used the other core to listen to a Russian techno radio (<A href="http://clubberry.fm/en" class="external autonumber" rel="nofollow">[1]</A>) to stay awake.
<H2><SPAN class="mw-headline" id="Cell_Detection_Algorithm"> Cell Detection Algorithm </SPAN></H2><P>The cell detection algorithm requires most of the CPU speed, therefore it was optimized most for speed while maintaining a sufficiently high percentage of true positive and a sufficiently low percentage of false positive detected cells. However, for the controller it is worse loosing the selected cell than dealing with a reasonably high amount of false positively detected cells. In comparison to other cell detection algorithms, the emphasis of our algorithm was put on reducing the amount of true negatives.
</P><P>The algorithm is based on a two-step approach: 
</P><OL><LI><B>Object Detection</B> - Every compact area having a sharp increase of brightness compared to the background is detected and classified as a cell. 
</LI><LI><B>Filtering</B> - Cells having unusual properties for an <I>E. coli</I> cell (e.g. having too large or too small area) are filtered out, so that mainly real <I>E. coli</I> cells persist. 
</LI></OL><H3><SPAN class="mw-headline" id="Object_Detection"> Object Detection </SPAN></H3><P>The microscope image (see Figure 1) is pre-processed for cell detection by decreasing its size to half of the size obtained by the microscope (336x256 pixels, please be aware that we already used a microscope internal binning of two). This downsizing reduces the speed of the following steps, but showed to not reduce the detection quality too much. The resized image is then filtered by a 3x3 median filter (see Figure 2) to reduce pixel noise while preserving edges, and its contrast is increased (see Figure 3). The image is then differentiated by convolution with two 3x3 pixel big horizontal, respectively vertical edges and calculating the Euclidean norm of the resulting two values for every pixel (Sobel filtering, see Figure 4). A binary image is created by setting all pixels which have gray - scale level over a user definable threshold to TRUE and all others to FALSE.
</P><P>With this approach we can detect the borders of the cells. However, these borders may still have holes, which are eliminated by dilating the borders with a horizontal and a vertical line of length 3 pixels. We have now detected the contours of each potential cell. 
</P><H3><SPAN class="mw-headline" id="Filtering"> Filtering </SPAN></H3><P>After the interior of the cell is filled, we calculate its properties and compare them to the properties of typical cells (e.g. the typical area of a cell). If the measured properties of the potential cells deviate too much from the reference properties, the wrongly detected cells get removed (see Figure 5). For the remaining cells the centroid is calculated and passed to the cell tracking algorithm as the current position of the cell.
</P><TABLE border="0" align="center"><TBODY><TR valign="top"><TD><DIV class="thumb tright"><DIV class="thumbinner" style="width:202px;"><DIV class="thumbcaption">Figure 1: Original image obtained from the microscope.</DIV></DIV></DIV></TD><TD><DIV class="thumb tright"><DIV class="thumbinner" style="width:202px;"><DIV class="thumbcaption">Figure 2: Image after median filtering to reduce noise.</DIV></DIV></DIV></TD><TD><DIV class="thumb tright"><DIV class="thumbinner" style="width:202px;"><DIV class="thumbcaption">Figure 3: Image with maximized contrast.</DIV></DIV></DIV></TD></TR><TR valign="top"><TD><DIV class="thumb tright"><DIV class="thumbinner" style="width:202px;"><DIV class="thumbcaption">Figure 4: Image after two dimensional differentiating and setting all pixels below a threshold to false (black) and all above to true (white).</DIV></DIV></DIV></TD><TD><DIV class="thumb tright"><DIV class="thumbinner" style="width:202px;"><DIV class="thumbcaption">Figure 5: The final image including all the cells is obtained after dilation, filling of the holes inside the cell and sorting out false positives.</DIV></DIV></DIV></TD></TR></TBODY></TABLE><H2><SPAN class="mw-headline" id="Cell_Tracking_Algorithm"> Cell Tracking Algorithm </SPAN></H2><P>The main propose of the tracking algorithm is to align cells in adjacent frames to be able to track them. This is achieved by assigning a unique identifier (UID) to every cell, which it ideally keeps over the whole duration of the measurement.
</P><H3><SPAN class="mw-headline" id="False_Positives_.26_False_Negatives"> False Positives &amp; False Negatives </SPAN></H3><P>From the cell detection algorithm (see above), the cell tracking algorithm receives the positions of all detected cells. However, not all detected cells are real <I>E. coli</I> cells, but some mud in the flow channel as well as dirt in the microscope apparatus can be wrongly classified as cells (false positives). Furthermore, depending on the threshold used in the cell detection algorithm, cells can be &quot;lost&quot; for one or several adjacent frames (false negatives). The main goal of both algorithms together is to make it possible to track a selected cell over a long period of time. This goal requires that our cell tracking algorithm has to be able to recognize cells and assign them their previous UID, even if they were &quot;lost&quot; over several frames. Furthermore, it must be able to not confuse a cell with false positively detected dirt, if the cell is passing nearby. The case of distinguishing two nearby passing true positively detected <I>E. coli</I> cells is widely omitted in the algorithm due to the complexity of such calculations and the thus unavoidable slow down of the algorithm. Instead, the experiment is set up so that the cell density is quite small. If however, by chance, two true positively detected cells are passing close to each other and their UIDs are mixed up, the user has to simply correct manually for this mistake by e.g. pressing the right button of a joystick.
</P><H3><SPAN class="mw-headline" id="Tracking_cells_using_cell_tables"> Tracking cells using cell tables </SPAN></H3><P>Due to speed limitations we decided to implement a simple but robust fast algorithm for cell tracking. In the first frame, a UID is assigned to all detected cells and stored together with the position of their centroids in a the so called 'cell table'. In all adjacent frames the Euclidean distance between all detected cells and the already known cells from the previous frame is calculated using matrix arithmetic (fast in Matlab).
</P><P>Starting with the two cells in adjacent frames having the smallest distance, the UID of the cell in the previous frame is assigned to the newly detected cell and both cells (the one from the previous frame and the one in the current frame) are excluded in further assignments. This step is repeated several times until the minimal distance between two remaining cells in adjacent frames exceeds a user definable threshold, depending on the maximal speed of the given cell line in the medium, and the imaging frequency of the microscope. The cells in the last frame which were not found in the current frame are stored for some time in a so called 'lost cell table'. For cells in the current frame which don't have an UID assigned yet, an UID is searched for in the lost cell table. Only for cells which were neither found in the cell table nor in the lost cell table a new UID is generated. Both the position of the cells in the cell table as well as the cells in the lost cell table are given as an output to the control algorithm.
</P><H3><SPAN class="mw-headline" id="Robustness"> Robustness </SPAN></H3><P>Although this algorithm is relatively simple and fast, it has several qualitative advantages: 
</P><OL><LI> First, having a lost cell table makes the whole algorithm more robust against images where, by chance, a cell is not detected. However, the limited lifetime of cells in the lost cell table ensures that the UID of a cell which was lost a long time ago will not wrongly be assigned to a yet unknown cell. 
</LI></OL><OL><LI> Second, different from <I>E. coli</I> cells, false positively detected &quot;dirt&quot; in the apparatus is normally immobile. The algorithm ensures that cells and dirt are not mixed up since, due to the fixed position of the dirt, in the next frame the dirt will always be assigned to its previous frame UID. Although it may happen that a cell, when passing closely to the dirt, will be lost. However, the lost cell table here also ensures that, when the cell passed the dirt a few frames later, it will be reassigned to the correct UID. 
</LI></OL><OL><LI> Third, by comparing the cells in the current frame first only to cells which were also found in the last frame and only, if they were not found there, to lost cell table, makes the algorithm more robust against all kind of high frequency noise. Namely, some of the false positively detected pseudo-cells are only detected in one frame. Giving priority to normally nearly continuously detected true positives thus lowers the chance that a detected cell is assigned to the UID of noise, which occurred already a few frames before, instead of to the UID of the same cell detected in the last frame. Finally, transmitting the positions of all cells, insignificant if in the cell or lost cell tables, eases the programming of the controller: it will always obtain at least the approximate position of the E. lemming.
</LI></OL><DIV class="printfooter">
Retrieved from &quot;<A href="http://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/CellDetection">http://2010.igem.org/Team:ETHZ_Basel/InformationProcessing/CellDetection</A>&quot;</DIV></DIV></DIV><DIV id="footer-box" class="noprint"><DIV id="footer"><UL id="f-list"><LI id="t-recentchanges"><A href="/Special:RecentChanges" title="Recent changes">Recent changes</A></LI><LI id="t-whatlinkshere"><A href="/Special:WhatLinksHere/Team:ETHZ_Basel/InformationProcessing/CellDetection" title="List of all wiki pages that link here [j]" accesskey="j">What links here</A></LI><LI id="t-recentchangeslinked"><A href="/Special:RecentChangesLinked/Team:ETHZ_Basel/InformationProcessing/CellDetection" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</A></LI><LI id="t-specialpages"><A href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</A></LI><LI><A href="/Special:Preferences">My preferences</A></LI></UL></DIV><DIV id="footer"><UL id="f-list"><LI id="t-print"><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/CellDetection&amp;printable=yes" title="Printable version of this page [p]" accesskey="p">Printable version</A></LI><LI id="t-permalink"><A href="/wiki/index.php?title=Team:ETHZ_Basel/InformationProcessing/CellDetection&amp;oldid=201065" title="Permanent link to this revision of the page">Permanent link</A></LI><LI id="privacy"><A href="/2010.igem.org:Privacy_policy" title="2010.igem.org:Privacy policy">Privacy policy</A></LI><LI id="disclaimer"><A href="/2010.igem.org:General_disclaimer" title="2010.igem.org:General disclaimer">Disclaimers</A></LI></UL></DIV></DIV></DIV></BODY></HTML>