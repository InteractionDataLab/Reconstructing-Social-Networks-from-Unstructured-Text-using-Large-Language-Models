<HTML xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki  ltr ns-0 ns-subject page-Team_TU-Munich_Results_How_To"><DIV id="globalWrapper"><DIV id="top-section"><DIV id="p-logo"><A href="/Main_Page" title="Main Page">&quot;
	    </A></DIV><DIV id="menubar" class="left-menu noprint"><UL><LI class="selected"><A href="/Team:TU-Munich/Results/How_To">Page               </A></LI><LI class="new"><A href="/wiki/index.php?title=Talk:Team:TU-Munich/Results/How_To&amp;action=edit&amp;redlink=1">Discussion               </A></LI><LI><A href="/wiki/index.php?title=Team:TU-Munich/Results/How_To&amp;action=edit">View source               </A></LI><LI><A href="/wiki/index.php?title=Team:TU-Munich/Results/How_To&amp;action=history">History               </A></LI><LI style="color:white;cursor:default">teams</LI></UL></DIV><DIV class="right-menu noprint" id="menubar"><UL><LI id="pt-login"><A href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Team:TU-Munich/Results/How_To" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</A></LI></UL></DIV><DIV id="search-controls" class="noprint"><FORM action="/Special:Search" id="searchform"> </FORM></DIV></DIV><DIV id="content"><H1 class="firstHeading">Team:TU-Munich/Results/How To</H1><DIV id="bodyContent"><H3 id="siteSub" class="noprint">From 2013.igem.org</H3><DIV id="header-container"><DIV id="menu"><UL><LI><A id="home" href="https://2013.igem.org/Team:TU-Munich">Home</A></LI><LI><A id="project" href="https://2013.igem.org/Team:TU-Munich/Project/Overview">Project</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Project/Phytoremediation">Phytoremediation</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Project/Physcomitrella"><I>Physcomitrella</I></A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Project/Localisation">Localization</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Project/Biodegradation">BioDegradation</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Project/Bioaccumulation">BioAccumulation</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Project/Killswitch">Kill Switch</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Project/Safety">Safety</A></LI></UL><LI><A id="results" href="https://2013.igem.org/Team:TU-Munich/Results/Overview">Results</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/BioBricks">BioBricks</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/Recombinant">Effector Studies</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/Moss">Moss Methods</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/Localization">Localization</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/GM-Moss">PhyscoFilter</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/KillSwitch">Kill Switch</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/Implementation">Implementation</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/Software">AutoAnnotator</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/Economics">Entrepreneurship</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/Summary">Summary</A></LI><LI><A id="modeling" href="https://2013.igem.org/Team:TU-Munich/Modeling/Overview">Modeling</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Modeling/Protein_Predictions">Protein Predictions</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Modeling/Kill_Switch">Kill Switch</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Modeling/Enzyme">Enzyme Kinetics</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Modeling/Filter">Filter Model</A></LI><LI><A id="team" href="https://2013.igem.org/Team:TU-Munich/Team/Members">Team</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Team/Members">Members</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Team/Sponsors">Sponsors</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Team/Collaborations">Collaborations</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Team/Gallery">Pictures</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Team/Statistics">Timeline</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Team/Attributions">Attributions</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Team/Judging">Judging</A></LI><LI><A id="notebook" href="https://2013.igem.org/Team:TU-Munich/Notebook/Labjournal">Notebook</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Notebook/Labjournal">Labjournal</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Notebook/Methods">Methods</A></LI><LI><A id="human_practice" href="https://2013.igem.org/Team:TU-Munich/HumanPractice/Overview">Outreach</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/HumanPractice/Interviews">Expert Counsel</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/HumanPractice/GMO">GMO release</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/HumanPractice/Media">Publicity</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/HumanPractice/Education">Educational Kit</A></LI><LI><A href="https://2013.igem.org/Team:TU-Munich/Results/How_To">Tutorials</A></LI></DIV></DIV><DIV id="wikicontent-container"><DIV id="wikicontent"><H2><SPAN class="mw-headline" id="Our_Tutorials">Our Tutorials</SPAN></H2><P>During our iGEM summer we have acquired many skills which are useful for iGEMers and for every synthetic biologist. In order to spread this knowledge we created some tutorials. We hope that these tutorials enable future iGEM teams to present their project in a more colorful fashion.
</P><H2><SPAN class="mw-headline" id="Wiki_Tips_.26_Tricks"> Wiki Tips &amp; Tricks </SPAN></H2><P>Below is a list of iGEM wiki related tips and tutorials for future teams.
</P><H3><SPAN class="mw-headline" id="Picture_viewer"> Picture viewer </SPAN></H3><P>Maybe you have not noticed it yet, but if you clicked any of the pictures on our wiki, you were not redirected to the ugly wiki page of the file. Instead a nice picture viewer opened and after you closed it, you did not have to go back to the site you saw the picture on. To get the same effect on your wiki follow the steps listed below:
</P><UL><LI><B>Get the files!</B>We modified the original slimbox 2 viewer to work with the wiki and to not exceed the browser viewport, so it is recommended to use our versions, which can be found at <A href="/Team:TU-Munich/TUM13_slimbox2.css" title="Team:TU-Munich/TUM13 slimbox2.css">Team:TU-Munich/TUM13_slimbox2.css</A> and <A href="/Team:TU-Munich/TUM13_slimbox2.js" title="Team:TU-Munich/TUM13 slimbox2.js">Team:TU-Munich/TUM13_slimbox2.js</A>.
</LI><LI><B>Embed the files in your wiki!</B>The two files mentioned above and <A href="http://jquery.com/" class="external text" rel="nofollow">jQuery</A> have to be embedded on all the pages that should use the picture viewer.
</LI><LI><B>Include the autoload code block!</B>A bit of JavaScript code that attaches the viewer to the right pictures needs to be executed on all the pages that use it. This code attaches the picture viewer to all images on the page which are embedded with the <CODE>[[File:xxx.png|thumb|caption]]</CODE> wiki code and it adds the corresponding caption to the viewer.
</LI></UL><PRE>$(document).ready(function(){
	$(&quot;div.thumbinner &gt; a img&quot;).slimbox({/* Put custom options here */}, function(el) {
		url = el.src;
		if (url.indexOf('thumb') != -1) {
			url = url.substring(0, url.lastIndexOf('/'));
			url = url.replace('/thumb/', '/');
		}
		description = $(el).parents(&quot;div.thumbinner&quot;).children(&quot;div.thumbcaption&quot;).text();
		return [url, description];
	}, function(el) {
		return (this == el);
	});
});
</PRE><UL><LI><B>Test it!</B>Below is an example picture, click on it to see what the picture viewer looks like.
</LI></UL><DIV class="center"><DIV class="thumb tnone"><DIV class="thumbinner" style="width:352px;"><DIV class="thumbcaption"><B>Figure 1:</B> The logo of our project.</DIV></DIV></DIV></DIV><H3><SPAN class="mw-headline" id="Slideshow"> Slideshow </SPAN></H3><P>To create a good looking slideshow just follow the instructions below:
</P><UL><LI><B>Get the files!</B>You can get the Stylesheet and Javascript for the slideshow either from <A href="http://bxslider.com/" class="external text" rel="nofollow">bxSlider</A> or from our wiki: <A href="/Team:TU-Munich/TUM13_bxslider.css" title="Team:TU-Munich/TUM13 bxslider.css">Team:TU-Munich/TUM13_bxslider.css</A> and <A href="/Team:TU-Munich/TUM13_bxslider.js" title="Team:TU-Munich/TUM13 bxslider.js">Team:TU-Munich/TUM13_bxslider.js</A>.
</LI></UL><UL><LI><B>Embed the files in your wiki!</B>The two files mentioned above and <A href="http://jquery.com/" class="external text" rel="nofollow">jQuery</A> have to be embedded on all the pages that should use the slideshow.
</LI></UL><UL><LI><B>Include the initializing code block!</B>A bit of JavaScript code that activates the slideshow needs to be executed on all the pages that use it. This code changes all unordered lists of the class bxslider into slideshows.
</LI></UL><PRE>$(document).ready(function(){
	$('.bxslider').bxSlider({
		responsive: false,
		auto: true,
		autoHover: true
	});
});
</PRE><UL><LI><B>Add the slideshow to the page!</B>To add a slideshow just put the pictures you want to include in an unordered list like shown below:
</LI></UL><PRE>&lt;html&gt;&lt;ul class=&quot;bxslider&quot;&gt;&lt;li&gt;&lt;img src=&quot;https://static.igem.org/mediawiki/2013/9/97/TUM13_slider_team1.jpg&quot; /&gt;&lt;/li&gt;&lt;li&gt;&lt;img src=&quot;https://static.igem.org/mediawiki/2013/3/30/TUM13_slider_team2.jpg&quot; /&gt;&lt;/li&gt;&lt;li&gt;&lt;img src=&quot;https://static.igem.org/mediawiki/2013/3/30/TUM13_slider_moos.jpg&quot; /&gt;&lt;/li&gt;&lt;li&gt;&lt;img src=&quot;https://static.igem.org/mediawiki/2013/6/66/TUM13_slider_kampen.jpg&quot; /&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/html&gt;</PRE><UL><LI><B>Test it!</B>Below is an example of the slideshow.
</LI></UL><H2><SPAN class="mw-headline" id="Generation_of_Rotating_Protein_Structures">Generation of Rotating Protein Structures</SPAN></H2><P>Animated gifs of rotating protein structures have been used for some time in the iGEM competition. Here we present an easy to reproduce tutorial for iGEMers which are interested in similar images.
</P><UL><LI>If there is no PDB file available for your protein of interest, you can use a homology search to find the most homologous structure. A good homology search tool is <A href="http://toolkit.tuebingen.mpg.de/hhpred" class="external text" rel="nofollow">HHpred</A>.
</LI><LI>The entry for the best matching structure was used for the figure. If it is only a homologous structure please cite this together with the homology when presenting the resulting image.
</LI><LI>You can save the PDB file of the homologous structure on your computer.
</LI><LI>If you do not have <A href="http://www.pymol.org/" class="external text" rel="nofollow">PyMol</A> (freeware) installed on your computer download and install it.
</LI><LI>Start PyMol software and open the PDB file by clicking File -&gt; Open.
</LI><LI>The following approach was adapted from a PyMol tutorial [<A href="http://ihome.cuhk.edu.hk/~b102142/pymol/pymol_tutorial.html" class="external text" rel="nofollow">Wong</A>].
</LI><LI>The following commands were entered into the command line:
</LI></UL><P><CODE>
PyMOL&gt; orient
PyMOL&gt; hide everything, all
PyMOL&gt; show cartoon, all
PyMol&gt; bg_color white
click&gt; Settings&gt;Rendering&gt;Shadows&gt;Occlusion
PyMOL&gt; color purple, ss h; color yellow, ss s; color green, ss &quot;&quot;
PyMOL&gt; show surface, all
PyMOL&gt; set transparency, 0.75
PyMOL&gt; set surface_quality, 1    (command will prolongue the process significantly, you may skip it) 
PyMOL&gt; set ray_trace_frames=1    (command will prolongue the process significantly, you may skip it) 
PyMOL&gt; mset 1 x180
PyMOL&gt; util.mroll 1,180
PyMOL&gt; mpng frame</CODE></P><UL><LI>Afterwards the *.png files were automatically converted to *.tif files using <A href="http://www.xnview.com/de/xnconvert/" class="external text" rel="nofollow">XnConvert</A>.
</LI><LI>The program <A href="http://www.animake.de/gif-animation.htm" class="external text" rel="nofollow">Animake</A> was used to generate the annimated gifs.
</LI><LI>The Animake software was started
</LI><LI>A new working folder was generated (File -&gt; New) and the *.tif files were imported (Edit -&gt; Import_from_file)
</LI><LI>The background was set to white (Animation -&gt; Settings)
</LI><LI>The range of colors was set to 256 (Edit -&gt; Select_all and Edit -&gt; Change_Color)
</LI><LI>The size of the file has to be reduced in order to be able to upload it on the iGEM wiki. This can be done by clicking Edit -&gt; Change_size. We suggest a size of 320x240 px or even smaller if the resulting gif becomes to big.
</LI><LI>Finally the animated gif can be saved in the program format (.abp) and as gif (File -&gt; Save_as)
</LI><LI>If you have problems to upload the file on the iGEM server you may try a reduced size (e.g. 300x225 px)
</LI></UL><CENTER>This is how your protein of interest could look like:</CENTER><DIV class="center"><DIV class="thumb tnone"><DIV class="thumbinner" style="width:182px;"><A href="/File:TUM13_Annimated_test.gif" title="File:TUM13 Annimated test.gif">File:TUM13 Annimated test.gif</A><DIV class="thumbcaption"><B>Figure 2:</B> Protein</DIV></DIV></DIV></DIV><H2><SPAN class="mw-headline" id="Setting_up_a_basic_Arduino_measuring_device">Setting up a basic Arduino measuring device</SPAN></H2><H3><SPAN class="mw-headline" id="Introduction">Introduction</SPAN></H3><DIV class="thumb tleft"><DIV class="thumbinner" style="width:182px;"><A href="/File:TUM13_Arduino_Assembly_Animation.gif" title="File:TUM13 Arduino Assembly Animation.gif">File:TUM13 Arduino Assembly Animation.gif</A><DIV class="thumbcaption"><B>Figure 3:</B> Assembly Order</DIV></DIV></DIV><P>Since the Arduino Due was released in autumn 2012, this is the first iGEM year this <B>very powerful</B> device can be used. We found it a useful <B>supervising tool</B> for short and long-term experiments. It can be used in as well as outside the lab. The improvements that were made from Uno to Due are considerable.
</P><P>It is capable of handling many things at once, such as a WiFi shield, a display, a SD-Card and multiple sensors.
At this point the Uno did not match up any longer. 
</P><P>To establish the usage of Arduino in iGEM even more we want to share our experiences and help you building up a <B>basic device</B> that can <B>collect</B> and <B>view sensor data</B> on its <B>display</B> and <B>upload</B> them to a server.
</P><H3><SPAN class="mw-headline" id="Part_Description">Part Description</SPAN></H3><H4><SPAN class="mw-headline" id="Arduino_Due">Arduino Due</SPAN></H4><P>The Arduino Due is the most powerful Arduino board. Its underlying 32bit-processor is the Atmel SAM3X8E. 
Contrary to the other boards which run at 5V, a power supply of 3.3V is sufficient.
It was released in October 2012.
</P><P><B>Data:</B></P><PRE> 84 Mhz	CPU Clock
 96 	KBytes of SRAM.
512 	KBytes of Flash memory. 
 54 	Digital I/O Pins
 12 	Analog Input Pins
  2 	(DAC)Analog Outputs Pins
</PRE><H4><SPAN class="mw-headline" id="Arduino_WiFi_Shield">Arduino WiFi Shield</SPAN></H4><P>The Arduino WiFi Shield is an attachable shield that provides Wireless LAN 802.11b/g to the Arduino. 
It scans and connects to networks and opens TCP and UDP sockets for data transfer. It also supports WEP and WPA2 encryption. It was released in August 2012.
The WiFi Shield is fully supported by the Arduino Due and Arduino supplies a suitable stock WiFi library. 
There is also an on-board SD-card socket to store received data. 
As the SD-card is accessible separately, it can also be used as a storage for any data generated by the Arduino.
The SD-card socket is also supported by a stock library. The communication between Arduino Due and the WiFi Shield runs via an SPI/ICSP interface.
</P><P><B>Pin usage:</B></P><PRE>Pin  4	SS for SD card (Slave Select)
Pin  7	Handshake between Arduino and WiFi Shield
Pin 10	SS for WiFi
Pin 74	SPI MISO (Master in, Slave out)
Pin 75	SPI MOSI (Master out, Slave in)
Pin 76	SPI SCK  (Serial clock)
    gnd
    3.3V
    5V
</PRE><H4><SPAN class="mw-headline" id="Watterott_Mega_MSD-Shield">Watterott Mega MSD-Shield</SPAN></H4><P>The Mega MSD-Shield was designed by Watterott and consists of a couple of components. 
The components are one real time clock, one SD-card socket (we will not use), a small battery and a socket for a touch display.
To get it ready to run, the shield must be assembled. The stackable headers and the clock's quartz must be soldered to the board and the battery must be inserted.
Unluckily the Mega MSD-Shield and therefore also the MI0283QT-9 touch display don't come with a working library for the Arduino Due. The existing library only supports all boards up to the Arduino Uno.
Therefore all libraries had to be rewritten.
The touch display and the SD-card slot communicate with the Arduino Due via SPI/ICSP. The real time clock transmits its data via I²C.
</P><P><B>Pin usage:</B></P><PRE>Pin  4	SS for SD card
Pin  6	SS for the touch of the touch display
Pin  8	reset LCD
Pin  9	LCD LED
Pin 20	RTC (real time clock) 	I²C	SDA (Serial Data Line)
Pin 21	RTC  			I²C	SCL (Serial Clock)
Pin 25 SS (7) for the LCD (Workarround of the double usage of pin 7 by the WIFI Shield)
Pin 50	SPI MISO
Pin 51	SPI MOSI
Pin 52	SPI SCK
    gnd
    3.3V
</PRE><H4><SPAN class="mw-headline" id="Display_MI0283QT-9">Display MI0283QT-9</SPAN></H4><P>The MI0283QT-9 is a multicolor touch display. It comes already attached to a board, where only the pin headers are left to be soldered.
Once assembled it can easily be plugged into the Mega MSD-Shield. It has an on-board touch controller (TI ADS7846).
The display size is 2.83&quot;(43.2 x 57.6mm) with a resolution of 240x320. It supports 262k colors. 
The pin usage is already considered in the Mega MSD-Shield description.
</P><H4><SPAN class="mw-headline" id="Light_Sensor_TSL2561">Light Sensor TSL2561</SPAN></H4><P>The light sensor is a small, so called, breakout board. It is usually connected by wires instead of directly plugged into the Arduino's headers.
The light sensor has two photo diodes on-board that measure visible and infrared light. Similar to the RTC, the TSL2561 is addressed via I²C.
Once you get the I²C library working on your Arduino Due working it takes only little effort to integrate additional I²C devices.
Just very few lines of the library have to be rewritten here.
The photo diodes can be addressed separately or both at one. Their output is already converted to Lux.
</P><P><B>Pin usage:</B></P><PRE>Pin 20	TSL2561		 	I²C	SDA (Serial Data Line)
Pin 21	TSL2561			I²C	SCL (Serial Clock)
    gnd
    3.3V
</PRE><H4><SPAN class="mw-headline" id="Temperature_Sensor_DS18B20">Temperature Sensor DS18B20</SPAN></H4><P>The temperature sensor is embedded into a water proof cable. It is addressed via a OneWire interface. 
The provided data are digital raw data, which need to be converted into degree Celsius. Information about the conversion are given by the manufacturer.
Similar to the I²C (TwoWire) bus, you only have to get the OneWire interface working once. After that, you can easily set up more OneWire devices.
Again, just very few lines of the library have to be rewritten.
</P><P><B>Pin usage:</B></P><PRE>Pin 14 	One-Wire DS18B20 (pin was randomly chosen)
Pin gnd
Pin 3.3V
</PRE><H4><SPAN class="mw-headline" id="Water_Sensor">Water Sensor</SPAN></H4><P>Setting up the water sensor is very easy. If and how much water the sensor registered can be measured via an analog pin.
</P><P><B>pin usage:</B></P><PRE>Pin A5	Water sensor
    gnd
    3.3V
</PRE><H3><SPAN class="mw-headline" id="Tools">Tools</SPAN></H3><UL><LI>Breadboard
</LI><LI>Soldering bolt
</LI><LI>Solder
</LI></UL><H3><SPAN class="mw-headline" id="Assembly">Assembly</SPAN></H3><P>Keep everything clear during your assembly. If you have different colored linking cables, always try to use the same color code (e.g. red cable for 3.3V etc.) otherwise troubleshooting can get nasty.
</P><P>All <B>steps</B> you need to follow building up your own Arduino measuring device are <B>explained below</B> in the <B>slide show</B> and the image descriptions.
</P><DIV class="thumb tleft"><DIV class="thumbinner" style="width:182px;"><A href="/File:TUM13_Arduino_in_action.gif" title="File:TUM13 Arduino in action.gif">File:TUM13 Arduino in action.gif</A><DIV class="thumbcaption"><B>Figure 33:</B> Arduino in action</DIV></DIV></DIV><P>For more explaining photos visit our <A href="#Arduino_photo_gallery">photo gallery</A>. On the left you see the Arduino as it boots up, connects to a WiFi hotspot and collects data.
</P><H3><SPAN class="mw-headline" id="Code">Code</SPAN></H3><P>We strongly recommend the usage of <B>Microsoft Visual Studio</B> with the <B>&quot;visual micro&quot;</B> plugin. Microsoft Intellisense helps you a lot, when you are unfamiliar with the manufacturer provided libraries (automatic code completion). In order to compile the code properly you need the latest beta version of <A href="http://arduino.cc/en/Main/Software" class="external text" rel="nofollow">Arduino's software</A>. In the visual micro settings, choose the path to the Arduino IDE on your hard drive, also disable &quot;Upload using programmer&quot;. In the settings of the Arduino IDE, select &quot;use external software&quot;.
</P><P>Now you are ready to start programming. Below we share our code, feel free to use, edit and play around with it!
But <B>wait</B> first you need our <B><A href="#Libraries">libraries</A></B>! They're exclusively <B>fitted</B> to the Arduino Due, mostly based on the existing manufacturer's libraries for the Arduino Uno.
</P><P>Since Arduino released a new version of its IDE and software, and extended its support on the Arduino Due, we have rewritten our previews code. Both, the old and the new code can be found in our <B><A href="https://github.com/VonAlphaBisZulu/IGEM_ARDUINO" class="external text" rel="nofollow">GitHub repo</A></B>.
</P><P>Assuming you followed our tutorial until here.
Once you adapted the code to your WiFi and server settings and uploaded it to the Arduino it does the following:
</P><OL><LI>it starts up and the <B>screen</B> stays black, but turns its lights on
</LI><LI>if you have pressed the screen, the calibration process starts
</LI><LI>it <B>searches for networks</B> and displays the total number of found networks on its screen
</LI><LI>it displays some <B>WiFi stations</B> that were found
</LI><LI>it tries to <B>connect</B> to the WiFi station you have set
</LI><LI>if a connection was established it shows the <B>Arduino's IP address</B> and the SSID (name) of the WiFi it is connected to
</LI><LI>then it idles until you you press the screen
</LI><LI>after you pressed the screen it jumps to the <B>&quot;loop&quot;-section</B> of the code
</LI><LI>it continuously runs and displays:
</LI><LI>the current <B>time</B></LI><LI>the <B>temperature</B></LI><LI>the measured <B>infrared</B> and <B>broadband light</B></LI><LI>the <B>coordinates</B> of the point you <B>pressed</B> on the screen
</LI></OL><LI>it builds up a <B>connection to a server, calling a PHP script, passing on the collected data</B></LI><PRE>
#include &quot;SPI.h&quot; // SPI library (stock)
#include &quot;Wire.h&quot; // TwoWire library (stock) sda-scl
#include &quot;RTClib.h&quot; // Real time clock library (original library, slightly rewritten to fit the Due)
#include &quot;SPI.h&quot;
#include &quot;MI0283QT9Due.h&quot; // LCD library (quite much had to be rewritten). Pins were changed, usage of Software SPI... quite a mess but it works great
#include &quot;ADS7846Due.h&quot; // Touch controller (same story as at the lcd library)
#include &quot;Adafruit_TSL2561.h&quot; // light sensor library (had to be rewritten in some parts to fit the Due) functions were added to correct the lux-output that wasn't always correct with the stock library
#include &quot;OneWire.h&quot; // OneWire (I don't know, but I guess it's the stock library)
#include &quot;avr/dtostrf.h&quot; // optional library to workaround some compatibility problems with the Due
#include &quot;math.h&quot; // standard C-maths library
#include &quot;SD.h&quot; // SD reader (stock)
#include &quot;WiFi.h&quot; // (stock)
#include &quot;time.h&quot; // standard C-time library
#include &quot;math.h&quot;

#define ledW        (11)
#define ledR        (12)
#define ledG        (13)
#define Poti        (A0)
#define Button        (A1)
#define Temp        (14)
#define Wat        (A5)

#define shift8to32(a,b,c,d) (d &lt;&lt; 24) | (c &lt;&lt; 16) | (b &lt;&lt; 8) | a
#define shift8to16(a,b) (b &lt;&lt; 8) | a

MI0283QT9 lcd;
ADS7846 tp;
RTC_DS1307 rtc;
OneWire tempsen(Temp);
Adafruit_TSL2561 lightsen(TSL2561_ADDR_FLOAT,12345);
File bitmap;
WiFiClient client(0);

float valueWater=0, valueTemp=0, valueLight=0, valueLightIR=0; // sensor values (avaredged)
uint32_t valueTime=0,valueCounter[3]={0,0,0};
uint16_t counter=1,potValue=0; // vlauecounter 0:Water 1:Temp 2:Light/IR
uint8_t cursorY=1,cursorX=0;
bool buttonValue=0,logging=0,wifiConnection,mossstatus=0,firstreceive=1;

int waitForTap(){
        tp.service();
        while(tp.getPressure()==0) // Idle until the touchscreen is pressed to continue
        {
                delay(20);
                tp.service();
                if(digitalRead(Button)==0)
                        return 1;
        }
        return 0;
}

void continueText(String drawtext, int cursY=cursorY-1, int cursX=cursorX,int maxlen=38){
        maxlen=maxlen-cursX;

        lcd.drawText(15+cursX*8,cursY*15,drawtext,1,COLOR_WHITE,COLOR_BLACK);

        cursorX=drawtext.length()+1;
}

void drawText(String drawtext=&quot;&quot;, int cursY=cursorY,int maxlen=38){
        continueText(drawtext,cursY,0);
        cursorY=cursY+1;
}

void OpenBMPFile(char *file, int16_t x, int16_t y)
{
  uint8_t pad;
  uint8_t buf[54]; //read buf (min. size = sizeof(BMP_DIPHeader))
  int16_t width, height, w, h;

  if(!SD.exists(file))
  {
    Serial.println(String(file)+&quot;not found&quot;);
    return;
  }
  else
         bitmap = SD.open(file, FILE_READ);
  if(!bitmap.available())
  {
    Serial.println(&quot;not reading image file&quot;);
        return;
  }
  else
         Serial.println(&quot;reading image file&quot;);

  //BMP Header
  for(int i=0;i&lt;14;i++)
  {
         buf[i]=bitmap.read();
  }

  if((buf[0] == 'B') &amp;&amp; (buf[1] == 'M') &amp;&amp; (buf[10] == 54))
  {
         Serial.println(&quot;Bitmap recognized&quot;);
    //BMP DIP-Header
        for(int i=14;i&lt;54;i++)
                buf[i]=bitmap.read();
        if(
        Serial.println(shift8to32(buf[14],buf[15],buf[16],buf[17]))&amp;&amp; // size
        Serial.println(shift8to16(buf[28],buf[29]))&amp;&amp; // bitspp
        Serial.println(shift8to32(buf[30],buf[31],buf[32],buf[33]))) // compress
        {
                Serial.println(&quot;DIP recognized&quot;);
      //BMP data (1. pixel = bottom left)
      width = shift8to32(buf[18],buf[19],buf[20],buf[21]); // width
      height = shift8to32(buf[22],buf[23],buf[24],buf[25]); // height
      pad = width % 4; //padding (line is multiply of 4)
         Serial.println(&quot;printing&quot;);
      if((x+width) &lt;= lcd.getWidth() &amp;&amp; (y+height) &lt;= lcd.getHeight())
      {
        lcd.setArea(x, y, x+width-1, y+height-1);
        for(h=(y+height-1); h &gt;= y; h--) //for every line
        {
                        uint8_t pix[320][3];
                bitmap.read(pix,width*3);
                for(w=0; w &lt; width; w++) //for every pixel in line
          {
            lcd.drawPixel(x+w, h, RGB(pix[w][2],pix[w][1],pix[w][0]));
          }
          if(pad)
          {
            bitmap.read(pix, pad);
          }
        }
      }
      else
      {
        lcd.drawTextPGM(x, y, PSTR(&quot;Pic out of screen!&quot;), 1, RGB(0,0,0), RGB(255,255,255));
      }
    }
  }
  bitmap.close();
}

void initDisplay()
{
        lcd.init();
        lcd.setOrientation(180);
        lcd.led(100);
        lcd.clear(COLOR_BLACK);
}

void initSD(){
  if (!SD.begin(4)) {
    continueText(&quot;failed&quot;);
        return;
  } else {
   continueText(&quot;succeeded&quot;);;
  }
}

void initLightSen() // initialize the light sensor
{
        lightsen.setIntegrationTime(TSL2561_INTEGRATIONTIME_101MS);
        lightsen.enableAutoGain(true);        
        lightsen.begin();
}

void initWiFi()
{
        lcd.clear(COLOR_BLACK);
        cursorY=1;
        WiFi.disconnect();
        drawText(&quot;number of networks:&quot;);
        uint8_t nnet=WiFi.scanNetworks();
        continueText(String(nnet));
        for(int i=0;i&lt;nnet;i++)
                drawText(WiFi.SSID(i));
        drawText();
        drawText(&quot;connecting to YOURWIFI..&quot;);
        for(int i=0;WL_CONNECTED!=WiFi.begin(&quot;YOURWIFI&quot;,&quot;yourpassword&quot;)&amp;&amp;i&lt;3;i++)
        {
                WiFi.scanNetworks();
                drawText(String(&quot;connection failed &quot;)+String(2-i)+String(&quot; left..&quot;));
        }
        if(WiFi.status()==WL_CONNECTED)
        {
                continueText(&quot; succeeded&quot;);
                drawText(&quot;local IP address: &quot;+String(WiFi.localIP()[0])+&quot;.&quot;+String(WiFi.localIP()[1])+&quot;.&quot;+String(WiFi.localIP()[2])+&quot;.&quot;+String(WiFi.localIP()[3]));
        }
        else
                drawText(&quot;connection failed&quot;);
        logging=0;
        drawText();
        drawText(&quot;continue to data display &amp; logging ..&quot;);
        waitForTap();
        lcd.clear(COLOR_BLACK);
        drawText(&quot;button: off&quot;,6);
        continueText(&quot;logging: off&quot;,1,25);
        String s=&quot;potentiometer: &quot;+String((((float)analogRead(Poti))*0.0977517106549))+&quot;&quot;;
        drawText(s,7);
}

void updateTP(){
        tp.service();
        drawText(&quot;x: &quot;+String(tp.getX())+&quot; y: &quot;+String(tp.getY())+&quot;&quot;,2);
}

void updateButtonAndPoti(){
        bool butv=(!digitalRead(Button));
        if(buttonValue!=butv)
        {
                if(wifiConnection==0)
                {
                        initWiFi();
                        counter=1;
                        return;
                }
                if(butv)
                {
                        logging=!logging;
                        if(logging)
                        {
                                continueText(&quot;logging: on &quot;,1,25);
                                WiFiSend();
                                counter=1;
                        }
                        else
                        {
                                continueText(&quot;logging: off&quot;,1,25);
                                WiFiReceive();
                                counter=1025;
                        }
                }
                if(!butv)
                        drawText(&quot;button: off&quot;,6);
                else
                        drawText(&quot;button: on &quot;,6);
                buttonValue=!buttonValue;
        }
        uint16_t potv=analogRead(Poti);
        if(potValue!=potv)
        {
                String s=&quot;potentiometer: &quot;+String((((float)potv)*0.0977517106549))+&quot;&quot;;
                drawText(s,7);
                potValue=potv;
        }

}

void updateRTC() // update the time from the clock
{
        DateTime tm=rtc.now();
        if(valueTime != tm.unixtime()) // Only refresh the values on the display if they changed (when the seconds value has changed since the last call)
        {
                char s[30];
                sprintf(s,&quot;%02i:%02i:%02i %02i.%02i:%04i&quot;,tm.hour(),tm.minute(),tm.second(),tm.day(),tm.month(),tm.year());
                drawText(s,1);
        }
        valueTime = tm.unixtime();
}

void updateSenLight() // get current light values
{
        uint16_t lsbroadband,lsinfrared; // definition
        float flsbroadband,flsinfrared;
        lightsen.getLuminosity(&amp;lsbroadband,&amp;lsinfrared); // the full function is implemented in the library
        flsbroadband=((float)lsbroadband*lightsen.getMultiplier());
        flsinfrared=((float)lsinfrared*lightsen.getMultiplier()); // getMultipier is a function I added. I believe the developers just missed something out in their lib
        valueLight=(((float)valueCounter[2]*valueLight)+(float)flsbroadband)/(float)(valueCounter[2]+1.0); // Calculate the avaredged values
        valueLightIR=(((float)valueCounter[2]*valueLightIR)+(float)flsinfrared)/(float)(valueCounter[2]+1.0);
        valueCounter[2]++;
        drawText(String(&quot;visible light: &quot;)+String(flsbroadband,1)+&quot;&quot;,4);
        drawText(String(&quot;infrared light: &quot;)+String(flsinfrared,1)+&quot;&quot;,5);
        float lratio=flsinfrared/flsbroadband;
        continueText(String(&quot;ratio: &quot;)+String(lratio,4),5,25);
        uint8_t ledvw=-0.0000307574013*pow((double)log(flsbroadband)*25.5,3.0)+0.0117647055*pow((double)log(flsbroadband)*25.5,2.0);
        analogWrite(ledW,ledvw);
        uint8_t ledvr=-0.0000307574013*pow((lratio-0.2)*425.0,3.0)+0.0117647055*pow((lratio-0.2)*425.0,2.0);
        analogWrite(ledR,ledvr);
        uint8_t ledvg=-0.0000307574013*pow(255.0-((lratio-0.2)*425.0),3.0)+0.0117647055*pow(255.0-((lratio-0.2)*425.0),2.0);
        analogWrite(ledG,ledvg);
        bool alive;
        if(flsinfrared&lt;30.0&amp;&amp;flsbroadband&gt;50)
                alive=1;
        else
                alive=0;
        mossstatus=alive;
        }

}

void updateSenWater() // get current water values
{
        float water = (0.0977517106549*(float)analogRead(Wat)); // The water sensor doesn't really work lineary. Here is my approximation for correction.
        valueWater=((valueCounter[0]*valueWater)+water)/(valueCounter[0]+1); // avaredged value
        valueCounter[0]++;
        String s=&quot;water level: &quot;+String(water)+&quot;% &quot;;
        drawText(s,6);
}

void updateSenTemp(){ // get current temperature data
  byte data[12]; // array the incoming values should be stored to
  byte addr[8] = {0x28,0x1D,0xF1,0xB0,0x04,0x00,0x00,0x6B}; // OneWire temperature sensor address
  
        tempsen.reset(); // build up a connection and request data
        tempsen.select(addr);
        tempsen.write(0x44,1);
        tempsen.depower();
        tempsen.reset();
        tempsen.select(addr);
        tempsen.write(0xBE);
        for(byte z = 0; z &lt; 9; z++) data[z] = tempsen.read(); // read out the return and store it byte per byte to the array
        unsigned int raw = (data[1] &lt;&lt; 8) | data[0];
        valueTemp=(float)((valueCounter[1]*valueTemp)+((float)raw / 16.0)-1.5)/(float)(valueCounter[1]+1); // Take the current temperature into account for the avaredged value
        valueCounter[1]++;
        String s=&quot;temperature: &quot;+String(((float)raw / 16.0)-1.5)+&quot;&quot;;
        drawText(s,3);
}

void updateWiFiConnection(){
        uint8_t wstat;
        if(!client.connected())
                client.stop();
        if(WiFi.status()==WL_CONNECTED)
                wstat=1;
        else
                wstat=0;
        if(wstat!=wifiConnection)
        {
                logging=0;
                continueText(&quot;logging: off&quot;,1,25);
                wifiConnection=wstat;
                if(wstat)
                {
                        continueText(&quot;WiFi: con&quot;,2,25);
                        continueText(&quot;&quot;,3,25);
                }
                else
                {
                        drawText(&quot;&quot;,10);
                        drawText(&quot;&quot;,11);
                        drawText(&quot;&quot;,12);
                        drawText(&quot;&quot;,13);
                        drawText(&quot;&quot;,14);
                        continueText(&quot;WiFi: dis&quot;,2,25);
                        continueText(&quot;button: recn&quot;,3,25);

                }
        }
}

void WiFiSend()
{
        if(!client.connected())
                client.stop();
        drawText(&quot;&quot;,10);
        drawText(&quot;&quot;,11);
        drawText(&quot;&quot;,12);
        drawText(&quot;&quot;,13);
        drawText(&quot;&quot;,14);
        drawText(&quot;client connecting.. &quot;,10);
        cursorX-=11;
        if(!wifiConnection)
        {
                updateWiFiConnection();
                return;
        }
        if(client.connect(&quot;your.website.here&quot;,80))
        {
                continueText(&quot;connected&quot;);
                drawText(&quot;sending data..&quot;,11);

                client.print(&quot;GET http://your.website.here/save.php?key=yourkey&quot;);
                client.print(String(&quot;&amp;water=&quot;)+String(valueWater,3) + &quot;&amp;temp=&quot;+String(valueTemp,3) + &quot;&amp;light1=&quot;+String(valueLight,3) + &quot;&amp;light2=&quot;+String(valueLightIR,3) +&quot;&amp;time=&quot;+String(valueTime));
                client.println(/*&quot; HTTP/1.1&quot;*/);
                client.println(&quot;Host: your.website.here&quot;);
                client.println(&quot;User-Agent: arduino-ethernet&quot;);
                client.println(&quot;Connection: close&quot;);
                client.println();

                continueText(&quot;done&quot;);
                for(int i=0;i&lt;3;i++)
                        valueCounter[i]=0; // Reset all counters and values for the avaredging process
                valueWater=0.0;
                valueTemp=0.0;
                valueLight=0.0;
                valueLightIR=0.0;
                firstreceive=1;
        }
        else
        {
                client.stop();
                continueText(&quot;failed&quot;);
                firstreceive=0;
                return;
        }
}

void WiFiReceive()
{
        int i=0;
        if(firstreceive)
        {
                drawText(&quot;&quot;,10);
                drawText(&quot;&quot;,11);
                drawText(&quot;&quot;,12);
                drawText(&quot;&quot;,13);
                drawText(&quot;&quot;,14);
                drawText(&quot;listening..&quot;,10);
                firstreceive=0;
        }
        String response = &quot;&quot;;
        while(client.connected() &amp;&amp; i++&lt;200)
        {
                if(client.available())
                {
                        while(client.available())
                        {
                                response.concat((char)client.read());        
                        }
                        i=200;
                        client.flush();
                }
                else
                        delay(1);
        }
        if(i==200)
                Serial.println();
        Serial.print(response);
        drawText(String(response),10);
}

void setup()
{
        initDisplay();
        Serial.begin(9600);
        Serial.println(&quot;serial ready&quot;);
        drawText(&quot;WiFi initialized&quot;);
        drawText(&quot;serial ready&quot;);
        drawText(&quot;init SD card reader.. &quot;);
        initSD();
        drawText(&quot;init some pins&quot;);
        analogReadResolution(10);
        pinMode(Poti,INPUT);
        pinMode(Button,INPUT);
        pinMode(Temp,INPUT);
        pinMode(Wat,INPUT);
        pinMode(ledW,OUTPUT);
        pinMode(ledR,OUTPUT);
        pinMode(ledG,OUTPUT);
        digitalWrite(Poti,HIGH);
        digitalWrite(Button,HIGH);
        analogWrite(ledW,255);
        analogWrite(ledR,255);
        analogWrite(ledG,255);
        drawText(&quot;init touchpad&quot;);
        tp.init();
        tp.setOrientation(180);
        drawText(&quot;init real time clock&quot;);
        rtc.begin();
        drawText(&quot;init light sensor&quot;);
        initLightSen();
        drawText(&quot;done&quot;);
        drawText();
        drawText(&quot;Tap for WiFi search and connection\n..&quot;);
        drawText(&quot;Press button to proceed without WiFi..&quot;);
        if(waitForTap()==0)
        {
                initWiFi();
        }
        else
        {
                lcd.clear(COLOR_BLACK);
                drawText(&quot;button: off&quot;,6);
                continueText(&quot;logging: off&quot;,1,25);
                String s=&quot;potentiometer: &quot;+String((((float)analogRead(Poti))*0.0977517106549))+&quot;&quot;;
                drawText(s,7);
                wifiConnection=0;
                continueText(&quot;WiFi: dis&quot;,2,25);
                continueText(&quot;button: recn&quot;,3,25);
        }
}

void loop()
{
        if(counter%8==1)                                updateButtonAndPoti();
        if(counter%8==5)                                updateTP();
        if(counter%64==19)                                updateRTC();
        if(counter%64==37)                                updateSenWater();
        if(counter%128==11)                                updateSenLight();
        if(counter%128==73)                                updateSenTemp();
        if(counter%256==7)                                updateWiFiConnection();
        if(counter%4096==0&amp;&amp;logging)        WiFiSend();
        if(counter%512==320&amp;&amp;logging)        WiFiReceive();
        counter++;
        delay(1);
}

</PRE><H4><SPAN class="mw-headline" id="Libraries">Libraries</SPAN></H4><P>Since it is not possible uploading files of the type file<B>.h</B> or file<B>.cpp</B>, we zipped our libraries, named the suffix <B>.zip.txt</B> and uploaded <B><A href="/wiki/images/8/8e/TUM13_arduino_libraries.zip.txt" class="internal" title="TUM13 arduino libraries.zip.txt">THEM</A></B> to the wiki. To unzip the libraries simply remove the <B>.txt</B>. We're very sorry but it was simply to much code to locate it as text on our pages.
Unzip the archive into your ./arduino/libraries folder.
</P><P>To store the sensor data the Arduino connects to a web server via WLAN. The sensor measurements are encoded as GET parameters and sent to the server in a HTTP request, then <A href="/Team:TU-Munich/TUM13_save.ph" title="Team:TU-Munich/TUM13 save.ph" class="mw-redirect">save.php</A> stores them in a MySQL database. The data can be viewed by visiting <A href="/Team:TU-Munich/TUM13_index.ph" title="Team:TU-Munich/TUM13 index.ph" class="mw-redirect">index.php</A>, which accesses the MySQL database and plots the sensor data in a graph. To view new data sets in real time <A href="/Team:TU-Munich/TUM13_real.ph" title="Team:TU-Munich/TUM13 real.ph">real.php</A> periodically requests new data from the server by using AJAX. An example of this setup can be viewed at <A href="http://igem.wzw.tum.de/arduino" class="external free" rel="nofollow">http://igem.wzw.tum.de/arduino</A>.
</P><P>Please also visit our <A href="https://github.com/VonAlphaBisZulu/IGEM_ARDUINO" class="external text" rel="nofollow">GitHub repo.</A></P><H4><SPAN class="mw-headline" id="Arduino_photo_gallery">Arduino photo gallery</SPAN></H4><DIV class="box-center"><UL class="bxgallery"><LI>/&gt;</LI></UL></DIV><H2><SPAN class="mw-headline" id="References">References</SPAN></H2><P>The 2D Graphic of the Arduino Due was taken from a open source software called &quot;fritzing&quot;
</P></DIV></DIV><DIV id="social-footer"><DIV id="annotator"><H2>AutoAnnotator:</H2><FORM action="https://2013.igem.org/Team:TU-Munich/Results/AutoAnnotator" method="get"> or go to the <A href="https://2013.igem.org/Team:TU-Munich/Results/AutoAnnotator">AutoAnnotator</A> page.
  </FORM></DIV><DIV id="follow"><H2>Follow us:</H2></DIV><DIV id="address"><H2>Address:</H2><P>iGEM Team TU-Munich
     Emil-Erlenmeyer-Forum 5
     85354 Freising, Germany</P><P>Email: <A id="mail" href="mailto:igem@wzw.tum.de">igem@wzw.tum.de</A>
     Phone: +49 8161 71-4351</P></DIV></DIV><DIV class="printfooter">
Retrieved from &quot;<A href="http://2013.igem.org/Team:TU-Munich/Results/How_To">http://2013.igem.org/Team:TU-Munich/Results/How_To</A>&quot;</DIV></DIV></DIV><DIV id="footer-box" class="noprint"><DIV id="footer"><UL id="f-list"><LI id="t-recentchanges"><A href="/Special:RecentChanges" title="Recent changes">Recent changes</A></LI><LI id="t-whatlinkshere"><A href="/Special:WhatLinksHere/Team:TU-Munich/Results/How_To" title="List of all wiki pages that link here [j]" accesskey="j">What links here</A></LI><LI id="t-recentchangeslinked"><A href="/Special:RecentChangesLinked/Team:TU-Munich/Results/How_To" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</A></LI><LI id="t-specialpages"><A href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</A></LI><LI><A href="/Special:Preferences">My preferences</A></LI></UL></DIV><DIV id="footer"><UL id="f-list"><LI id="t-print"><A href="/wiki/index.php?title=Team:TU-Munich/Results/How_To&amp;printable=yes" title="Printable version of this page [p]" accesskey="p">Printable version</A></LI><LI id="t-permalink"><A href="/wiki/index.php?title=Team:TU-Munich/Results/How_To&amp;oldid=356930" title="Permanent link to this revision of the page">Permanent link</A></LI><LI id="privacy"><A href="/2013.igem.org:Privacy_policy" title="2013.igem.org:Privacy policy">Privacy policy</A></LI><LI id="disclaimer"><A href="/2013.igem.org:General_disclaimer" title="2013.igem.org:General disclaimer">Disclaimers</A></LI></UL></DIV></DIV></DIV></BODY></HTML>