<HTML xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki  ltr ns-0 ns-subject page-Team_TU-Eindhoven_Code_PDBQuery"><DIV id="globalWrapper"><DIV id="top-section"><DIV id="p-logo"><A href="/Main_Page" title="Main Page">&quot;
	    </A></DIV><DIV id="menubar" class="left-menu noprint"><UL><LI class="selected"><A href="/Team:TU-Eindhoven/Code:PDBQuery">Page               </A></LI><LI class="new"><A href="/wiki/index.php?title=Talk:Team:TU-Eindhoven/Code:PDBQuery&amp;action=edit&amp;redlink=1">Discussion               </A></LI><LI><A href="/wiki/index.php?title=Team:TU-Eindhoven/Code:PDBQuery&amp;action=edit">View source               </A></LI><LI><A href="/wiki/index.php?title=Team:TU-Eindhoven/Code:PDBQuery&amp;action=history">History               </A></LI><LI style="color:white;cursor:default">teams</LI></UL></DIV><DIV class="right-menu noprint" id="menubar"><UL><LI id="pt-login"><A href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Team:TU-Eindhoven/Code:PDBQuery" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</A></LI></UL></DIV><DIV id="search-controls" class="noprint"><FORM action="/Special:Search" id="searchform"> </FORM></DIV></DIV><DIV id="content"><H1 class="firstHeading">Team:TU-Eindhoven/Code:PDBQuery</H1><DIV id="bodyContent"><H3 id="siteSub" class="noprint">From 2013.igem.org</H3><DIV class="navwrapper"><DIV class="container"><DIV class="navbar"><DIV class="navbar-inner"><UL class="nav"><LI id="tue-menu-home"><A href="/Team:TU-Eindhoven">Home</A></LI><LI id="tue-menu-team"><A href="/Team:TU-Eindhoven/Team">Team</A></LI><LI id="tue-menu-project" class="dropdown"><A class="dropdown-toggle" data-toggle="dropdown" href="#">Project </A></LI><LI><A href="/Team:TU-Eindhoven/Project">Abstract</A></LI><LI><A href="/Team:TU-Eindhoven/Description">Project Description</A></LI><LI><A href="/Team:TU-Eindhoven/Background">Background</A></LI><LI><A href="/Team:TU-Eindhoven/Chasis">The Chassis</A></LI><LI><A href="/Team:TU-Eindhoven/Production">Potential Contrast Agents</A></LI><LI><A href="/Team:TU-Eindhoven/KillingMechanism">Kill Switch</A></LI><LI><A href="/Team:TU-Eindhoven/Applications">Applications</A></LI><LI class="nav-header">Results</LI><LI><A href="/Team:TU-Eindhoven/Results">Main Results</A></LI><LI><A href="/Team:TU-Eindhoven/Parts">Parts Submitted</A></LI><LI class="nav-header">Outlook</LI><LI><A href="/Team:TU-Eindhoven/FutureProspects">Future Steps</A></LI><LI class="nav-header">Others</LI><LI><A href="/Team:TU-Eindhoven/Attributions">Attributions</A></LI><LI><A href="/Team:TU-Eindhoven/Collaboration">Collaboration</A></LI><LI><A href="/Team:TU-Eindhoven/Achievements">Achievements</A></LI></UL><LI id="tue-menu-wetlab" class="dropdown"><A class="dropdown-toggle" data-toggle="dropdown" href="#">Wetlab </A></LI><LI><A href="/Team:TU-Eindhoven/Wetlab">Overview</A></LI><LI><A href="/Team:TU-Eindhoven/Preparation">Preparation</A></LI><LI class="nav-header">Lab Reports</LI><LI><A href="/Team:TU-Eindhoven/MRIProcessing">MRI Data Processing</A></LI><LI><A href="/Team:TU-Eindhoven/AnearobicTesting">Anaerobic FNR Testing</A></LI><LI><A href="/Team:TU-Eindhoven/CESTAgentTesting">CEST Agent Testing</A></LI><LI><A href="/Team:TU-Eindhoven/LabJournal">Lab Journal</A></LI><LI id="tue-menu-drylab" class="dropdown"><A class="dropdown-toggle" data-toggle="dropdown" href="#">Drylab </A></LI><LI><A href="/Team:TU-Eindhoven/Modeling">Summary</A></LI><LI><A href="/Team:TU-Eindhoven/ProteinSelection">Protein Selection</A></LI><LI class="nav-header">Contrast Mechanism</LI><LI><A href="/Team:TU-Eindhoven/StochasticModel">Decoy Sites</A></LI><LI><A href="/Team:TU-Eindhoven/ODEModel">FNR Dynamics</A></LI><LI><A href="/Team:TU-Eindhoven/FNRPromotor">FNR Promotor</A></LI><LI><A href="/Team:TU-Eindhoven/IntegralModel">Integral Model</A></LI><LI class="nav-header">Bacteria in the Body</LI><LI><A href="/Team:TU-Eindhoven/PBPK">Ganciclovir Distribution</A></LI><LI><A href="/Team:TU-Eindhoven/TimeKill">Time-kill Behavior</A></LI><LI id="tue-menu-safety" class="dropdown"><A class="dropdown-toggle" data-toggle="dropdown" href="#">Safety </A></LI><LI><A href="/Team:TU-Eindhoven/Safety">Overview</A></LI><LI><A href="/Team:TU-Eindhoven/LabSafety">Lab Safety</A></LI><LI><A href="/Team:TU-Eindhoven/PublicSafety">Public and Environmental Safety</A></LI><LI><A href="/Team:TU-Eindhoven/SafetyiGEM">Biosafety Within iGEM</A></LI><LI id="tue-menu-society" class="dropdown"><A class="dropdown-toggle" data-toggle="dropdown" href="#">Society </A></LI><LI><A href="/Team:TU-Eindhoven/Outreach">Outreach</A></LI><LI><A href="/Team:TU-Eindhoven/Society">Human Practice</A></LI><LI id="tue-menu-notebook"><A href="/Team:TU-Eindhoven/Notebook">Notebook</A></LI></DIV></DIV></DIV></DIV><DIV class="tue-content container"><TABLE id="toc" class="toc"><TBODY><TR><TD><DIV id="toctitle"><H2>Contents</H2></DIV><UL><LI class="toclevel-1 tocsection-1"><A href="#PDB_Querying"><SPAN class="tocnumber">1</SPAN><SPAN class="toctext">PDB Querying</SPAN></A></LI><LI class="toclevel-2 tocsection-2"><A href="#General_Information"><SPAN class="tocnumber">1.1</SPAN><SPAN class="toctext">General Information</SPAN></A></LI><LI class="toclevel-2 tocsection-3"><A href="#query.xml"><SPAN class="tocnumber">1.2</SPAN><SPAN class="toctext">query.xml</SPAN></A></LI><LI class="toclevel-2 tocsection-4"><A href="#PDB.py"><SPAN class="tocnumber">1.3</SPAN><SPAN class="toctext">PDB.py</SPAN></A></LI><LI class="toclevel-2 tocsection-5"><A href="#queryPDB.py"><SPAN class="tocnumber">1.4</SPAN><SPAN class="toctext">queryPDB.py</SPAN></A></LI></UL></TD></TR></TBODY></TABLE><H2><SPAN class="mw-headline" id="PDB_Querying">PDB Querying</SPAN></H2><H3><SPAN class="mw-headline" id="General_Information">General Information</SPAN></H3><TABLE class="table table-striped" style="width: 600px;"><TBODY><TR><TD><B>Dependencies</B></TD><TD> Python, numpy, pylab, wget
</TD></TR><TR><TD><B>License</B></TD><TD> GPL
</TD></TR><TR><TD><B>Example Usage</B></TD><TD> python <I>queryPDB.py</I> -q <I>query.xml</I> -f 10
</TD></TR><TR><TD><B>Output</B></TD><TD><I>freq.csv</I>, which is a comma seperated file containing various properties of the different proteins. The most important value is the frequency of the aminoacids Lysing (K) or Arginine (R). Which on is taken can be changed in the source code of <I>queryPDB.py</I> changing the K in the following line: <CODE>freq = L.getFrequencies(proteins, 'K', 'freq.csv')</CODE></TD></TR></TBODY></TABLE><H3><SPAN class="mw-headline" id="query.xml">query.xml</SPAN></H3><P><PRE class="prettyprint linenums">&lt;orgPdbQuery&gt;&lt;version&gt;head&lt;/version&gt;&lt;queryType&gt;org.pdb.query.simple.ChainTypeQuery&lt;/queryType&gt;&lt;description&gt;Chain Type: there is a Protein chain&lt;/description&gt;&lt;containsProtein&gt;Y&lt;/containsProtein&gt;&lt;containsDna&gt;?&lt;/containsDna&gt;&lt;containsRna&gt;?&lt;/containsRna&gt;&lt;containsHybrid&gt;?&lt;/containsHybrid&gt;&lt;/orgPdbQuery&gt;</PRE></P><H3><SPAN class="mw-headline" id="PDB.py">PDB.py</SPAN></H3><P><PRE class="prettyprint linenums">
#!/usr/bin/env python

&quot;&quot;&quot;
Module to read and process PDB data. (http://www.pdb.org)

@author: Pascal Pieters
@copyright: Copyright 2013, TU-Eindhoven iGEM Team
@credits: TU-Eindhoven iGEM Team 2013
@license: GPL
@version: 0.0.1
@maintainer: Pascal Pieters
@email: p.a.pieters@student.tue.nl
@status: Testing
&quot;&quot;&quot;

import urllib2
import os
import pylab as P
import numpy as N
import csv
import shutil

class RemoteInstance:
	&quot;&quot;&quot;General PDB RemoteInstance that can be used to retrieve PDB data&quot;&quot;&quot;
	def __init__(self):
		&quot;&quot;&quot;Initiate the RemoteInstance&quot;&quot;&quot;
		self.searchURL = &quot;http://www.rcsb.org/pdb/rest/search&quot;
		self.query = &quot;&quot;
		self.result = &quot;&quot;
		return
	
	def loadQuery(self, filename):
		f = open(filename, 'r')
		self.query = ''.join(f.readlines())
		f.close()
		return
	
	def setQuery(self,q):
		self.query = q
		return
	
	def executeQuery(self):
		req = urllib2.Request(self.searchURL, data=self.query)
		r = urllib2.urlopen(req)
		self.result = r.read()
		self.result = self.result.split('\n')[0:-1]
		return len(self.result)
	
	def getBasicInformation(self, filename):
		u = [&quot;http://www.rcsb.org/pdb/rest/customReport?pdbids=&quot;, &quot;&amp;customReportColumns=structureId,chainId,entityId,sequence,chainLength,db_id,db_name,molecularWeight,secondaryStructure,entityMacromoleculeType&amp;service=wsdisplay&amp;format=csv&quot;]
		ft = open(filename, 'w')
		
		for i in range(0, len(self.result), 100):
			print &quot;# Downloading %d-%d&quot; % (i, i+100)
			url = u[0] + (', '.join((self.result[i:i+100] if i+100 &lt; len(self.result) else self.result[i:]))) + u[1]
			os.system((&quot;wget -q -O out.csv \&quot;%s\&quot;&quot; % url))
		
			f = open('out.csv', 'r')
			data = ''.join(f.readlines())
			print &quot;# - Data Size: %d&quot; % len(data)
			f.close()
			os.remove('out.csv')
		
			data = data.replace('&lt;br /&gt;', '\n')
			if i &gt; 0:
				[temp, data] = data.split('\n',1)
			ft.write(data)
		ft.close()
		return
	

class LocalInstance:
	def __init__(self, path):
		self.filename = path
		return
	
	def filterBasics(self, minChainLength=1):
		fin = open(self.filename, 'r')
		fout = open(&quot;temp.csv&quot;, 'w')
		
		dh = ['chainLength']
		headertext = fin.readline()
		fout.write(headertext)
		header = headertext.strip().split(',')
		d = {i:header.index(i) for i in dh}
		print &quot;Chain Length: %d&quot; % tuple(d.values())
				
		for line in fin:
			l = line.strip().split(',')
			l = [i.strip('&quot;') for i in l]
			if int(l[d['chainLength']]) &gt; minChainLength:
				fout.write(line)
		
		fout.close()
		fin.close()
		os.remove(self.filename)
		shutil.move(&quot;temp.csv&quot;, self.filename)
		return
	
	def getProteinSequences(self):
		f = open(self.filename, 'r')
		p = {}
		
		dh = ['structureId', 'chainId', 'entityId', 'sequence', 'entityMacromoleculeType']
		header = f.readline().strip().split(',')
		d = {i:header.index(i) for i in dh}
		print &quot;# Parsing '%s'\n# - Header: &quot; % (self.filename),
		for i in d.keys():
			print &quot;%s: %d&quot; % (i, d[i]),
		print &quot;&quot;		

		for line in f:
			l = line.strip().split(',')
			l = [i.strip('&quot;') for i in l]
			if 'Polypeptide' in l[d['entityMacromoleculeType']]:
				p[(l[d['structureId']], l[d['chainId']], int(l[d['entityId']]))] = l[d['sequence']]
		
		f.close()
		return p
	
	def getFrequencies(self, p, aa, filename):
		f = {}
		max_cnt = 0; max_rat = 0
		for k, v in p.iteritems():
			cnt = v.count(aa)
			lev = len(v)
			rat = float(cnt)/float(lev)
			f[k] = (cnt, lev, rat)
			max_cnt = max(max_cnt, cnt)
			max_rat = max(max_rat, rat)
		
		f = {k:(v[0], v[1], v[2], (float(v[0])/float(max_cnt)), (float(v[2])/float(max_rat)), (((float(v[0])/float(max_cnt))**2)+((float(v[2])/float(max_rat))**2))) for k,v in f.iteritems()}
		
		self.writeToCSV(filename, ['structureId', 'chainId', 'entityId', 'lysineCount', 'chainLength', 'lysineRatio', 'normalizedLysineCount', 'normalizedLysineRatio', 'suitabilityIndexA'], [[k[0], k[1], k[2], v[0], v[1], v[2], v[3], v[4], v[5]] for k,v in f.iteritems()])

		return f
	
	def plotFrequencies(self, f):
		x = []; y = []; d = []; keys = []
		for k,v in f.iteritems():
			x.append(v[2])
			y.append(float(v[0]))
			d.append(v[5])
			keys.append(k)
		
		npd = N.array(d)
		r_mean = N.mean(npd)
		r_std = N.std(npd)
		del npd
		
		xs = []; ys = []; ds = []; keyss = []
		t = []
		i = 0;
		while i &lt; len(x):
			if d[i] &gt; (r_mean+(3*r_std)):
				ds.append(d.pop(i))
				xs.append(x.pop(i))
				ys.append(y.pop(i))
				keyss.append(keys.pop(i))
				t.append((xs[-1], ys[-1], ds[-1], keyss[-1]))
			else:
				i += 1
		del i
		
		fig = P.figure(1)
		ax = fig.add_subplot(111)
		
		P.scatter(x,y)
		P.scatter(xs, ys, c='r')
		
		P.ylabel('Lysine Count')
		P.xlabel('Lysine Ratio')
		
		t = sorted(t, key=lambda st: st[2])
		
		P.show()
	
	def writeToCSV(self, filename, header, data):
		with open(filename, 'wb') as csvfile:
			cwriter = csv.writer(csvfile, delimiter=',', quotechar='&quot;', quoting=csv.QUOTE_MINIMAL)
			cwriter.writerow(header)
			for i in data:
				cwriter.writerow(i)
		return
</PRE></P><H3><SPAN class="mw-headline" id="queryPDB.py">queryPDB.py</SPAN></H3><P><PRE class="prettyprint linenums">
#!/usr/bin/env python

&quot;&quot;&quot;
Script to execute a simple PDB query

@author: Pascal Pieters
@copyright: Copyright 2013, TU-Eindhoven iGEM Team
@credits: TU-Eindhoven iGEM Team 2013
@license: GPL
@version: 0.0.1
@maintainer: Pascal Pieters
@email: p.a.pieters@student.tue.nl
@status: Testing
&quot;&quot;&quot;

import PDB
import getopt, sys

if __name__ == &quot;__main__&quot;:
	opts, args = getopt.getopt(sys.argv[1:], &quot;q:f:pv&quot;, [&quot;query=&quot;, &quot;filterlength=&quot;, &quot;plot&quot;])
	
	query = &quot;&quot;
	filterlength = 0
	plot = False
	verbose = False
	
	for o, a in opts:
		if o == &quot;-v&quot;:
			verbose = True
		elif o in (&quot;-q&quot;, &quot;--query&quot;):
			query = (a if a else &quot;query.xml&quot;) 
		elif o in (&quot;-f&quot;, &quot;--filterlength&quot;):
			filterlength = (int(a) if a else 10)
		elif o in (&quot;-p&quot;, &quot;--plot&quot;):
			plot = True
		else:
			assert False, &quot;unhandled option&quot;
	
	if query:
		P = PDB.RemoteInstance()
		P.loadQuery(&quot;query.xml&quot;)
		if verbose: print &quot;Structures Found: &quot;, P.executeQuery()
		else: P.executeQuery()
		P.getBasicInformation(&quot;basic.csv&quot;)
	
	if filterlength or plot:
		L = PDB.LocalInstance(&quot;basic.csv&quot;)
	if filterlength:
		L.filterBasics(minChainLength=filterlength)
	if plot:
		proteins = L.getProteinSequences()
		if verbose:
			for k,v in proteins.iteritems():
				print k, &quot;: &quot;, v
		freq = L.getFrequencies(proteins, 'K', 'freq.csv')
		L.plotFrequencies(freq)

</PRE></P></DIV><DIV class="tue-gototop-sticky"><A href="#top" title="Go to the top of the page">Go to Top   </A></DIV><DIV class="printfooter">
Retrieved from &quot;<A href="http://2013.igem.org/Team:TU-Eindhoven/Code:PDBQuery">http://2013.igem.org/Team:TU-Eindhoven/Code:PDBQuery</A>&quot;</DIV></DIV></DIV><DIV id="footer-box" class="noprint"><DIV id="footer"><UL id="f-list"><LI id="t-recentchanges"><A href="/Special:RecentChanges" title="Recent changes">Recent changes</A></LI><LI id="t-whatlinkshere"><A href="/Special:WhatLinksHere/Team:TU-Eindhoven/Code:PDBQuery" title="List of all wiki pages that link here [j]" accesskey="j">What links here</A></LI><LI id="t-recentchangeslinked"><A href="/Special:RecentChangesLinked/Team:TU-Eindhoven/Code:PDBQuery" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</A></LI><LI id="t-specialpages"><A href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</A></LI><LI><A href="/Special:Preferences">My preferences</A></LI></UL></DIV><DIV id="footer"><UL id="f-list"><LI id="t-print"><A href="/wiki/index.php?title=Team:TU-Eindhoven/Code:PDBQuery&amp;printable=yes" title="Printable version of this page [p]" accesskey="p">Printable version</A></LI><LI id="t-permalink"><A href="/wiki/index.php?title=Team:TU-Eindhoven/Code:PDBQuery&amp;oldid=309587" title="Permanent link to this revision of the page">Permanent link</A></LI><LI id="privacy"><A href="/2013.igem.org:Privacy_policy" title="2013.igem.org:Privacy policy">Privacy policy</A></LI><LI id="disclaimer"><A href="/2013.igem.org:General_disclaimer" title="2013.igem.org:General disclaimer">Disclaimers</A></LI></UL></DIV></DIV></DIV></BODY></HTML>