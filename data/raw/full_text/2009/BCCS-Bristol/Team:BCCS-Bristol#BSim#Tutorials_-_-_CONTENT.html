<HTML xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki  ltr ns-0 ns-subject page-Team_BCCS-Bristol_BSim_Tutorials"><DIV id="globalWrapper"><DIV id="top-section"><DIV id="p-logo"><A href="/Main_Page" title="Main Page">&quot;
	    </A></DIV><DIV id="menubar" class="left-menu"><UL><LI class="selected"><A href="/Team:BCCS-Bristol/BSim/Tutorials">Page               </A></LI><LI class="new"><A href="/wiki/index.php?title=Talk:Team:BCCS-Bristol/BSim/Tutorials&amp;action=edit&amp;redlink=1">Discussion               </A></LI><LI><A href="/wiki/index.php?title=Team:BCCS-Bristol/BSim/Tutorials&amp;action=edit">View source               </A></LI><LI><A href="/wiki/index.php?title=Team:BCCS-Bristol/BSim/Tutorials&amp;action=history">History               </A></LI><LI style="color:#808080;cursor:default">teams</LI></UL></DIV><DIV class="right-menu" id="menubar"><UL><LI id="pt-login"><A href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Team:BCCS-Bristol/BSim/Tutorials" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</A></LI></UL></DIV><DIV id="search-controls"><FORM action="/Special:Search" id="searchform"> </FORM></DIV></DIV><DIV id="content"><H1 class="firstHeading">Team:BCCS-Bristol/BSim/Tutorials</H1><DIV id="bodyContent"><H3 id="siteSub">From 2009.igem.org</H3><P><UL id="nav"><LI><A href="https://2009.igem.org/Team:BCCS-Bristol">Home</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Project">VESECURE</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Project/Wet_lab">Wet lab</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Project/Wet_lab/BioBricks">BioBricks</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Project/Wet_lab/Notebook">Notebook</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Project/Wet_lab/Lab_photos">Lab photos</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Project/Wet_lab#Safety_Issues">Safety</A></LI></UL><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Project/Modelling">Modelling</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/BSim">BSim</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/BSim#Features">Features</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/BSim/Tutorials">Tutorials</A></LI><LI><A href="http://code.google.com/p/bsim-bccs/downloads">Download</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/BSim/Case_studies">Case studies</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/BSim/Case_studies/VESECURE">VESECURE</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/BSim/Case_studies/Magnetotaxis">Magnetotaxis</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/BSim/Case_studies/Repressilators">Repressilators</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Bioscaffold">Bioscaffold</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Bioscaffold/Protein_Fusion_Problem">Fusion Problem</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Bioscaffold/BCCS_Bioscaffold">BCCS Bioscaffold</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Team">Team</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Team/Calendar">Calendar</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Team/Brainstorm">Brainstorm</A></LI><LI><A href="https://2009.igem.org/Team:BCCS-Bristol/Team/Preliminary_meetings">Preliminary meetings</A></LI></P><DIV style="position: relative; width: 965px; height: 150px; background: url('https://static.igem.org/mediawiki/2009/c/c2/BCCSBanner.jpg'); clear: both;  "><DIV style="position: absolute; bottom: 12px; right: 25px; color: black; z-index: 3; font-size: 1.5em">
BCCS-Bristol
<SPAN style="font-size: small">iGEM 2009</SPAN></DIV></DIV><P>
In this section we discuss the new structure of BSim simulations and the improvements made in how they are specified. The examples presented in this section are available from our Google code <A href="http://code.google.com/p/bsim-bccs/source/browse/#svn/trunk/src/bsim/example" class="external text" rel="nofollow">subversion repository</A>, from where it is also possibly to checkout a copy of the BSim source code. BSim is available as a standalone pre-compiled library which can be compiled against like any other Java library, or as archived source code (for more details please see <A href="http://code.google.com/p/bsim-bccs/wiki/BSimSummary" class="external text" rel="nofollow">here</A>). A brief tutorial for one method of obtaining BSim using SVN is also provided <A href="http://code.google.com/p/bsim-bccs/wiki/BSimEclipse" class="external text" rel="nofollow">here</A>.
</P><P>We present two walkthroughs for creating basic simulations in BSim:
</P><UL><LI> The <A href="#example1">first tutorial</A> describes the basics of a BSim simulation file, and the steps required to create a single bacterium. 
</LI><LI>The <A href="#example2">second tutorial</A> provides a detailed overview of the core features of a BSim simulation file. In the simulation, we create 100 bacteria exhibiting classic run and tumble behaviour and detect collisions between the bacteria by changing their colour from green to red (any such activity can also be easily logged and imported into a numerical analysis package e.g. MATLAB or Excel). The following video shows the simulation running over a 100x100x100 micron volume for 30 seconds.
</LI></UL><H2><SPAN class="mw-headline" id="New_Simulation_Structure"> New Simulation Structure</SPAN></H2><P>When we set out to restructure BSim it was decided that it should be made much more versatile and adaptable, and that as much as possible of the physics and coding should effectively be behind the scenes. This would allow stronger focus on the biological aspects of the simulation. To this end BSim has now been rebuilt as an environment where the user takes various functionalities already in place and uses them to create a simulation tailored to their specific requirements. 
</P><P>The creation of a BSim simulation requires a basic working knowledge of the Java programming language. However as stated above, in designing the new structure of the BSim environment we have endeavoured to provide a toolkit that would also be useful to people without a programming background. The BSim distribution will include complete documentation for all available functions, and numerous example simulations showcasing the available features.
</P><P>Comprehensive and complete Java documentation can be found on the <A href="http://java.sun.com/javase/reference/index.jsp" class="external text" rel="nofollow">Sun Website</A>, including a number of <A href="http://java.sun.com/docs/books/tutorial/" class="external text" rel="nofollow">tutorial trails</A>. However for help on a specific function it is often easier to perform an internet search for &quot;Java&quot; followed by the name of the function.
</P><H2><SPAN class="mw-headline" id="Example_1:_The_simplest_simulation.21"> Example 1: The simplest simulation! </SPAN></H2><P>Arguably the simplest simulation would be a single bacterium floating around in a viscous medium. In this example we define an example file in which we create a new simulation, add a single bacterium with classic run-tumble motion, and define parameters for drawing the bacterium. 
</P><P><B>Step 1: Create the simulation file.</B> Create a new java file called &quot;BSimSimplestExample.java&quot;. Now we define the class that will contain the simulation and the &quot;main&quot; method which is called when running the simulation.
</P><PRE>
public class BSimSimplestExample {

	public static void main(String[] args) {

	}
}
</PRE><P><B>Step 2: Define a new BSim simulation.</B> We must now write the code to define the simulation inside our &quot;main&quot; method. Here we define a new instance of the BSim simulation environment as follows:
</P><PRE>
		BSim sim = new BSim();
</PRE><P><B>Step 3: Create a bacterium.</B> This is a single line in which we define one bacterium instance. When creating the bacteriun we need to specify that the bacterium is attached to our simulation &quot;sim&quot; variable, and specify the starting position of the bacterium using the &quot;Vector3d&quot; constructor which specifies an &quot;X, Y, Z&quot; position in the 3D environment.
</P><PRE>
		final BSimBacterium bacterium = new BSimBacterium(sim, new Vector3d(50,50,50));
</PRE><P><B>Step 4: Create a &quot;BSimTicker&quot;.</B> A BSimTicker object will iterate at every time-step of the simulation, so we must specify here what we want to occur as the simulation runs. First we assign the ticker to our simulation object, then define what we want to occur at each time-step using the &quot;tick()&quot; method.  In this case all we want the bacterium to do is perform run-tumble motion through our environment, which is its default &quot;action()&quot; method. We then need to update the position of the bacterium for that time-step.
</P><PRE>
		sim.setTicker(new BSimTicker() {
			@Override
			public void tick() {
				bacterium.action();		
				bacterium.updatePosition();
			}
		});
</PRE><P><B>Step 5: Create a &quot;drawer&quot; object to display the simulation.</B> The &quot;drawer&quot; defines what should be drawn (to screen or to a file) at each time step. Here we simply specify the size of our display area as 800 by 600 pixels when we create a new BSimP3DDrawer object, and then specify that we want our bacterium &quot;bacterium&quot; drawn as a green coloured sphere.
</P><PRE>
		sim.setDrawer(new BSimP3DDrawer(sim, 800,600) {
			@Override
			public void scene(PGraphics3D p3d) {							
				draw(bacterium,Color.GREEN);
			}
		});	
</PRE><P><B>Step 6: Draw the simulation to screen.</B> The final step of a simulation definition is to specify what we want to do with the generated data. In this case we just want to show the motion of the bacterium on the screen, so we add the following line at the end of our &quot;main&quot; method:
</P><PRE>
		sim.preview();
</PRE><P>This tells BSim to create a new window when the simulation is run and draw the bacterium's behaviour to the screen.
</P><P>The result? Congratulations, you have created your first running, tumbling bacterium!
</P><H2><SPAN class="mw-headline" id="Example_2:_BSimTutorialExample.3B_A_detailed_outline_of_a_complete_simulation_specification"> Example 2: BSimTutorialExample; A detailed outline of a complete simulation specification </SPAN></H2><P>The tutorial example was designed to show the user how to implement many of the features one by one in a clear modular fashion, and with an explanation of the options available for each of the features.
In this example we again define a new example file, in which we create a new simulation, add 100 bacteria in the same way as we added one bacterium in the last example and register the number of collisions between the bacteria in an exporter file and also by changing the colour of the bacteria when they collide.
</P><P><B>Step 1: Create the simulation file and define a new simulation.</B> Create a new java file called &quot;BSimTutorialExample.java&quot;. Now we define the class that will contain the simulation and the &quot;main&quot; method which is called when running the simulation followed by defining a new instance of the BSim simulation environment.
</P><PRE>
public class BSimTutorialExample {

	public static void main(String[] args) {

	BSim sim = new BSim();

	}
}
</PRE><P><B>Step 2: Set environmental properties.</B> There are many available environmental settings, all with defaults, as defined below:
</P><P>BSim#setDt() <I>Overall simulation time step</I>: default for the time step is 0.01 seconds
BSim#setSimulatonTime() <I>The length of the simulation</I>: length of simulation in seconds
BSim#setTimeFormat() <I>Display format of the elapsed simulation time</I>: defaults to &quot;0.00&quot;
BSim#setBound() <I>Simulation boundary dimensions</I>: The default is (100,100,100), specified in microns
BSim#setSolid() <I>Simulation boundary conditions</I>: Sets whether the boundaries are solid or wrapping (periodic boundary conditions). Defaults to {false, false, false} i.e. fully wrapping boundaries
BSim#setVisc() <I>Fluid environment viscosity</I>: default is 2.7e-3 Pa s
BSim#setTemperature() <I>Environment temperature</I>: defaults to 305 K</P><PRE>
		sim.setDt(0.01);
		sim.setSimulationTime(10);
		sim.setTimeFormat(&quot;0.00&quot;);
		sim.setBound(100,100,100);
</PRE><P><B>Step 3: Create the bacteria.</B> Extend BSimParticle as required and create vectors marked final. In this example the bacteria will turns red when they collide. Firstly the collision is set as the default, false. Then the size and position of the bacteria in the simulation are defined and the interaction method is defined. Finally, the bacteria are created inside the boundary, defined previously, and added to the vector.  
</P><PRE>
        class BSimTutorialBacterium extends BSimBacterium {
                private boolean collision = false;

                public BSimTutorialBacterium(BSim sim, Vector3d position) {
                        super(sim, position); // default radius is 1 micron			
                }

                public void interaction(BSimTutorialBacterium p) {
                        if(outerDistance(p) &lt; 0) {
                                collision = true;
                                p.collision = true;
                        }
                }
        }
		
        final Vector&lt;BSimTutorialBacterium&gt; bacteria = new Vector&lt;BSimTutorialBacterium&gt;();
		
        while(bacteria.size() &lt; 100) {		
                BSimTutorialBacterium b = new BSimTutorialBacterium(sim, new Vector3d(
                                                        Math.random()*sim.getBound().x,
                                                        Math.random()*sim.getBound().y,
                                                        Math.random()*sim.getBound().z));
                if(!b.intersection(bacteria)) bacteria.add(b);		
        }
</PRE><P><B>Step 4: Create a &quot;BSimTicker&quot;.</B> Implementation of tick() on a BSimTicker and add the ticker to the simulation. This has to be implemented such that for each bacterium from the vector, the position and action of the bacterium will be updated at every timestep.
</P><PRE>
                sim.setTicker(new BSimTicker() {
                        @Override
                        public void tick() {
                                for(int i = 1; i &lt; bacteria.size(); i++)
                                        for(int j = i+1; j &lt; bacteria.size(); j++)
                                                bacteria.get(i).interaction(bacteria.get(j));

                                for(BSimTutorialBacterium b : bacteria) {
                                        b.action();		
                                        b.updatePosition();
                                }
                         }		
                });
</PRE><P><B>Step 5: Create a &quot;drawer&quot; object to display the simulation.</B> Here we use the BSimP3DDrawer which has already implemented draw(Graphics) to draw boundaries and the simulation time, but still requires the implementation of scene(PGraphics3D) to draw particles. You can use the draw(BSimParticle, Color) method to draw particles. In this case, the bacteria will be green unless they have experienced a collision, in which case they will be coloured red.
</P><PRE>
                BSimP3DDrawer drawer = new BSimP3DDrawer(sim, 800,600) {
                        @Override
                        public void scene(PGraphics3D p3d) {						
                                for(BSimTutorialBacterium b : bacteria) {
                                        draw(b, b.collision ? Color.RED : Color.GREEN);
                                }			
                        }
                };
                sim.setDrawer(drawer);
</PRE><P><B>Step 6: Create the &quot;exporter&quot; object.</B> Implement before(), during() and after() methods on BSimExporters and add them to the simulation.
</P><P>BSimMovExporter is a concrete BSimExporter for creating Quicktime movies, with settings defined below:
</P><P>BSimMovExporter#setSpeed() <I>The relative speed that the movie file plays at</I>.
</P><PRE>
                BSimMovExporter movExporter = new BSimMovExporter(sim, drawer, &quot;results/BSim.mov&quot;);
                movExporter.setSpeed(2);
                sim.addExporter(movExporter);			
</PRE><P>BSimPngExporter is another concrete BSimExporter for creating png images.
</P><PRE> 
                BSimPngExporter pngExporter = new BSimPngExporter(sim, drawer, &quot;results&quot;);
                pngExporter.setDt(0.5);
                sim.addExporter(pngExporter);
</PRE><P>BSimLogger is an abstract BSimExporter that requires an implementation of at least the during() method. It provides the method write() which will write the specified data to the log file and then start a new line.
</P><PRE>
                BSimLogger logger = new BSimLogger(sim, &quot;results/tutorialExample.csv&quot;) {
                        @Override
                        public void before() {
                                super.before();
                                write(&quot;time,collisions&quot;); 
                        }

                        @Override
                        public void during() {
                                int collisions = 0;
                                for (BSimTutorialBacterium p : bacteria)
                                        if(p.collision) collisions++;
                                write(sim.getFormattedTime()+&quot;,&quot;+collisions);
                        }
                };
                sim.addExporter(logger);
</PRE><P>Add your own exporters by extending BSimExporter with:
</P><PRE>
BSimExporter e = new BSimExporter(){};
</PRE><P><B>Step 7: Draw the simulation to screen or output results.</B> This step will create the desired output from the simulation:
</P><PRE>
		sim.preview();
</PRE><P>This tells BSim to create a new window when the simulation is run and draw the bacterium's behaviour to the screen in a preview. This function is useful to check that the simulation has been set up correctly and that all elements are interacting as desired.
</P><PRE>
		sim.export();
</PRE><P>This will run all of the &quot;exporter&quot; objects with no output to screen, and save files storing the results from the simulation.
</P><DIV class="printfooter">
Retrieved from &quot;<A href="http://2009.igem.org/Team:BCCS-Bristol/BSim/Tutorials">http://2009.igem.org/Team:BCCS-Bristol/BSim/Tutorials</A>&quot;</DIV></DIV></DIV><DIV id="footer-box"><DIV id="footer"><UL id="f-list"><LI id="t-recentchanges"><A href="/Special:RecentChanges" title="Recent changes">Recent changes</A></LI><LI id="t-whatlinkshere"><A href="/Special:WhatLinksHere/Team:BCCS-Bristol/BSim/Tutorials" title="List of all wiki pages that link here [j]" accesskey="j">What links here</A></LI><LI id="t-recentchangeslinked"><A href="/Special:RecentChangesLinked/Team:BCCS-Bristol/BSim/Tutorials" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</A></LI><LI id="t-specialpages"><A href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</A></LI><LI><A href="/Special:Preferences">My preferences</A></LI></UL></DIV><DIV id="footer"><UL id="f-list"><LI id="t-print"><A href="/wiki/index.php?title=Team:BCCS-Bristol/BSim/Tutorials&amp;printable=yes" title="Printable version of this page [p]" accesskey="p">Printable version</A></LI><LI id="t-permalink"><A href="/wiki/index.php?title=Team:BCCS-Bristol/BSim/Tutorials&amp;oldid=169854" title="Permanent link to this revision of the page">Permanent link</A></LI><LI id="privacy"><A href="/2009.igem.org:Privacy_policy" title="2009.igem.org:Privacy policy">Privacy policy</A></LI><LI id="disclaimer"><A href="/2009.igem.org:General_disclaimer" title="2009.igem.org:General disclaimer">Disclaimers</A></LI></UL></DIV></DIV></DIV></BODY></HTML>