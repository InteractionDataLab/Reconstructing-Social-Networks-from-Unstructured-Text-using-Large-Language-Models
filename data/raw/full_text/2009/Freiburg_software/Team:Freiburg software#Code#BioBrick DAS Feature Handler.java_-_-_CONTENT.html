<HTML xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki  ltr ns-0 ns-subject page-Team_Freiburg_software_Code_BioBrick_DAS_Feature_Handler_java"><DIV id="globalWrapper"><DIV id="top-section"><DIV id="p-logo"><A href="/Main_Page" title="Main Page">&quot;
	    </A></DIV><DIV id="menubar" class="left-menu"><UL><LI class="selected"><A href="/Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java">Page               </A></LI><LI class="new"><A href="/wiki/index.php?title=Talk:Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java&amp;action=edit&amp;redlink=1">Discussion               </A></LI><LI><A href="/wiki/index.php?title=Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java&amp;action=edit">View source               </A></LI><LI><A href="/wiki/index.php?title=Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java&amp;action=history">History               </A></LI><LI style="color:#808080;cursor:default">teams</LI></UL></DIV><DIV class="right-menu" id="menubar"><UL><LI id="pt-login"><A href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</A></LI></UL></DIV><DIV id="search-controls"><FORM action="/Special:Search" id="searchform"> </FORM></DIV></DIV><DIV id="content"><H1 class="firstHeading">Team:Freiburg software/Code/BioBrick DAS Feature Handler.java</H1><DIV id="bodyContent"><H3 id="siteSub">From 2009.igem.org</H3><PRE>

/*
    Copyright: synbiowave
     
    License: GPL
     
    Authors: Jörg Wassolesk
     
    Version: 0.1 
    
    DESCRIPTION:
    	This class provides the methods for the handling of DAS feature requests.
*/

package org.synbiowave.biobrick;

import org.xml.sax.helpers.DefaultHandler;
import org.xml.sax.Attributes;

import java.util.ArrayList ;
import java.util.HashMap ;
import java.util.List;
import java.util.Map;

// TODO: Auto-generated Javadoc
/**
 * a class to parse the response of a DAS - Feature request.
 * 
 * @author Andreas Prlic
 */
public class BioBrick_DAS_Feature_Handler  extends DefaultHandler{

	/** The features. */
	List&lt;Map&lt;String,String&gt;&gt; features ;
	
	/** The first_flag. */
	boolean first_flag ;
	
	/** The feature. */
	Map&lt;String,String&gt; feature ;
	
	/** The featurefield. */
	String featurefield ;
	
	/** The characterdata. */
	StringBuffer characterdata ;
	
	/** The das command. */
	String dasCommand ;

	/** The come back later. */
	int comeBackLater ;

	/** The max features. */
	int maxFeatures ;

	/** The segment id. */
	String segmentId ;
	
	/** The version. */
	String version;
	
	/** The type_id. */
	String type_id;
	
	/** The type_category. */
	String type_category;
	
	
	/**
	 * Instantiates a new bio brick_ da s_ feature_ handler.
	 */
	public BioBrick_DAS_Feature_Handler() {
		super();

		features= new ArrayList&lt;Map&lt;String, String&gt;&gt;() ;
		first_flag = true ;
		featurefield = &quot;&quot; ;
		characterdata = new StringBuffer();
		dasCommand = &quot;&quot; ;
		comeBackLater = -1; 
		maxFeatures = -1;
		segmentId = &quot;&quot;;
		version   = &quot;&quot;;
		type_id = &quot;&quot;;
		type_category=&quot;&quot;;
	}

	
	
	/**
	 * get the id information specified int the SEGMENT field of the DAS response.
	 * 
	 * @return the segmentId or an emtpy string if not available
	 */
	public String getSegmentId() {
		return segmentId;
	}

	/**
	 * get the version informationspecified in the SEGMENT field of the DAS response.
	 * 
	 * @return the version information of an empty string if not available
	 */
	public String getVersion() {
		return version;
	}
	
	/**
	 * Checks if is m d5 checksum.
	 * 
	 * @return true, if is m d5 checksum
	 */
	public boolean isMD5Checksum(){
		
		if ((version != null) &amp;&amp; (version.length() == 32))
			return true;
		return false;
	}


	/**
	 * specifies a maximum number of features to be downloaded. if a
	 * server returns more, they will be ignored.  default is to load
	 * all features
	 * 
	 * @param max the maximium number of features to be downloaded
	 */

	public void setMaxFeatures(int max) {
		maxFeatures = max;
	}

	/**
	 * Gets the max features.
	 * 
	 * @return the max features
	 */
	public int getMaxFeatures() {
		return maxFeatures;
	}

	/**
	 * Sets the dAS command.
	 * 
	 * @param cmd the new dAS command
	 */
	public void setDASCommand(String cmd) { dasCommand = cmd ;}
	
	/**
	 * Gets the dAS command.
	 * 
	 * @return the dAS command
	 */
	public String getDASCommand() { return dasCommand; }

	/**
	 * Gets the _features.
	 * 
	 * @return the _features
	 */
	public List&lt;Map&lt;String,String&gt;&gt; get_features() {
		return features ;
	}

	/**
	 * Gets the com back later.
	 * 
	 * @return the com back later
	 */
	public int getComBackLater(){
		return comeBackLater;
	}

	/**
	 * Start_feature.
	 * 
	 * @param uri the uri
	 * @param name the name
	 * @param qName the q name
	 * @param atts the atts
	 */
	void start_feature(String uri, String name, String qName, Attributes atts) {

		if (( maxFeatures &gt; 0 ) &amp;&amp; ( features.size() &gt; maxFeatures ) ) {
			characterdata = new StringBuffer();
			return;
		}
		feature = new HashMap&lt;String,String&gt;() ;
		String id 	= atts.getValue(&quot;id&quot;);
		feature.put(&quot;id&quot;,id);
		feature.put(&quot;dassource&quot;,dasCommand);
		characterdata = new StringBuffer();
	}

	/**
	 * Add_featuredata.
	 * 
	 * @param uri the uri
	 * @param name the name
	 * @param qName the q name
	 */
	void add_featuredata(String uri, String name, String qName) {
		//System.out.println(&quot;featurefield &quot;+featurefield+ &quot; data &quot;+characterdata);
		// NOTE can have multiple lines ..

		if (( maxFeatures &gt; 0 ) &amp;&amp; ( features.size() &gt; maxFeatures ) ) {
			return;
		}


		String data = (String)feature.get(featurefield);
		String featureText = characterdata.toString();
		if (data != null){
			featureText = data + &quot;&quot; + featureText;
		}

		if ( qName.equals(&quot;TYPE&quot;)){
			if ( featureText.length() &lt; 1)
				featureText = type_id;
		
			feature.put(&quot;TYPE_ID&quot;,type_id);
			feature.put(&quot;TYPE_CATEGORY&quot;, type_category);
			type_id = &quot;&quot;;
			type_category=&quot;&quot;;
		}
		
		
		feature.put(featurefield,featureText);
		featurefield = &quot;&quot;;
		characterdata = new StringBuffer();
	}

	/**
	 * Adds the link.
	 * 
	 * @param uri the uri
	 * @param name the name
	 * @param qName the q name
	 * @param atts the atts
	 */
	private void addLink(String uri, String name, String qName, Attributes atts) {
		String href = atts.getValue(&quot;href&quot;);
		feature.put(&quot;LINK&quot;,href);
		characterdata= new StringBuffer();
		featurefield = &quot;LINK-TEXT&quot;;

	}

	/**
	 * Adds the group.
	 * 
	 * @param uri the uri
	 * @param name the name
	 * @param qName the q name
	 * @param atts the atts
	 */
	private void addGroup(String uri, String name, String qName, Attributes atts) {
		String id = atts.getValue(&quot;id&quot;);
		feature.put(&quot;GROUP&quot;,id);
		characterdata= new StringBuffer();
		featurefield = &quot;GROUP&quot;;
	}
	
	/* (non-Javadoc)
	 * @see org.xml.sax.helpers.DefaultHandler#startElement(java.lang.String, java.lang.String, java.lang.String, org.xml.sax.Attributes)
	 */
	public void startElement (String uri, String name, String qName, Attributes atts){
		//System.out.println(&quot;new element &quot;+qName);

		if (qName.equals(&quot;FEATURE&quot;)) 
			start_feature(uri,  name,  qName,  atts);
		else if ( qName.equals(&quot;LINK&quot;))
			addLink(uri,name,qName, atts);
		else if ( qName.equals(&quot;GROUP&quot;))
			addGroup(uri,name,qName, atts);
		else if ( qName.equals(&quot;METHOD&quot;) || 
				qName.equals(&quot;TYPE&quot;) ||
				qName.equals(&quot;START&quot;) ||
				qName.equals(&quot;END&quot;) ||
				qName.equals(&quot;NOTE&quot;) ||                
				qName.equals(&quot;SCORE&quot;) ||
				qName.equals(&quot;ORIENTATION&quot;) 				
		){
			characterdata = new StringBuffer();
			featurefield = qName ;
		} else if (qName.equals(&quot;SEGMENT&quot;)){
			String id = atts.getValue(&quot;id&quot;);
			if (id != null)
				segmentId = id;
			
			String v = atts.getValue(&quot;version&quot;);
			if ( v != null)
				version = v;
			
			
		}
		if ( qName.equals(&quot;TYPE&quot;)){
			type_id      = atts.getValue(&quot;id&quot;);
			type_category= atts.getValue(&quot;category&quot;);
		}

	}



	/* (non-Javadoc)
	 * @see org.xml.sax.helpers.DefaultHandler#endElement(java.lang.String, java.lang.String, java.lang.String)
	 */
	public void endElement(String uri, String name, String qName) {

		if ( qName.equals(&quot;METHOD&quot;) || 
				qName.equals(&quot;TYPE&quot;) ||
				qName.equals(&quot;START&quot;) ||
				qName.equals(&quot;END&quot;) ||
				qName.equals(&quot;NOTE&quot;) || 
				qName.equals(&quot;LINK&quot;) || 
				qName.equals(&quot;SCORE&quot;) ||
				qName.equals(&quot;ORIENTATION&quot;) ||
				qName.equals(&quot;GROUP&quot;)
		) {
			add_featuredata(uri,name,qName);
		}
		else if ( qName.equals(&quot;FEATURE&quot;)) {

			if ( maxFeatures &gt; 0 ) {
				if ( features.size() &lt; maxFeatures ) {
					features.add(feature);
				} 
			} else {
				// no restriction
				features.add(feature);
			}
		}
	}

	/* (non-Javadoc)
	 * @see org.xml.sax.helpers.DefaultHandler#characters(char[], int, int)
	 */
	public void characters (char ch[], int start, int length){
		if ( maxFeatures &gt; 0)
			if ( features.size() &gt; maxFeatures )
				return;

		for (int i = start; i &lt; start + length; i++) {

			characterdata.append(ch[i]);
		}

	}

}


</PRE><DIV class="printfooter">
Retrieved from &quot;<A href="http://2009.igem.org/Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java">http://2009.igem.org/Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java</A>&quot;</DIV></DIV></DIV><DIV id="footer-box"><DIV id="footer"><UL id="f-list"><LI id="t-recentchanges"><A href="/Special:RecentChanges" title="Recent changes">Recent changes</A></LI><LI id="t-whatlinkshere"><A href="/Special:WhatLinksHere/Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java" title="List of all wiki pages that link here [j]" accesskey="j">What links here</A></LI><LI id="t-recentchangeslinked"><A href="/Special:RecentChangesLinked/Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</A></LI><LI id="t-specialpages"><A href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</A></LI><LI><A href="/Special:Preferences">My preferences</A></LI></UL></DIV><DIV id="footer"><UL id="f-list"><LI id="t-print"><A href="/wiki/index.php?title=Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java&amp;printable=yes" title="Printable version of this page [p]" accesskey="p">Printable version</A></LI><LI id="t-permalink"><A href="/wiki/index.php?title=Team:Freiburg_software/Code/BioBrick_DAS_Feature_Handler.java&amp;oldid=161049" title="Permanent link to this revision of the page">Permanent link</A></LI><LI id="privacy"><A href="/2009.igem.org:Privacy_policy" title="2009.igem.org:Privacy policy">Privacy policy</A></LI><LI id="disclaimer"><A href="/2009.igem.org:General_disclaimer" title="2009.igem.org:General disclaimer">Disclaimers</A></LI></UL></DIV></DIV></DIV></BODY></HTML>