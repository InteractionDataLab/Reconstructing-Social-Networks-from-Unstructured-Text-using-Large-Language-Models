<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_Manchester_calendar-heatmap_min_js skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><DIV id="top_title"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:Manchester/calendar-heatmap.min.js</SPAN></H1></DIV><DIV id="HQ_page"><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><P>&quot;use strict&quot;;
var calendarHeatmap = {
</P><PRE>   settings: {
       gutter: 5,
       item_gutter: 1,
       width: 1e3,
       height: 200,
       item_size: 10,
       label_padding: 40,
       max_block_height: 20,
       transition_duration: 500,
       tooltip_width: 250,
       tooltip_padding: 15
   },
   init: function(a, e, t, n) {
       calendarHeatmap.data = a,
       calendarHeatmap.color = e || &quot;#ff4500&quot;,
       calendarHeatmap.overview = t || &quot;global&quot;,
       calendarHeatmap.history = [&quot;global&quot;],
       calendarHeatmap.selected = {},
       calendarHeatmap.handler = n,
       calendarHeatmap.in_transition = !1,
       calendarHeatmap.createElements(),
       calendarHeatmap.parseData(),
       calendarHeatmap.drawChart()
   },
   createElements: function() {
       var a = document.createElement(&quot;div&quot;);
       a.className = &quot;calendar-heatmap&quot;,
       document.body.appendChild(a);
       var e = d3.select(a).append(&quot;svg&quot;).attr(&quot;class&quot;, &quot;svg&quot;);
       calendarHeatmap.items = e.append(&quot;g&quot;),
       calendarHeatmap.labels = e.append(&quot;g&quot;),
       calendarHeatmap.buttons = e.append(&quot;g&quot;),
       calendarHeatmap.tooltip = d3.select(a).append(&quot;div&quot;).attr(&quot;class&quot;, &quot;heatmap-tooltip&quot;).style(&quot;opacity&quot;, 0);
       var t = function() {
           var t = Math.round((moment() - moment().subtract(1, &quot;year&quot;).startOf(&quot;week&quot;)) / 864e5)
             , n = Math.trunc(t / 7)
             , r = n + 1;
           calendarHeatmap.settings.width = a.offsetWidth &lt; 1e3 ? 1e3 : a.offsetWidth,
           calendarHeatmap.settings.item_size = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / r - calendarHeatmap.settings.gutter,
           calendarHeatmap.settings.height = calendarHeatmap.settings.label_padding + 7 * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter),
           e.attr({
               width: calendarHeatmap.settings.width,
               height: calendarHeatmap.settings.height
           }),
           calendarHeatmap.data &amp;&amp; calendarHeatmap.data[0].summary &amp;&amp; calendarHeatmap.drawChart()
       };
       t(),
       window.onresize = function(a) {
           t()
       }
   },
   parseData: function() {
       calendarHeatmap.data &amp;&amp; (calendarHeatmap.data[0].summary || calendarHeatmap.data.map(function(a) {
           var e = a.details.reduce(function(a, e) {
               return a[e.name] ? a[e.name].value += e.value : a[e.name] = {
                   value: e.value
               },
               a
           }, {})
             , t = Object.keys(e).map(function(a) {
               return {
                   name: a,
                   value: e[a].value
               }
           });
           return a.summary = t.sort(function(a, e) {
               return e.value - a.value
           }),
           a
       }))
   },
   drawChart: function() {
       &quot;global&quot; === calendarHeatmap.overview ? calendarHeatmap.drawGlobalOverview() : &quot;year&quot; === calendarHeatmap.overview ? calendarHeatmap.drawYearOverview() : &quot;month&quot; === calendarHeatmap.overview ? calendarHeatmap.drawMonthOverview() : &quot;week&quot; === calendarHeatmap.overview ? calendarHeatmap.drawWeekOverview() : &quot;day&quot; === calendarHeatmap.overview &amp;&amp; calendarHeatmap.drawDayOverview()
   },
   drawGlobalOverview: function() {
       calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview &amp;&amp; calendarHeatmap.history.push(calendarHeatmap.overview);
       var a = moment(calendarHeatmap.data[0].date).startOf(&quot;year&quot;)
         , e = moment(calendarHeatmap.data[calendarHeatmap.data.length - 1].date).endOf(&quot;year&quot;)
         , t = d3.time.years(a, e).map(function(a) {
           var e = moment(a);
           return {
               date: e,
               total: calendarHeatmap.data.reduce(function(a, t) {
                   return moment(t.date).year() === e.year() &amp;&amp; (a += t.total),
                   a
               }, 0),
               summary: function() {
                   var a = calendarHeatmap.data.reduce(function(a, t) {
                       if (moment(t.date).year() === e.year())
                           for (var n = 0; n &lt; t.summary.length; n++)
                               a[t.summary[n].name] ? a[t.summary[n].name].value += t.summary[n].value : a[t.summary[n].name] = {
                                   value: t.summary[n].value
                               };
                       return a
                   }, {})
                     , t = Object.keys(a).map(function(e) {
                       return {
                           name: e,
                           value: a[e].value
                       }
                   });
                   return t.sort(function(a, e) {
                       return e.value - a.value
                   })
               }()
           }
       })
         , n = d3.max(t, function(a) {
           return a.total
       })
         , r = d3.time.years(a, e).map(function(a) {
           return moment(a)
       })
         , i = d3.scale.ordinal().rangeRoundBands([0, calendarHeatmap.settings.width], .05).domain(r.map(function(a) {
           return a.year()
       }));
       calendarHeatmap.items.selectAll(&quot;.item-block-year&quot;).remove();
       calendarHeatmap.items.selectAll(&quot;.item-block-year&quot;).data(t).enter().append(&quot;rect&quot;).attr(&quot;class&quot;, &quot;item item-block-year&quot;).attr(&quot;width&quot;, function() {
           return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / r.length - 5 * calendarHeatmap.settings.gutter
       }).attr(&quot;height&quot;, function() {
           return calendarHeatmap.settings.height - calendarHeatmap.settings.label_padding
       }).attr(&quot;transform&quot;, function(a) {
           return &quot;translate(&quot; + i(a.date.year()) + &quot;,&quot; + 2 * calendarHeatmap.settings.tooltip_padding + &quot;)&quot;
       }).attr(&quot;fill&quot;, function(a) {
           var e = d3.scale.linear().range([&quot;#ffffff&quot;, calendarHeatmap.color || &quot;#ff4500&quot;]).domain([-.15 * n, n]);
           return e(a.total) || &quot;#ff4500&quot;
       }).on(&quot;click&quot;, function(a) {
           calendarHeatmap.in_transition || (calendarHeatmap.in_transition = !0,
           calendarHeatmap.selected = a,
           calendarHeatmap.hideTooltip(),
           calendarHeatmap.removeGlobalOverview(),
           calendarHeatmap.overview = &quot;year&quot;,
           calendarHeatmap.drawChart())
       }).style(&quot;opacity&quot;, 0).on(&quot;mouseover&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = &quot;&quot;;
</PRE>
                e += &quot;<DIV><SPAN><STRONG>Total time tracked:</STRONG></SPAN>&quot;;
<PRE>               var t = parseInt(a.total, 10)
                 , n = Math.floor(t / 86400);
</PRE>
                n &gt; 0 &amp;&amp; (e += &quot;<SPAN>&quot; + (1 === n ? &quot;1 day&quot; : n + &quot; days&quot;) + &quot;</SPAN></DIV>&quot;);
<PRE>               var r = Math.floor((t - 86400 * n) / 3600);
</PRE>
                r &gt; 0 &amp;&amp; (e += n &gt; 0 ? &quot;<DIV><SPAN>&quot; + (1 === r ? &quot;1 hour&quot; : r + &quot; hours&quot;) + &quot;</SPAN></DIV>&quot; : &quot;<SPAN>&quot; + (1 === r ? &quot;1 hour&quot; : r + &quot; hours&quot;) + &quot;</SPAN>&lt;/div&gt;&quot;);
<PRE>               var l = Math.floor((t - 86400 * n - 3600 * r) / 60);
</PRE>
                if (l &gt; 0 &amp;&amp; (e += n &gt; 0 || r &gt; 0 ? &quot;<DIV><SPAN>&quot; + (1 === l ? &quot;1 minute&quot; : l + &quot; minutes&quot;) + &quot;</SPAN></DIV>&quot; : &quot;<SPAN>&quot; + (1 === l ? &quot;1 minute&quot; : l + &quot; minutes&quot;) + &quot;</SPAN>&lt;/div&gt;&quot;),
<PRE>               e += &quot;&quot;,
               a.summary.length &lt;= 5)
                   for (var d = 0; d &lt; a.summary.length; d++)
</PRE>
                        e += &quot;<DIV><SPAN><STRONG>&quot; + a.summary[d].name + &quot;</STRONG></SPAN>&quot;,
                        e += &quot;<SPAN>&quot; + calendarHeatmap.formatTime(a.summary[d].value) + &quot;</SPAN></DIV>&quot;;
<PRE>               else {
                   for (var d = 0; d &lt; 5; d++)
</PRE>
                        e += &quot;<DIV><SPAN><STRONG>&quot; + a.summary[d].name + &quot;</STRONG></SPAN>&quot;,
                        e += &quot;<SPAN>&quot; + calendarHeatmap.formatTime(a.summary[d].value) + &quot;</SPAN></DIV>&quot;;
<PRE>                   e += &quot;&quot;;
                   for (var o = 0, d = 5; d &lt; a.summary.length; d++)
                       o = +a.summary[d].value;
</PRE>
                    e += &quot;<DIV><SPAN><STRONG>Other:</STRONG></SPAN>&quot;,
                    e += &quot;<SPAN>&quot; + calendarHeatmap.formatTime(o) + &quot;</SPAN></DIV>&quot;
<PRE>               }
               for (var s = i(a.date.year()) + 2 * calendarHeatmap.settings.tooltip_padding; calendarHeatmap.settings.width - s &lt; calendarHeatmap.settings.tooltip_width + 5 * calendarHeatmap.settings.tooltip_padding; )
                   s -= 10;
               var m = 3 * calendarHeatmap.settings.tooltip_padding;
               calendarHeatmap.tooltip.html(e).style(&quot;left&quot;, s + &quot;px&quot;).style(&quot;top&quot;, m + &quot;px&quot;).transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.hideTooltip()
       }).transition().delay(function(a, e) {
           return calendarHeatmap.settings.transition_duration * (e + 1) / 10
       }).duration(function() {
           return calendarHeatmap.settings.transition_duration
       }).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1).call(function(a, e) {
           a.empty() &amp;&amp; e();
           var t = 0;
           a.each(function() {
               ++t
           }).each(&quot;end&quot;, function() {
               --t || e.apply(this, arguments)
           })
       }, function() {
           calendarHeatmap.in_transition = !1
       });
       calendarHeatmap.labels.selectAll(&quot;.label-year&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-year&quot;).data(r).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-year&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return a.year()
       }).attr(&quot;x&quot;, function(a) {
           return i(a.year())
       }).attr(&quot;y&quot;, calendarHeatmap.settings.label_padding / 2).on(&quot;mouseenter&quot;, function(a) {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-year&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(e) {
               return moment(e.date).year() === a.year() ? 1 : .1
           })
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-year&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
       }).on(&quot;click&quot;, function(a) {
           calendarHeatmap.in_transition || (calendarHeatmap.in_transition = !0,
           calendarHeatmap.selected = a,
           calendarHeatmap.hideTooltip(),
           calendarHeatmap.removeGlobalOverview(),
           calendarHeatmap.overview = &quot;year&quot;,
           calendarHeatmap.drawChart())
       })
   },
   drawYearOverview: function() {
       calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview &amp;&amp; calendarHeatmap.history.push(calendarHeatmap.overview);
       var a = moment(calendarHeatmap.selected.date).startOf(&quot;year&quot;)
         , e = moment(calendarHeatmap.selected.date).endOf(&quot;year&quot;)
         , t = calendarHeatmap.data.filter(function(t) {
           return a &lt;= moment(t.date) &amp;&amp; moment(t.date) &lt; e
       })
         , n = d3.max(t, function(a) {
           return a.total
       })
         , r = d3.scale.linear().range([&quot;#ffffff&quot;, calendarHeatmap.color || &quot;#ff4500&quot;]).domain([-.15 * n, n])
         , i = function(e) {
           var t = moment(e.date)
             , n = Math.round((t - moment(a).startOf(&quot;week&quot;)) / 864e5)
             , r = Math.trunc(n / 7);
           return r * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter) + calendarHeatmap.settings.label_padding
       }
         , l = function(a) {
           return calendarHeatmap.settings.label_padding + moment(a.date).weekday() * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter)
       }
         , d = function(a) {
           return n &lt;= 0 ? calendarHeatmap.settings.item_size : .75 * calendarHeatmap.settings.item_size + calendarHeatmap.settings.item_size * a.total / n * .25
       };
       calendarHeatmap.items.selectAll(&quot;.item-circle&quot;).remove(),
       calendarHeatmap.items.selectAll(&quot;.item-circle&quot;).data(t).enter().append(&quot;rect&quot;).attr(&quot;class&quot;, &quot;item item-circle&quot;).style(&quot;opacity&quot;, 0).attr(&quot;x&quot;, function(a) {
           return i(a) + (calendarHeatmap.settings.item_size - d(a)) / 2
       }).attr(&quot;y&quot;, function(a) {
           return l(a) + (calendarHeatmap.settings.item_size - d(a)) / 2
       }).attr(&quot;rx&quot;, function(a) {
           return d(a)
       }).attr(&quot;ry&quot;, function(a) {
           return d(a)
       }).attr(&quot;width&quot;, function(a) {
           return d(a)
       }).attr(&quot;height&quot;, function(a) {
           return d(a)
       }).attr(&quot;fill&quot;, function(a) {
           return a.total &gt; 0 ? r(a.total) : &quot;transparent&quot;
       }).on(&quot;click&quot;, function(a) {
           calendarHeatmap.in_transition || 0 !== a.total &amp;&amp; (calendarHeatmap.in_transition = !0,
           calendarHeatmap.selected = a,
           calendarHeatmap.hideTooltip(),
           calendarHeatmap.removeYearOverview(),
           calendarHeatmap.overview = &quot;day&quot;,
           calendarHeatmap.drawChart())
       }).on(&quot;mouseover&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = d3.select(this);
               !function s() {
                   e = e.transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).attr(&quot;x&quot;, function(a) {
                       return i(a) - (1.1 * calendarHeatmap.settings.item_size - calendarHeatmap.settings.item_size) / 2
                   }).attr(&quot;y&quot;, function(a) {
                       return l(a) - (1.1 * calendarHeatmap.settings.item_size - calendarHeatmap.settings.item_size) / 2
                   }).attr(&quot;width&quot;, 1.1 * calendarHeatmap.settings.item_size).attr(&quot;height&quot;, 1.1 * calendarHeatmap.settings.item_size).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).attr(&quot;x&quot;, function(a) {
                       return i(a) + (calendarHeatmap.settings.item_size - d(a)) / 2
                   }).attr(&quot;y&quot;, function(a) {
                       return l(a) + (calendarHeatmap.settings.item_size - d(a)) / 2
                   }).attr(&quot;width&quot;, function(a) {
                       return d(a)
                   }).attr(&quot;height&quot;, function(a) {
                       return d(a)
                   }).each(&quot;end&quot;, s)
               }();
               var t = &quot;&quot;;
</PRE>
                t += '<DIV class="header"><STRONG>' + (a.total ? calendarHeatmap.formatTime(a.total) : &quot;No time&quot;) + &quot; tracked</STRONG></DIV>&quot;,
                t += &quot;<DIV>on &quot; + moment(a.date).format(&quot;dddd, MMM Do YYYY&quot;) + &quot;</DIV>&quot;;
<PRE>               for (var n = 0; n &lt; a.summary.length; n++)
</PRE>
                    t += &quot;<DIV><SPAN><STRONG>&quot; + a.summary[n].name + &quot;</STRONG></SPAN>&quot;,
                    t += &quot;<SPAN>&quot; + calendarHeatmap.formatTime(a.summary[n].value) + &quot;</SPAN></DIV>&quot;;
<PRE>               var r = i(a) + calendarHeatmap.settings.item_size;
               calendarHeatmap.settings.width - r &lt; calendarHeatmap.settings.tooltip_width + 3 * calendarHeatmap.settings.tooltip_padding &amp;&amp; (r -= calendarHeatmap.settings.tooltip_width + 2 * calendarHeatmap.settings.tooltip_padding);
               var o = l(a) + calendarHeatmap.settings.item_size;
               calendarHeatmap.tooltip.html(t).style(&quot;left&quot;, r + &quot;px&quot;).style(&quot;top&quot;, o + &quot;px&quot;).transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || (d3.select(this).transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(&quot;ease-in&quot;).attr(&quot;x&quot;, function(a) {
               return i(a) + (calendarHeatmap.settings.item_size - d(a)) / 2
           }).attr(&quot;y&quot;, function(a) {
               return l(a) + (calendarHeatmap.settings.item_size - d(a)) / 2
           }).attr(&quot;width&quot;, function(a) {
               return d(a)
           }).attr(&quot;height&quot;, function(a) {
               return d(a)
           }),
           calendarHeatmap.hideTooltip())
       }).transition().delay(function() {
           return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration
       }).duration(function() {
           return calendarHeatmap.settings.transition_duration
       }).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1).call(function(a, e) {
           a.empty() &amp;&amp; e();
           var t = 0;
           a.each(function() {
               ++t
           }).each(&quot;end&quot;, function() {
               --t || e.apply(this, arguments)
           })
       }, function() {
           calendarHeatmap.in_transition = !1
       });
       var o = d3.time.months(a, e)
         , s = d3.scale.linear().range([0, calendarHeatmap.settings.width]).domain([0, o.length]);
       calendarHeatmap.labels.selectAll(&quot;.label-month&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-month&quot;).data(o).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-month&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return a.toLocaleDateString(&quot;en-us&quot;, {
               month: &quot;short&quot;
           })
       }).attr(&quot;x&quot;, function(a, e) {
           return s(e) + (s(e) - s(e - 1)) / 2
       }).attr(&quot;y&quot;, calendarHeatmap.settings.label_padding / 2).on(&quot;mouseenter&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = moment(a);
               calendarHeatmap.items.selectAll(&quot;.item-circle&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(a) {
                   return moment(a.date).isSame(e, &quot;month&quot;) ? 1 : .1
               })
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-circle&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
       }).on(&quot;click&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = calendarHeatmap.data.filter(function(e) {
                   return moment(a).startOf(&quot;month&quot;) &lt;= moment(e.date) &amp;&amp; moment(e.date) &lt; moment(a).endOf(&quot;month&quot;)
               });
               e.length &amp;&amp; (calendarHeatmap.selected = {
                   date: a
               },
               calendarHeatmap.in_transition = !0,
               calendarHeatmap.hideTooltip(),
               calendarHeatmap.removeYearOverview(),
               calendarHeatmap.overview = &quot;month&quot;,
               calendarHeatmap.drawChart())
           }
       });
       var m = d3.time.days(moment().startOf(&quot;week&quot;), moment().endOf(&quot;week&quot;))
         , c = d3.scale.ordinal().rangeRoundBands([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(m.map(function(a) {
           return moment(a).weekday()
       }));
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).data(m).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-day&quot;).attr(&quot;x&quot;, calendarHeatmap.settings.label_padding / 3).attr(&quot;y&quot;, function(a, e) {
           return c(e) + c.rangeBand() / 1.75
       }).style(&quot;text-anchor&quot;, &quot;left&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return moment(a).format(&quot;dddd&quot;)[0]
       }).on(&quot;mouseenter&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = moment(a);
               calendarHeatmap.items.selectAll(&quot;.item-circle&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(a) {
                   return moment(a.date).day() === e.day() ? 1 : .1
               })
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-circle&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
       }),
       calendarHeatmap.drawButton()
   },
   drawMonthOverview: function() {
       calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview &amp;&amp; calendarHeatmap.history.push(calendarHeatmap.overview);
       for (var a = moment(calendarHeatmap.selected.date).startOf(&quot;month&quot;), e = moment(calendarHeatmap.selected.date).endOf(&quot;month&quot;), t = calendarHeatmap.data.filter(function(t) {
           return a &lt;= moment(t.date) &amp;&amp; moment(t.date) &lt; e
       }), n = d3.max(t, function(a) {
           return d3.max(a.summary, function(a) {
               return a.value
           })
       }), r = d3.time.days(moment().startOf(&quot;week&quot;), moment().endOf(&quot;week&quot;)), i = d3.scale.ordinal().rangeRoundBands([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(r.map(function(a) {
           return moment(a).weekday()
       })), l = [a.clone()]; a.week() !== e.week(); )
           l.push(a.add(1, &quot;week&quot;).clone());
       var d = d3.scale.ordinal().rangeRoundBands([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width], .05).domain(l.map(function(a) {
           return a.week()
       }));
       calendarHeatmap.items.selectAll(&quot;.item-block-month&quot;).remove();
       var o = calendarHeatmap.items.selectAll(&quot;.item-block-month&quot;).data(t).enter().append(&quot;g&quot;).attr(&quot;class&quot;, &quot;item item-block-month&quot;).attr(&quot;width&quot;, function() {
           return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / l.length - 5 * calendarHeatmap.settings.gutter
       }).attr(&quot;height&quot;, function() {
           return Math.min(i.rangeBand(), calendarHeatmap.settings.max_block_height)
       }).attr(&quot;transform&quot;, function(a) {
           return &quot;translate(&quot; + d(moment(a.date).week()) + &quot;,&quot; + (i(moment(a.date).weekday()) + i.rangeBand() / 1.75 - 15) + &quot;)&quot;
       }).attr(&quot;total&quot;, function(a) {
           return a.total
       }).attr(&quot;date&quot;, function(a) {
           return a.date
       }).attr(&quot;offset&quot;, 0).on(&quot;click&quot;, function(a) {
           calendarHeatmap.in_transition || 0 !== a.total &amp;&amp; (calendarHeatmap.in_transition = !0,
           calendarHeatmap.selected = a,
           calendarHeatmap.hideTooltip(),
           calendarHeatmap.removeMonthOverview(),
           calendarHeatmap.overview = &quot;day&quot;,
           calendarHeatmap.drawChart())
       })
         , s = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / l.length - 5 * calendarHeatmap.settings.gutter
         , m = d3.scale.linear().rangeRound([0, s]);
       o.selectAll(&quot;.item-block-rect&quot;).data(function(a) {
           return a.summary
       }).enter().append(&quot;rect&quot;).attr(&quot;class&quot;, &quot;item item-block-rect&quot;).attr(&quot;x&quot;, function(a) {
           var e = parseInt(d3.select(this.parentNode).attr(&quot;total&quot;))
             , t = parseInt(d3.select(this.parentNode).attr(&quot;offset&quot;));
           return m.domain([0, e]),
           d3.select(this.parentNode).attr(&quot;offset&quot;, t + m(a.value)),
           t
       }).attr(&quot;width&quot;, function(a) {
           var e = parseInt(d3.select(this.parentNode).attr(&quot;total&quot;));
           return m.domain([0, e]),
           Math.max(m(a.value) - calendarHeatmap.settings.item_gutter, 1)
       }).attr(&quot;height&quot;, function() {
           return Math.min(i.rangeBand(), calendarHeatmap.settings.max_block_height)
       }).attr(&quot;fill&quot;, function(a) {
           var e = d3.scale.linear().range([&quot;#ffffff&quot;, calendarHeatmap.color || &quot;#ff4500&quot;]).domain([-.15 * n, n]);
           return e(a.value) || &quot;#ff4500&quot;
       }).style(&quot;opacity&quot;, 0).on(&quot;mouseover&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = new Date(d3.select(this.parentNode).attr(&quot;date&quot;))
                 , t = &quot;&quot;;
</PRE>
                t += '<DIV class="header"><STRONG>' + a.name + &quot;</STRONG></DIV>&quot;,
                t += &quot;<DIV><STRONG>&quot; + (a.value ? calendarHeatmap.formatTime(a.value) : &quot;No time&quot;) + &quot; tracked</STRONG></DIV>&quot;,
                t += &quot;<DIV>on &quot; + moment(e).format(&quot;dddd, MMM Do YYYY&quot;) + &quot;</DIV>&quot;;
<PRE>               for (var n = d(moment(e).week()) + calendarHeatmap.settings.tooltip_padding; calendarHeatmap.settings.width - n &lt; calendarHeatmap.settings.tooltip_width + 3 * calendarHeatmap.settings.tooltip_padding; )
                   n -= 10;
               var r = i(moment(e).weekday()) + 2 * calendarHeatmap.settings.tooltip_padding;
               calendarHeatmap.tooltip.html(t).style(&quot;left&quot;, n + &quot;px&quot;).style(&quot;top&quot;, r + &quot;px&quot;).transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.hideTooltip()
       }).transition().delay(function() {
           return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration
       }).duration(function() {
           return calendarHeatmap.settings.transition_duration
       }).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1).call(function(a, e) {
           a.empty() &amp;&amp; e();
           var t = 0;
           a.each(function() {
               ++t
           }).each(&quot;end&quot;, function() {
               --t || e.apply(this, arguments)
           })
       }, function() {
           calendarHeatmap.in_transition = !1
       }),
       calendarHeatmap.labels.selectAll(&quot;.label-week&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-week&quot;).data(l).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-week&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return &quot;Week &quot; + a.week()
       }).attr(&quot;x&quot;, function(a) {
           return d(a.week())
       }).attr(&quot;y&quot;, calendarHeatmap.settings.label_padding / 2).on(&quot;mouseenter&quot;, function(a) {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-month&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(e) {
               return moment(e.date).week() === a.week() ? 1 : .1
           })
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-month&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
       }).on(&quot;click&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = calendarHeatmap.data.filter(function(e) {
                   return a.startOf(&quot;week&quot;) &lt;= moment(e.date) &amp;&amp; moment(e.date) &lt; a.endOf(&quot;week&quot;)
               });
               e.length &amp;&amp; (calendarHeatmap.in_transition = !0,
               calendarHeatmap.selected = {
                   date: a
               },
               calendarHeatmap.hideTooltip(),
               calendarHeatmap.removeMonthOverview(),
               calendarHeatmap.overview = &quot;week&quot;,
               calendarHeatmap.drawChart())
           }
       }),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).data(r).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-day&quot;).attr(&quot;x&quot;, calendarHeatmap.settings.label_padding / 3).attr(&quot;y&quot;, function(a, e) {
           return i(e) + i.rangeBand() / 1.75
       }).style(&quot;text-anchor&quot;, &quot;left&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return moment(a).format(&quot;dddd&quot;)[0]
       }).on(&quot;mouseenter&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = moment(a);
               calendarHeatmap.items.selectAll(&quot;.item-block-month&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(a) {
                   return moment(a.date).day() === e.day() ? 1 : .1
               })
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-month&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
       }),
       calendarHeatmap.drawButton()
   },
   drawWeekOverview: function() {
       calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview &amp;&amp; calendarHeatmap.history.push(calendarHeatmap.overview);
       var a = moment(calendarHeatmap.selected.date).startOf(&quot;week&quot;)
         , e = moment(calendarHeatmap.selected.date).endOf(&quot;week&quot;)
         , t = calendarHeatmap.data.filter(function(t) {
           return a &lt;= moment(t.date) &amp;&amp; moment(t.date) &lt; e
       })
         , n = d3.max(t, function(a) {
           return d3.max(a.summary, function(a) {
               return a.value
           })
       })
         , r = d3.time.days(moment().startOf(&quot;week&quot;), moment().endOf(&quot;week&quot;))
         , i = d3.scale.ordinal().rangeRoundBands([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(r.map(function(a) {
           return moment(a).weekday()
       }))
         , l = [a]
         , d = d3.scale.ordinal().rangeRoundBands([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width], .01).domain(l.map(function(a) {
           return a.week()
       }));
       calendarHeatmap.items.selectAll(&quot;.item-block-week&quot;).remove();
       var o = calendarHeatmap.items.selectAll(&quot;.item-block-week&quot;).data(t).enter().append(&quot;g&quot;).attr(&quot;class&quot;, &quot;item item-block-week&quot;).attr(&quot;width&quot;, function() {
           return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / l.length - 5 * calendarHeatmap.settings.gutter
       }).attr(&quot;height&quot;, function() {
           return Math.min(i.rangeBand(), calendarHeatmap.settings.max_block_height)
       }).attr(&quot;transform&quot;, function(a) {
           return &quot;translate(&quot; + d(moment(a.date).week()) + &quot;,&quot; + (i(moment(a.date).weekday()) + i.rangeBand() / 1.75 - 15) + &quot;)&quot;
       }).attr(&quot;total&quot;, function(a) {
           return a.total
       }).attr(&quot;date&quot;, function(a) {
           return a.date
       }).attr(&quot;offset&quot;, 0).on(&quot;click&quot;, function(a) {
           calendarHeatmap.in_transition || 0 !== a.total &amp;&amp; (calendarHeatmap.in_transition = !0,
           calendarHeatmap.selected = a,
           calendarHeatmap.hideTooltip(),
           calendarHeatmap.removeWeekOverview(),
           calendarHeatmap.overview = &quot;day&quot;,
           calendarHeatmap.drawChart())
       })
         , s = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / l.length - 5 * calendarHeatmap.settings.gutter
         , m = d3.scale.linear().rangeRound([0, s]);
       o.selectAll(&quot;.item-block-rect&quot;).data(function(a) {
           return a.summary
       }).enter().append(&quot;rect&quot;).attr(&quot;class&quot;, &quot;item item-block-rect&quot;).attr(&quot;x&quot;, function(a) {
           var e = parseInt(d3.select(this.parentNode).attr(&quot;total&quot;))
             , t = parseInt(d3.select(this.parentNode).attr(&quot;offset&quot;));
           return m.domain([0, e]),
           d3.select(this.parentNode).attr(&quot;offset&quot;, t + m(a.value)),
           t
       }).attr(&quot;width&quot;, function(a) {
           var e = parseInt(d3.select(this.parentNode).attr(&quot;total&quot;));
           return m.domain([0, e]),
           Math.max(m(a.value) - calendarHeatmap.settings.item_gutter, 1)
       }).attr(&quot;height&quot;, function() {
           return Math.min(i.rangeBand(), calendarHeatmap.settings.max_block_height)
       }).attr(&quot;fill&quot;, function(a) {
           var e = d3.scale.linear().range([&quot;#ffffff&quot;, calendarHeatmap.color || &quot;#ff4500&quot;]).domain([-.15 * n, n]);
           return e(a.value) || &quot;#ff4500&quot;
       }).style(&quot;opacity&quot;, 0).on(&quot;mouseover&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = new Date(d3.select(this.parentNode).attr(&quot;date&quot;))
                 , t = &quot;&quot;;
</PRE>
                t += '<DIV class="header"><STRONG>' + a.name + &quot;</STRONG></DIV>&quot;,
                t += &quot;<DIV><STRONG>&quot; + (a.value ? calendarHeatmap.formatTime(a.value) : &quot;No time&quot;) + &quot; tracked</STRONG></DIV>&quot;,
                t += &quot;<DIV>on &quot; + moment(e).format(&quot;dddd, MMM Do YYYY&quot;) + &quot;</DIV>&quot;;
<PRE>               var n = parseInt(d3.select(this.parentNode).attr(&quot;total&quot;));
               m.domain([0, n]);
               for (var r = parseInt(d3.select(this).attr(&quot;x&quot;)) + m(a.value) / 4 + calendarHeatmap.settings.tooltip_width / 4; calendarHeatmap.settings.width - r &lt; calendarHeatmap.settings.tooltip_width + 3 * calendarHeatmap.settings.tooltip_padding; )
                   r -= 10;
               var l = i(moment(e).weekday()) + 1.5 * calendarHeatmap.settings.tooltip_padding;
               calendarHeatmap.tooltip.html(t).style(&quot;left&quot;, r + &quot;px&quot;).style(&quot;top&quot;, l + &quot;px&quot;).transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.hideTooltip()
       }).transition().delay(function() {
           return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration
       }).duration(function() {
           return calendarHeatmap.settings.transition_duration
       }).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1).call(function(a, e) {
           a.empty() &amp;&amp; e();
           var t = 0;
           a.each(function() {
               ++t
           }).each(&quot;end&quot;, function() {
               --t || e.apply(this, arguments)
           })
       }, function() {
           calendarHeatmap.in_transition = !1
       }),
       calendarHeatmap.labels.selectAll(&quot;.label-week&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-week&quot;).data(l).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-week&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return &quot;Week &quot; + a.week()
       }).attr(&quot;x&quot;, function(a) {
           return d(a.week())
       }).attr(&quot;y&quot;, calendarHeatmap.settings.label_padding / 2).on(&quot;mouseenter&quot;, function(a) {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-week&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(e) {
               return moment(e.date).week() === a.week() ? 1 : .1
           })
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-week&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
       }),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).data(r).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-day&quot;).attr(&quot;x&quot;, calendarHeatmap.settings.label_padding / 3).attr(&quot;y&quot;, function(a, e) {
           return i(e) + i.rangeBand() / 1.75
       }).style(&quot;text-anchor&quot;, &quot;left&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return moment(a).format(&quot;dddd&quot;)[0]
       }).on(&quot;mouseenter&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = moment(a);
               calendarHeatmap.items.selectAll(&quot;.item-block-week&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(a) {
                   return moment(a.date).day() === e.day() ? 1 : .1
               })
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block-week&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
       }),
       calendarHeatmap.drawButton()
   },
   drawDayOverview: function() {
       calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview &amp;&amp; calendarHeatmap.history.push(calendarHeatmap.overview),
       Object.keys(calendarHeatmap.selected).length || (calendarHeatmap.selected = calendarHeatmap.data[calendarHeatmap.data.length - 1]);
       var a = calendarHeatmap.selected.summary.map(function(a) {
           return a.name
       })
         , e = d3.scale.ordinal().rangeRoundBands([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(a)
         , t = d3.time.scale().range([2 * calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width]).domain([moment(calendarHeatmap.selected.date).startOf(&quot;day&quot;), moment(calendarHeatmap.selected.date).endOf(&quot;day&quot;)]);
       calendarHeatmap.items.selectAll(&quot;.item-block&quot;).remove(),
       calendarHeatmap.items.selectAll(&quot;.item-block&quot;).data(calendarHeatmap.selected.details).enter().append(&quot;rect&quot;).attr(&quot;class&quot;, &quot;item item-block&quot;).attr(&quot;x&quot;, function(a) {
           return t(moment(a.date))
       }).attr(&quot;y&quot;, function(a) {
           return e(a.name) + e.rangeBand() / 2 - 15
       }).attr(&quot;width&quot;, function(a) {
           var e = t(d3.time.second.offset(moment(a.date), a.value));
           return Math.max(e - t(moment(a.date)), 1)
       }).attr(&quot;height&quot;, function() {
           return Math.min(e.rangeBand(), calendarHeatmap.settings.max_block_height)
       }).attr(&quot;fill&quot;, function() {
           return calendarHeatmap.color || &quot;#ff4500&quot;
       }).style(&quot;opacity&quot;, 0).on(&quot;mouseover&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var n = &quot;&quot;;
</PRE>
                n += '<DIV class="header"><STRONG>' + a.name + &quot;</STRONG><DIV>&quot;,
                n += &quot;<DIV><STRONG>&quot; + (a.value ? calendarHeatmap.formatTime(a.value) : &quot;No time&quot;) + &quot; tracked</STRONG></DIV>&quot;,
                n += &quot;<DIV>on &quot; + moment(a.date).format(&quot;dddd, MMM Do YYYY HH:mm&quot;) + &quot;</DIV>&quot;;
<PRE>               for (var r = 100 * a.value / 86400 + t(moment(a.date)); calendarHeatmap.settings.width - r &lt; calendarHeatmap.settings.tooltip_width + 3 * calendarHeatmap.settings.tooltip_padding; )
                   r -= 10;
               var i = e(a.name) + e.rangeBand() / 2 + calendarHeatmap.settings.tooltip_padding / 2;
               calendarHeatmap.tooltip.html(n).style(&quot;left&quot;, r + &quot;px&quot;).style(&quot;top&quot;, i + &quot;px&quot;).transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.hideTooltip()
       }).on(&quot;click&quot;, function(a) {
           calendarHeatmap.handler &amp;&amp; &quot;function&quot; == typeof calendarHeatmap.handler &amp;&amp; calendarHeatmap.handler(a)
       }).transition().delay(function() {
           return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration
       }).duration(function() {
           return calendarHeatmap.settings.transition_duration
       }).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, .5).call(function(a, e) {
           a.empty() &amp;&amp; e();
           var t = 0;
           a.each(function() {
               ++t
           }).each(&quot;end&quot;, function() {
               --t || e.apply(this, arguments)
           })
       }, function() {
           calendarHeatmap.in_transition = !1
       });
       var n = d3.time.hours(moment(calendarHeatmap.selected.date).startOf(&quot;day&quot;), moment(calendarHeatmap.selected.date).endOf(&quot;day&quot;))
         , r = d3.time.scale().range([2 * calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width]).domain([0, n.length]);
       calendarHeatmap.labels.selectAll(&quot;.label-time&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-time&quot;).data(n).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-time&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return moment(a).format(&quot;HH:mm&quot;)
       }).attr(&quot;x&quot;, function(a, e) {
           return r(e)
       }).attr(&quot;y&quot;, calendarHeatmap.settings.label_padding / 2).on(&quot;mouseenter&quot;, function(a) {
           if (!calendarHeatmap.in_transition) {
               var e = t(moment(a));
               calendarHeatmap.items.selectAll(&quot;.item-block&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(a) {
                   var n = t(moment(a.date))
                     , r = t(moment(a.date).add(a.value, &quot;seconds&quot;));
                   return e &gt;= n &amp;&amp; e &lt;= r ? 1 : .1
               })
           }
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, .5)
       }),
       calendarHeatmap.labels.selectAll(&quot;.label-project&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-project&quot;).data(a).enter().append(&quot;text&quot;).attr(&quot;class&quot;, &quot;label label-project&quot;).attr(&quot;x&quot;, calendarHeatmap.settings.gutter).attr(&quot;y&quot;, function(a) {
           return e(a) + e.rangeBand() / 2
       }).attr(&quot;min-height&quot;, function() {
           return e.rangeBand()
       }).style(&quot;text-anchor&quot;, &quot;left&quot;).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).text(function(a) {
           return a
       }).each(function() {
           for (var a = d3.select(this), e = a.node().getComputedTextLength(), t = a.text(); e &gt; 1.5 * calendarHeatmap.settings.label_padding &amp;&amp; t.length &gt; 0; )
               t = t.slice(0, -1),
               a.text(t + &quot;...&quot;),
               e = a.node().getComputedTextLength()
       }).on(&quot;mouseenter&quot;, function(a) {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, function(e) {
               return e.name === a ? 1 : .1
           })
       }).on(&quot;mouseout&quot;, function() {
           calendarHeatmap.in_transition || calendarHeatmap.items.selectAll(&quot;.item-block&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, .5)
       }),
       calendarHeatmap.drawButton()
   },
   drawButton: function() {
       calendarHeatmap.buttons.selectAll(&quot;.button&quot;).remove();
       var a = calendarHeatmap.buttons.append(&quot;g&quot;).attr(&quot;class&quot;, &quot;button button-back&quot;).style(&quot;opacity&quot;, 0).on(&quot;click&quot;, function() {
           calendarHeatmap.in_transition || (calendarHeatmap.in_transition = !0,
           &quot;year&quot; === calendarHeatmap.overview ? calendarHeatmap.removeYearOverview() : &quot;month&quot; === calendarHeatmap.overview ? calendarHeatmap.removeMonthOverview() : &quot;week&quot; === calendarHeatmap.overview ? calendarHeatmap.removeWeekOverview() : &quot;day&quot; === calendarHeatmap.overview &amp;&amp; calendarHeatmap.removeDayOverview(),
           calendarHeatmap.history.pop(),
           calendarHeatmap.overview = calendarHeatmap.history.pop(),
           calendarHeatmap.drawChart())
       });
       a.append(&quot;circle&quot;).attr(&quot;cx&quot;, calendarHeatmap.settings.label_padding / 2.25).attr(&quot;cy&quot;, calendarHeatmap.settings.label_padding / 2.5).attr(&quot;r&quot;, calendarHeatmap.settings.item_size / 2),
       a.append(&quot;text&quot;).attr(&quot;x&quot;, calendarHeatmap.settings.label_padding / 2.25).attr(&quot;y&quot;, calendarHeatmap.settings.label_padding / 2.5).attr(&quot;dy&quot;, function() {
           return Math.floor(calendarHeatmap.settings.width / 100) / 3
       }).attr(&quot;font-size&quot;, function() {
           return Math.floor(calendarHeatmap.settings.label_padding / 3) + &quot;px&quot;
       }).html(&quot;←&quot;),
       a.transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 1)
   },
   removeGlobalOverview: function() {
       calendarHeatmap.items.selectAll(&quot;.item-block-year&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-out&quot;).style(&quot;opacity&quot;, 0).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-year&quot;).remove()
   },
   removeYearOverview: function() {
       calendarHeatmap.items.selectAll(&quot;.item-circle&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease&quot;).style(&quot;opacity&quot;, 0).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-month&quot;).remove(),
       calendarHeatmap.hideBackButton()
   },
   removeMonthOverview: function() {
       calendarHeatmap.items.selectAll(&quot;.item-block-month&quot;).selectAll(&quot;.item-block-rect&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 0).attr(&quot;x&quot;, function(a, e) {
           return e % 2 === 0 ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3
       }).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-week&quot;).remove(),
       calendarHeatmap.hideBackButton()
   },
   removeWeekOverview: function() {
       calendarHeatmap.items.selectAll(&quot;.item-block-week&quot;).selectAll(&quot;.item-block-rect&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 0).attr(&quot;x&quot;, function(a, e) {
           return e % 2 === 0 ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3
       }).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-day&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-week&quot;).remove(),
       calendarHeatmap.hideBackButton()
   },
   removeDayOverview: function() {
       calendarHeatmap.items.selectAll(&quot;.item-block&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 0).attr(&quot;x&quot;, function(a, e) {
           return e % 2 === 0 ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3
       }).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-time&quot;).remove(),
       calendarHeatmap.labels.selectAll(&quot;.label-project&quot;).remove(),
       calendarHeatmap.hideBackButton()
   },
   hideTooltip: function() {
       calendarHeatmap.tooltip.transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(&quot;ease-in&quot;).style(&quot;opacity&quot;, 0)
   },
   hideBackButton: function() {
       calendarHeatmap.buttons.selectAll(&quot;.button&quot;).transition().duration(calendarHeatmap.settings.transition_duration).ease(&quot;ease&quot;).style(&quot;opacity&quot;, 0).remove()
   },
   formatTime: function(a) {
       var e = Math.floor(a / 3600)
         , t = Math.floor((a - 3600 * e) / 60)
         , n = &quot;&quot;;
       return e &gt; 0 &amp;&amp; (n += 1 === e ? &quot;1 hour &quot; : e + &quot; hours &quot;),
       t &gt; 0 &amp;&amp; (n += 1 === t ? &quot;1 minute&quot; : t + &quot; minutes&quot;),
       0 === e &amp;&amp; 0 === t &amp;&amp; (n = Math.round(a) + &quot; seconds&quot;),
       n
   }
</PRE>
};</DIV></DIV></DIV></DIV></DIV></DIV></DIV></BODY></HTML>