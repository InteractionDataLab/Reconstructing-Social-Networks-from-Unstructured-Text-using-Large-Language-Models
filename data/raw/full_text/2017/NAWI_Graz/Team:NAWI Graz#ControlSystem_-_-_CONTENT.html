<HTML lang="en" dir="ltr" class="client-nojs">
<style type="text/css">
A:before { content:' '; } 
A:after { content:' '; } 
SPAN:before { content:' '; } 
SPAN:after { content:' '; } 
</style>
<BODY class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Team_NAWI_Graz_ControlSystem skin-igem action-view"><DIV id="globalWrapper"><DIV id="content" class="mw-body" role="main"><DIV id="top_title"><H1 id="firstHeading" class="firstHeading"><SPAN dir="auto">Team:NAWI Graz/ControlSystem</SPAN></H1></DIV><DIV id="HQ_page"><DIV id="bodyContent"><DIV id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><DIV class="menu-navbar"><NAV class="navbar navbar-expand-lg navbar-light bg-light"><DIV class="collapse navbar-collapse" id="navbarNavDropdown"><UL class="navbar-nav ml-auto"><LI class="nav-item dropdown"><DIV class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink"><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Description">Description</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Design">Design</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Demonstrate">Demonstrate</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Model">Model</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Application">Application</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Results">Results</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/InterLab">InterLab Measurement Study</A></DIV></LI><LI class="nav-item dropdown"><A class="nav-link dropdown-toggle" role="button" href="https://2017.igem.org/Team:NAWI_Graz/Hardware" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Components
                </A><DIV class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink"><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Hardware"><SPAN class="top-menu">Parts</SPAN></A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Arena">Arena</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Bioreactor">Bioreactor</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Robot">Robot</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/ControlSystem">Control System</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/TemperatureModule">Temperature Interaction Module</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/TemperaturePlasmid">Temperature Plasmid</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/phInteractionModule">pH Interaction Module</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/pHPlasmid">pH Plasmid</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/FlourescenceChamber">Flourescence Measurement Chamber</A></DIV></LI><LI class="nav-item dropdown"><A class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Team
                </A><DIV class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink"><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Team">NAWI_Graz 2017</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Collaborations">Collaborations</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Attributions">Attributions</A></DIV></LI><LI class="nav-item dropdown"><A class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Lab Book
                </A><DIV class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink"><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Notebook">Notebook</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/WP">Working Protocols</A></DIV></LI><LI class="nav-item dropdown"><A class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Human Practices
                </A><DIV class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink"><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/HP/Silver">Public Engagement</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/HP/Gold">Integrated Human Practices</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Discussions">Discussions</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Education">Education</A><A class="dropdown-item" href="https://2017.igem.org/Team:NAWI_Graz/Interviews">Interviews</A></DIV></LI><LI class="nav-item"><A class="nav-link" href="https://2017.igem.org/Team:NAWI_Graz/Safety">Safety</A></LI></UL><UL class="navbar-nav ml-auto"><LI class="nav-item"><A class="nav-link" href="https://igem.org/2017_Judging_Form?team=NAWI_Graz">Judging Form</A></LI></UL></DIV></NAV></DIV><BUTTON onclick="topFunction()" id="topBtn" class="btn-info" title="Go to top">Go to Top</BUTTON><DIV class="jumbotron"><DIV class="section section-heading container"><H1>CONTROL SYSTEM</H1></DIV><DIV class="section-text container">
        The integration of the living and inanimate components of the
         project of course requires a reliable and thought-through architecture of control systems. Based on the
        <A href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b/">Raspberry Pi</A> single board computer, we devised a server / client system that manages actuation, measurement and
        intra-system interaction. Running on Raspbian Linux and written in Python3, both very well documented approaches
        for hardware - software interfaces, our system is highly adaptable, scalable and offers flexibility during the experimental
        development of new functionality. The wide availability and low cost of all the hardware components used in the
        control system of
         ties well into our concept of engineering without financial hurdles that could slow down or inhibit developement
        and innovation.

    </DIV></DIV><DIV class="section container"><H2 class="section-sub">The
         Server</H2><DIV class="section-text container"><P>
            Our server was built and programmed as the centerpiece of the control architecture that encompasses the bioreactor and measurement
            system of
             and as communication hub between scientists, reactor and robot. The single-board Raspberry Pi hardware platform
            that is present in all parts of the system is also the base of the server component. Connected to the
            other hardware components via the GPIO (general purpose input output) interface, and communicating with the robot
            and client via UDP, the server is the central information hub and controller of the system.
        </P><P>The server code controls the interaction modules, the measurement chambers and the communication with the robot in
            the arena. It listens for commands that are sent by either the robot or the client software and reacts by executing
            the following functions.
            </P><H3 class="section-sub-sub">Directly available
                    -Server functions activated by commands sent from client:</H3><UL class="list-group"><LI class="list-group-item"><CODE class="server-command">heat</CODE> Starts the heating module for 5 seconds.
                    </LI><LI class="list-group-item"><CODE class="server-command">pump_1</CODE> Start all pumps for 11 seconds (the length of one measure cycle) to flush the system
                        and fill it with fresh suspension from the reactor.
                    </LI><LI class="list-group-item"><CODE class="server-command">temp</CODE> Get the current temperature reading from the themperature sensor in the
                        <A href="https://2017.igem.org/Team:NAWI_Graz/TemperatureModule">Temperature Interaction Module</A>.
                    </LI><LI class="list-group-item"><CODE class="server-command">cam</CODE> Take a testpicture with the master camera and report the measurement result.
                    </LI><LI class="list-group-item"><CODE class="server-command">drive</CODE> Send out a
                        <CODE>drive</CODE> command to the Robot to test range and connection.
                    </LI><LI class="list-group-item"><CODE class="server-command">turn</CODE> Send out a
                        <CODE>turn</CODE> command to the Robot to calibrate the radius.
                    </LI></UL><DIV class="section-sub-text container"><B>Tab. 1: </B>List of commands and the corresponding functionality in the servercode.
                </DIV><P>
            In the case of a real experiment run in the temperature setup, the robot sends one of the following messages to the server
            according to its position and orientation in the arena and the sensor input it perceives. The server reacts by
            initiating the corresponding processes as described below.
            </P><H3 class="section-sub-sub">Robot - Server Interaction :</H3><UL class="list-group"><LI class="row list-group-item"><CODE class="col-1 server-command">clear</CODE><P class="col">The server starts a waiting loop to cool down the potentially still hot heating chamber to prevent tainting
                        the current run by previous runs. After this cool-down period, fresh suspension is pumped into
                        the measurement chamber and a baseline measurement is conducted. To prevent any unknown or outside
                        influences, another waiting loop, identical in duration to the activation heating period during a
                        run with activated temperature interaction, is started now. Finally, the suspension is pumped
                        into the measurement chamber and a measurement is taken. The baseline measurement and actual measurement
                        data is now compared and in case the difference surpasses a given threshold, the server sends the
                        <CODE>turn</CODE> command to the robot. Otherwise
                        <CODE>drive</CODE> sent to the robot to signal an open path ahead.</P></LI><DIV class="section-sub-text container"><B>Tab. 2: </B>List of commands for server interaction.
                </DIV><LI class="row list-group-item"><CODE class="col-1 server-command">obstacle</CODE><P class="col">The server starts with a cool-down period to prevent tainted measuring results. A baseline measurement
                        is made with fresh suspension. Fresh suspension is pumped into the temperature interaction module
                        and heated to target temperature. The heated and activated suspension is pumped into the measurement
                        chamber and a measurement is taken and compared to the baseline value. If the baseline and the actual
                        measurement have a difference equal or greater than the given threshold, the server sends the
                        <CODE>turn</CODE> command to the robot. Otherwise
                        <CODE>drive</CODE> sent to the robot to signal an open path ahead.
                        </P></LI></UL></DIV></DIV><DIV class="section container"><H2 class="section-sub">The
         Client</H2><DIV class="section-text container"><P>To be able to test all of the control systems functionality (pump control, heating, measurements) without having
            to actually run the full experiments, a small command line application was written in Python3. Intended to being
            run on any computer in the same network as the
             Server and
            <A class="intralink" href="https://2017.igem.org/Team:NAWI_Graz/Robot">Robot</A>, this application allowed us to conveniently send the above mentioned commands to the server for testing
            and verification of the componenets of the bioreactor setup and robot. Especially during the calibration of the
            interaction modules and pump cycle lengths, this little tool proved to be very useful.</P><P>The commands are sent and answers are received over
            <A href="https://en.wikipedia.org/wiki/User_Datagram_Protocol">UDP</A>, a common data transfer protocol. Although not reliable for critical communication because of missing
            error checking and guaranteed order of the packets arriving, for the small data packets we are sending here it
            is sufficient. </P><DIV class="section-text container"><P>
The  client code for testing the system functionality:


</P><DIV style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><TABLE><TBODY><TR><TD><PRE style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</PRE></TD><TD><PRE style="margin: 0; line-height: 125%"><SPAN style="color: #8f5902; font-style: italic">#!/usr/sbin/python3</SPAN><SPAN style="color: #8f5902; font-style: italic">#  ColiBot Client</SPAN><SPAN style="color: #8f5902; font-style: italic">#  -</SPAN><SPAN style="color: #8f5902; font-style: italic">#  A minimal udp messaging client to send (test) messages to the ColiBot server.</SPAN><SPAN style="color: #8f5902; font-style: italic">#</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">sys</SPAN><SPAN style="color: #8f5902; font-style: italic"># create datagram udp socket</SPAN><SPAN style="color: #204a87; font-weight: bold">try</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">AF_INET</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">SOCK_DGRAM</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">except</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">error</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #204a87">print</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Failed to create socket'</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">sys</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">exit</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">host</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'192.168.0.4'</SPAN><SPAN style="color: #000000">port</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">4343</SPAN><SPAN style="color: #204a87; font-weight: bold">while</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #000000">msg</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #204a87">input</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Enter message to send : '</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">try</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># Send string</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sendto</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87">str</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">encode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">msg</SPAN><SPAN style="color: #000000; font-weight: bold">),</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">host</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">port</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #8f5902; font-style: italic"># receive data from client (data, addr)</SPAN><SPAN style="color: #000000">d</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">recvfrom</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">1024</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">d</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #000000">addr</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">d</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #204a87">print</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Server reply : '</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #204a87">str</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #4e9a06">'turn'</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #204a87">print</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;Got 'turn' message.&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #4e9a06">'drive'</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #204a87">print</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;Got 'drive' message.&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">except</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">error</SPAN><SPAN style="color: #204a87; font-weight: bold">as</SPAN><SPAN style="color: #000000">e</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #204a87">print</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Socket Error: {}'</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">e</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">close</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">sys</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">exit</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">except</SPAN><SPAN style="color: #cc0000; font-weight: bold">KeyboardInterrupt</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">close</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">sys</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">exit</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN></PRE></TD></TR></TBODY></TABLE></DIV></DIV><DIV class="section-text container"><P>
The server code for controlling the bioreactor and measurement system:


</P><DIV style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><TABLE><TBODY><TR><TD><PRE style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364</PRE></TD><TD><PRE style="margin: 0; line-height: 125%"><SPAN style="color: #8f5902; font-style: italic">#! /usr/bin/python3</SPAN><SPAN style="color: #8f5902; font-style: italic">#    Simple udp socket server</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">calendar</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">datetime</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">logging</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">sys</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">RPi.GPIO</SPAN><SPAN style="color: #204a87; font-weight: bold">as</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">serial</SPAN><SPAN style="color: #204a87; font-weight: bold">from</SPAN><SPAN style="color: #000000">cam.colicam_master</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">ColiCamMaster</SPAN><SPAN style="color: #204a87; font-weight: bold">from</SPAN><SPAN style="color: #000000">cam.colicam_slave</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">ColiCamSlave</SPAN><SPAN style="color: #204a87; font-weight: bold">from</SPAN><SPAN style="color: #000000">w1thermsensor</SPAN><SPAN style="color: #204a87; font-weight: bold">import</SPAN><SPAN style="color: #000000">W1ThermSensor</SPAN><SPAN style="color: #8f5902; font-style: italic"># heater pins</SPAN><SPAN style="color: #000000">HEAT</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">40</SPAN><SPAN style="color: #000000">PORT</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">4343</SPAN><SPAN style="color: #8f5902; font-style: italic"># Arbitrary non-privileged port</SPAN><SPAN style="color: #000000">HOST</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">&quot;192.168.43.150&quot;</SPAN><SPAN style="color: #8f5902; font-style: italic"># Messages</SPAN><SPAN style="color: #000000">OBSTACLE</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'obstacle'</SPAN><SPAN style="color: #000000">CLEAR</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'clear'</SPAN><SPAN style="color: #000000">HEATING_TEST</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'heat'</SPAN><SPAN style="color: #000000">GET_TEMP</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'temp'</SPAN><SPAN style="color: #000000">PUMP_1_TEST</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'pump_1'</SPAN><SPAN style="color: #000000">CAM_TEST</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'cam'</SPAN><SPAN style="color: #000000">TURN</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'turn'</SPAN><SPAN style="color: #000000">DRIVE</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'drive'</SPAN><SPAN style="color: #8f5902; font-style: italic"># heating</SPAN><SPAN style="color: #000000">HEATING</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #000000">TARGET_TEMP</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">43</SPAN><SPAN style="color: #8f5902; font-style: italic"># degrees</SPAN><SPAN style="color: #000000">INTERVALL</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">8</SPAN><SPAN style="color: #8f5902; font-style: italic"># seconds</SPAN><SPAN style="color: #000000">HEATING_PERIOD</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">300</SPAN><SPAN style="color: #8f5902; font-style: italic"># seconds</SPAN><SPAN style="color: #8f5902; font-style: italic"># pump</SPAN><SPAN style="color: #000000">PUMP_IVALL</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">12</SPAN><SPAN style="color: #000000">DIFF_THRESHOLD</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">12</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">logging</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">getLogger</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'colibot'</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">get_temperature</SPAN><SPAN style="color: #000000; font-weight: bold">():</SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #8f5902; font-style: italic">    read temperature from sensor</SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #000000">sensor</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">W1ThermSensor</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">temp_c</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">sensor</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">get_temperature</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">return</SPAN><SPAN style="color: #000000">temp_c</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">heat</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #8f5902; font-style: italic">    GPIO 20 and 21</SPAN><SPAN style="color: #8f5902; font-style: italic">    HIGH = heating on</SPAN><SPAN style="color: #8f5902; font-style: italic">    LOW  = heating off</SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000">heat</SPAN><SPAN style="color: #204a87; font-weight: bold">is</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic">#logger.info(&quot;HEATING OFF&quot;)</SPAN><SPAN style="color: #000000">HEATING</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">output</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">HEAT</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">else</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic">#logger.info(&quot;HEATING ON&quot;)</SPAN><SPAN style="color: #000000">HEATING</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #204a87; font-weight: bold">True</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">output</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">HEAT</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">start_heating</SPAN><SPAN style="color: #000000; font-weight: bold">():</SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** Entering heating loop ...&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">while</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">get_temperature</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** Current temperature: &quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #204a87">str</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #ce5c00; font-weight: bold">&gt;=</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">TARGET_TEMP</SPAN><SPAN style="color: #ce5c00; font-weight: bold">-</SPAN><SPAN style="color: #0000cf; font-weight: bold">2</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** TARGET_TEMP reached!&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">break</SPAN><SPAN style="color: #000000; font-weight: bold">;</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87; font-weight: bold">True</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">15</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">heating_time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">HEATING_PERIOD</SPAN><SPAN style="color: #8f5902; font-style: italic"># seconds</SPAN><SPAN style="color: #000000">start</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">calendar</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">timegm</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">gmtime</SPAN><SPAN style="color: #000000; font-weight: bold">())</SPAN><SPAN style="color: #000000">end</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">start</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #000000">heating_time</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** activation period, keeping target temp for 5 mins:&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">remaining_time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">heating_time</SPAN><SPAN style="color: #204a87; font-weight: bold">while</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #8f5902; font-style: italic">#        logger.info(&quot;minutes left: &quot;+str( (end - calendar.timegm(time.gmtime()))/60   ) )</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000">calendar</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">timegm</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">gmtime</SPAN><SPAN style="color: #000000; font-weight: bold">())</SPAN><SPAN style="color: #ce5c00; font-weight: bold">&gt;=</SPAN><SPAN style="color: #000000">end</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #204a87; font-weight: bold">break</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">get_temperature</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #8f5902; font-style: italic">#        logger.info(&quot;--&gt;&quot;)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** Current temperature: &quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #204a87">str</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #ce5c00; font-weight: bold">&gt;=</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">TARGET_TEMP</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">10</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #ce5c00; font-weight: bold">&lt;</SPAN><SPAN style="color: #000000">TARGET_TEMP</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #8f5902; font-style: italic">#           logger.info(&quot;*** heating ...&quot;)</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87; font-weight: bold">True</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">5</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic">#if remaining_time % 60 == 0:</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;&gt; {} mins remaining.&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">remaining_time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">/</SPAN><SPAN style="color: #0000cf; font-weight: bold">60</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">5</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">remaining_time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">-=</SPAN><SPAN style="color: #0000cf; font-weight: bold">14</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">start_pump</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">seconds</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #8f5902; font-style: italic">    pump_1:</SPAN><SPAN style="color: #8f5902; font-style: italic">    pwms[0](11, 180)</SPAN><SPAN style="color: #8f5902; font-style: italic">    pin 13 </SPAN><SPAN style="color: #8f5902; font-style: italic">    pin 15 </SPAN><SPAN style="color: #8f5902; font-style: italic">    pump_2:</SPAN><SPAN style="color: #8f5902; font-style: italic">    pwms[1](19, 180)</SPAN><SPAN style="color: #8f5902; font-style: italic">    pin 21</SPAN><SPAN style="color: #8f5902; font-style: italic">    pin 23</SPAN><SPAN style="color: #8f5902; font-style: italic">    --&gt; ~1ml per second </SPAN><SPAN style="color: #8f5902; font-style: italic">&quot;&quot;&quot;</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** Starting pumps for {} seconds.&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87">str</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">seconds</SPAN><SPAN style="color: #000000; font-weight: bold">)))</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">start</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">100</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># out</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">start</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">100</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># in</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">seconds</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** Stopping pumps&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">stop</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">stop</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">take_measure</SPAN><SPAN style="color: #000000; font-weight: bold">():</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** Measuring ...&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">result</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">cam</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">measure</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">return</SPAN><SPAN style="color: #000000">result</SPAN><SPAN style="color: #000000; font-weight: bold">;</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">diff_results</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">bl</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">m</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #000000">r_diff</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #204a87">abs</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">bl</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #ce5c00; font-weight: bold">-</SPAN><SPAN style="color: #000000">m</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">])</SPAN><SPAN style="color: #000000">g_diff</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #204a87">abs</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">bl</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #ce5c00; font-weight: bold">-</SPAN><SPAN style="color: #000000">m</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">])</SPAN><SPAN style="color: #000000">b_diff</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #204a87">abs</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">bl</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">2</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #ce5c00; font-weight: bold">-</SPAN><SPAN style="color: #000000">m</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">2</SPAN><SPAN style="color: #000000; font-weight: bold">])</SPAN><SPAN style="color: #000000">diff</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">r_diff</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #000000">g_diff</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #000000">b_diff</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** Diff_results: r_diff={} g_diff={} b_diff={}&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">r_diff</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">g_diff</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">b_diff</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;*** total: {}&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">diff</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">diff</SPAN><SPAN style="color: #ce5c00; font-weight: bold">&gt;=</SPAN><SPAN style="color: #000000">DIFF_THRESHOLD</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #204a87; font-weight: bold">return</SPAN><SPAN style="color: #204a87; font-weight: bold">True</SPAN><SPAN style="color: #204a87; font-weight: bold">else</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #204a87; font-weight: bold">return</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">create_socket</SPAN><SPAN style="color: #000000; font-weight: bold">():</SPAN><SPAN style="color: #8f5902; font-style: italic"># Datagram (udp) socket</SPAN><SPAN style="color: #204a87; font-weight: bold">try</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">AF_INET</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">SOCK_DGRAM</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Socket created'</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">except</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">error</SPAN><SPAN style="color: #204a87; font-weight: bold">as</SPAN><SPAN style="color: #000000">msg</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">error</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Failed to create socket.'</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">cleanup</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">sys</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">exit</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #8f5902; font-style: italic"># Bind socket to local host and port</SPAN><SPAN style="color: #204a87; font-weight: bold">try</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">bind</SPAN><SPAN style="color: #000000; font-weight: bold">((</SPAN><SPAN style="color: #000000">HOST</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">PORT</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #204a87; font-weight: bold">except</SPAN><SPAN style="color: #000000">socket</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">error</SPAN><SPAN style="color: #204a87; font-weight: bold">as</SPAN><SPAN style="color: #000000">msg</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">error</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Bind failed. '</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">cleanup</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">sys</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">exit</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'Socket bind complete'</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">return</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">start_listening</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #8f5902; font-style: italic"># now keep talking with the client</SPAN><SPAN style="color: #204a87; font-weight: bold">try</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #204a87; font-weight: bold">while</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># receive data from client (data, addr)</SPAN><SPAN style="color: #000000">rec</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">recvfrom</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">1024</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">rec</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #000000">addr</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">rec</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;***&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">OBSTACLE</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'obstacle'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;recieved OBSTACLE: requesting colis and heating them to TARGET_TEMP...&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># wait for some time to cool of heating chamber</SPAN><SPAN style="color: #000000">cooldown</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">180</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;Waiting {} to cool chamber.&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">cooldown</SPAN><SPAN style="color: #ce5c00; font-weight: bold">/</SPAN><SPAN style="color: #0000cf; font-weight: bold">60</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">cooldown</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># fill chamber for baseline measureing</SPAN><SPAN style="color: #000000">start_pump</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">PUMP_IVALL</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># baseline</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">take_measure</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;baseline values: r{}, g{}, b{}&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">],</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">],</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">2</SPAN><SPAN style="color: #000000; font-weight: bold">]))</SPAN><SPAN style="color: #000000">start_heating</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #8f5902; font-style: italic"># activated to chamber</SPAN><SPAN style="color: #000000">start_pump</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">5</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;... start analyzing&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">measurement</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">take_measure</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">diff_results</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">measurement</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">is</SPAN><SPAN style="color: #204a87; font-weight: bold">True</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot; TURN !!.&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'turn'</SPAN><SPAN style="color: #204a87; font-weight: bold">else</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot; DRIVE !!.&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'drive'</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">CLEAR</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'clear'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;recieved CLEAR: requesting colis and start analyzing.&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># wait for some time to cool of heating chamber</SPAN><SPAN style="color: #000000">cooldown</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">180</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;Waiting {} to cool chamber.&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">cooldown</SPAN><SPAN style="color: #ce5c00; font-weight: bold">/</SPAN><SPAN style="color: #0000cf; font-weight: bold">60</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">cooldown</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># fill chamber for baseline measureing</SPAN><SPAN style="color: #000000">start_pump</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">PUMP_IVALL</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># baseline</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">take_measure</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;baseline values: r{}, g{}, b{}&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">],</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">],</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #0000cf; font-weight: bold">2</SPAN><SPAN style="color: #000000; font-weight: bold">]))</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;waiting loop: {} minutes.&quot;</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">format</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">HEATING_PERIOD</SPAN><SPAN style="color: #ce5c00; font-weight: bold">/</SPAN><SPAN style="color: #0000cf; font-weight: bold">60</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">HEATING_PERIOD</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">start_pump</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">5</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;... start analyzing&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">measurement</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">take_measure</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">diff_results</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">baseline</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">measurement</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">is</SPAN><SPAN style="color: #204a87; font-weight: bold">True</SPAN><SPAN style="color: #000000; font-weight: bold">):</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot; TURN !!&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'turn'</SPAN><SPAN style="color: #204a87; font-weight: bold">else</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'drive'</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">HEATING_TEST</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'heat'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;received HEATING_TEST&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'OK: HEATING TEST for 5 seconds ...'</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87; font-weight: bold">True</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">time</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sleep</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">5</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">PUMP_1_TEST</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'pump_1'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;received PUMP_1_TEST&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'OK: PUMPING TEST for 11 seconds (measure cycle)'</SPAN><SPAN style="color: #000000">start_pump</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">11</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">GET_TEMP</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'temp'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;received GET_TEMP&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">get_temperature</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'OK: temperature is '</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN> \
                    <SPAN style="color: #204a87">str</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">temp</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #4e9a06">' degree Celsius ...'</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">CAM_TEST</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'cam'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;received CAM_TEST&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">result</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">cam</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">measure</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'OK: Took pic, result = '</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #204a87">str</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">result</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">cam</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">exit_clean</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">DRIVE</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'drive'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;received DRIVE&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'drive'</SPAN><SPAN style="color: #204a87; font-weight: bold">elif</SPAN><SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #000000">TURN</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #8f5902; font-style: italic"># 'turn'</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;received TURN&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'turn'</SPAN><SPAN style="color: #204a87; font-weight: bold">else</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;invalid message&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'FAIL: ... invalid message: ['</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN> \
                    <SPAN style="color: #000000">data</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">decode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;utf-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #ce5c00; font-weight: bold">+</SPAN><SPAN style="color: #4e9a06">']'</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">sendto</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">reply</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">encode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;UTF-8&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">),</SPAN><SPAN style="color: #000000">addr</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;Sent message.&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># logger.info('Message[' + addr[0] + ':' +</SPAN><SPAN style="color: #8f5902; font-style: italic">#       str(addr[1]) + '] - ' + data.decode(&quot;utf-8&quot;))</SPAN><SPAN style="color: #204a87; font-weight: bold">except</SPAN><SPAN style="color: #cc0000; font-weight: bold">KeyboardInterrupt</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;Quitting.&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000">HEATING</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">toggle_heating</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #204a87; font-weight: bold">False</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">close</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">cleanup</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">cam</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">exit_clean</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">def</SPAN><SPAN style="color: #000000">main</SPAN><SPAN style="color: #000000; font-weight: bold">():</SPAN><SPAN style="color: #8f5902; font-style: italic"># format</SPAN><SPAN style="color: #000000">FORMAT</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">&quot;[%(asctime)s %(funcName)18s()]   %(message)s&quot;</SPAN><SPAN style="color: #000000">fileHandler</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">logging</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">FileHandler</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">'log.txt'</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">fileHandler</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setFormatter</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">logging</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">Formatter</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">FORMAT</SPAN><SPAN style="color: #000000; font-weight: bold">))</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">addHandler</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">fileHandler</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logging</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">basicConfig</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">level</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #0000cf; font-weight: bold">20</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #204a87">format</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">FORMAT</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">datefmt</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #4e9a06">'%d.%m.%Y %H:%M:%S'</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;Start logging&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic"># setup GPIO</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setmode</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">BOARD</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setup</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">HEAT</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">OUT</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">output</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">HEAT</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic">#pwm1</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setup</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">11</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">OUT</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setup</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">13</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">OUT</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setup</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">15</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">OUT</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">pwm1</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">PWM</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">11</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">220</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">output</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">13</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">output</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">15</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #8f5902; font-style: italic">#pwm2</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setup</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">29</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">OUT</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setup</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">31</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">OUT</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">setup</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">33</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">OUT</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">pwm2</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">PWM</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">29</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">220</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">output</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">31</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">0</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">GPIO</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">output</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #0000cf; font-weight: bold">33</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #0000cf; font-weight: bold">1</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000; font-weight: bold">[</SPAN><SPAN style="color: #000000">pwm1</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">pwm2</SPAN><SPAN style="color: #000000; font-weight: bold">]</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;###############################&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;   ColiBot Thermo udp_server   &quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;-------------------------------&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">create_socket</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;-------------------------------&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">logger</SPAN><SPAN style="color: #ce5c00; font-weight: bold">.</SPAN><SPAN style="color: #000000">info</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #4e9a06">&quot;...     start listening     ...&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">start_listening</SPAN><SPAN style="color: #000000; font-weight: bold">(</SPAN><SPAN style="color: #000000">sock</SPAN><SPAN style="color: #000000; font-weight: bold">,</SPAN><SPAN style="color: #000000">pwms</SPAN><SPAN style="color: #000000; font-weight: bold">)</SPAN><SPAN style="color: #000000">cam</SPAN><SPAN style="color: #ce5c00; font-weight: bold">=</SPAN><SPAN style="color: #000000">ColiCamMaster</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #000000">ColiCamSlave</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN><SPAN style="color: #204a87; font-weight: bold">if</SPAN><SPAN style="color: #000000">__name__</SPAN><SPAN style="color: #ce5c00; font-weight: bold">==</SPAN><SPAN style="color: #4e9a06">&quot;__main__&quot;</SPAN><SPAN style="color: #000000; font-weight: bold">:</SPAN><SPAN style="color: #000000">main</SPAN><SPAN style="color: #000000; font-weight: bold">()</SPAN></PRE></TD></TR></TBODY></TABLE></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></BODY></HTML>